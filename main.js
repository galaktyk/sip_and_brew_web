var GI=Object.defineProperty,qI=Object.defineProperties;var WI=Object.getOwnPropertyDescriptors;var Iw=Object.getOwnPropertySymbols;var $I=Object.prototype.hasOwnProperty,YI=Object.prototype.propertyIsEnumerable;var Tw=(i,e,t)=>e in i?GI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ne=(i,e)=>{for(var t in e||={})$I.call(e,t)&&Tw(i,t,e[t]);if(Iw)for(var t of Iw(e))YI.call(e,t)&&Tw(i,t,e[t]);return i},Ve=(i,e)=>qI(i,WI(e));var _e=(i,e,t)=>new Promise((n,r)=>{var o=l=>{try{a(t.next(l))}catch(c){r(c)}},s=l=>{try{a(t.throw(l))}catch(c){r(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(i,e)).next())});var Km;function fd(){return Km}function Sr(i){let e=Km;return Km=i,e}var Aw=Symbol("NotFound");function Da(i){return i===Aw||i?.name==="\u0275NotFound"}var Vn=null,md=!1,Qm=1,ZI=null,Bn=Symbol("SIGNAL");function qe(i){let e=Vn;return Vn=i,e}function _d(){return Vn}var Ia={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Ta(i){if(md)throw new Error("");if(Vn===null)return;Vn.consumerOnSignalRead(i);let e=Vn.producersTail;if(e!==void 0&&e.producer===i)return;let t,n=Vn.recomputing;if(n&&(t=e!==void 0?e.nextProducer:Vn.producers,t!==void 0&&t.producer===i)){Vn.producersTail=t,t.lastReadVersion=i.version;return}let r=i.consumersTail;if(r!==void 0&&r.consumer===Vn&&(!n||KI(r,Vn)))return;let o=Ra(Vn),s={producer:i,consumer:Vn,nextProducer:t,prevConsumer:r,lastReadVersion:i.version,nextConsumer:void 0};Vn.producersTail=s,e!==void 0?e.nextProducer=s:Vn.producers=s,o&&kw(i,s)}function Rw(){Qm++}function bd(i){if(!(Ra(i)&&!i.dirty)&&!(!i.dirty&&i.lastCleanEpoch===Qm)){if(!i.producerMustRecompute(i)&&!hc(i)){yd(i);return}i.producerRecomputeValue(i),yd(i)}}function Jm(i){if(i.consumers===void 0)return;let e=md;md=!0;try{for(let t=i.consumers;t!==void 0;t=t.nextConsumer){let n=t.consumer;n.dirty||XI(n)}}finally{md=e}}function eg(){return Vn?.consumerAllowSignalWrites!==!1}function XI(i){i.dirty=!0,Jm(i),i.consumerMarkedDirty?.(i)}function yd(i){i.dirty=!1,i.lastCleanEpoch=Qm}function Aa(i){return i&&Pw(i),qe(i)}function Pw(i){i.producersTail=void 0,i.recomputing=!0}function dc(i,e){qe(e),i&&Nw(i)}function Nw(i){i.recomputing=!1;let e=i.producersTail,t=e!==void 0?e.nextProducer:i.producers;if(t!==void 0){if(Ra(i))do t=tg(t);while(t!==void 0);e!==void 0?e.nextProducer=void 0:i.producers=void 0}}function hc(i){for(let e=i.producers;e!==void 0;e=e.nextProducer){let t=e.producer,n=e.lastReadVersion;if(n!==t.version||(bd(t),n!==t.version))return!0}return!1}function pc(i){if(Ra(i)){let e=i.producers;for(;e!==void 0;)e=tg(e)}i.producers=void 0,i.producersTail=void 0,i.consumers=void 0,i.consumersTail=void 0}function kw(i,e){let t=i.consumersTail,n=Ra(i);if(t!==void 0?(e.nextConsumer=t.nextConsumer,t.nextConsumer=e):(e.nextConsumer=void 0,i.consumers=e),e.prevConsumer=t,i.consumersTail=e,!n)for(let r=i.producers;r!==void 0;r=r.nextProducer)kw(r.producer,r)}function tg(i){let e=i.producer,t=i.nextProducer,n=i.nextConsumer,r=i.prevConsumer;if(i.nextConsumer=void 0,i.prevConsumer=void 0,n!==void 0?n.prevConsumer=r:e.consumersTail=r,r!==void 0)r.nextConsumer=n;else if(e.consumers=n,!Ra(e)){let o=e.producers;for(;o!==void 0;)o=tg(o)}return t}function Ra(i){return i.consumerIsAlwaysLive||i.consumers!==void 0}function wd(i){ZI?.(i)}function KI(i,e){let t=e.producersTail;if(t!==void 0){let n=e.producers;do{if(n===i)return!0;if(n===t)break;n=n.nextProducer}while(n!==void 0)}return!1}function xd(i,e){return Object.is(i,e)}function Sd(i,e){let t=Object.create(QI);t.computation=i,e!==void 0&&(t.equal=e);let n=()=>{if(bd(t),Ta(t),t.value===uc)throw t.error;return t.value};return n[Bn]=t,wd(t),n}var gd=Symbol("UNSET"),vd=Symbol("COMPUTING"),uc=Symbol("ERRORED"),QI=Ve(ne({},Ia),{value:gd,dirty:!0,error:null,equal:xd,kind:"computed",producerMustRecompute(i){return i.value===gd||i.value===vd},producerRecomputeValue(i){if(i.value===vd)throw new Error("");let e=i.value;i.value=vd;let t=Aa(i),n,r=!1;try{n=i.computation(),qe(null),r=e!==gd&&e!==uc&&n!==uc&&i.equal(e,n)}catch(o){n=uc,i.error=o}finally{dc(i,t)}if(r){i.value=e;return}i.value=n,i.version++}});function JI(){throw new Error}var Ow=JI;function Lw(i){Ow(i)}function ng(i){Ow=i}var eT=null;function ig(i,e){let t=Object.create(Cd);t.value=i,e!==void 0&&(t.equal=e);let n=()=>Fw(t);return n[Bn]=t,wd(t),[n,s=>Pa(t,s),s=>rg(t,s)]}function Fw(i){return Ta(i),i.value}function Pa(i,e){eg()||Lw(i),i.equal(i.value,e)||(i.value=e,tT(i))}function rg(i,e){eg()||Lw(i),Pa(i,e(i.value))}var Cd=Ve(ne({},Ia),{equal:xd,value:void 0,kind:"signal"});function tT(i){i.version++,Rw(),Jm(i),eT?.(i)}function Ye(i){return typeof i=="function"}function Na(i){let t=i(n=>{Error.call(n),n.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ed=Na(i=>function(t){i(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((n,r)=>`${r+1}) ${n.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function fc(i,e){if(i){let t=i.indexOf(e);0<=t&&i.splice(t,1)}}var an=class i{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let o of t)o.remove(this);else t.remove(this);let{initialTeardown:n}=this;if(Ye(n))try{n()}catch(o){e=o instanceof Ed?o.errors:[o]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let o of r)try{Vw(o)}catch(s){e=e??[],s instanceof Ed?e=[...e,...s.errors]:e.push(s)}}if(e)throw new Ed(e)}}add(e){var t;if(e&&e!==this)if(this.closed)Vw(e);else{if(e instanceof i){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&fc(t,e)}remove(e){let{_finalizers:t}=this;t&&fc(t,e),e instanceof i&&e._removeParent(this)}};an.EMPTY=(()=>{let i=new an;return i.closed=!0,i})();var og=an.EMPTY;function Md(i){return i instanceof an||i&&"closed"in i&&Ye(i.remove)&&Ye(i.add)&&Ye(i.unsubscribe)}function Vw(i){Ye(i)?i():i.unsubscribe()}var Ji={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var ka={setTimeout(i,e,...t){let{delegate:n}=ka;return n?.setTimeout?n.setTimeout(i,e,...t):setTimeout(i,e,...t)},clearTimeout(i){let{delegate:e}=ka;return(e?.clearTimeout||clearTimeout)(i)},delegate:void 0};function Dd(i){ka.setTimeout(()=>{let{onUnhandledError:e}=Ji;if(e)e(i);else throw i})}function mc(){}var Bw=sg("C",void 0,void 0);function zw(i){return sg("E",void 0,i)}function jw(i){return sg("N",i,void 0)}function sg(i,e,t){return{kind:i,value:e,error:t}}var As=null;function Oa(i){if(Ji.useDeprecatedSynchronousErrorHandling){let e=!As;if(e&&(As={errorThrown:!1,error:null}),i(),e){let{errorThrown:t,error:n}=As;if(As=null,t)throw n}}else i()}function Uw(i){Ji.useDeprecatedSynchronousErrorHandling&&As&&(As.errorThrown=!0,As.error=i)}var Rs=class extends an{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Md(e)&&e.add(this)):this.destination=rT}static create(e,t,n){return new La(e,t,n)}next(e){this.isStopped?lg(jw(e),this):this._next(e)}error(e){this.isStopped?lg(zw(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?lg(Bw,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},nT=Function.prototype.bind;function ag(i,e){return nT.call(i,e)}var cg=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(n){Id(n)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(n){Id(n)}else Id(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Id(t)}}},La=class extends Rs{constructor(e,t,n){super();let r;if(Ye(e)||!e)r={next:e??void 0,error:t??void 0,complete:n??void 0};else{let o;this&&Ji.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&ag(e.next,o),error:e.error&&ag(e.error,o),complete:e.complete&&ag(e.complete,o)}):r=e}this.destination=new cg(r)}};function Id(i){Ji.useDeprecatedSynchronousErrorHandling?Uw(i):Dd(i)}function iT(i){throw i}function lg(i,e){let{onStoppedNotification:t}=Ji;t&&ka.setTimeout(()=>t(i,e))}var rT={closed:!0,next:mc,error:iT,complete:mc};var Fa=typeof Symbol=="function"&&Symbol.observable||"@@observable";function yi(i){return i}function ug(...i){return dg(i)}function dg(i){return i.length===0?yi:i.length===1?i[0]:function(t){return i.reduce((n,r)=>r(n),t)}}var ct=(()=>{class i{constructor(t){t&&(this._subscribe=t)}lift(t){let n=new i;return n.source=this,n.operator=t,n}subscribe(t,n,r){let o=sT(t)?t:new La(t,n,r);return Oa(()=>{let{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(t){try{return this._subscribe(t)}catch(n){t.error(n)}}forEach(t,n){return n=Hw(n),new n((r,o)=>{let s=new La({next:a=>{try{t(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)}[Fa](){return this}pipe(...t){return dg(t)(this)}toPromise(t){return t=Hw(t),new t((n,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>n(o))})}}return i.create=e=>new i(e),i})();function Hw(i){var e;return(e=i??Ji.Promise)!==null&&e!==void 0?e:Promise}function oT(i){return i&&Ye(i.next)&&Ye(i.error)&&Ye(i.complete)}function sT(i){return i&&i instanceof Rs||oT(i)&&Md(i)}function hg(i){return Ye(i?.lift)}function mt(i){return e=>{if(hg(e))return e.lift(function(t){try{return i(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function dt(i,e,t,n,r){return new pg(i,e,t,n,r)}var pg=class extends Rs{constructor(e,t,n,r,o,s){super(e),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function Va(){return mt((i,e)=>{let t=null;i._refCount++;let n=dt(e,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount){t=null;return}let r=i._connection,o=t;t=null,r&&(!o||r===o)&&r.unsubscribe(),e.unsubscribe()});i.subscribe(n),n.closed||(t=i.connect())})}var Ba=class extends ct{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,hg(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new an;let t=this.getSubject();e.add(this.source.subscribe(dt(t,void 0,()=>{this._teardown(),t.complete()},n=>{this._teardown(),t.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=an.EMPTY)}return e}refCount(){return Va()(this)}};var Gw=Na(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Tt=(()=>{class i extends ct{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let n=new Td(this,this);return n.operator=t,n}_throwIfClosed(){if(this.closed)throw new Gw}next(t){Oa(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let n of this.currentObservers)n.next(t)}})}error(t){Oa(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:n}=this;for(;n.length;)n.shift().error(t)}})}complete(){Oa(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:n,isStopped:r,observers:o}=this;return n||r?og:(this.currentObservers=null,o.push(t),new an(()=>{this.currentObservers=null,fc(o,t)}))}_checkFinalizedStatuses(t){let{hasError:n,thrownError:r,isStopped:o}=this;n?t.error(r):o&&t.complete()}asObservable(){let t=new ct;return t.source=this,t}}return i.create=(e,t)=>new Td(e,t),i})(),Td=class extends Tt{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.next)===null||n===void 0||n.call(t,e)}error(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.error)===null||n===void 0||n.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,n;return(n=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&n!==void 0?n:og}};var st=class extends Tt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}};var si=new ct(i=>i.complete());function qw(i){return i&&Ye(i.schedule)}function Ww(i){return i[i.length-1]}function Ad(i){return Ye(Ww(i))?i.pop():void 0}function Go(i){return qw(Ww(i))?i.pop():void 0}function Yw(i,e,t,n){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(h){s(h)}}function l(u){try{c(n.throw(u))}catch(h){s(h)}}function c(u){u.done?o(u.value):r(u.value).then(a,l)}c((n=n.apply(i,e||[])).next())})}function $w(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ps(i){return this instanceof Ps?(this.v=i,this):new Ps(i)}function Zw(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(p){return function(g){return Promise.resolve(g).then(p,h)}}function a(p,g){n[p]&&(r[p]=function(f){return new Promise(function(m,v){o.push([p,f,m,v])>1||l(p,f)})},g&&(r[p]=g(r[p])))}function l(p,g){try{c(n[p](g))}catch(f){d(o[0][3],f)}}function c(p){p.value instanceof Ps?Promise.resolve(p.value.v).then(u,h):d(o[0][2],p)}function u(p){l("next",p)}function h(p){l("throw",p)}function d(p,g){p(g),o.shift(),o.length&&l(o[0][0],o[0][1])}}function Xw(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof $w=="function"?$w(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=i[o]&&function(s){return new Promise(function(a,l){s=i[o](s),r(a,l,s.done,s.value)})}}function r(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}var Rd=i=>i&&typeof i.length=="number"&&typeof i!="function";function Pd(i){return Ye(i?.then)}function Nd(i){return Ye(i[Fa])}function kd(i){return Symbol.asyncIterator&&Ye(i?.[Symbol.asyncIterator])}function Od(i){return new TypeError(`You provided ${i!==null&&typeof i=="object"?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function aT(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ld=aT();function Fd(i){return Ye(i?.[Ld])}function Vd(i){return Zw(this,arguments,function*(){let t=i.getReader();try{for(;;){let{value:n,done:r}=yield Ps(t.read());if(r)return yield Ps(void 0);yield yield Ps(n)}}finally{t.releaseLock()}})}function Bd(i){return Ye(i?.getReader)}function ln(i){if(i instanceof ct)return i;if(i!=null){if(Nd(i))return lT(i);if(Rd(i))return cT(i);if(Pd(i))return uT(i);if(kd(i))return Kw(i);if(Fd(i))return dT(i);if(Bd(i))return hT(i)}throw Od(i)}function lT(i){return new ct(e=>{let t=i[Fa]();if(Ye(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function cT(i){return new ct(e=>{for(let t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()})}function uT(i){return new ct(e=>{i.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Dd)})}function dT(i){return new ct(e=>{for(let t of i)if(e.next(t),e.closed)return;e.complete()})}function Kw(i){return new ct(e=>{pT(i,e).catch(t=>e.error(t))})}function hT(i){return Kw(Vd(i))}function pT(i,e){var t,n,r,o;return Yw(this,void 0,void 0,function*(){try{for(t=Xw(i);n=yield t.next(),!n.done;){let s=n.value;if(e.next(s),e.closed)return}}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=t.return)&&(yield o.call(t))}finally{if(r)throw r.error}}e.complete()})}function ai(i,e,t,n=0,r=!1){let o=e.schedule(function(){t(),r?i.add(this.schedule(null,n)):this.unsubscribe()},n);if(i.add(o),!r)return o}function zd(i,e=0){return mt((t,n)=>{t.subscribe(dt(n,r=>ai(n,i,()=>n.next(r),e),()=>ai(n,i,()=>n.complete(),e),r=>ai(n,i,()=>n.error(r),e)))})}function jd(i,e=0){return mt((t,n)=>{n.add(i.schedule(()=>t.subscribe(n),e))})}function Qw(i,e){return ln(i).pipe(jd(e),zd(e))}function Jw(i,e){return ln(i).pipe(jd(e),zd(e))}function ex(i,e){return new ct(t=>{let n=0;return e.schedule(function(){n===i.length?t.complete():(t.next(i[n++]),t.closed||this.schedule())})})}function tx(i,e){return new ct(t=>{let n;return ai(t,e,()=>{n=i[Ld](),ai(t,e,()=>{let r,o;try{({value:r,done:o}=n.next())}catch(s){t.error(s);return}o?t.complete():t.next(r)},0,!0)}),()=>Ye(n?.return)&&n.return()})}function Ud(i,e){if(!i)throw new Error("Iterable cannot be null");return new ct(t=>{ai(t,e,()=>{let n=i[Symbol.asyncIterator]();ai(t,e,()=>{n.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function nx(i,e){return Ud(Vd(i),e)}function ix(i,e){if(i!=null){if(Nd(i))return Qw(i,e);if(Rd(i))return ex(i,e);if(Pd(i))return Jw(i,e);if(kd(i))return Ud(i,e);if(Fd(i))return tx(i,e);if(Bd(i))return nx(i,e)}throw Od(i)}function Qt(i,e){return e?ix(i,e):ln(i)}function Be(...i){let e=Go(i);return Qt(i,e)}function za(i,e){let t=Ye(i)?i:()=>i,n=r=>r.error(t());return new ct(e?r=>e.schedule(n,0,r):n)}function fg(i){return!!i&&(i instanceof ct||Ye(i.lift)&&Ye(i.subscribe))}var ro=Na(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function ze(i,e){return mt((t,n)=>{let r=0;t.subscribe(dt(n,o=>{n.next(i.call(e,o,r++))}))})}var{isArray:fT}=Array;function mT(i,e){return fT(e)?i(...e):i(e)}function Hd(i){return ze(e=>mT(i,e))}var{isArray:gT}=Array,{getPrototypeOf:vT,prototype:yT,keys:_T}=Object;function Gd(i){if(i.length===1){let e=i[0];if(gT(e))return{args:e,keys:null};if(bT(e)){let t=_T(e);return{args:t.map(n=>e[n]),keys:t}}}return{args:i,keys:null}}function bT(i){return i&&typeof i=="object"&&vT(i)===yT}function qd(i,e){return i.reduce((t,n,r)=>(t[n]=e[r],t),{})}function Wd(...i){let e=Go(i),t=Ad(i),{args:n,keys:r}=Gd(i);if(n.length===0)return Qt([],e);let o=new ct(wT(n,e,r?s=>qd(r,s):yi));return t?o.pipe(Hd(t)):o}function wT(i,e,t=yi){return n=>{rx(e,()=>{let{length:r}=i,o=new Array(r),s=r,a=r;for(let l=0;l<r;l++)rx(e,()=>{let c=Qt(i[l],e),u=!1;c.subscribe(dt(n,h=>{o[l]=h,u||(u=!0,a--),a||n.next(t(o.slice()))},()=>{--s||n.complete()}))},n)},n)}}function rx(i,e,t){i?ai(t,i,e):e()}function ox(i,e,t,n,r,o,s,a){let l=[],c=0,u=0,h=!1,d=()=>{h&&!l.length&&!c&&e.complete()},p=f=>c<n?g(f):l.push(f),g=f=>{o&&e.next(f),c++;let m=!1;ln(t(f,u++)).subscribe(dt(e,v=>{r?.(v),o?p(v):e.next(v)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;l.length&&c<n;){let v=l.shift();s?ai(e,s,()=>g(v)):g(v)}d()}catch(v){e.error(v)}}))};return i.subscribe(dt(e,p,()=>{h=!0,d()})),()=>{a?.()}}function fn(i,e,t=1/0){return Ye(e)?fn((n,r)=>ze((o,s)=>e(n,o,r,s))(ln(i(n,r))),t):(typeof e=="number"&&(t=e),mt((n,r)=>ox(n,r,i,t)))}function sx(i=1/0){return fn(yi,i)}function ax(){return sx(1)}function ja(...i){return ax()(Qt(i,Go(i)))}function gc(i){return new ct(e=>{ln(i()).subscribe(e)})}function mg(...i){let e=Ad(i),{args:t,keys:n}=Gd(i),r=new ct(o=>{let{length:s}=t;if(!s){o.complete();return}let a=new Array(s),l=s,c=s;for(let u=0;u<s;u++){let h=!1;ln(t[u]).subscribe(dt(o,d=>{h||(h=!0,c--),a[u]=d},()=>l--,void 0,()=>{(!l||!h)&&(c||o.next(n?qd(n,a):a),o.complete())}))}});return e?r.pipe(Hd(e)):r}function zn(i,e){return mt((t,n)=>{let r=0;t.subscribe(dt(n,o=>i.call(e,o,r++)&&n.next(o)))})}function qo(i){return mt((e,t)=>{let n=null,r=!1,o;n=e.subscribe(dt(t,void 0,void 0,s=>{o=ln(i(s,qo(i)(e))),n?(n.unsubscribe(),n=null,o.subscribe(t)):r=!0})),r&&(n.unsubscribe(),n=null,o.subscribe(t))})}function lx(i,e,t,n,r){return(o,s)=>{let a=t,l=e,c=0;o.subscribe(dt(s,u=>{let h=c++;l=a?i(l,u,h):(a=!0,u),n&&s.next(l)},r&&(()=>{a&&s.next(l),s.complete()})))}}function Wo(i,e){return Ye(e)?fn(i,e,1):fn(i,1)}function $o(i){return mt((e,t)=>{let n=!1;e.subscribe(dt(t,r=>{n=!0,t.next(r)},()=>{n||t.next(i),t.complete()}))})}function oo(i){return i<=0?()=>si:mt((e,t)=>{let n=0;e.subscribe(dt(t,r=>{++n<=i&&(t.next(r),i<=n&&t.complete())}))})}function $d(i=xT){return mt((e,t)=>{let n=!1;e.subscribe(dt(t,r=>{n=!0,t.next(r)},()=>n?t.complete():t.error(i())))})}function xT(){return new ro}function Ns(i){return mt((e,t)=>{try{e.subscribe(t)}finally{t.add(i)}})}function so(i,e){let t=arguments.length>=2;return n=>n.pipe(i?zn((r,o)=>i(r,o,n)):yi,oo(1),t?$o(e):$d(()=>new ro))}function Ua(i){return i<=0?()=>si:mt((e,t)=>{let n=[];e.subscribe(dt(t,r=>{n.push(r),i<n.length&&n.shift()},()=>{for(let r of n)t.next(r);t.complete()},void 0,()=>{n=null}))})}function gg(i,e){let t=arguments.length>=2;return n=>n.pipe(i?zn((r,o)=>i(r,o,n)):yi,Ua(1),t?$o(e):$d(()=>new ro))}function vg(i,e){return mt(lx(i,e,arguments.length>=2,!0))}function yg(...i){let e=Go(i);return mt((t,n)=>{(e?ja(i,t,e):ja(i,t)).subscribe(n)})}function jn(i,e){return mt((t,n)=>{let r=null,o=0,s=!1,a=()=>s&&!r&&n.complete();t.subscribe(dt(n,l=>{r?.unsubscribe();let c=0,u=o++;ln(i(l,u)).subscribe(r=dt(n,h=>n.next(e?e(l,h,u,c++):h),()=>{r=null,a()}))},()=>{s=!0,a()}))})}function Ha(i){return mt((e,t)=>{ln(i).subscribe(dt(t,()=>t.complete(),mc)),!t.closed&&e.subscribe(t)})}function En(i,e,t){let n=Ye(i)||e||t?{next:i,error:e,complete:t}:i;return n?mt((r,o)=>{var s;(s=n.subscribe)===null||s===void 0||s.call(n);let a=!0;r.subscribe(dt(o,l=>{var c;(c=n.next)===null||c===void 0||c.call(n,l),o.next(l)},()=>{var l;a=!1,(l=n.complete)===null||l===void 0||l.call(n),o.complete()},l=>{var c;a=!1,(c=n.error)===null||c===void 0||c.call(n,l),o.error(l)},()=>{var l,c;a&&((l=n.unsubscribe)===null||l===void 0||l.call(n)),(c=n.finalize)===null||c===void 0||c.call(n)}))}):yi}function cx(i){let e=qe(null);try{return i()}finally{qe(e)}}var Kd="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",ue=class extends Error{code;constructor(e,t){super(qa(e,t)),this.code=e}};function ST(i){return`NG0${Math.abs(i)}`}function qa(i,e){return`${ST(i)}${e?": "+e:""}`}var Oi=globalThis;function Mt(i){for(let e in i)if(i[e]===Mt)return e;throw Error("")}function hx(i,e){for(let t in e)e.hasOwnProperty(t)&&!i.hasOwnProperty(t)&&(i[t]=e[t])}function lo(i){if(typeof i=="string")return i;if(Array.isArray(i))return`[${i.map(lo).join(", ")}]`;if(i==null)return""+i;let e=i.overriddenName||i.name;if(e)return`${e}`;let t=i.toString();if(t==null)return""+t;let n=t.indexOf(`
`);return n>=0?t.slice(0,n):t}function Ag(i,e){return i?e?`${i} ${e}`:i:e||""}var CT=Mt({__forward_ref__:Mt});function Li(i){return i.__forward_ref__=Li,i.toString=function(){return lo(this())},i}function Nn(i){return Rg(i)?i():i}function Rg(i){return typeof i=="function"&&i.hasOwnProperty(CT)&&i.__forward_ref__===Li}function he(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function Er(i){return{providers:i.providers||[],imports:i.imports||[]}}function bc(i){return ET(i,Qd)}function Pg(i){return bc(i)!==null}function ET(i,e){return i.hasOwnProperty(e)&&i[e]||null}function MT(i){let e=i?.[Qd]??null;return e||null}function bg(i){return i&&i.hasOwnProperty(Zd)?i[Zd]:null}var Qd=Mt({\u0275prov:Mt}),Zd=Mt({\u0275inj:Mt}),we=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=he({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function Ng(i){return i&&!!i.\u0275providers}var kg=Mt({\u0275cmp:Mt}),Og=Mt({\u0275dir:Mt}),Lg=Mt({\u0275pipe:Mt}),Fg=Mt({\u0275mod:Mt}),yc=Mt({\u0275fac:Mt}),Vs=Mt({__NG_ELEMENT_ID__:Mt}),ux=Mt({__NG_ENV_ID__:Mt});function Fi(i){return typeof i=="string"?i:i==null?"":String(i)}function px(i){return typeof i=="function"?i.name||i.toString():typeof i=="object"&&i!=null&&typeof i.type=="function"?i.type.name||i.type.toString():Fi(i)}var fx=Mt({ngErrorCode:Mt}),DT=Mt({ngErrorMessage:Mt}),IT=Mt({ngTokenPath:Mt});function Vg(i,e){return mx("",-200,e)}function Jd(i,e){throw new ue(-201,!1)}function mx(i,e,t){let n=new ue(e,i);return n[fx]=e,n[DT]=i,t&&(n[IT]=t),n}function TT(i){return i[fx]}var wg;function gx(){return wg}function Xn(i){let e=wg;return wg=i,e}function Bg(i,e,t){let n=bc(i);if(n&&n.providedIn=="root")return n.value===void 0?n.value=n.factory():n.value;if(t&8)return null;if(e!==void 0)return e;Jd(i,"Injector")}var AT={},ks=AT,RT="__NG_DI_FLAG__",xg=class{injector;constructor(e){this.injector=e}retrieve(e,t){let n=Os(t)||0;try{return this.injector.get(e,n&8?null:ks,n)}catch(r){if(Da(r))return r;throw r}}};function PT(i,e=0){let t=fd();if(t===void 0)throw new ue(-203,!1);if(t===null)return Bg(i,void 0,e);{let n=NT(e),r=t.retrieve(i,n);if(Da(r)){if(n.optional)return null;throw r}return r}}function Ce(i,e=0){return(gx()||PT)(Nn(i),e)}function oe(i,e){return Ce(i,Os(e))}function Os(i){return typeof i>"u"||typeof i=="number"?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function NT(i){return{optional:!!(i&8),host:!!(i&1),self:!!(i&2),skipSelf:!!(i&4)}}function Sg(i){let e=[];for(let t=0;t<i.length;t++){let n=Nn(i[t]);if(Array.isArray(n)){if(n.length===0)throw new ue(900,!1);let r,o=0;for(let s=0;s<n.length;s++){let a=n[s],l=kT(a);typeof l=="number"?l===-1?r=a.token:o|=l:r=a}e.push(Ce(r,o))}else e.push(Ce(n))}return e}function kT(i){return i[RT]}function Yo(i,e){let t=i.hasOwnProperty(yc);return t?i[yc]:null}function vx(i,e,t){if(i.length!==e.length)return!1;for(let n=0;n<i.length;n++){let r=i[n],o=e[n];if(t&&(r=t(r),o=t(o)),o!==r)return!1}return!0}function yx(i){return i.flat(Number.POSITIVE_INFINITY)}function eh(i,e){i.forEach(t=>Array.isArray(t)?eh(t,e):e(t))}function zg(i,e,t){e>=i.length?i.push(t):i.splice(e,0,t)}function wc(i,e){return e>=i.length-1?i.pop():i.splice(e,1)[0]}function _x(i,e,t,n){let r=i.length;if(r==e)i.push(t,n);else if(r===1)i.push(n,i[0]),i[0]=t;else{for(r--,i.push(i[r-1],i[r]);r>e;){let o=r-2;i[r]=i[o],r--}i[e]=t,i[e+1]=n}}function bx(i,e,t){let n=Wa(i,e);return n>=0?i[n|1]=t:(n=~n,_x(i,n,e,t)),n}function th(i,e){let t=Wa(i,e);if(t>=0)return i[t|1]}function Wa(i,e){return OT(i,e,1)}function OT(i,e,t){let n=0,r=i.length>>t;for(;r!==n;){let o=n+(r-n>>1),s=i[o<<t];if(e===s)return o<<t;s>e?r=o:n=o+1}return~(r<<t)}var Ko={},_i=[],Mr=new we(""),jg=new we("",-1),Ug=new we(""),_c=class{get(e,t=ks){if(t===ks){let r=mx("",-201);throw r.name="\u0275NotFound",r}return t}};function Hg(i){return i[Fg]||null}function Qo(i){return i[kg]||null}function Gg(i){return i[Og]||null}function wx(i){return i[Lg]||null}function Dr(i){return{\u0275providers:i}}function xx(i){return Dr([{provide:Mr,multi:!0,useValue:i}])}function Sx(...i){return{\u0275providers:qg(!0,i),\u0275fromNgModule:!0}}function qg(i,...e){let t=[],n=new Set,r,o=s=>{t.push(s)};return eh(e,s=>{let a=s;Xd(a,o,[],n)&&(r||=[],r.push(a))}),r!==void 0&&Cx(r,o),t}function Cx(i,e){for(let t=0;t<i.length;t++){let{ngModule:n,providers:r}=i[t];Wg(r,o=>{e(o,n)})}}function Xd(i,e,t,n){if(i=Nn(i),!i)return!1;let r=null,o=bg(i),s=!o&&Qo(i);if(!o&&!s){let l=i.ngModule;if(o=bg(l),o)r=l;else return!1}else{if(s&&!s.standalone)return!1;r=i}let a=n.has(r);if(s){if(a)return!1;if(n.add(r),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)Xd(c,e,t,n)}}else if(o){if(o.imports!=null&&!a){n.add(r);let c;try{eh(o.imports,u=>{Xd(u,e,t,n)&&(c||=[],c.push(u))})}finally{}c!==void 0&&Cx(c,e)}if(!a){let c=Yo(r)||(()=>new r);e({provide:r,useFactory:c,deps:_i},r),e({provide:Ug,useValue:r,multi:!0},r),e({provide:Mr,useValue:()=>Ce(r),multi:!0},r)}let l=o.providers;if(l!=null&&!a){let c=i;Wg(l,u=>{e(u,c)})}}else return!1;return r!==i&&i.providers!==void 0}function Wg(i,e){for(let t of i)Ng(t)&&(t=t.\u0275providers),Array.isArray(t)?Wg(t,e):e(t)}var LT=Mt({provide:String,useValue:Mt});function Ex(i){return i!==null&&typeof i=="object"&&LT in i}function FT(i){return!!(i&&i.useExisting)}function VT(i){return!!(i&&i.useFactory)}function Ls(i){return typeof i=="function"}function Mx(i){return!!i.useClass}var xc=new we(""),Yd={},dx={},_g;function Sc(){return _g===void 0&&(_g=new _c),_g}var mn=class{},Fs=class extends mn{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,n,r){super(),this.parent=t,this.source=n,this.scopes=r,Eg(e,s=>this.processProvider(s)),this.records.set(jg,Ga(void 0,this)),r.has("environment")&&this.records.set(mn,Ga(void 0,this));let o=this.records.get(xc);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(Ug,_i,{self:!0}))}retrieve(e,t){let n=Os(t)||0;try{return this.get(e,ks,n)}catch(r){if(Da(r))return r;throw r}}destroy(){vc(this),this._destroyed=!0;let e=qe(null);try{for(let n of this._ngOnDestroyHooks)n.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),qe(e)}}onDestroy(e){return vc(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){vc(this);let t=Sr(this),n=Xn(void 0),r;try{return e()}finally{Sr(t),Xn(n)}}get(e,t=ks,n){if(vc(this),e.hasOwnProperty(ux))return e[ux](this);let r=Os(n),o,s=Sr(this),a=Xn(void 0);try{if(!(r&4)){let c=this.records.get(e);if(c===void 0){let u=HT(e)&&bc(e);u&&this.injectableDefInScope(u)?c=Ga(Cg(e),Yd):c=null,this.records.set(e,c)}if(c!=null)return this.hydrate(e,c,r)}let l=r&2?Sc():this.parent;return t=r&8&&t===ks?null:t,l.get(e,t)}catch(l){let c=TT(l);throw c===-200||c===-201?new ue(c,null):l}finally{Xn(a),Sr(s)}}resolveInjectorInitializers(){let e=qe(null),t=Sr(this),n=Xn(void 0),r;try{let o=this.get(Mr,_i,{self:!0});for(let s of o)s()}finally{Sr(t),Xn(n),qe(e)}}toString(){let e=[],t=this.records;for(let n of t.keys())e.push(lo(n));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=Nn(e);let t=Ls(e)?e:Nn(e&&e.provide),n=zT(e);if(!Ls(e)&&e.multi===!0){let r=this.records.get(t);r||(r=Ga(void 0,Yd,!0),r.factory=()=>Sg(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,n)}hydrate(e,t,n){let r=qe(null);try{if(t.value===dx)throw Vg(lo(e));return t.value===Yd&&(t.value=dx,t.value=t.factory(void 0,n)),typeof t.value=="object"&&t.value&&UT(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{qe(r)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Nn(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function Cg(i){let e=bc(i),t=e!==null?e.factory:Yo(i);if(t!==null)return t;if(i instanceof we)throw new ue(204,!1);if(i instanceof Function)return BT(i);throw new ue(204,!1)}function BT(i){if(i.length>0)throw new ue(204,!1);let t=MT(i);return t!==null?()=>t.factory(i):()=>new i}function zT(i){if(Ex(i))return Ga(void 0,i.useValue);{let e=$g(i);return Ga(e,Yd)}}function $g(i,e,t){let n;if(Ls(i)){let r=Nn(i);return Yo(r)||Cg(r)}else if(Ex(i))n=()=>Nn(i.useValue);else if(VT(i))n=()=>i.useFactory(...Sg(i.deps||[]));else if(FT(i))n=(r,o)=>Ce(Nn(i.useExisting),o!==void 0&&o&8?8:void 0);else{let r=Nn(i&&(i.useClass||i.provide));if(jT(i))n=()=>new r(...Sg(i.deps));else return Yo(r)||Cg(r)}return n}function vc(i){if(i.destroyed)throw new ue(205,!1)}function Ga(i,e,t=!1){return{factory:i,value:e,multi:t?[]:void 0}}function jT(i){return!!i.deps}function UT(i){return i!==null&&typeof i=="object"&&typeof i.ngOnDestroy=="function"}function HT(i){return typeof i=="function"||typeof i=="object"&&i.ngMetadataName==="InjectionToken"}function Eg(i,e){for(let t of i)Array.isArray(t)?Eg(t,e):t&&Ng(t)?Eg(t.\u0275providers,e):e(t)}function kn(i,e){let t;i instanceof Fs?(vc(i),t=i):t=new xg(i);let n,r=Sr(t),o=Xn(void 0);try{return e()}finally{Sr(r),Xn(o)}}function Dx(){return gx()!==void 0||fd()!=null}var er=0,Re=1,$e=2,gn=3,Vi=4,Bi=5,$a=6,Ya=7,on=8,Za=9,Ir=10,Lt=11,Xa=12,Yg=13,Bs=14,bi=15,Jo=16,zs=17,Tr=18,Cc=19,Zg=20,ao=21,nh=22,Ec=23,wi=24,ih=25,On=26,Yt=27,Ix=1,Xg=6,es=7,Mc=8,js=9,cn=10;function Ar(i){return Array.isArray(i)&&typeof i[Ix]=="object"}function tr(i){return Array.isArray(i)&&i[Ix]===!0}function Kg(i){return(i.flags&4)!==0}function ts(i){return i.componentOffset>-1}function Ka(i){return(i.flags&1)===1}function Rr(i){return!!i.template}function Qa(i){return(i[$e]&512)!==0}function Us(i){return(i[$e]&256)===256}var Tx="svg",Ax="math";function zi(i){for(;Array.isArray(i);)i=i[er];return i}function Qg(i,e){return zi(e[i])}function nr(i,e){return zi(e[i.index])}function Dc(i,e){return i.data[e]}function rh(i,e){return i[e]}function Jg(i,e,t,n){t>=i.data.length&&(i.data[t]=null,i.blueprint[t]=null),e[t]=n}function ji(i,e){let t=e[i];return Ar(t)?t:t[er]}function Rx(i){return(i[$e]&4)===4}function oh(i){return(i[$e]&128)===128}function Px(i){return tr(i[gn])}function Ui(i,e){return e==null?null:i[e]}function ev(i){i[zs]=0}function tv(i){i[$e]&1024||(i[$e]|=1024,oh(i)&&Tc(i))}function Nx(i,e){for(;i>0;)e=e[Bs],i--;return e}function Ic(i){return!!(i[$e]&9216||i[wi]?.dirty)}function sh(i){i[Ir].changeDetectionScheduler?.notify(8),i[$e]&64&&(i[$e]|=1024),Ic(i)&&Tc(i)}function Tc(i){i[Ir].changeDetectionScheduler?.notify(0);let e=Zo(i);for(;e!==null&&!(e[$e]&8192||(e[$e]|=8192,!oh(e)));)e=Zo(e)}function nv(i,e){if(Us(i))throw new ue(911,!1);i[ao]===null&&(i[ao]=[]),i[ao].push(e)}function kx(i,e){if(i[ao]===null)return;let t=i[ao].indexOf(e);t!==-1&&i[ao].splice(t,1)}function Zo(i){let e=i[gn];return tr(e)?e[gn]:e}function iv(i){return i[Ya]??=[]}function rv(i){return i.cleanup??=[]}function Ox(i,e,t,n){let r=iv(e);r.push(t),i.firstCreatePass&&rv(i).push(n,r.length-1)}var it={lFrame:Yx(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var Mg=!1;function Lx(){return it.lFrame.elementDepthCount}function Fx(){it.lFrame.elementDepthCount++}function ov(){it.lFrame.elementDepthCount--}function ah(){return it.bindingsEnabled}function Vx(){return it.skipHydrationRootTNode!==null}function sv(i){return it.skipHydrationRootTNode===i}function av(){it.skipHydrationRootTNode=null}function je(){return it.lFrame.lView}function Jt(){return it.lFrame.tView}function ve(i){return it.lFrame.contextLView=i,i[on]}function ye(i){return it.lFrame.contextLView=null,i}function Ln(){let i=lv();for(;i!==null&&i.type===64;)i=i.parent;return i}function lv(){return it.lFrame.currentTNode}function Bx(){let i=it.lFrame,e=i.currentTNode;return i.isParent?e:e.parent}function Ja(i,e){let t=it.lFrame;t.currentTNode=i,t.isParent=e}function cv(){return it.lFrame.isParent}function zx(){it.lFrame.isParent=!1}function jx(){return it.lFrame.contextLView}function uv(){return Mg}function dv(i){let e=Mg;return Mg=i,e}function el(){let i=it.lFrame,e=i.bindingRootIndex;return e===-1&&(e=i.bindingRootIndex=i.tView.bindingStartIndex),e}function hv(){return it.lFrame.bindingIndex}function Ux(i){return it.lFrame.bindingIndex=i}function ns(){return it.lFrame.bindingIndex++}function lh(i){let e=it.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+i,t}function Hx(){return it.lFrame.inI18n}function Gx(i,e){let t=it.lFrame;t.bindingIndex=t.bindingRootIndex=i,ch(e)}function qx(){return it.lFrame.currentDirectiveIndex}function ch(i){it.lFrame.currentDirectiveIndex=i}function Wx(i){let e=it.lFrame.currentDirectiveIndex;return e===-1?null:i[e]}function pv(){return it.lFrame.currentQueryIndex}function uh(i){it.lFrame.currentQueryIndex=i}function GT(i){let e=i[Re];return e.type===2?e.declTNode:e.type===1?i[Bi]:null}function fv(i,e,t){if(t&4){let r=e,o=i;for(;r=r.parent,r===null&&!(t&1);)if(r=GT(o),r===null||(o=o[Bs],r.type&10))break;if(r===null)return!1;e=r,i=o}let n=it.lFrame=$x();return n.currentTNode=e,n.lView=i,!0}function dh(i){let e=$x(),t=i[Re];it.lFrame=e,e.currentTNode=t.firstChild,e.lView=i,e.tView=t,e.contextLView=i,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function $x(){let i=it.lFrame,e=i===null?null:i.child;return e===null?Yx(i):e}function Yx(i){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return i!==null&&(i.child=e),e}function Zx(){let i=it.lFrame;return it.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var mv=Zx;function hh(){let i=Zx();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Xx(i){return(it.lFrame.contextLView=Nx(i,it.lFrame.contextLView))[on]}function Pr(){return it.lFrame.selectedIndex}function is(i){it.lFrame.selectedIndex=i}function Ac(){let i=it.lFrame;return Dc(i.tView,i.selectedIndex)}function Kx(){return it.lFrame.currentNamespace}var Qx=!0;function ph(){return Qx}function Rc(i){Qx=i}function Dg(i,e=null,t=null,n){let r=gv(i,e,t,n);return r.resolveInjectorInitializers(),r}function gv(i,e=null,t=null,n,r=new Set){let o=[t||_i,Sx(i)];return n=n||(typeof i=="object"?void 0:lo(i)),new Fs(o,e||Sc(),n||null,r)}var ki=class i{static THROW_IF_NOT_FOUND=ks;static NULL=new _c;static create(e,t){if(Array.isArray(e))return Dg({name:""},t,e,"");{let n=e.name??"";return Dg({name:n},e.parent,e.providers,n)}}static \u0275prov=he({token:i,providedIn:"any",factory:()=>Ce(jg)});static __NG_ELEMENT_ID__=-1},Bt=new we(""),co=(()=>{class i{static __NG_ELEMENT_ID__=qT;static __NG_ENV_ID__=t=>t}return i})(),Ig=class extends co{_lView;constructor(e){super(),this._lView=e}get destroyed(){return Us(this._lView)}onDestroy(e){let t=this._lView;return nv(t,e),()=>kx(t,e)}};function qT(){return new Ig(je())}var Cr=class{_console=console;handleError(e){this._console.error("ERROR",e)}},Kn=new we("",{providedIn:"root",factory:()=>{let i=oe(mn),e;return t=>{i.destroyed&&!e?setTimeout(()=>{throw t}):(e??=i.get(Cr),e.handleError(t))}}}),Jx={provide:Mr,useValue:()=>void oe(Cr),multi:!0},WT=new we("",{providedIn:"root",factory:()=>{let i=oe(Bt).defaultView;if(!i)return;let e=oe(Kn),t=o=>{e(o.reason),o.preventDefault()},n=o=>{o.error?e(o.error):e(new Error(o.message,{cause:o})),o.preventDefault()},r=()=>{i.addEventListener("unhandledrejection",t),i.addEventListener("error",n)};typeof Zone<"u"?Zone.root.run(r):r(),oe(co).onDestroy(()=>{i.removeEventListener("error",n),i.removeEventListener("unhandledrejection",t)})}});function vv(){return Dr([xx(()=>void oe(WT))])}function yv(i){return typeof i=="function"&&i[Bn]!==void 0}function at(i,e){let[t,n,r]=ig(i,e?.equal),o=t,s=o[Bn];return o.set=n,o.update=r,o.asReadonly=eS.bind(o),o}function eS(){let i=this[Bn];if(i.readonlyFn===void 0){let e=()=>this();e[Bn]=i,i.readonlyFn=e}return i.readonlyFn}function _v(i){return yv(i)&&typeof i.set=="function"}var Xo=class{},tl=new we("",{providedIn:"root",factory:()=>!1});var bv=new we(""),wv=new we("");var Nr=(()=>{class i{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new st(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new ct(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=he({token:i,providedIn:"root",factory:()=>new i})}return i})(),fh=(()=>{class i{internalPendingTasks=oe(Nr);scheduler=oe(Xo);errorHandler=oe(Kn);add(){let t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){let n=this.add();t().catch(this.errorHandler).finally(n)}static \u0275prov=he({token:i,providedIn:"root",factory:()=>new i})}return i})();function Pc(...i){}var xv=(()=>{class i{static \u0275prov=he({token:i,providedIn:"root",factory:()=>new Tg})}return i})(),Tg=class{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){let t=e.zone,n=this.queues.get(t);n.has(e)&&(n.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){let t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);let n=this.queues.get(t);n.has(e)||n.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(let[t,n]of this.queues)t===null?e||=this.flushQueue(n):e||=t.run(()=>this.flushQueue(n));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(let n of e)n.dirty&&(this.dirtyEffectCount--,t=!0,n.run());return t}};function jc(i){return{toString:i}.toString()}function tA(i){return typeof i=="function"}var Eh=class{previousValue;currentValue;firstChange;constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}};function OS(i,e,t,n){e!==null?e.applyValueToInputSignal(e,n):i[t]=n}var po=(()=>{let i=()=>LS;return i.ngInherit=!0,i})();function LS(i){return i.type.prototype.ngOnChanges&&(i.setInput=iA),nA}function nA(){let i=VS(this),e=i?.current;if(e){let t=i.previous;if(t===Ko)i.previous=e;else for(let n in e)t[n]=e[n];i.current=null,this.ngOnChanges(e)}}function iA(i,e,t,n,r){let o=this.declaredInputs[n],s=VS(i)||rA(i,{previous:Ko,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[o];a[o]=new Eh(c&&c.currentValue,t,l===Ko),OS(i,e,r,t)}var FS="__ngSimpleChanges__";function VS(i){return i[FS]||null}function rA(i,e){return i[FS]=e}var tS=[];var Ot=function(i,e=null,t){for(let n=0;n<tS.length;n++){let r=tS[n];r(i,e,t)}};function oA(i,e,t){let{ngOnChanges:n,ngOnInit:r,ngDoCheck:o}=e.type.prototype;if(n){let s=LS(e);(t.preOrderHooks??=[]).push(i,s),(t.preOrderCheckHooks??=[]).push(i,s)}r&&(t.preOrderHooks??=[]).push(0-i,r),o&&((t.preOrderHooks??=[]).push(i,o),(t.preOrderCheckHooks??=[]).push(i,o))}function BS(i,e){for(let t=e.directiveStart,n=e.directiveEnd;t<n;t++){let o=i.data[t].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=o;s&&(i.contentHooks??=[]).push(-t,s),a&&((i.contentHooks??=[]).push(t,a),(i.contentCheckHooks??=[]).push(t,a)),l&&(i.viewHooks??=[]).push(-t,l),c&&((i.viewHooks??=[]).push(t,c),(i.viewCheckHooks??=[]).push(t,c)),u!=null&&(i.destroyHooks??=[]).push(t,u)}}function bh(i,e,t){zS(i,e,3,t)}function wh(i,e,t,n){(i[$e]&3)===t&&zS(i,e,t,n)}function Sv(i,e){let t=i[$e];(t&3)===e&&(t&=16383,t+=1,i[$e]=t)}function zS(i,e,t,n){let r=n!==void 0?i[zs]&65535:0,o=n??-1,s=e.length-1,a=0;for(let l=r;l<s;l++)if(typeof e[l+1]=="number"){if(a=e[l],n!=null&&a>=n)break}else e[l]<0&&(i[zs]+=65536),(a<o||o==-1)&&(sA(i,t,e,l),i[zs]=(i[zs]&4294901760)+l+2),l++}function nS(i,e){Ot(4,i,e);let t=qe(null);try{e.call(i)}finally{qe(t),Ot(5,i,e)}}function sA(i,e,t,n){let r=t[n]<0,o=t[n+1],s=r?-t[n]:t[n],a=i[s];r?i[$e]>>14<i[zs]>>16&&(i[$e]&3)===e&&(i[$e]+=16384,nS(a,o)):nS(a,o)}var il=-1,Gs=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,n,r){this.factory=e,this.name=r,this.canSeeViewProviders=t,this.injectImpl=n}};function aA(i){return(i.flags&8)!==0}function lA(i){return(i.flags&16)!==0}function cA(i,e,t){let n=0;for(;n<t.length;){let r=t[n];if(typeof r=="number"){if(r!==0)break;n++;let o=t[n++],s=t[n++],a=t[n++];i.setAttribute(e,s,a,o)}else{let o=r,s=t[++n];dA(o)?i.setProperty(e,o,s):i.setAttribute(e,o,s),n++}}return n}function uA(i){return i===3||i===4||i===6}function dA(i){return i.charCodeAt(0)===64}function rl(i,e){if(!(e===null||e.length===0))if(i===null||i.length===0)i=e.slice();else{let t=-1;for(let n=0;n<e.length;n++){let r=e[n];typeof r=="number"?t=r:t===0||(t===-1||t===2?iS(i,t,r,null,e[++n]):iS(i,t,r,null,null))}}return i}function iS(i,e,t,n,r){let o=0,s=i.length;if(e===-1)s=-1;else for(;o<i.length;){let a=i[o++];if(typeof a=="number"){if(a===e){s=-1;break}else if(a>e){s=o-1;break}}}for(;o<i.length;){let a=i[o];if(typeof a=="number")break;if(a===t){r!==null&&(i[o+1]=r);return}o++,r!==null&&o++}s!==-1&&(i.splice(s,0,e),o=s+1),i.splice(o++,0,t),r!==null&&i.splice(o++,0,r)}function jS(i){return i!==il}function Mh(i){return i&32767}function hA(i){return i>>16}function Dh(i,e){let t=hA(i),n=e;for(;t>0;)n=n[Bs],t--;return n}var kv=!0;function Ih(i){let e=kv;return kv=i,e}var pA=256,US=pA-1,HS=5,fA=0,kr={};function mA(i,e,t){let n;typeof t=="string"?n=t.charCodeAt(0)||0:t.hasOwnProperty(Vs)&&(n=t[Vs]),n==null&&(n=t[Vs]=fA++);let r=n&US,o=1<<r;e.data[i+(r>>HS)]|=o}function Th(i,e){let t=GS(i,e);if(t!==-1)return t;let n=e[Re];n.firstCreatePass&&(i.injectorIndex=e.length,Cv(n.data,i),Cv(e,null),Cv(n.blueprint,null));let r=_0(i,e),o=i.injectorIndex;if(jS(r)){let s=Mh(r),a=Dh(r,e),l=a[Re].data;for(let c=0;c<8;c++)e[o+c]=a[s+c]|l[s+c]}return e[o+8]=r,o}function Cv(i,e){i.push(0,0,0,0,0,0,0,0,e)}function GS(i,e){return i.injectorIndex===-1||i.parent&&i.parent.injectorIndex===i.injectorIndex||e[i.injectorIndex+8]===null?-1:i.injectorIndex}function _0(i,e){if(i.parent&&i.parent.injectorIndex!==-1)return i.parent.injectorIndex;let t=0,n=null,r=e;for(;r!==null;){if(n=ZS(r),n===null)return il;if(t++,r=r[Bs],n.injectorIndex!==-1)return n.injectorIndex|t<<16}return il}function Ov(i,e,t){mA(i,e,t)}function qS(i,e,t){if(t&8||i!==void 0)return i;Jd(e,"NodeInjector")}function WS(i,e,t,n){if(t&8&&n===void 0&&(n=null),(t&3)===0){let r=i[Za],o=Xn(void 0);try{return r?r.get(e,n,t&8):Bg(e,n,t&8)}finally{Xn(o)}}return qS(n,e,t)}function $S(i,e,t,n=0,r){if(i!==null){if(e[$e]&2048&&!(n&2)){let s=_A(i,e,t,n,kr);if(s!==kr)return s}let o=YS(i,e,t,n,kr);if(o!==kr)return o}return WS(e,t,n,r)}function YS(i,e,t,n,r){let o=vA(t);if(typeof o=="function"){if(!fv(e,i,n))return n&1?qS(r,t,n):WS(e,t,n,r);try{let s;if(s=o(n),s==null&&!(n&8))Jd(t);else return s}finally{mv()}}else if(typeof o=="number"){let s=null,a=GS(i,e),l=il,c=n&1?e[bi][Bi]:null;for((a===-1||n&4)&&(l=a===-1?_0(i,e):e[a+8],l===il||!oS(n,!1)?a=-1:(s=e[Re],a=Mh(l),e=Dh(l,e)));a!==-1;){let u=e[Re];if(rS(o,a,u.data)){let h=gA(a,e,t,s,n,c);if(h!==kr)return h}l=e[a+8],l!==il&&oS(n,e[Re].data[a+8]===c)&&rS(o,a,e)?(s=u,a=Mh(l),e=Dh(l,e)):a=-1}}return r}function gA(i,e,t,n,r,o){let s=e[Re],a=s.data[i+8],l=n==null?ts(a)&&kv:n!=s&&(a.type&3)!==0,c=r&1&&o===a,u=xh(a,s,t,l,c);return u!==null?Oc(e,s,u,a,r):kr}function xh(i,e,t,n,r){let o=i.providerIndexes,s=e.data,a=o&1048575,l=i.directiveStart,c=i.directiveEnd,u=o>>20,h=n?a:a+u,d=r?a+u:c;for(let p=h;p<d;p++){let g=s[p];if(p<l&&t===g||p>=l&&g.type===t)return p}if(r){let p=s[l];if(p&&Rr(p)&&p.type===t)return l}return null}function Oc(i,e,t,n,r){let o=i[t],s=e.data;if(o instanceof Gs){let a=o;if(a.resolving){let p=px(s[t]);throw Vg(p)}let l=Ih(a.canSeeViewProviders);a.resolving=!0;let c=s[t].type||s[t],u,h=a.injectImpl?Xn(a.injectImpl):null,d=fv(i,n,0);try{o=i[t]=a.factory(void 0,r,s,i,n),e.firstCreatePass&&t>=n.directiveStart&&oA(t,s[t],e)}finally{h!==null&&Xn(h),Ih(l),a.resolving=!1,mv()}}return o}function vA(i){if(typeof i=="string")return i.charCodeAt(0)||0;let e=i.hasOwnProperty(Vs)?i[Vs]:void 0;return typeof e=="number"?e>=0?e&US:yA:e}function rS(i,e,t){let n=1<<i;return!!(t[e+(i>>HS)]&n)}function oS(i,e){return!(i&2)&&!(i&1&&e)}var Hs=class{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return $S(this._tNode,this._lView,e,Os(n),t)}};function yA(){return new Hs(Ln(),je())}function ss(i){return jc(()=>{let e=i.prototype.constructor,t=e[yc]||Lv(e),n=Object.prototype,r=Object.getPrototypeOf(i.prototype).constructor;for(;r&&r!==n;){let o=r[yc]||Lv(r);if(o&&o!==t)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function Lv(i){return Rg(i)?()=>{let e=Lv(Nn(i));return e&&e()}:Yo(i)}function _A(i,e,t,n,r){let o=i,s=e;for(;o!==null&&s!==null&&s[$e]&2048&&!Qa(s);){let a=YS(o,s,t,n|2,kr);if(a!==kr)return a;let l=o.parent;if(!l){let c=s[Zg];if(c){let u=c.get(t,kr,n);if(u!==kr)return u}l=ZS(s),s=s[Bs]}o=l}return r}function ZS(i){let e=i[Re],t=e.type;return t===2?e.declTNode:t===1?i[Bi]:null}function bA(){return ll(Ln(),je())}function ll(i,e){return new Fn(nr(i,e))}var Fn=(()=>{class i{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=bA}return i})();function wA(i){return i instanceof Fn?i.nativeElement:i}function xA(){return this._results[Symbol.iterator]()}var Ah=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Tt}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let n=yx(e);(this._changesDetected=!vx(this._results,n,t))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=xA};function XS(i){return(i.flags&128)===128}var b0=(function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i})(b0||{}),KS=new Map,SA=0;function CA(){return SA++}function EA(i){KS.set(i[Cc],i)}function Fv(i){KS.delete(i[Cc])}var sS="__ngContext__";function ol(i,e){Ar(e)?(i[sS]=e[Cc],EA(e)):i[sS]=e}function QS(i){return eC(i[Xa])}function JS(i){return eC(i[Vi])}function eC(i){for(;i!==null&&!tr(i);)i=i[Vi];return i}var Vv;function w0(i){Vv=i}function x0(){if(Vv!==void 0)return Vv;if(typeof document<"u")return document;throw new ue(210,!1)}var qh=new we("",{providedIn:"root",factory:()=>MA}),MA="ng",Wh=new we(""),cl=new we("",{providedIn:"platform",factory:()=>"unknown"});var $h=new we("",{providedIn:"root",factory:()=>x0().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var DA="h",IA="b";var tC="r";var nC="di";var iC=!1,rC=new we("",{providedIn:"root",factory:()=>iC});var TA=(i,e,t,n)=>{};function AA(i,e,t,n){TA(i,e,t,n)}function S0(i){return(i.flags&32)===32}var RA=()=>null;function oC(i,e,t=!1){return RA(i,e,t)}function sC(i,e){let t=i.contentQueries;if(t!==null){let n=qe(null);try{for(let r=0;r<t.length;r+=2){let o=t[r],s=t[r+1];if(s!==-1){let a=i.data[s];uh(o),a.contentQueries(2,e[s],s)}}}finally{qe(n)}}}function Bv(i,e,t){uh(0);let n=qe(null);try{e(i,t)}finally{qe(n)}}function C0(i,e,t){if(Kg(e)){let n=qe(null);try{let r=e.directiveStart,o=e.directiveEnd;for(let s=r;s<o;s++){let a=i.data[s];if(a.contentQueries){let l=t[s];a.contentQueries(1,l,s)}}}finally{qe(n)}}}var uo=(function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i})(uo||{}),mh;function PA(){if(mh===void 0&&(mh=null,Oi.trustedTypes))try{mh=Oi.trustedTypes.createPolicy("angular",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return mh}function Yh(i){return PA()?.createHTML(i)||i}var gh;function NA(){if(gh===void 0&&(gh=null,Oi.trustedTypes))try{gh=Oi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return gh}function aS(i){return NA()?.createHTML(i)||i}var ho=class{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Kd})`}},zv=class extends ho{getTypeName(){return"HTML"}},jv=class extends ho{getTypeName(){return"Style"}},Uv=class extends ho{getTypeName(){return"Script"}},Hv=class extends ho{getTypeName(){return"URL"}},Gv=class extends ho{getTypeName(){return"ResourceURL"}};function Or(i){return i instanceof ho?i.changingThisBreaksApplicationSecurity:i}function fo(i,e){let t=aC(i);if(t!=null&&t!==e){if(t==="ResourceURL"&&e==="URL")return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${Kd})`)}return t===e}function aC(i){return i instanceof ho&&i.getTypeName()||null}function E0(i){return new zv(i)}function M0(i){return new jv(i)}function D0(i){return new Uv(i)}function I0(i){return new Hv(i)}function T0(i){return new Gv(i)}function kA(i){let e=new Wv(i);return OA()?new qv(e):e}var qv=class{inertDocumentHelper;constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{let t=new window.DOMParser().parseFromString(Yh(e),"text/html").body;return t===null?this.inertDocumentHelper.getInertBodyElement(e):(t.firstChild?.remove(),t)}catch{return null}}},Wv=class{defaultDoc;inertDocument;constructor(e){this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(e){let t=this.inertDocument.createElement("template");return t.innerHTML=Yh(e),t}};function OA(){try{return!!new window.DOMParser().parseFromString(Yh(""),"text/html")}catch{return!1}}var LA=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Uc(i){return i=String(i),i.match(LA)?i:"unsafe:"+i}function mo(i){let e={};for(let t of i.split(","))e[t]=!0;return e}function Hc(...i){let e={};for(let t of i)for(let n in t)t.hasOwnProperty(n)&&(e[n]=!0);return e}var lC=mo("area,br,col,hr,img,wbr"),cC=mo("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),uC=mo("rp,rt"),FA=Hc(uC,cC),VA=Hc(cC,mo("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),BA=Hc(uC,mo("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),lS=Hc(lC,VA,BA,FA),dC=mo("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),zA=mo("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),jA=mo("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),UA=Hc(dC,zA,jA),HA=mo("script,style,template"),$v=class{sanitizedSomething=!1;buf=[];sanitizeChildren(e){let t=e.firstChild,n=!0,r=[];for(;t;){if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild){r.push(t),t=WA(t);continue}for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let o=qA(t);if(o){t=o;break}t=r.pop()}}return this.buf.join("")}startElement(e){let t=cS(e).toLowerCase();if(!lS.hasOwnProperty(t))return this.sanitizedSomething=!0,!HA.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);let n=e.attributes;for(let r=0;r<n.length;r++){let o=n.item(r),s=o.name,a=s.toLowerCase();if(!UA.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let l=o.value;dC[a]&&(l=Uc(l)),this.buf.push(" ",s,'="',uS(l),'"')}return this.buf.push(">"),!0}endElement(e){let t=cS(e).toLowerCase();lS.hasOwnProperty(t)&&!lC.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(uS(e))}};function GA(i,e){return(i.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function qA(i){let e=i.nextSibling;if(e&&i!==e.previousSibling)throw hC(e);return e}function WA(i){let e=i.firstChild;if(e&&GA(i,e))throw hC(e);return e}function cS(i){let e=i.nodeName;return typeof e=="string"?e:"FORM"}function hC(i){return new Error(`Failed to sanitize html because the element is clobbered: ${i.outerHTML}`)}var $A=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,YA=/([^\#-~ |!])/g;function uS(i){return i.replace(/&/g,"&amp;").replace($A,function(e){let t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+((t-55296)*1024+(n-56320)+65536)+";"}).replace(YA,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var vh;function Zh(i,e){let t=null;try{vh=vh||kA(i);let n=e?String(e):"";t=vh.getInertBodyElement(n);let r=5,o=n;do{if(r===0)throw new Error("Failed to sanitize html because the input is unstable");r--,n=o,o=t.innerHTML,t=vh.getInertBodyElement(n)}while(n!==o);let a=new $v().sanitizeChildren(dS(t)||t);return Yh(a)}finally{if(t){let n=dS(t)||t;for(;n.firstChild;)n.firstChild.remove()}}}function dS(i){return"content"in i&&ZA(i)?i.content:null}function ZA(i){return i.nodeType===Node.ELEMENT_NODE&&i.nodeName==="TEMPLATE"}var sr=(function(i){return i[i.NONE=0]="NONE",i[i.HTML=1]="HTML",i[i.STYLE=2]="STYLE",i[i.SCRIPT=3]="SCRIPT",i[i.URL=4]="URL",i[i.RESOURCE_URL=5]="RESOURCE_URL",i})(sr||{});function Ys(i){let e=pC();return e?aS(e.sanitize(sr.HTML,i)||""):fo(i,"HTML")?aS(Or(i)):Zh(x0(),Fi(i))}function xi(i){let e=pC();return e?e.sanitize(sr.URL,i)||"":fo(i,"URL")?Or(i):Uc(Fi(i))}function pC(){let i=je();return i&&i[Ir].sanitizer}var XA=/^>|^->|<!--|-->|--!>|<!-$/g,KA=/(<|>)/g,QA="\u200B$1\u200B";function JA(i){return i.replace(XA,e=>e.replace(KA,QA))}function Zs(i){return i.ownerDocument.defaultView}function Si(i){return i.ownerDocument}function fC(i){return i instanceof Function?i():i}function eR(i,e,t){let n=i.length;for(;;){let r=i.indexOf(e,t);if(r===-1)return r;if(r===0||i.charCodeAt(r-1)<=32){let o=e.length;if(r+o===n||i.charCodeAt(r+o)<=32)return r}t=r+1}}var mC="ng-template";function tR(i,e,t,n){let r=0;if(n){for(;r<e.length&&typeof e[r]=="string";r+=2)if(e[r]==="class"&&eR(e[r+1].toLowerCase(),t,0)!==-1)return!0}else if(A0(i))return!1;if(r=e.indexOf(1,r),r>-1){let o;for(;++r<e.length&&typeof(o=e[r])=="string";)if(o.toLowerCase()===t)return!0}return!1}function A0(i){return i.type===4&&i.value!==mC}function nR(i,e,t){let n=i.type===4&&!t?mC:i.value;return e===n}function iR(i,e,t){let n=4,r=i.attrs,o=r!==null?sR(r):0,s=!1;for(let a=0;a<e.length;a++){let l=e[a];if(typeof l=="number"){if(!s&&!ir(n)&&!ir(l))return!1;if(s&&ir(l))continue;s=!1,n=l|n&1;continue}if(!s)if(n&4){if(n=2|n&1,l!==""&&!nR(i,l,t)||l===""&&e.length===1){if(ir(n))return!1;s=!0}}else if(n&8){if(r===null||!tR(i,r,l,t)){if(ir(n))return!1;s=!0}}else{let c=e[++a],u=rR(l,r,A0(i),t);if(u===-1){if(ir(n))return!1;s=!0;continue}if(c!==""){let h;if(u>o?h="":h=r[u+1].toLowerCase(),n&2&&c!==h){if(ir(n))return!1;s=!0}}}}return ir(n)||s}function ir(i){return(i&1)===0}function rR(i,e,t,n){if(e===null)return-1;let r=0;if(n||!t){let o=!1;for(;r<e.length;){let s=e[r];if(s===i)return r;if(s===3||s===6)o=!0;else if(s===1||s===2){let a=e[++r];for(;typeof a=="string";)a=e[++r];continue}else{if(s===4)break;if(s===0){r+=4;continue}}r+=o?1:2}return-1}else return aR(e,i)}function oR(i,e,t=!1){for(let n=0;n<e.length;n++)if(iR(i,e[n],t))return!0;return!1}function sR(i){for(let e=0;e<i.length;e++){let t=i[e];if(uA(t))return e}return i.length}function aR(i,e){let t=i.indexOf(4);if(t>-1)for(t++;t<i.length;){let n=i[t];if(typeof n=="number")return-1;if(n===e)return t;t++}return-1}function hS(i,e){return i?":not("+e.trim()+")":e}function lR(i){let e=i[0],t=1,n=2,r="",o=!1;for(;t<i.length;){let s=i[t];if(typeof s=="string")if(n&2){let a=i[++t];r+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else n&8?r+="."+s:n&4&&(r+=" "+s);else r!==""&&!ir(s)&&(e+=hS(o,r),r=""),n=s,o=o||!ir(n);t++}return r!==""&&(e+=hS(o,r)),e}function cR(i){return i.map(lR).join(",")}function uR(i){let e=[],t=[],n=1,r=2;for(;n<i.length;){let o=i[n];if(typeof o=="string")r===2?o!==""&&e.push(o,i[++n]):r===8&&t.push(o);else{if(!ir(r))break;r=o}n++}return t.length&&e.push(1,...t),e}var Qn={};function dR(i,e){return i.createText(e)}function hR(i,e,t){i.setValue(e,t)}function pR(i,e){return i.createComment(JA(e))}function gC(i,e,t){return i.createElement(e,t)}function Rh(i,e,t,n,r){i.insertBefore(e,t,n,r)}function vC(i,e,t){i.appendChild(e,t)}function pS(i,e,t,n,r){n!==null?Rh(i,e,t,n,r):vC(i,e,t)}function yC(i,e,t,n){i.removeChild(null,e,t,n)}function fR(i,e,t){i.setAttribute(e,"style",t)}function mR(i,e,t){t===""?i.removeAttribute(e,"class"):i.setAttribute(e,"class",t)}function _C(i,e,t){let{mergedAttrs:n,classes:r,styles:o}=t;n!==null&&cA(i,e,n),r!==null&&mR(i,e,r),o!==null&&fR(i,e,o)}function R0(i,e,t,n,r,o,s,a,l,c,u){let h=Yt+n,d=h+r,p=gR(h,d),g=typeof c=="function"?c():c;return p[Re]={type:i,blueprint:p,template:t,queries:null,viewQuery:a,declTNode:e,data:p.slice().fill(null,h),bindingStartIndex:h,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:g,incompleteFirstPass:!1,ssrId:u}}function gR(i,e){let t=[];for(let n=0;n<e;n++)t.push(n<i?null:Qn);return t}function vR(i){let e=i.tView;return e===null||e.incompleteFirstPass?i.tView=R0(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):e}function P0(i,e,t,n,r,o,s,a,l,c,u){let h=e.blueprint.slice();return h[er]=r,h[$e]=n|4|128|8|64|1024,(c!==null||i&&i[$e]&2048)&&(h[$e]|=2048),ev(h),h[gn]=h[Bs]=i,h[on]=t,h[Ir]=s||i&&i[Ir],h[Lt]=a||i&&i[Lt],h[Za]=l||i&&i[Za]||null,h[Bi]=o,h[Cc]=CA(),h[$a]=u,h[Zg]=c,h[bi]=e.type==2?i[bi]:h,h}function yR(i,e,t){let n=nr(e,i),r=vR(t),o=i[Ir].rendererFactory,s=N0(i,P0(i,r,null,bC(t),n,e,null,o.createRenderer(n,t),null,null,null));return i[e.index]=s}function bC(i){let e=16;return i.signals?e=4096:i.onPush&&(e=64),e}function wC(i,e,t,n){if(t===0)return-1;let r=e.length;for(let o=0;o<t;o++)e.push(n),i.blueprint.push(n),i.data.push(null);return r}function N0(i,e){return i[Xa]?i[Yg][Vi]=e:i[Xa]=e,i[Yg]=e,e}function P(i=1){xC(Jt(),je(),Pr()+i,!1)}function xC(i,e,t,n){if(!n)if((e[$e]&3)===3){let o=i.preOrderCheckHooks;o!==null&&bh(e,o,t)}else{let o=i.preOrderHooks;o!==null&&wh(e,o,0,t)}is(t)}var Xh=(function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i})(Xh||{});function Yv(i,e,t,n){let r=qe(null);try{let[o,s,a]=i.inputs[t],l=null;(s&Xh.SignalBased)!==0&&(l=e[o][Bn]),l!==null&&l.transformFn!==void 0?n=l.transformFn(n):a!==null&&(n=a.call(e,n)),i.setInput!==null?i.setInput(e,l,n,t,o):OS(e,l,o,n)}finally{qe(r)}}var rr=(function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i})(rr||{}),_R;function k0(i,e){return _R(i,e)}var Kh=new Set;function nl(i,e,t,n,r,o){if(n!=null){let s,a=!1;tr(n)?s=n:Ar(n)&&(a=!0,n=n[er]);let l=zi(n);i===0&&t!==null?r==null?vC(e,t,l):Rh(e,t,l,r||null,!0):i===1&&t!==null?Rh(e,t,l,r||null,!0):i===2?fS(o,c=>{yC(e,l,a,c)}):i===3&&fS(o,()=>{e.destroyNode(l)}),s!=null&&PR(e,i,s,t,r)}}function bR(i,e){SC(i,e),e[er]=null,e[Bi]=null}function wR(i,e,t,n,r,o){n[er]=r,n[Bi]=e,Jh(i,n,t,1,r,o)}function SC(i,e){e[Ir].changeDetectionScheduler?.notify(9),Jh(i,e,e[Lt],2,null,null)}function xR(i){let e=i[Xa];if(!e)return Ev(i[Re],i);for(;e;){let t=null;if(Ar(e))t=e[Xa];else{let n=e[cn];n&&(t=n)}if(!t){for(;e&&!e[Vi]&&e!==i;)Ar(e)&&Ev(e[Re],e),e=e[gn];e===null&&(e=i),Ar(e)&&Ev(e[Re],e),t=e&&e[Vi]}e=t}}function O0(i,e){let t=i[js],n=t.indexOf(e);t.splice(n,1)}function Qh(i,e){if(Us(e))return;let t=e[Lt];t.destroyNode&&Jh(i,e,t,3,null,null),xR(e)}function Ev(i,e){if(Us(e))return;let t=qe(null);try{e[$e]&=-129,e[$e]|=256,e[wi]&&pc(e[wi]),ER(i,e),CR(i,e),e[Re].type===1&&e[Lt].destroy();let n=e[Jo];if(n!==null&&tr(e[gn])){n!==e[gn]&&O0(n,e);let r=e[Tr];r!==null&&r.detachView(i)}Fv(e)}finally{qe(t)}}function fS(i,e){if(i&&i[On]&&i[On].leave)if(i[On].skipLeaveAnimations)i[On].skipLeaveAnimations=!1;else{let t=i[On].leave,n=[];for(let r=0;r<t.length;r++){let o=t[r];n.push(o())}i[On].running=Promise.allSettled(n),i[On].leave=void 0}SR(i,e)}function SR(i,e){if(i&&i[On]&&i[On].running){i[On].running.then(()=>{i[On]&&i[On].running&&(i[On].running=void 0),Kh.delete(i),e(!0)});return}e(!1)}function CR(i,e){let t=i.cleanup,n=e[Ya];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let a=t[s+3];a>=0?n[a]():n[-a].unsubscribe(),s+=2}else{let a=n[t[s+1]];t[s].call(a)}n!==null&&(e[Ya]=null);let r=e[ao];if(r!==null){e[ao]=null;for(let s=0;s<r.length;s++){let a=r[s];a()}}let o=e[Ec];if(o!==null){e[Ec]=null;for(let s of o)s.destroy()}}function ER(i,e){let t;if(i!=null&&(t=i.destroyHooks)!=null)for(let n=0;n<t.length;n+=2){let r=e[t[n]];if(!(r instanceof Gs)){let o=t[n+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){let a=r[o[s]],l=o[s+1];Ot(4,a,l);try{l.call(a)}finally{Ot(5,a,l)}}else{Ot(4,r,o);try{o.call(r)}finally{Ot(5,r,o)}}}}}function MR(i,e,t){return DR(i,e.parent,t)}function DR(i,e,t){let n=e;for(;n!==null&&n.type&168;)e=n,n=e.parent;if(n===null)return t[er];if(ts(n)){let{encapsulation:r}=i.data[n.directiveStart+n.componentOffset];if(r===uo.None||r===uo.Emulated)return null}return nr(n,t)}function IR(i,e,t){return AR(i,e,t)}function TR(i,e,t){return i.type&40?nr(i,t):null}var AR=TR,mS;function L0(i,e,t,n){let r=MR(i,n,e),o=e[Lt],s=n.parent||e[Bi],a=IR(s,n,e);if(r!=null)if(Array.isArray(t))for(let l=0;l<t.length;l++)pS(o,r,t[l],a,!1);else pS(o,r,t,a,!1);mS!==void 0&&mS(o,n,e,t,r)}function Nc(i,e){if(e!==null){let t=e.type;if(t&3)return nr(e,i);if(t&4)return Zv(-1,i[e.index]);if(t&8){let n=e.child;if(n!==null)return Nc(i,n);{let r=i[e.index];return tr(r)?Zv(-1,r):zi(r)}}else{if(t&128)return Nc(i,e.next);if(t&32)return k0(e,i)()||zi(i[e.index]);{let n=CC(i,e);if(n!==null){if(Array.isArray(n))return n[0];let r=Zo(i[bi]);return Nc(r,n)}else return Nc(i,e.next)}}}return null}function CC(i,e){if(e!==null){let n=i[bi][Bi],r=e.projection;return n.projection[r]}return null}function Zv(i,e){let t=cn+i+1;if(t<e.length){let n=e[t],r=n[Re].firstChild;if(r!==null)return Nc(n,r)}return e[es]}function F0(i,e,t,n,r,o,s){for(;t!=null;){if(t.type===128){t=t.next;continue}let a=n[t.index],l=t.type;if(s&&e===0&&(a&&ol(zi(a),n),t.flags|=2),!S0(t))if(l&8)F0(i,e,t.child,n,r,o,!1),nl(e,i,r,a,o,n);else if(l&32){let c=k0(t,n),u;for(;u=c();)nl(e,i,r,u,o,n);nl(e,i,r,a,o,n)}else l&16?RR(i,e,n,t,r,o):nl(e,i,r,a,o,n);t=s?t.projectionNext:t.next}}function Jh(i,e,t,n,r,o){F0(t,n,i.firstChild,e,r,o,!1)}function RR(i,e,t,n,r,o){let s=t[bi],l=s[Bi].projection[n.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];nl(e,i,r,u,o,t)}else{let c=l,u=s[gn];XS(n)&&(c.flags|=128),F0(i,e,c,u,r,o,!0)}}function PR(i,e,t,n,r){let o=t[es],s=zi(t);o!==s&&nl(e,i,n,o,r);for(let a=cn;a<t.length;a++){let l=t[a];Jh(l[Re],l,i,e,n,o)}}function NR(i,e,t,n,r){if(e)r?i.addClass(t,n):i.removeClass(t,n);else{let o=n.indexOf("-")===-1?void 0:rr.DashCase;r==null?i.removeStyle(t,n,o):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=rr.Important),i.setStyle(t,n,r,o))}}function EC(i,e,t,n,r){let o=Pr(),s=n&2;try{is(-1),s&&e.length>Yt&&xC(i,e,Yt,!1),Ot(s?2:0,r,t),t(n,r)}finally{is(o),Ot(s?3:1,r,t)}}function ep(i,e,t){BR(i,e,t),(t.flags&64)===64&&zR(i,e,t)}function Gc(i,e,t=nr){let n=e.localNames;if(n!==null){let r=e.index+1;for(let o=0;o<n.length;o+=2){let s=n[o+1],a=s===-1?t(e,i):i[s];i[r++]=a}}}function kR(i,e,t,n){let o=n.get(rC,iC)||t===uo.ShadowDom,s=i.selectRootElement(e,o);return OR(s),s}function OR(i){LR(i)}var LR=()=>null;function FR(i){return i==="class"?"className":i==="for"?"htmlFor":i==="formaction"?"formAction":i==="innerHtml"?"innerHTML":i==="readonly"?"readOnly":i==="tabindex"?"tabIndex":i}function MC(i,e,t,n,r,o){let s=e[Re];if(j0(i,s,e,t,n)){ts(i)&&VR(e,i.index);return}i.type&3&&(t=FR(t)),DC(i,e,t,n,r,o)}function DC(i,e,t,n,r,o){if(i.type&3){let s=nr(i,e);n=o!=null?o(n,i.value||"",t):n,r.setProperty(s,t,n)}else i.type&12}function VR(i,e){let t=ji(e,i);t[$e]&16||(t[$e]|=64)}function BR(i,e,t){let n=t.directiveStart,r=t.directiveEnd;ts(t)&&yR(e,t,i.data[n+t.componentOffset]),i.firstCreatePass||Th(t,e);let o=t.initialInputs;for(let s=n;s<r;s++){let a=i.data[s],l=Oc(e,i,s,t);if(ol(l,e),o!==null&&GR(e,s-n,l,a,t,o),Rr(a)){let c=ji(t.index,e);c[on]=Oc(e,i,s,t)}}}function zR(i,e,t){let n=t.directiveStart,r=t.directiveEnd,o=t.index,s=qx();try{is(o);for(let a=n;a<r;a++){let l=i.data[a],c=e[a];ch(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&jR(l,c)}}finally{is(-1),ch(s)}}function jR(i,e){i.hostBindings!==null&&i.hostBindings(1,e)}function V0(i,e){let t=i.directiveRegistry,n=null;if(t)for(let r=0;r<t.length;r++){let o=t[r];oR(e,o.selectors,!1)&&(n??=[],Rr(o)?n.unshift(o):n.push(o))}return n}function UR(i,e,t,n,r,o){let s=nr(i,e);HR(e[Lt],s,o,i.value,t,n,r)}function HR(i,e,t,n,r,o,s){if(o==null)i.removeAttribute(e,r,t);else{let a=s==null?Fi(o):s(o,n||"",r);i.setAttribute(e,r,a,t)}}function GR(i,e,t,n,r,o){let s=o[e];if(s!==null)for(let a=0;a<s.length;a+=2){let l=s[a],c=s[a+1];Yv(n,t,l,c)}}function B0(i,e,t,n,r){let o=Yt+t,s=e[Re],a=r(s,e,i,n,t);e[o]=a,Ja(i,!0);let l=i.type===2;return l?(_C(e[Lt],a,i),(Lx()===0||Ka(i))&&ol(a,e),Fx()):ol(a,e),ph()&&(!l||!S0(i))&&L0(s,e,a,i),i}function z0(i){let e=i;return cv()?zx():(e=e.parent,Ja(e,!1)),e}function qR(i,e){let t=i[Za];if(!t)return;let n;try{n=t.get(Kn,null)}catch{n=null}n?.(e)}function j0(i,e,t,n,r){let o=i.inputs?.[n],s=i.hostDirectiveInputs?.[n],a=!1;if(s)for(let l=0;l<s.length;l+=2){let c=s[l],u=s[l+1],h=e.data[c];Yv(h,t[c],u,r),a=!0}if(o)for(let l of o){let c=t[l],u=e.data[l];Yv(u,c,n,r),a=!0}return a}function WR(i,e){let t=ji(e,i),n=t[Re];$R(n,t);let r=t[er];r!==null&&t[$a]===null&&(t[$a]=oC(r,t[Za])),Ot(18),U0(n,t,t[on]),Ot(19,t[on])}function $R(i,e){for(let t=e.length;t<i.blueprint.length;t++)e.push(i.blueprint[t])}function U0(i,e,t){dh(e);try{let n=i.viewQuery;n!==null&&Bv(1,n,t);let r=i.template;r!==null&&EC(i,e,r,1,t),i.firstCreatePass&&(i.firstCreatePass=!1),e[Tr]?.finishViewCreation(i),i.staticContentQueries&&sC(i,e),i.staticViewQueries&&Bv(2,i.viewQuery,t);let o=i.components;o!==null&&YR(e,o)}catch(n){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),n}finally{e[$e]&=-5,hh()}}function YR(i,e){for(let t=0;t<e.length;t++)WR(i,e[t])}function tp(i,e,t,n){let r=qe(null);try{let o=e.tView,a=i[$e]&4096?4096:16,l=P0(i,o,t,a,null,e,null,null,n?.injector??null,n?.embeddedViewInjector??null,n?.dehydratedView??null),c=i[e.index];l[Jo]=c;let u=i[Tr];return u!==null&&(l[Tr]=u.createEmbeddedView(o)),U0(o,l,t),l}finally{qe(r)}}function Lc(i,e){return!e||e.firstChild===null||XS(i)}function Fc(i,e,t,n,r=!1){for(;t!==null;){if(t.type===128){t=r?t.projectionNext:t.next;continue}let o=e[t.index];o!==null&&n.push(zi(o)),tr(o)&&IC(o,n);let s=t.type;if(s&8)Fc(i,e,t.child,n);else if(s&32){let a=k0(t,e),l;for(;l=a();)n.push(l)}else if(s&16){let a=CC(e,t);if(Array.isArray(a))n.push(...a);else{let l=Zo(e[bi]);Fc(l[Re],l,a,n,!0)}}t=r?t.projectionNext:t.next}return n}function IC(i,e){for(let t=cn;t<i.length;t++){let n=i[t],r=n[Re].firstChild;r!==null&&Fc(n[Re],n,r,e)}i[es]!==i[er]&&e.push(i[es])}function TC(i){if(i[ih]!==null){for(let e of i[ih])e.impl.addSequence(e);i[ih].length=0}}var AC=[];function ZR(i){return i[wi]??XR(i)}function XR(i){let e=AC.pop()??Object.create(QR);return e.lView=i,e}function KR(i){i.lView[wi]!==i&&(i.lView=null,AC.push(i))}var QR=Ve(ne({},Ia),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{Tc(i.lView)},consumerOnSignalRead(){this.lView[wi]=this}});function JR(i){let e=i[wi]??Object.create(eP);return e.lView=i,e}var eP=Ve(ne({},Ia),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{let e=Zo(i.lView);for(;e&&!RC(e[Re]);)e=Zo(e);e&&tv(e)},consumerOnSignalRead(){this.lView[wi]=this}});function RC(i){return i.type!==2}function PC(i){if(i[Ec]===null)return;let e=!0;for(;e;){let t=!1;for(let n of i[Ec])n.dirty&&(t=!0,n.zone===null||Zone.current===n.zone?n.run():n.zone.run(()=>n.run()));e=t&&!!(i[$e]&8192)}}var tP=100;function NC(i,e=0){let n=i[Ir].rendererFactory,r=!1;r||n.begin?.();try{nP(i,e)}finally{r||n.end?.()}}function nP(i,e){let t=uv();try{dv(!0),Xv(i,e);let n=0;for(;Ic(i);){if(n===tP)throw new ue(103,!1);n++,Xv(i,1)}}finally{dv(t)}}function iP(i,e,t,n){if(Us(e))return;let r=e[$e],o=!1,s=!1;dh(e);let a=!0,l=null,c=null;o||(RC(i)?(c=ZR(e),l=Aa(c)):_d()===null?(a=!1,c=JR(e),l=Aa(c)):e[wi]&&(pc(e[wi]),e[wi]=null));try{ev(e),Ux(i.bindingStartIndex),t!==null&&EC(i,e,t,2,n),rP(e);let u=(r&3)===3;if(!o)if(u){let p=i.preOrderCheckHooks;p!==null&&bh(e,p,null)}else{let p=i.preOrderHooks;p!==null&&wh(e,p,0,null),Sv(e,0)}if(s||oP(e),PC(e),kC(e,0),i.contentQueries!==null&&sC(i,e),!o)if(u){let p=i.contentCheckHooks;p!==null&&bh(e,p)}else{let p=i.contentHooks;p!==null&&wh(e,p,1),Sv(e,1)}aP(i,e);let h=i.components;h!==null&&LC(e,h,0);let d=i.viewQuery;if(d!==null&&Bv(2,d,n),!o)if(u){let p=i.viewCheckHooks;p!==null&&bh(e,p)}else{let p=i.viewHooks;p!==null&&wh(e,p,2),Sv(e,2)}if(i.firstUpdatePass===!0&&(i.firstUpdatePass=!1),e[nh]){for(let p of e[nh])p();e[nh]=null}o||(TC(e),e[$e]&=-73)}catch(u){throw o||Tc(e),u}finally{c!==null&&(dc(c,l),a&&KR(c)),hh()}}function rP(i){let e=i[On];if(e?.enter){for(let t of e.enter)t();e.enter=void 0}}function kC(i,e){for(let t=QS(i);t!==null;t=JS(t))for(let n=cn;n<t.length;n++){let r=t[n];OC(r,e)}}function oP(i){for(let e=QS(i);e!==null;e=JS(e)){if(!(e[$e]&2))continue;let t=e[js];for(let n=0;n<t.length;n++){let r=t[n];tv(r)}}}function sP(i,e,t){Ot(18);let n=ji(e,i);OC(n,t),Ot(19,n[on])}function OC(i,e){oh(i)&&Xv(i,e)}function Xv(i,e){let n=i[Re],r=i[$e],o=i[wi],s=!!(e===0&&r&16);if(s||=!!(r&64&&e===0),s||=!!(r&1024),s||=!!(o?.dirty&&hc(o)),s||=!1,o&&(o.dirty=!1),i[$e]&=-9217,s)iP(n,i,n.template,i[on]);else if(r&8192){let a=qe(null);try{PC(i),kC(i,1);let l=n.components;l!==null&&LC(i,l,1),TC(i)}finally{qe(a)}}}function LC(i,e,t){for(let n=0;n<e.length;n++)sP(i,e[n],t)}function aP(i,e){let t=i.hostBindingOpCodes;if(t!==null)try{for(let n=0;n<t.length;n++){let r=t[n];if(r<0)is(~r);else{let o=r,s=t[++n],a=t[++n];Gx(s,o);let l=e[o];Ot(24,l),a(2,l),Ot(25,l)}}}finally{is(-1)}}function H0(i,e){let t=uv()?64:1088;for(i[Ir].changeDetectionScheduler?.notify(e);i;){i[$e]|=t;let n=Zo(i);if(Qa(i)&&!n)return i;i=n}return null}function FC(i,e,t,n){return[i,!0,0,e,null,n,null,t,null,null]}function VC(i,e){let t=cn+e;if(t<i.length)return i[t]}function np(i,e,t,n=!0){let r=e[Re];if(lP(r,e,i,t),n){let s=Zv(t,i),a=e[Lt],l=a.parentNode(i[es]);l!==null&&wR(r,i[Bi],a,e,l,s)}let o=e[$a];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function BC(i,e){let t=Vc(i,e);return t!==void 0&&Qh(t[Re],t),t}function Vc(i,e){if(i.length<=cn)return;let t=cn+e,n=i[t];if(n){let r=n[Jo];r!==null&&r!==i&&O0(r,n),e>0&&(i[t-1][Vi]=n[Vi]);let o=wc(i,cn+e);bR(n[Re],n);let s=o[Tr];s!==null&&s.detachView(o[Re]),n[gn]=null,n[Vi]=null,n[$e]&=-129}return n}function lP(i,e,t,n){let r=cn+n,o=t.length;n>0&&(t[r-1][Vi]=e),n<o-cn?(e[Vi]=t[r],zg(t,cn+n,e)):(t.push(e),e[Vi]=null),e[gn]=t;let s=e[Jo];s!==null&&t!==s&&zC(s,e);let a=e[Tr];a!==null&&a.insertView(i),sh(e),e[$e]|=128}function zC(i,e){let t=i[js],n=e[gn];if(Ar(n))i[$e]|=2;else{let r=n[gn][bi];e[bi]!==r&&(i[$e]|=2)}t===null?i[js]=[e]:t.push(e)}var rs=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let e=this._lView,t=e[Re];return Fc(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[on]}set context(e){this._lView[on]=e}get destroyed(){return Us(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[gn];if(tr(e)){let t=e[Mc],n=t?t.indexOf(this):-1;n>-1&&(Vc(e,n),wc(t,n))}this._attachedToViewContainer=!1}Qh(this._lView[Re],this._lView)}onDestroy(e){nv(this._lView,e)}markForCheck(){H0(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[$e]&=-129}reattach(){sh(this._lView),this._lView[$e]|=128}detectChanges(){this._lView[$e]|=1024,NC(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ue(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=Qa(this._lView),t=this._lView[Jo];t!==null&&!e&&O0(t,this._lView),SC(this._lView[Re],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new ue(902,!1);this._appRef=e;let t=Qa(this._lView),n=this._lView[Jo];n!==null&&!t&&zC(n,this._lView),sh(this._lView)}};var os=(()=>{class i{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=cP;constructor(t,n,r){this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,r){let o=tp(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:r});return new rs(o)}}return i})();function cP(){return ip(Ln(),je())}function ip(i,e){return i.type&4?new os(e,i,ll(i,e)):null}function qc(i,e,t,n,r){let o=i.data[e];if(o===null)o=uP(i,e,t,n,r),Hx()&&(o.flags|=32);else if(o.type&64){o.type=t,o.value=n,o.attrs=r;let s=Bx();o.injectorIndex=s===null?-1:s.injectorIndex}return Ja(o,!0),o}function uP(i,e,t,n,r){let o=lv(),s=cv(),a=s?o:o&&o.parent,l=i.data[e]=hP(i,a,t,e,n,r);return dP(i,l,o,s),l}function dP(i,e,t,n){i.firstChild===null&&(i.firstChild=e),t!==null&&(n?t.child==null&&e.parent!==null&&(t.child=e):t.next===null&&(t.next=e,e.prev=t))}function hP(i,e,t,n,r,o){let s=e?e.injectorIndex:-1,a=0;return Vx()&&(a|=128),{type:t,index:n,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var K$=new RegExp(`^(\\d+)*(${IA}|${DA})*(.*)`);function pP(i){let e=i[Xg]??[],n=i[gn][Lt],r=[];for(let o of e)o.data[nC]!==void 0?r.push(o):fP(o,n);i[Xg]=r}function fP(i,e){let t=0,n=i.firstChild;if(n){let r=i.data[tC];for(;t<r;){let o=n.nextSibling;yC(e,n,!1),n=o,t++}}}var mP=()=>null,gP=()=>null;function Kv(i,e){return mP(i,e)}function jC(i,e,t){return gP(i,e,t)}var UC=class{},rp=class{},Qv=class{resolveComponentFactory(e){throw new ue(917,!1)}},Wc=class{static NULL=new Qv},qs=class{},Xs=(()=>{class i{destroyNode=null;static __NG_ELEMENT_ID__=()=>vP()}return i})();function vP(){let i=je(),e=Ln(),t=ji(e.index,i);return(Ar(t)?t:i)[Lt]}var HC=(()=>{class i{static \u0275prov=he({token:i,providedIn:"root",factory:()=>null})}return i})();var Sh={},Jv=class{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,n){let r=this.injector.get(e,Sh,n);return r!==Sh||t===Sh?r:this.parentInjector.get(e,t,n)}};function Ph(i,e,t){let n=t?i.styles:null,r=t?i.classes:null,o=0;if(e!==null)for(let s=0;s<e.length;s++){let a=e[s];if(typeof a=="number")o=a;else if(o==1)r=Ag(r,a);else if(o==2){let l=a,c=e[++s];n=Ag(n,l+": "+c+";")}}t?i.styles=n:i.stylesWithoutHost=n,t?i.classes=r:i.classesWithoutHost=r}function se(i,e=0){let t=je();if(t===null)return Ce(i,e);let n=Ln();return $S(n,t,Nn(i),e)}function GC(i,e,t,n,r){let o=n===null?null:{"":-1},s=r(i,t);if(s!==null){let a=s,l=null,c=null;for(let u of s)if(u.resolveHostDirectives!==null){[a,l,c]=u.resolveHostDirectives(s);break}bP(i,e,t,a,o,l,c)}o!==null&&n!==null&&yP(t,n,o)}function yP(i,e,t){let n=i.localNames=[];for(let r=0;r<e.length;r+=2){let o=t[e[r+1]];if(o==null)throw new ue(-301,!1);n.push(e[r],o)}}function _P(i,e,t){e.componentOffset=t,(i.components??=[]).push(e.index)}function bP(i,e,t,n,r,o,s){let a=n.length,l=!1;for(let d=0;d<a;d++){let p=n[d];!l&&Rr(p)&&(l=!0,_P(i,t,d)),Ov(Th(t,e),i,p.type)}MP(t,i.data.length,a);for(let d=0;d<a;d++){let p=n[d];p.providersResolver&&p.providersResolver(p)}let c=!1,u=!1,h=wC(i,e,a,null);a>0&&(t.directiveToIndex=new Map);for(let d=0;d<a;d++){let p=n[d];if(t.mergedAttrs=rl(t.mergedAttrs,p.hostAttrs),xP(i,t,e,h,p),EP(h,p,r),s!==null&&s.has(p)){let[f,m]=s.get(p);t.directiveToIndex.set(p.type,[h,f+t.directiveStart,m+t.directiveStart])}else(o===null||!o.has(p))&&t.directiveToIndex.set(p.type,h);p.contentQueries!==null&&(t.flags|=4),(p.hostBindings!==null||p.hostAttrs!==null||p.hostVars!==0)&&(t.flags|=64);let g=p.type.prototype;!c&&(g.ngOnChanges||g.ngOnInit||g.ngDoCheck)&&((i.preOrderHooks??=[]).push(t.index),c=!0),!u&&(g.ngOnChanges||g.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(t.index),u=!0),h++}wP(i,t,o)}function wP(i,e,t){for(let n=e.directiveStart;n<e.directiveEnd;n++){let r=i.data[n];if(t===null||!t.has(r))gS(0,e,r,n),gS(1,e,r,n),yS(e,n,!1);else{let o=t.get(r);vS(0,e,o,n),vS(1,e,o,n),yS(e,n,!0)}}}function gS(i,e,t,n){let r=i===0?t.inputs:t.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s;i===0?s=e.inputs??={}:s=e.outputs??={},s[o]??=[],s[o].push(n),qC(e,o)}}function vS(i,e,t,n){let r=i===0?t.inputs:t.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s=r[o],a;i===0?a=e.hostDirectiveInputs??={}:a=e.hostDirectiveOutputs??={},a[s]??=[],a[s].push(n,o),qC(e,s)}}function qC(i,e){e==="class"?i.flags|=8:e==="style"&&(i.flags|=16)}function yS(i,e,t){let{attrs:n,inputs:r,hostDirectiveInputs:o}=i;if(n===null||!t&&r===null||t&&o===null||A0(i)){i.initialInputs??=[],i.initialInputs.push(null);return}let s=null,a=0;for(;a<n.length;){let l=n[a];if(l===0){a+=4;continue}else if(l===5){a+=2;continue}else if(typeof l=="number")break;if(!t&&r.hasOwnProperty(l)){let c=r[l];for(let u of c)if(u===e){s??=[],s.push(l,n[a+1]);break}}else if(t&&o.hasOwnProperty(l)){let c=o[l];for(let u=0;u<c.length;u+=2)if(c[u]===e){s??=[],s.push(c[u+1],n[a+1]);break}}a+=2}i.initialInputs??=[],i.initialInputs.push(s)}function xP(i,e,t,n,r){i.data[n]=r;let o=r.factory||(r.factory=Yo(r.type,!0)),s=new Gs(o,Rr(r),se,null);i.blueprint[n]=s,t[n]=s,SP(i,e,n,wC(i,t,r.hostVars,Qn),r)}function SP(i,e,t,n,r){let o=r.hostBindings;if(o){let s=i.hostBindingOpCodes;s===null&&(s=i.hostBindingOpCodes=[]);let a=~e.index;CP(s)!=a&&s.push(a),s.push(t,n,o)}}function CP(i){let e=i.length;for(;e>0;){let t=i[--e];if(typeof t=="number"&&t<0)return t}return 0}function EP(i,e,t){if(t){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)t[e.exportAs[n]]=i;Rr(e)&&(t[""]=i)}}function MP(i,e,t){i.flags|=1,i.directiveStart=e,i.directiveEnd=e+t,i.providerIndexes=e}function G0(i,e,t,n,r,o,s,a){let l=e[Re],c=l.consts,u=Ui(c,s),h=qc(l,i,t,n,u);return o&&GC(l,e,h,Ui(c,a),r),h.mergedAttrs=rl(h.mergedAttrs,h.attrs),h.attrs!==null&&Ph(h,h.attrs,!1),h.mergedAttrs!==null&&Ph(h,h.mergedAttrs,!0),l.queries!==null&&l.queries.elementStart(l,h),h}function q0(i,e){BS(i,e),Kg(e)&&i.queries.elementEnd(e)}function DP(i,e,t,n,r,o){let s=e.consts,a=Ui(s,r),l=qc(e,i,t,n,a);if(l.mergedAttrs=rl(l.mergedAttrs,l.attrs),o!=null){let c=Ui(s,o);l.localNames=[];for(let u=0;u<c.length;u+=2)l.localNames.push(c[u],-1)}return l.attrs!==null&&Ph(l,l.attrs,!1),l.mergedAttrs!==null&&Ph(l,l.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,l),l}function W0(i){return op(i)?Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i:!1}function WC(i,e){if(Array.isArray(i))for(let t=0;t<i.length;t++)e(i[t]);else{let t=i[Symbol.iterator](),n;for(;!(n=t.next()).done;)e(n.value)}}function op(i){return i!==null&&(typeof i=="function"||typeof i=="object")}function $0(i,e,t){return i[e]=t}function IP(i,e){return i[e]}function or(i,e,t){if(t===Qn)return!1;let n=i[e];return Object.is(n,t)?!1:(i[e]=t,!0)}function Nh(i,e,t,n){let r=or(i,e,t);return or(i,e+1,n)||r}function TP(i,e,t,n,r,o){let s=Nh(i,e,t,n);return Nh(i,e+2,r,o)||s}function Ch(i,e,t){return function n(r){let o=ts(i)?ji(i.index,e):e;H0(o,5);let s=e[on],a=_S(e,s,t,r),l=n.__ngNextListenerFn__;for(;l;)a=_S(e,s,l,r)&&a,l=l.__ngNextListenerFn__;return a}}function _S(i,e,t,n){let r=qe(null);try{return Ot(6,e,t),t(n)!==!1}catch(o){return qR(i,o),!1}finally{Ot(7,e,t),qe(r)}}function $C(i,e,t,n,r,o,s,a){let l=Ka(i),c=!1,u=null;if(!n&&l&&(u=RP(e,t,o,i.index)),u!==null){let h=u.__ngLastListenerFn__||u;h.__ngNextListenerFn__=s,u.__ngLastListenerFn__=s,c=!0}else{let h=nr(i,t),d=n?n(h):h;AA(t,d,o,a);let p=r.listen(d,o,a);if(!AP(o)){let g=n?f=>n(zi(f[i.index])):i.index;YC(g,e,t,o,a,p,!1)}}return c}function AP(i){return i.startsWith("animation")||i.startsWith("transition")}function RP(i,e,t,n){let r=i.cleanup;if(r!=null)for(let o=0;o<r.length-1;o+=2){let s=r[o];if(s===t&&r[o+1]===n){let a=e[Ya],l=r[o+2];return a&&a.length>l?a[l]:null}typeof s=="string"&&(o+=2)}return null}function YC(i,e,t,n,r,o,s){let a=e.firstCreatePass?rv(e):null,l=iv(t),c=l.length;l.push(r,o),a&&a.push(n,i,c,(c+1)*(s?-1:1))}function bS(i,e,t,n,r,o){let s=e[t],a=e[Re],c=a.data[t].outputs[n],h=s[c].subscribe(o);YC(i.index,a,e,r,o,h,!0)}var e0=Symbol("BINDING");var kh=class extends Wc{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Qo(e);return new sl(t,this.ngModule)}};function PP(i){return Object.keys(i).map(e=>{let[t,n,r]=i[e],o={propName:t,templateName:e,isSignal:(n&Xh.SignalBased)!==0};return r&&(o.transform=r),o})}function NP(i){return Object.keys(i).map(e=>({propName:i[e],templateName:e}))}function kP(i,e,t){let n=e instanceof mn?e:e?.injector;return n&&i.getStandaloneInjector!==null&&(n=i.getStandaloneInjector(n)||n),n?new Jv(t,n):t}function OP(i){let e=i.get(qs,null);if(e===null)throw new ue(407,!1);let t=i.get(HC,null),n=i.get(Xo,null);return{rendererFactory:e,sanitizer:t,changeDetectionScheduler:n,ngReflect:!1}}function LP(i,e){let t=ZC(i);return gC(e,t,t==="svg"?Tx:t==="math"?Ax:null)}function ZC(i){return(i.selectors[0][0]||"div").toLowerCase()}var sl=class extends rp{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=PP(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=NP(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=cR(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,n,r,o,s){Ot(22);let a=qe(null);try{let l=this.componentDef,c=FP(n,l,s,o),u=kP(l,r||this.ngModule,e),h=OP(u),d=h.rendererFactory.createRenderer(null,l),p=n?kR(d,n,l.encapsulation,u):LP(l,d),g=s?.some(wS)||o?.some(v=>typeof v!="function"&&v.bindings.some(wS)),f=P0(null,c,null,512|bC(l),null,null,h,d,u,null,oC(p,u,!0));f[Yt]=p,dh(f);let m=null;try{let v=G0(Yt,f,2,"#host",()=>c.directiveRegistry,!0,0);_C(d,p,v),ol(p,f),ep(c,f,v),C0(c,v,f),q0(c,v),t!==void 0&&BP(v,this.ngContentSelectors,t),m=ji(v.index,f),f[on]=m[on],U0(c,f,null)}catch(v){throw m!==null&&Fv(m),Fv(f),v}finally{Ot(23),hh()}return new Oh(this.componentType,f,!!g)}finally{qe(a)}}};function FP(i,e,t,n){let r=i?["ng-version","20.3.3"]:uR(e.selectors[0]),o=null,s=null,a=0;if(t)for(let u of t)a+=u[e0].requiredVars,u.create&&(u.targetIdx=0,(o??=[]).push(u)),u.update&&(u.targetIdx=0,(s??=[]).push(u));if(n)for(let u=0;u<n.length;u++){let h=n[u];if(typeof h!="function")for(let d of h.bindings){a+=d[e0].requiredVars;let p=u+1;d.create&&(d.targetIdx=p,(o??=[]).push(d)),d.update&&(d.targetIdx=p,(s??=[]).push(d))}}let l=[e];if(n)for(let u of n){let h=typeof u=="function"?u:u.type,d=Gg(h);l.push(d)}return R0(0,null,VP(o,s),1,a,l,null,null,null,[r],null)}function VP(i,e){return!i&&!e?null:t=>{if(t&1&&i)for(let n of i)n.create();if(t&2&&e)for(let n of e)n.update()}}function wS(i){let e=i[e0].kind;return e==="input"||e==="twoWay"}var Oh=class extends UC{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,n){super(),this._rootLView=t,this._hasInputBindings=n,this._tNode=Dc(t[Re],Yt),this.location=ll(this._tNode,t),this.instance=ji(this._tNode.index,t)[on],this.hostView=this.changeDetectorRef=new rs(t,void 0),this.componentType=e}setInput(e,t){this._hasInputBindings;let n=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let r=this._rootLView,o=j0(n,r[Re],r,e,t);this.previousInputValues.set(e,t);let s=ji(n.index,r);H0(s,1)}get injector(){return new Hs(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function BP(i,e,t){let n=i.projection=[];for(let r=0;r<e.length;r++){let o=t[r];n.push(o!=null&&o.length?Array.from(o):null)}}var go=(()=>{class i{static __NG_ELEMENT_ID__=zP}return i})();function zP(){let i=Ln();return KC(i,je())}var jP=go,XC=class extends jP{_lContainer;_hostTNode;_hostLView;constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return ll(this._hostTNode,this._hostLView)}get injector(){return new Hs(this._hostTNode,this._hostLView)}get parentInjector(){let e=_0(this._hostTNode,this._hostLView);if(jS(e)){let t=Dh(e,this._hostLView),n=Mh(e),r=t[Re].data[n+8];return new Hs(r,t)}else return new Hs(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=xS(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-cn}createEmbeddedView(e,t,n){let r,o;typeof n=="number"?r=n:n!=null&&(r=n.index,o=n.injector);let s=Kv(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},o,s);return this.insertImpl(a,r,Lc(this._hostTNode,s)),a}createComponent(e,t,n,r,o,s,a){let l=e&&!tA(e),c;if(l)c=t;else{let m=t||{};c=m.index,n=m.injector,r=m.projectableNodes,o=m.environmentInjector||m.ngModuleRef,s=m.directives,a=m.bindings}let u=l?e:new sl(Qo(e)),h=n||this.parentInjector;if(!o&&u.ngModule==null){let v=(l?h:this.parentInjector).get(mn,null);v&&(o=v)}let d=Qo(u.componentType??{}),p=Kv(this._lContainer,d?.id??null),g=p?.firstChild??null,f=u.create(h,r,g,o,s,a);return this.insertImpl(f.hostView,c,Lc(this._hostTNode,p)),f}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,n){let r=e._lView;if(Px(r)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let l=r[gn],c=new XC(l,l[Bi],l[gn]);c.detach(c.indexOf(e))}}let o=this._adjustIndex(t),s=this._lContainer;return np(s,r,o,n),e.attachToViewContainerRef(),zg(Mv(s),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=xS(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),n=Vc(this._lContainer,t);n&&(wc(Mv(this._lContainer),t),Qh(n[Re],n))}detach(e){let t=this._adjustIndex(e,-1),n=Vc(this._lContainer,t);return n&&wc(Mv(this._lContainer),t)!=null?new rs(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function xS(i){return i[Mc]}function Mv(i){return i[Mc]||(i[Mc]=[])}function KC(i,e){let t,n=e[i.index];return tr(n)?t=n:(t=FC(n,e,null,i),e[i.index]=t,N0(e,t)),HP(t,e,i,n),new XC(t,i,e)}function UP(i,e){let t=i[Lt],n=t.createComment(""),r=nr(e,i),o=t.parentNode(r);return Rh(t,o,n,t.nextSibling(r),!1),n}var HP=WP,GP=()=>!1;function qP(i,e,t){return GP(i,e,t)}function WP(i,e,t,n){if(i[es])return;let r;t.type&8?r=zi(n):r=UP(e,t),i[es]=r}var t0=class i{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new i(this.queryList)}setDirty(){this.queryList.setDirty()}},n0=class i{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let n=e.contentQueries!==null?e.contentQueries[0]:t.length,r=[];for(let o=0;o<n;o++){let s=t.getByIndex(o),a=this.queries[s.indexInDeclarationView];r.push(a.clone())}return new i(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)Y0(e,t).matches!==null&&this.queries[t].setDirty()}},i0=class{flags;read;predicate;constructor(e,t,n=null){this.flags=t,this.read=n,typeof e=="string"?this.predicate=eN(e):this.predicate=e}},r0=class i{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){let r=t!==null?t.length:0,o=this.getByIndex(n).embeddedTView(e,r);o&&(o.indexInDeclarationView=n,t!==null?t.push(o):t=[o])}return t!==null?new i(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},o0=class i{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new i(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,n=e.parent;for(;n!==null&&n.type&8&&n.index!==t;)n=n.parent;return t===(n!==null?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){let o=n[r];this.matchTNodeWithReadOption(e,t,$P(t,o)),this.matchTNodeWithReadOption(e,t,xh(t,e,o,!1,!1))}else n===os?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,xh(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(n!==null){let r=this.metadata.read;if(r!==null)if(r===Fn||r===go||r===os&&t.type&4)this.addMatch(t.index,-2);else{let o=xh(t,e,r,!1,!1);o!==null&&this.addMatch(t.index,o)}else this.addMatch(t.index,n)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function $P(i,e){let t=i.localNames;if(t!==null){for(let n=0;n<t.length;n+=2)if(t[n]===e)return t[n+1]}return null}function YP(i,e){return i.type&11?ll(i,e):i.type&4?ip(i,e):null}function ZP(i,e,t,n){return t===-1?YP(e,i):t===-2?XP(i,e,n):Oc(i,i[Re],t,e)}function XP(i,e,t){if(t===Fn)return ll(e,i);if(t===os)return ip(e,i);if(t===go)return KC(e,i)}function QC(i,e,t,n){let r=e[Tr].queries[n];if(r.matches===null){let o=i.data,s=t.matches,a=[];for(let l=0;s!==null&&l<s.length;l+=2){let c=s[l];if(c<0)a.push(null);else{let u=o[c];a.push(ZP(e,u,s[l+1],t.metadata.read))}}r.matches=a}return r.matches}function s0(i,e,t,n){let r=i.queries.getByIndex(t),o=r.matches;if(o!==null){let s=QC(i,e,r,t);for(let a=0;a<o.length;a+=2){let l=o[a];if(l>0)n.push(s[a/2]);else{let c=o[a+1],u=e[-l];for(let h=cn;h<u.length;h++){let d=u[h];d[Jo]===d[gn]&&s0(d[Re],d,c,n)}if(u[js]!==null){let h=u[js];for(let d=0;d<h.length;d++){let p=h[d];s0(p[Re],p,c,n)}}}}}return n}function KP(i,e){return i[Tr].queries[e].queryList}function QP(i,e,t){let n=new Ah((t&4)===4);return Ox(i,e,n,n.destroy),(e[Tr]??=new n0).queries.push(new t0(n))-1}function JP(i,e,t){let n=Jt();return n.firstCreatePass&&(tN(n,new i0(i,e,t),-1),(e&2)===2&&(n.staticViewQueries=!0)),QP(n,je(),e)}function eN(i){return i.split(",").map(e=>e.trim())}function tN(i,e,t){i.queries===null&&(i.queries=new r0),i.queries.track(new o0(e,t))}function Y0(i,e){return i.queries.getByIndex(e)}function nN(i,e){let t=i[Re],n=Y0(t,e);return n.crossesNgTemplate?s0(t,i,e,[]):QC(t,i,n,e)}var SS=new Set;function as(i){SS.has(i)||(SS.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}var Ws=class{},sp=class{};var Lh=class extends Ws{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new kh(this);constructor(e,t,n,r=!0){super(),this.ngModuleType=e,this._parent=t;let o=Hg(e);this._bootstrapComponents=fC(o.bootstrap),this._r3Injector=gv(e,t,[{provide:Ws,useValue:this},{provide:Wc,useValue:this.componentFactoryResolver},...n],lo(e),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},Fh=class extends sp{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new Lh(this.moduleType,e,[])}};var Bc=class extends Ws{injector;componentFactoryResolver=new kh(this);instance=null;constructor(e){super();let t=new Fs([...e.providers,{provide:Ws,useValue:this},{provide:Wc,useValue:this.componentFactoryResolver}],e.parent||Sc(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function $c(i,e,t=null){return new Bc({providers:i,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var iN=(()=>{class i{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let n=qg(!1,t.type),r=n.length>0?$c([n],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=he({token:i,providedIn:"environment",factory:()=>new i(Ce(mn))})}return i})();function Pe(i){return jc(()=>{let e=JC(i),t=Ve(ne({},e),{decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===b0.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&i.dependencies||null,getStandaloneInjector:e.standalone?r=>r.get(iN).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||uo.Emulated,styles:i.styles||_i,_:null,schemas:i.schemas||null,tView:null,id:""});e.standalone&&as("NgStandalone"),e1(t);let n=i.dependencies;return t.directiveDefs=CS(n,rN),t.pipeDefs=CS(n,wx),t.id=aN(t),t})}function rN(i){return Qo(i)||Gg(i)}function vo(i){return jc(()=>({type:i.type,bootstrap:i.bootstrap||_i,declarations:i.declarations||_i,imports:i.imports||_i,exports:i.exports||_i,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function oN(i,e){if(i==null)return Ko;let t={};for(let n in i)if(i.hasOwnProperty(n)){let r=i[n],o,s,a,l;Array.isArray(r)?(a=r[0],o=r[1],s=r[2]??o,l=r[3]||null):(o=r,s=r,a=Xh.None,l=null),t[o]=[n,a,l],e[o]=s}return t}function sN(i){if(i==null)return Ko;let e={};for(let t in i)i.hasOwnProperty(t)&&(e[i[t]]=t);return e}function en(i){return jc(()=>{let e=JC(i);return e1(e),e})}function ar(i){return{type:i.type,name:i.name,factory:null,pure:i.pure!==!1,standalone:i.standalone??!0,onDestroy:i.type.prototype.ngOnDestroy||null}}function JC(i){let e={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:e,inputConfig:i.inputs||Ko,exportAs:i.exportAs||null,standalone:i.standalone??!0,signals:i.signals===!0,selectors:i.selectors||_i,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:oN(i.inputs,e),outputs:sN(i.outputs),debugInfo:null}}function e1(i){i.features?.forEach(e=>e(i))}function CS(i,e){return i?()=>{let t=typeof i=="function"?i():i,n=[];for(let r of t){let o=e(r);o!==null&&n.push(o)}return n}:null}function aN(i){let e=0,t=typeof i.consts=="function"?"":i.consts,n=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,t,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery];for(let o of n.join("|"))e=Math.imul(31,e)+o.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function lN(i){return Object.getPrototypeOf(i.prototype).constructor}function lr(i){let e=lN(i.type),t=!0,n=[i];for(;e;){let r;if(Rr(i))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new ue(903,!1);r=e.\u0275dir}if(r){if(t){n.push(r);let s=i;s.inputs=Dv(i.inputs),s.declaredInputs=Dv(i.declaredInputs),s.outputs=Dv(i.outputs);let a=r.hostBindings;a&&pN(i,a);let l=r.viewQuery,c=r.contentQueries;if(l&&dN(i,l),c&&hN(i,c),cN(i,r),hx(i.outputs,r.outputs),Rr(r)&&r.data.animation){let u=i.data;u.animation=(u.animation||[]).concat(r.data.animation)}}let o=r.features;if(o)for(let s=0;s<o.length;s++){let a=o[s];a&&a.ngInherit&&a(i),a===lr&&(t=!1)}}e=Object.getPrototypeOf(e)}uN(n)}function cN(i,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||i.inputs.hasOwnProperty(t))continue;let n=e.inputs[t];n!==void 0&&(i.inputs[t]=n,i.declaredInputs[t]=e.declaredInputs[t])}}function uN(i){let e=0,t=null;for(let n=i.length-1;n>=0;n--){let r=i[n];r.hostVars=e+=r.hostVars,r.hostAttrs=rl(r.hostAttrs,t=rl(t,r.hostAttrs))}}function Dv(i){return i===Ko?{}:i===_i?[]:i}function dN(i,e){let t=i.viewQuery;t?i.viewQuery=(n,r)=>{e(n,r),t(n,r)}:i.viewQuery=e}function hN(i,e){let t=i.contentQueries;t?i.contentQueries=(n,r,o)=>{e(n,r,o),t(n,r,o)}:i.contentQueries=e}function pN(i,e){let t=i.hostBindings;t?i.hostBindings=(n,r)=>{e(n,r),t(n,r)}:i.hostBindings=e}function t1(i,e,t,n,r,o,s,a){if(t.firstCreatePass){i.mergedAttrs=rl(i.mergedAttrs,i.attrs);let u=i.tView=R0(2,i,r,o,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);t.queries!==null&&(t.queries.template(t,i),u.queries=t.queries.embeddedTView(i))}a&&(i.flags|=a),Ja(i,!1);let l=mN(t,e,i,n);ph()&&L0(t,e,l,i),ol(l,e);let c=FC(l,e,l,i);e[n+Yt]=c,N0(e,c),qP(c,i,e)}function fN(i,e,t,n,r,o,s,a,l,c,u){let h=t+Yt,d;return e.firstCreatePass?(d=qc(e,h,4,s||null,a||null),ah()&&GC(e,i,d,Ui(e.consts,c),V0),BS(e,d)):d=e.data[h],t1(d,i,e,t,n,r,o,l),Ka(d)&&ep(e,i,d),c!=null&&Gc(i,d,u),d}function Vh(i,e,t,n,r,o,s,a,l,c,u){let h=t+Yt,d;if(e.firstCreatePass){if(d=qc(e,h,4,s||null,a||null),c!=null){let p=Ui(e.consts,c);d.localNames=[];for(let g=0;g<p.length;g+=2)d.localNames.push(p[g],-1)}}else d=e.data[h];return t1(d,i,e,t,n,r,o,l),c!=null&&Gc(i,d,u),d}function nt(i,e,t,n,r,o,s,a){let l=je(),c=Jt(),u=Ui(c.consts,o);return fN(l,c,i,e,t,n,r,u,void 0,s,a),nt}var mN=gN;function gN(i,e,t,n){return Rc(!0),e[Lt].createComment("")}var Z0=(function(i){return i[i.CHANGE_DETECTION=0]="CHANGE_DETECTION",i[i.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",i})(Z0||{}),Yc=new we(""),n1=!1,a0=class extends Tt{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,Dx()&&(this.destroyRef=oe(co,{optional:!0})??void 0,this.pendingTasks=oe(Nr,{optional:!0})??void 0)}emit(e){let t=qe(null);try{super.next(e)}finally{qe(t)}}subscribe(e,t,n){let r=e,o=t||(()=>null),s=n;if(e&&typeof e=="object"){let l=e;r=l.next?.bind(l),o=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(o=this.wrapInTimeout(o),r&&(r=this.wrapInTimeout(r)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:r,error:o,complete:s});return e instanceof an&&e.add(a),a}wrapInTimeout(e){return t=>{let n=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{n!==void 0&&this.pendingTasks?.remove(n)}})}}},xt=a0;function i1(i){let e,t;function n(){i=Pc;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{i(),n()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{i(),n()})),()=>n()}function ES(i){return queueMicrotask(()=>i()),()=>{i=Pc}}var X0="isAngularZone",Bh=X0+"_ID",vN=0,zt=class i{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new xt(!1);onMicrotaskEmpty=new xt(!1);onStable=new xt(!1);onError=new xt(!1);constructor(e){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:o=n1}=e;if(typeof Zone>"u")throw new ue(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&n,s.shouldCoalesceRunChangeDetection=r,s.callbackScheduled=!1,s.scheduleInRootZone=o,bN(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(X0)===!0}static assertInAngularZone(){if(!i.isInAngularZone())throw new ue(909,!1)}static assertNotInAngularZone(){if(i.isInAngularZone())throw new ue(909,!1)}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){let o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,e,yN,Pc,Pc);try{return o.runTask(s,t,n)}finally{o.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}},yN={};function K0(i){if(i._nesting==0&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function _N(i){if(i.isCheckStableRunning||i.callbackScheduled)return;i.callbackScheduled=!0;function e(){i1(()=>{i.callbackScheduled=!1,l0(i),i.isCheckStableRunning=!0,K0(i),i.isCheckStableRunning=!1})}i.scheduleInRootZone?Zone.root.run(()=>{e()}):i._outer.run(()=>{e()}),l0(i)}function bN(i){let e=()=>{_N(i)},t=vN++;i._inner=i._inner.fork({name:"angular",properties:{[X0]:!0,[Bh]:t,[Bh+t]:!0},onInvokeTask:(n,r,o,s,a,l)=>{if(wN(l))return n.invokeTask(o,s,a,l);try{return MS(i),n.invokeTask(o,s,a,l)}finally{(i.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||i.shouldCoalesceRunChangeDetection)&&e(),DS(i)}},onInvoke:(n,r,o,s,a,l,c)=>{try{return MS(i),n.invoke(o,s,a,l,c)}finally{i.shouldCoalesceRunChangeDetection&&!i.callbackScheduled&&!xN(l)&&e(),DS(i)}},onHasTask:(n,r,o,s)=>{n.hasTask(o,s),r===o&&(s.change=="microTask"?(i._hasPendingMicrotasks=s.microTask,l0(i),K0(i)):s.change=="macroTask"&&(i.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,r,o,s)=>(n.handleError(o,s),i.runOutsideAngular(()=>i.onError.emit(s)),!1)})}function l0(i){i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&i.callbackScheduled===!0?i.hasPendingMicrotasks=!0:i.hasPendingMicrotasks=!1}function MS(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function DS(i){i._nesting--,K0(i)}var zh=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new xt;onMicrotaskEmpty=new xt;onStable=new xt;onError=new xt;run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}};function wN(i){return r1(i,"__ignore_ng_zone__")}function xN(i){return r1(i,"__scheduler_tick__")}function r1(i,e){return!Array.isArray(i)||i.length!==1?!1:i[0]?.data?.[e]===!0}var o1=(()=>{class i{impl=null;execute(){this.impl?.execute()}static \u0275prov=he({token:i,providedIn:"root",factory:()=>new i})}return i})();var ap=(()=>{class i{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();var Q0=new we("");function yo(i){return!!i&&typeof i.then=="function"}function lp(i){return!!i&&typeof i.subscribe=="function"}var Zc=new we("");var J0=(()=>{class i{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,n)=>{this.resolve=t,this.reject=n});appInits=oe(Zc,{optional:!0})??[];injector=oe(ki);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let r of this.appInits){let o=kn(this.injector,r);if(yo(o))t.push(o);else if(lp(o)){let s=new Promise((a,l)=>{o.subscribe({complete:a,error:l})});t.push(s)}}let n=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{n()}).catch(r=>{this.reject(r)}),t.length===0&&n(),this.initialized=!0}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),cp=new we("");function s1(){ng(()=>{let i="";throw new ue(600,i)})}function a1(i){return i.isBoundToModule}var SN=10;var _o=(()=>{class i{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=oe(Kn);afterRenderManager=oe(o1);zonelessEnabled=oe(tl);rootEffectScheduler=oe(xv);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new Tt;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=oe(Nr);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(ze(t=>!t))}constructor(){oe(Yc,{optional:!0})}whenStable(){let t;return new Promise(n=>{t=this.isStable.subscribe({next:r=>{r&&n()}})}).finally(()=>{t.unsubscribe()})}_injector=oe(mn);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,n){return this.bootstrapImpl(t,n)}bootstrapImpl(t,n,r=ki.NULL){return this._injector.get(zt).run(()=>{Ot(10);let s=t instanceof rp;if(!this._injector.get(J0).done){let g="";throw new ue(405,g)}let l;s?l=t:l=this._injector.get(Wc).resolveComponentFactory(t),this.componentTypes.push(l.componentType);let c=a1(l)?void 0:this._injector.get(Ws),u=n||l.selector,h=l.create(r,[],u,c),d=h.location.nativeElement,p=h.injector.get(Q0,null);return p?.registerApplication(d),h.onDestroy(()=>{this.detachView(h.hostView),kc(this.components,h),p?.unregisterApplication(d)}),this._loadComponent(h),Ot(11,h),h})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Ot(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(Z0.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new ue(101,!1);let t=qe(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,qe(t),this.afterTick.next(),Ot(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(qs,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<SN;)Ot(14),this.synchronizeOnce(),Ot(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(this.dirtyFlags&7){let n=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews){if(!n&&!Ic(r))continue;let o=n&&!this.zonelessEnabled?0:1;NC(r,o),t=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>Ic(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let n=t;this._views.push(n),n.attachToAppRef(this)}detachView(t){let n=t;kc(this._views,n),n.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(t),this._injector.get(cp,[]).forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>kc(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ue(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function kc(i,e){let t=i.indexOf(e);t>-1&&i.splice(t,1)}function Jn(i,e,t,n){let r=je(),o=ns();if(or(r,o,e)){let s=Jt(),a=Ac();UR(a,r,i,e,t,n)}return Jn}var r7=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var c0=class{destroy(e){}updateValue(e,t){}swap(e,t){let n=Math.min(e,t),r=Math.max(e,t),o=this.detach(r);if(r-n>1){let s=this.detach(n);this.attach(n,o),this.attach(r,s)}else this.attach(n,o)}move(e,t){this.attach(t,this.detach(e,!0))}};function Iv(i,e,t,n,r){return i===t&&Object.is(e,n)?1:Object.is(r(i,e),r(t,n))?-1:0}function CN(i,e,t){let n,r,o=0,s=i.length-1,a=void 0;if(Array.isArray(e)){let l=e.length-1;for(;o<=s&&o<=l;){let c=i.at(o),u=e[o],h=Iv(o,c,o,u,t);if(h!==0){h<0&&i.updateValue(o,u),o++;continue}let d=i.at(s),p=e[l],g=Iv(s,d,l,p,t);if(g!==0){g<0&&i.updateValue(s,p),s--,l--;continue}let f=t(o,c),m=t(s,d),v=t(o,u);if(Object.is(v,m)){let y=t(l,p);Object.is(y,f)?(i.swap(o,s),i.updateValue(s,p),l--,s--):i.move(s,o),i.updateValue(o,u),o++;continue}if(n??=new jh,r??=TS(i,o,s,t),u0(i,n,o,v))i.updateValue(o,u),o++,s++;else if(r.has(v))n.set(f,i.detach(o)),s--;else{let y=i.create(o,e[o]);i.attach(o,y),o++,s++}}for(;o<=l;)IS(i,n,t,o,e[o]),o++}else if(e!=null){let l=e[Symbol.iterator](),c=l.next();for(;!c.done&&o<=s;){let u=i.at(o),h=c.value,d=Iv(o,u,o,h,t);if(d!==0)d<0&&i.updateValue(o,h),o++,c=l.next();else{n??=new jh,r??=TS(i,o,s,t);let p=t(o,h);if(u0(i,n,o,p))i.updateValue(o,h),o++,s++,c=l.next();else if(!r.has(p))i.attach(o,i.create(o,h)),o++,s++,c=l.next();else{let g=t(o,u);n.set(g,i.detach(o)),s--}}}for(;!c.done;)IS(i,n,t,i.length,c.value),c=l.next()}for(;o<=s;)i.destroy(i.detach(s--));n?.forEach(l=>{i.destroy(l)})}function u0(i,e,t,n){return e!==void 0&&e.has(n)?(i.attach(t,e.get(n)),e.delete(n),!0):!1}function IS(i,e,t,n,r){if(u0(i,e,n,t(n,r)))i.updateValue(n,r);else{let o=i.create(n,r);i.attach(n,o)}}function TS(i,e,t,n){let r=new Set;for(let o=e;o<=t;o++)r.add(n(o,i.at(o)));return r}var jh=class{kvMap=new Map;_vMap=void 0;has(e){return this.kvMap.has(e)}delete(e){if(!this.has(e))return!1;let t=this.kvMap.get(e);return this._vMap!==void 0&&this._vMap.has(t)?(this.kvMap.set(e,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(e),!0}get(e){return this.kvMap.get(e)}set(e,t){if(this.kvMap.has(e)){let n=this.kvMap.get(e);this._vMap===void 0&&(this._vMap=new Map);let r=this._vMap;for(;r.has(n);)n=r.get(n);r.set(n,t)}else this.kvMap.set(e,t)}forEach(e){for(let[t,n]of this.kvMap)if(e(n,t),this._vMap!==void 0){let r=this._vMap;for(;r.has(n);)n=r.get(n),e(n,t)}}};function li(i,e,t,n,r,o,s,a){as("NgControlFlow");let l=je(),c=Jt(),u=Ui(c.consts,o);return Vh(l,c,i,e,t,n,r,u,256,s,a),ey}function ey(i,e,t,n,r,o,s,a){as("NgControlFlow");let l=je(),c=Jt(),u=Ui(c.consts,o);return Vh(l,c,i,e,t,n,r,u,512,s,a),ey}function ci(i,e){as("NgControlFlow");let t=je(),n=ns(),r=t[n]!==Qn?t[n]:-1,o=r!==-1?Uh(t,Yt+r):void 0,s=0;if(or(t,n,i)){let a=qe(null);try{if(o!==void 0&&BC(o,s),i!==-1){let l=Yt+i,c=Uh(t,l),u=f0(t[Re],l),h=jC(c,u,t),d=tp(t,u,e,{dehydratedView:h});np(c,d,s,Lc(u,h))}}finally{qe(a)}}else if(o!==void 0){let a=VC(o,s);a!==void 0&&(a[on]=e)}}var d0=class{lContainer;$implicit;$index;constructor(e,t,n){this.lContainer=e,this.$implicit=t,this.$index=n}get $count(){return this.lContainer.length-cn}};var h0=class{hasEmptyBlock;trackByFn;liveCollection;constructor(e,t,n){this.hasEmptyBlock=e,this.trackByFn=t,this.liveCollection=n}};function Ks(i,e,t,n,r,o,s,a,l,c,u,h,d){as("NgControlFlow");let p=je(),g=Jt(),f=l!==void 0,m=je(),v=a?s.bind(m[bi][on]):s,y=new h0(f,v);m[Yt+i]=y,Vh(p,g,i+1,e,t,n,r,Ui(g.consts,o),256),f&&Vh(p,g,i+2,l,c,u,h,Ui(g.consts,d),512)}var p0=class extends c0{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(e,t,n){super(),this.lContainer=e,this.hostLView=t,this.templateTNode=n}get length(){return this.lContainer.length-cn}at(e){return this.getLView(e)[on].$implicit}attach(e,t){let n=t[$a];this.needsIndexUpdate||=e!==this.length,np(this.lContainer,t,e,Lc(this.templateTNode,n))}detach(e,t){return this.needsIndexUpdate||=e!==this.length-1,t&&EN(this.lContainer,e),MN(this.lContainer,e)}create(e,t){let n=Kv(this.lContainer,this.templateTNode.tView.ssrId),r=tp(this.hostLView,this.templateTNode,new d0(this.lContainer,t,e),{dehydratedView:n});return this.operationsCounter?.recordCreate(),r}destroy(e){Qh(e[Re],e),this.operationsCounter?.recordDestroy()}updateValue(e,t){this.getLView(e)[on].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let e=0;e<this.length;e++)this.getLView(e)[on].$index=e}getLView(e){return DN(this.lContainer,e)}};function Qs(i){let e=qe(null),t=Pr();try{let n=je(),r=n[Re],o=n[t],s=t+1,a=Uh(n,s);if(o.liveCollection===void 0){let c=f0(r,s);o.liveCollection=new p0(a,n,c)}else o.liveCollection.reset();let l=o.liveCollection;if(CN(l,i,o.trackByFn),l.updateIndexes(),o.hasEmptyBlock){let c=ns(),u=l.length===0;if(or(n,c,u)){let h=t+2,d=Uh(n,h);if(u){let p=f0(r,h),g=jC(d,p,n),f=tp(n,p,void 0,{dehydratedView:g});np(d,f,0,Lc(p,g))}else r.firstUpdatePass&&pP(d),BC(d,0)}}}finally{qe(e)}}function Uh(i,e){return i[e]}function EN(i,e){if(i.length<=cn)return;let t=cn+e,n=i[t];n&&n[On]&&(n[On].skipLeaveAnimations=!0)}function MN(i,e){return Vc(i,e)}function DN(i,e){return VC(i,e)}function f0(i,e){return Dc(i,e)}function ae(i,e,t){let n=je(),r=ns();if(or(n,r,e)){let o=Jt(),s=Ac();MC(s,n,i,e,n[Lt],t)}return ae}function AS(i,e,t,n,r){j0(e,i,t,r?"class":"style",n)}function C(i,e,t,n){let r=je(),o=r[Re],s=i+Yt,a=o.firstCreatePass?G0(s,r,2,e,V0,ah(),t,n):o.data[s];if(B0(a,r,i,e,l1),Ka(a)){let l=r[Re];ep(l,r,a),C0(l,a,r)}return n!=null&&Gc(r,a),C}function E(){let i=Jt(),e=Ln(),t=z0(e);return i.firstCreatePass&&q0(i,t),sv(t)&&av(),ov(),t.classesWithoutHost!=null&&aA(t)&&AS(i,t,je(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&lA(t)&&AS(i,t,je(),t.stylesWithoutHost,!1),E}function Te(i,e,t,n){return C(i,e,t,n),E(),Te}function Zt(i,e,t,n){let r=je(),o=r[Re],s=i+Yt,a=o.firstCreatePass?DP(s,o,2,e,t,n):o.data[s];return B0(a,r,i,e,l1),n!=null&&Gc(r,a),Zt}function jt(){let i=Ln(),e=z0(i);return sv(e)&&av(),ov(),jt}function Lr(i,e,t,n){return Zt(i,e,t,n),jt(),Lr}var l1=(i,e,t,n,r)=>(Rc(!0),gC(e[Lt],n,Kx()));function Ci(i,e,t){let n=je(),r=n[Re],o=i+Yt,s=r.firstCreatePass?G0(o,n,8,"ng-container",V0,ah(),e,t):r.data[o];if(B0(s,n,i,"ng-container",IN),Ka(s)){let a=n[Re];ep(a,n,s),C0(a,s,n)}return t!=null&&Gc(n,s),Ci}function Ei(){let i=Jt(),e=Ln(),t=z0(e);return i.firstCreatePass&&q0(i,t),Ei}var IN=(i,e,t,n,r)=>(Rc(!0),pR(e[Lt],""));function Qe(){return je()}function Fr(i,e,t){let n=je(),r=ns();if(or(n,r,e)){let o=Jt(),s=Ac();DC(s,n,i,e,n[Lt],t)}return Fr}var yh=void 0;function TN(i){let e=Math.floor(Math.abs(i)),t=i.toString().replace(/^[^.]*\.?/,"").length;return e===1&&t===0?1:5}var AN=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],yh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],yh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",yh,"{1} 'at' {0}",yh],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",TN],Tv={};function ui(i){let e=RN(i),t=RS(e);if(t)return t;let n=e.split("-")[0];if(t=RS(n),t)return t;if(n==="en")return AN;throw new ue(701,!1)}function RS(i){return i in Tv||(Tv[i]=Oi.ng&&Oi.ng.common&&Oi.ng.common.locales&&Oi.ng.common.locales[i]),Tv[i]}var tn=(function(i){return i[i.LocaleId=0]="LocaleId",i[i.DayPeriodsFormat=1]="DayPeriodsFormat",i[i.DayPeriodsStandalone=2]="DayPeriodsStandalone",i[i.DaysFormat=3]="DaysFormat",i[i.DaysStandalone=4]="DaysStandalone",i[i.MonthsFormat=5]="MonthsFormat",i[i.MonthsStandalone=6]="MonthsStandalone",i[i.Eras=7]="Eras",i[i.FirstDayOfWeek=8]="FirstDayOfWeek",i[i.WeekendRange=9]="WeekendRange",i[i.DateFormat=10]="DateFormat",i[i.TimeFormat=11]="TimeFormat",i[i.DateTimeFormat=12]="DateTimeFormat",i[i.NumberSymbols=13]="NumberSymbols",i[i.NumberFormats=14]="NumberFormats",i[i.CurrencyCode=15]="CurrencyCode",i[i.CurrencySymbol=16]="CurrencySymbol",i[i.CurrencyName=17]="CurrencyName",i[i.Currencies=18]="Currencies",i[i.Directionality=19]="Directionality",i[i.PluralCase=20]="PluralCase",i[i.ExtraData=21]="ExtraData",i})(tn||{});function RN(i){return i.toLowerCase().replace(/_/g,"-")}var Xc="en-US";var PN=Xc;function c1(i){typeof i=="string"&&(PN=i.toLowerCase().replace(/_/g,"-"))}function Y(i,e,t){let n=je(),r=Jt(),o=Ln();return u1(r,n,n[Lt],o,i,e,t),Y}function ul(i,e,t){let n=je(),r=Jt(),o=Ln();return(o.type&3||t)&&$C(o,r,n,t,n[Lt],i,e,Ch(o,n,e)),ul}function u1(i,e,t,n,r,o,s){let a=!0,l=null;if((n.type&3||s)&&(l??=Ch(n,e,o),$C(n,i,e,s,t,r,o,l)&&(a=!1)),a){let c=n.outputs?.[r],u=n.hostDirectiveOutputs?.[r];if(u&&u.length)for(let h=0;h<u.length;h+=2){let d=u[h],p=u[h+1];l??=Ch(n,e,o),bS(n,e,d,p,r,l)}if(c&&c.length)for(let h of c)l??=Ch(n,e,o),bS(n,e,h,r,r,l)}}function ie(i=1){return Xx(i)}function At(i,e,t){JP(i,e,t)}function Rt(i){let e=je(),t=Jt(),n=pv();uh(n+1);let r=Y0(t,n);if(i.dirty&&Rx(e)===((r.metadata.flags&2)===2)){if(r.matches===null)i.reset([]);else{let o=nN(e,n);i.reset(o,wA),i.notifyOnChanges()}return!0}return!1}function Pt(){return KP(je(),pv())}function cr(i){let e=jx();return rh(e,Yt+i)}function _h(i,e){return i<<17|e<<2}function $s(i){return i>>17&32767}function NN(i){return(i&2)==2}function kN(i,e){return i&131071|e<<17}function m0(i){return i|2}function al(i){return(i&131068)>>2}function Av(i,e){return i&-131069|e<<2}function ON(i){return(i&1)===1}function g0(i){return i|1}function LN(i,e,t,n,r,o){let s=o?e.classBindings:e.styleBindings,a=$s(s),l=al(s);i[n]=t;let c=!1,u;if(Array.isArray(t)){let h=t;u=h[1],(u===null||Wa(h,u)>0)&&(c=!0)}else u=t;if(r)if(l!==0){let d=$s(i[a+1]);i[n+1]=_h(d,a),d!==0&&(i[d+1]=Av(i[d+1],n)),i[a+1]=kN(i[a+1],n)}else i[n+1]=_h(a,0),a!==0&&(i[a+1]=Av(i[a+1],n)),a=n;else i[n+1]=_h(l,0),a===0?a=n:i[l+1]=Av(i[l+1],n),l=n;c&&(i[n+1]=m0(i[n+1])),PS(i,u,n,!0),PS(i,u,n,!1),FN(e,u,i,n,o),s=_h(a,l),o?e.classBindings=s:e.styleBindings=s}function FN(i,e,t,n,r){let o=r?i.residualClasses:i.residualStyles;o!=null&&typeof e=="string"&&Wa(o,e)>=0&&(t[n+1]=g0(t[n+1]))}function PS(i,e,t,n){let r=i[t+1],o=e===null,s=n?$s(r):al(r),a=!1;for(;s!==0&&(a===!1||o);){let l=i[s],c=i[s+1];VN(l,e)&&(a=!0,i[s+1]=n?g0(c):m0(c)),s=n?$s(c):al(c)}a&&(i[t+1]=n?m0(r):g0(r))}function VN(i,e){return i===null||e==null||(Array.isArray(i)?i[1]:i)===e?!0:Array.isArray(i)&&typeof e=="string"?Wa(i,e)>=0:!1}function gt(i,e,t){return d1(i,e,t,!1),gt}function Ze(i,e){return d1(i,e,null,!0),Ze}function d1(i,e,t,n){let r=je(),o=Jt(),s=lh(2);if(o.firstUpdatePass&&zN(o,i,s,n),e!==Qn&&or(r,s,e)){let a=o.data[Pr()];qN(o,a,r,r[Lt],i,r[s+1]=WN(e,t),n,s)}}function BN(i,e){return e>=i.expandoStartIndex}function zN(i,e,t,n){let r=i.data;if(r[t+1]===null){let o=r[Pr()],s=BN(i,t);$N(o,n)&&e===null&&!s&&(e=!1),e=jN(r,o,e,n),LN(r,o,e,t,s,n)}}function jN(i,e,t,n){let r=Wx(i),o=n?e.residualClasses:e.residualStyles;if(r===null)(n?e.classBindings:e.styleBindings)===0&&(t=Rv(null,i,e,t,n),t=zc(t,e.attrs,n),o=null);else{let s=e.directiveStylingLast;if(s===-1||i[s]!==r)if(t=Rv(r,i,e,t,n),o===null){let l=UN(i,e,n);l!==void 0&&Array.isArray(l)&&(l=Rv(null,i,e,l[1],n),l=zc(l,e.attrs,n),HN(i,e,n,l))}else o=GN(i,e,n)}return o!==void 0&&(n?e.residualClasses=o:e.residualStyles=o),t}function UN(i,e,t){let n=t?e.classBindings:e.styleBindings;if(al(n)!==0)return i[$s(n)]}function HN(i,e,t,n){let r=t?e.classBindings:e.styleBindings;i[$s(r)]=n}function GN(i,e,t){let n,r=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<r;o++){let s=i[o].hostAttrs;n=zc(n,s,t)}return zc(n,e.attrs,t)}function Rv(i,e,t,n,r){let o=null,s=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<s&&(o=e[a],n=zc(n,o.hostAttrs,r),o!==i);)a++;return i!==null&&(t.directiveStylingLast=a),n}function zc(i,e,t){let n=t?1:2,r=-1;if(e!==null)for(let o=0;o<e.length;o++){let s=e[o];typeof s=="number"?r=s:r===n&&(Array.isArray(i)||(i=i===void 0?[]:["",i]),bx(i,s,t?!0:e[++o]))}return i===void 0?null:i}function qN(i,e,t,n,r,o,s,a){if(!(e.type&3))return;let l=i.data,c=l[a+1],u=ON(c)?NS(l,e,t,r,al(c),s):void 0;if(!Hh(u)){Hh(o)||NN(c)&&(o=NS(l,null,t,r,a,s));let h=Qg(Pr(),t);NR(n,s,h,r,o)}}function NS(i,e,t,n,r,o){let s=e===null,a;for(;r>0;){let l=i[r],c=Array.isArray(l),u=c?l[1]:l,h=u===null,d=t[r+1];d===Qn&&(d=h?_i:void 0);let p=h?th(d,n):u===n?d:void 0;if(c&&!Hh(p)&&(p=th(l,n)),Hh(p)&&(a=p,s))return a;let g=i[r+1];r=s?$s(g):al(g)}if(e!==null){let l=o?e.residualClasses:e.residualStyles;l!=null&&(a=th(l,n))}return a}function Hh(i){return i!==void 0}function WN(i,e){return i==null||i===""||(typeof e=="string"?i=i+e:typeof i=="object"&&(i=lo(Or(i)))),i}function $N(i,e){return(i.flags&(e?8:16))!==0}function A(i,e=""){let t=je(),n=Jt(),r=i+Yt,o=n.firstCreatePass?qc(n,r,1,e,null):n.data[r],s=YN(n,t,o,e,i);t[r]=s,ph()&&L0(n,t,s,o),Ja(o,!1)}var YN=(i,e,t,n,r)=>(Rc(!0),dR(e[Lt],n));function h1(i,e,t,n=""){return or(i,ns(),t)?e+Fi(t)+n:Qn}function ZN(i,e,t,n,r,o=""){let s=hv(),a=Nh(i,s,t,r);return lh(2),a?e+Fi(t)+n+Fi(r)+o:Qn}function XN(i,e,t,n,r,o,s,a,l,c=""){let u=hv(),h=TP(i,u,t,r,s,l);return lh(4),h?e+Fi(t)+n+Fi(r)+o+Fi(s)+a+Fi(l)+c:Qn}function Le(i){return rt("",i),Le}function rt(i,e,t){let n=je(),r=h1(n,i,e,t);return r!==Qn&&ty(n,Pr(),r),rt}function Ge(i,e,t,n,r){let o=je(),s=ZN(o,i,e,t,n,r);return s!==Qn&&ty(o,Pr(),s),Ge}function up(i,e,t,n,r,o,s,a,l){let c=je(),u=XN(c,i,e,t,n,r,o,s,a,l);return u!==Qn&&ty(c,Pr(),u),up}function ty(i,e,t){let n=Qg(e,i);hR(i[Lt],n,t)}function un(i,e,t){_v(e)&&(e=e());let n=je(),r=ns();if(or(n,r,e)){let o=Jt(),s=Ac();MC(s,n,i,e,n[Lt],t)}return un}function vn(i,e){let t=_v(i);return t&&i.set(e),t}function dn(i,e){let t=je(),n=Jt(),r=Ln();return u1(n,t,t[Lt],r,i,e),dn}function dp(i,e,t=""){return h1(je(),i,e,t)}function KN(i,e,t){let n=Jt();if(n.firstCreatePass){let r=Rr(i);v0(t,n.data,n.blueprint,r,!0),v0(e,n.data,n.blueprint,r,!1)}}function v0(i,e,t,n,r){if(i=Nn(i),Array.isArray(i))for(let o=0;o<i.length;o++)v0(i[o],e,t,n,r);else{let o=Jt(),s=je(),a=Ln(),l=Ls(i)?i:Nn(i.provide),c=$g(i),u=a.providerIndexes&1048575,h=a.directiveStart,d=a.providerIndexes>>20;if(Ls(i)||!i.multi){let p=new Gs(c,r,se,null),g=Nv(l,e,r?u:u+d,h);g===-1?(Ov(Th(a,s),o,l),Pv(o,i,e.length),e.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),t.push(p),s.push(p)):(t[g]=p,s[g]=p)}else{let p=Nv(l,e,u+d,h),g=Nv(l,e,u,u+d),f=p>=0&&t[p],m=g>=0&&t[g];if(r&&!m||!r&&!f){Ov(Th(a,s),o,l);let v=ek(r?JN:QN,t.length,r,n,c,i);!r&&m&&(t[g].providerFactory=v),Pv(o,i,e.length,0),e.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),t.push(v),s.push(v)}else{let v=p1(t[r?g:p],c,!r&&n);Pv(o,i,p>-1?p:g,v)}!r&&n&&m&&t[g].componentProviders++}}}function Pv(i,e,t,n){let r=Ls(e),o=Mx(e);if(r||o){let l=(o?Nn(e.useClass):e).prototype.ngOnDestroy;if(l){let c=i.destroyHooks||(i.destroyHooks=[]);if(!r&&e.multi){let u=c.indexOf(t);u===-1?c.push(t,[n,l]):c[u+1].push(n,l)}else c.push(t,l)}}}function p1(i,e,t){return t&&i.componentProviders++,i.multi.push(e)-1}function Nv(i,e,t,n){for(let r=t;r<n;r++)if(e[r]===i)return r;return-1}function QN(i,e,t,n,r){return y0(this.multi,[])}function JN(i,e,t,n,r){let o=this.multi,s;if(this.providerFactory){let a=this.providerFactory.componentProviders,l=Oc(n,n[Re],this.providerFactory.index,r);s=l.slice(0,a),y0(o,s);for(let c=a;c<l.length;c++)s.push(l[c])}else s=[],y0(o,s);return s}function y0(i,e){for(let t=0;t<i.length;t++){let n=i[t];e.push(n())}return e}function ek(i,e,t,n,r,o){let s=new Gs(i,t,se,null);return s.multi=[],s.index=e,s.componentProviders=0,p1(s,r,n&&!t),s}function bo(i,e=[]){return t=>{t.providersResolver=(n,r)=>KN(n,r?r(i):i,e)}}function Un(i,e,t){let n=el()+i,r=je();return r[n]===Qn?$0(r,n,t?e.call(t):e()):IP(r,n)}function Kc(i,e,t,n){return m1(je(),el(),i,e,t,n)}function Qc(i,e,t,n,r){return g1(je(),el(),i,e,t,n,r)}function f1(i,e){let t=i[e];return t===Qn?void 0:t}function m1(i,e,t,n,r,o){let s=e+t;return or(i,s,r)?$0(i,s+1,o?n.call(o,r):n(r)):f1(i,s+1)}function g1(i,e,t,n,r,o,s){let a=e+t;return Nh(i,a,r,o)?$0(i,a+2,s?n.call(s,r,o):n(r,o)):f1(i,a+2)}function sn(i,e){let t=Jt(),n,r=i+Yt;t.firstCreatePass?(n=tk(e,t.pipeRegistry),t.data[r]=n,n.onDestroy&&(t.destroyHooks??=[]).push(r,n.onDestroy)):n=t.data[r];let o=n.factory||(n.factory=Yo(n.type,!0)),s,a=Xn(se);try{let l=Ih(!1),c=o();return Ih(l),Jg(t,je(),r,c),c}finally{Xn(a)}}function tk(i,e){if(e)for(let t=e.length-1;t>=0;t--){let n=e[t];if(i===n.name)return n}}function Hn(i,e,t){let n=i+Yt,r=je(),o=rh(r,n);return v1(r,n)?m1(r,el(),e,o.transform,t,o):o.transform(t)}function dl(i,e,t,n){let r=i+Yt,o=je(),s=rh(o,r);return v1(o,r)?g1(o,el(),e,s.transform,t,n,s):s.transform(t,n)}function v1(i,e){return i[Re].data[e].pure}function wo(i,e){return ip(i,e)}var Gh=class{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},ny=(()=>{class i{compileModuleSync(t){return new Fh(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let n=this.compileModuleSync(t),r=Hg(t),o=fC(r.declarations).reduce((s,a)=>{let l=Qo(a);return l&&s.push(new sl(l)),s},[]);return new Gh(n,o)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var nk=(()=>{class i{zone=oe(zt);changeDetectionScheduler=oe(Xo);applicationRef=oe(_o);applicationErrorHandler=oe(Kn);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),y1=new we("",{factory:()=>!1});function iy({ngZoneFactory:i,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return i??=()=>new zt(Ve(ne({},oy()),{scheduleInRootZone:t})),[{provide:zt,useFactory:i},{provide:Mr,multi:!0,useFactory:()=>{let n=oe(nk,{optional:!0});return()=>n.initialize()}},{provide:Mr,multi:!0,useFactory:()=>{let n=oe(ik);return()=>{n.initialize()}}},e===!0?{provide:bv,useValue:!0}:[],{provide:wv,useValue:t??n1},{provide:Kn,useFactory:()=>{let n=oe(zt),r=oe(mn),o;return s=>{n.runOutsideAngular(()=>{r.destroyed&&!o?setTimeout(()=>{throw s}):(o??=r.get(Cr),o.handleError(s))})}}}]}function ry(i){let e=i?.ignoreChangesOutsideZone,t=i?.scheduleInRootZone,n=iy({ngZoneFactory:()=>{let r=oy(i);return r.scheduleInRootZone=t,r.shouldCoalesceEventChangeDetection&&as("NgZone_CoalesceEvent"),new zt(r)},ignoreChangesOutsideZone:e,scheduleInRootZone:t});return Dr([{provide:y1,useValue:!0},{provide:tl,useValue:!1},n])}function oy(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}var ik=(()=>{class i{subscription=new an;initialized=!1;zone=oe(zt);pendingTasks=oe(Nr);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{zt.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{zt.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var _1=(()=>{class i{applicationErrorHandler=oe(Kn);appRef=oe(_o);taskService=oe(Nr);ngZone=oe(zt);zonelessEnabled=oe(tl);tracing=oe(Yc,{optional:!0});disableScheduling=oe(bv,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new an;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Bh):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(oe(wv,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof zh||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let n=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,n=!0;break}case 12:{this.appRef.dirtyFlags|=16,n=!0;break}case 13:{this.appRef.dirtyFlags|=2,n=!0;break}case 11:{n=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(n))return;let r=this.useMicrotaskScheduler?ES:i1;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>r(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Bh+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(n){this.taskService.remove(t),this.applicationErrorHandler(n)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,ES(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function rk(){return typeof $localize<"u"&&$localize.locale||Xc}var hl=new we("",{providedIn:"root",factory:()=>oe(hl,{optional:!0,skipSelf:!0})||rk()});function yn(i){return cx(i)}function Vr(i,e){return Sd(i,e?.equal)}var b1=class{[Bn];constructor(e){this[Bn]=e}destroy(){this[Bn].destroy()}};var I1=Symbol("InputSignalNode#UNSET"),yk=Ve(ne({},Cd),{transformFn:void 0,applyValueToInputSignal(i,e){Pa(i,e)}});function T1(i,e){let t=Object.create(yk);t.value=i,t.transformFn=e?.transform;function n(){if(Ta(t),t.value===I1){let r=null;throw new ue(-950,r)}return t.value}return n[Bn]=t,n}var _k=new we("");_k.__NG_ELEMENT_ID__=i=>{let e=Ln();if(e===null)throw new ue(204,!1);if(e.type&2)return e.value;if(i&8)return null;throw new ue(204,!1)};function w1(i,e){return T1(i,e)}function bk(i){return T1(I1,i)}var A1=(w1.required=bk,w1);var sy=new we(""),wk=new we("");function Jc(i){return!i.moduleRef}function xk(i){let e=Jc(i)?i.r3Injector:i.moduleRef.injector,t=e.get(zt);return t.run(()=>{Jc(i)?i.r3Injector.resolveInjectorInitializers():i.moduleRef.resolveInjectorInitializers();let n=e.get(Kn),r;if(t.runOutsideAngular(()=>{r=t.onError.subscribe({next:n})}),Jc(i)){let o=()=>e.destroy(),s=i.platformInjector.get(sy);s.add(o),e.onDestroy(()=>{r.unsubscribe(),s.delete(o)})}else{let o=()=>i.moduleRef.destroy(),s=i.platformInjector.get(sy);s.add(o),i.moduleRef.onDestroy(()=>{kc(i.allPlatformModules,i.moduleRef),r.unsubscribe(),s.delete(o)})}return Ck(n,t,()=>{let o=e.get(Nr),s=o.add(),a=e.get(J0);return a.runInitializers(),a.donePromise.then(()=>{let l=e.get(hl,Xc);if(c1(l||Xc),!e.get(wk,!0))return Jc(i)?e.get(_o):(i.allPlatformModules.push(i.moduleRef),i.moduleRef);if(Jc(i)){let u=e.get(_o);return i.rootComponent!==void 0&&u.bootstrap(i.rootComponent),u}else return Sk?.(i.moduleRef,i.allPlatformModules),i.moduleRef}).finally(()=>void o.remove(s))})})}var Sk;function Ck(i,e,t){try{let n=t();return yo(n)?n.catch(r=>{throw e.runOutsideAngular(()=>i(r)),r}):n}catch(n){throw e.runOutsideAngular(()=>i(n)),n}}var hp=null;function Ek(i=[],e){return ki.create({name:e,providers:[{provide:xc,useValue:"platform"},{provide:sy,useValue:new Set([()=>hp=null])},...i]})}function Mk(i=[]){if(hp)return hp;let e=Ek(i);return hp=e,s1(),Dk(e),e}function Dk(i){let e=i.get(Wh,null);kn(i,()=>{e?.forEach(t=>t())})}var ls=(()=>{class i{static __NG_ELEMENT_ID__=Ik}return i})();function Ik(i){return Tk(Ln(),je(),(i&16)===16)}function Tk(i,e,t){if(ts(i)&&!t){let n=ji(i.index,e);return new rs(n,n)}else if(i.type&175){let n=e[bi];return new rs(n,e)}return null}var ay=class{constructor(){}supports(e){return W0(e)}create(e){return new ly(e)}},Ak=(i,e)=>e,ly=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||Ak}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,o=null;for(;t||n;){let s=!n||t&&t.currentIndex<x1(n,r,o)?t:n,a=x1(s,r,o),l=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(t=t._next,s.previousIndex==null)r++;else{o||(o=[]);let c=a-r,u=l-r;if(c!=u){for(let d=0;d<c;d++){let p=d<o.length?o[d]:o[d]=0,g=p+d;u<=g&&g<c&&(o[d]=p+1)}let h=s.previousIndex;o[h]=u-c}}a!==l&&e(s,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!W0(e))throw new ue(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,n=!1,r,o,s;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)o=e[a],s=this._trackByFn(a,o),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,o,s,a),n=!0):(n&&(t=this._verifyReinsertion(t,o,s,a)),Object.is(t.item,o)||this._addIdentityChange(t,o)),t=t._next}else r=0,WC(e,a=>{s=this._trackByFn(r,a),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,a,s,r),n=!0):(n&&(t=this._verifyReinsertion(t,a,s,r)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let o;return e===null?o=this._itTail:(o=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,r)):(e=this._linkedRecords===null?null:this._linkedRecords.get(n,r),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,r)):e=this._addAfter(new cy(t,n),o,r)),e}_verifyReinsertion(e,t,n,r){let o=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null);return o!==null?e=this._reinsertAfter(o,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let r=e._prevRemoved,o=e._nextRemoved;return r===null?this._removalsHead=o:r._nextRemoved=o,o===null?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){let r=t===null?this._itHead:t._next;return e._next=r,e._prev=t,r===null?this._itTail=e:r._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new pp),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,n=e._next;return t===null?this._itHead=n:t._next=n,n===null?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new pp),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},cy=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}},uy=class{_head=null;_tail=null;add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;n!==null;n=n._nextDup)if((t===null||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){let t=e._prevDup,n=e._nextDup;return t===null?this._head=n:t._nextDup=n,n===null?this._tail=t:n._prevDup=t,this._head===null}},pp=class{map=new Map;put(e){let t=e.trackById,n=this.map.get(t);n||(n=new uy,this.map.set(t,n)),n.add(e)}get(e,t){let n=e,r=this.map.get(n);return r?r.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function x1(i,e,t){let n=i.previousIndex;if(n===null)return n;let r=0;return t&&n<t.length&&(r=t[n]),n+e+r}var dy=class{constructor(){}supports(e){return e instanceof Map||op(e)}create(){return new hy}},hy=class{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(e){let t;for(t=this._mapHead;t!==null;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;t!==null;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;t!==null;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}diff(e){if(!e)e=new Map;else if(!(e instanceof Map||op(e)))throw new ue(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(n,r)=>{if(t&&t.key===r)this._maybeAddToChanges(t,n),this._appendAfter=t,t=t._next;else{let o=this._getOrCreateRecordForKey(r,n);t=this._insertBeforeOrAppend(t,o)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let n=t;n!==null;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){let n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){let r=this._records.get(e);this._maybeAddToChanges(r,t);let o=r._prev,s=r._next;return o&&(o._next=s),s&&(s._prev=o),r._next=null,r._prev=null,r}let n=new py(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;e!==null;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;e!=null;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){this._additionsHead===null?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){this._changesHead===null?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}},py=class{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(e){this.key=e}};function S1(){return new fy([new ay])}var fy=(()=>{class i{factories;static \u0275prov=he({token:i,providedIn:"root",factory:S1});constructor(t){this.factories=t}static create(t,n){if(n!=null){let r=n.factories.slice();t=t.concat(r)}return new i(t)}static extend(t){return{provide:i,useFactory:()=>{let n=oe(i,{optional:!0,skipSelf:!0});return i.create(t,n||S1())}}}find(t){let n=this.factories.find(r=>r.supports(t));if(n!=null)return n;throw new ue(901,!1)}}return i})();function C1(){return new my([new dy])}var my=(()=>{class i{static \u0275prov=he({token:i,providedIn:"root",factory:C1});factories;constructor(t){this.factories=t}static create(t,n){if(n){let r=n.factories.slice();t=t.concat(r)}return new i(t)}static extend(t){return{provide:i,useFactory:()=>{let n=oe(i,{optional:!0,skipSelf:!0});return i.create(t,n||C1())}}}find(t){let n=this.factories.find(r=>r.supports(t));if(n)return n;throw new ue(901,!1)}}return i})();function R1(i){let{rootComponent:e,appProviders:t,platformProviders:n,platformRef:r}=i;Ot(8);try{let o=r?.injector??Mk(n),s=[iy({}),{provide:Xo,useExisting:_1},Jx,...t||[]],a=new Bc({providers:s,parent:o,debugName:"",runEnvironmentInitializers:!1});return xk({r3Injector:a.injector,platformInjector:o,rootComponent:e})}catch(o){return Promise.reject(o)}finally{Ot(9)}}function fp(i){return typeof i=="boolean"?i:i!=null&&i!=="false"}var k1=null;function Hi(){return k1}function gy(i){k1??=i}var eu=class{},vy=(()=>{class i{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>oe(O1),providedIn:"platform"})}return i})();var O1=(()=>{class i extends vy{_location;_history;_doc=oe(Bt);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Hi().getBaseHref(this._doc)}onPopState(t){let n=Hi().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",t,!1),()=>n.removeEventListener("popstate",t)}onHashChange(t){let n=Hi().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",t,!1),()=>n.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,n,r){this._history.pushState(t,n,r)}replaceState(t,n,r){this._history.replaceState(t,n,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>new i,providedIn:"platform"})}return i})();function L1(i,e){return i?e?i.endsWith("/")?e.startsWith("/")?i+e.slice(1):i+e:e.startsWith("/")?i+e:`${i}/${e}`:i:e}function P1(i){let e=i.search(/#|\?|$/);return i[e-1]==="/"?i.slice(0,e-1)+i.slice(e):i}function cs(i){return i&&i[0]!=="?"?`?${i}`:i}var mp=(()=>{class i{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>oe(V1),providedIn:"root"})}return i})(),F1=new we(""),V1=(()=>{class i extends mp{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,n){super(),this._platformLocation=t,this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??oe(Bt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return L1(this._baseHref,t)}path(t=!1){let n=this._platformLocation.pathname+cs(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${n}${r}`:n}pushState(t,n,r,o){let s=this.prepareExternalUrl(r+cs(o));this._platformLocation.pushState(t,n,s)}replaceState(t,n,r,o){let s=this.prepareExternalUrl(r+cs(o));this._platformLocation.replaceState(t,n,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(n){return new(n||i)(Ce(vy),Ce(F1,8))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),pl=(()=>{class i{_subject=new Tt;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let n=this._locationStrategy.getBaseHref();this._basePath=Nk(P1(N1(n))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,n=""){return this.path()==this.normalize(t+cs(n))}normalize(t){return i.stripTrailingSlash(Pk(this._basePath,N1(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,n="",r=null){this._locationStrategy.pushState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+cs(n)),r)}replaceState(t,n="",r=null){this._locationStrategy.replaceState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+cs(n)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}),()=>{let n=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(n,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",n){this._urlChangeListeners.forEach(r=>r(t,n))}subscribe(t,n,r){return this._subject.subscribe({next:t,error:n??void 0,complete:r??void 0})}static normalizeQueryParams=cs;static joinWithSlash=L1;static stripTrailingSlash=P1;static \u0275fac=function(n){return new(n||i)(Ce(mp))};static \u0275prov=he({token:i,factory:()=>Rk(),providedIn:"root"})}return i})();function Rk(){return new pl(Ce(mp))}function Pk(i,e){if(!i||!e.startsWith(i))return e;let t=e.substring(i.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function N1(i){return i.replace(/\/index.html$/,"")}function Nk(i){if(new RegExp("^(https?:)?//").test(i)){let[,t]=i.split(/\/\/[^\/]+/);return t}return i}var My=(function(i){return i[i.Decimal=0]="Decimal",i[i.Percent=1]="Percent",i[i.Currency=2]="Currency",i[i.Scientific=3]="Scientific",i})(My||{});var Gn=(function(i){return i[i.Format=0]="Format",i[i.Standalone=1]="Standalone",i})(Gn||{}),Nt=(function(i){return i[i.Narrow=0]="Narrow",i[i.Abbreviated=1]="Abbreviated",i[i.Wide=2]="Wide",i[i.Short=3]="Short",i})(Nt||{}),di=(function(i){return i[i.Short=0]="Short",i[i.Medium=1]="Medium",i[i.Long=2]="Long",i[i.Full=3]="Full",i})(di||{}),hi={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function G1(i){return ui(i)[tn.LocaleId]}function q1(i,e,t){let n=ui(i),r=[n[tn.DayPeriodsFormat],n[tn.DayPeriodsStandalone]],o=Gi(r,e);return Gi(o,t)}function W1(i,e,t){let n=ui(i),r=[n[tn.DaysFormat],n[tn.DaysStandalone]],o=Gi(r,e);return Gi(o,t)}function $1(i,e,t){let n=ui(i),r=[n[tn.MonthsFormat],n[tn.MonthsStandalone]],o=Gi(r,e);return Gi(o,t)}function Y1(i,e){let n=ui(i)[tn.Eras];return Gi(n,e)}function tu(i,e){let t=ui(i);return Gi(t[tn.DateFormat],e)}function nu(i,e){let t=ui(i);return Gi(t[tn.TimeFormat],e)}function iu(i,e){let n=ui(i)[tn.DateTimeFormat];return Gi(n,e)}function Br(i,e){let t=ui(i),n=t[tn.NumberSymbols][e];if(typeof n>"u"){if(e===hi.CurrencyDecimal)return t[tn.NumberSymbols][hi.Decimal];if(e===hi.CurrencyGroup)return t[tn.NumberSymbols][hi.Group]}return n}function Z1(i,e){return ui(i)[tn.NumberFormats][e]}function X1(i){if(!i[tn.ExtraData])throw new ue(2303,!1)}function K1(i){let e=ui(i);return X1(e),(e[tn.ExtraData][2]||[]).map(n=>typeof n=="string"?yy(n):[yy(n[0]),yy(n[1])])}function Q1(i,e,t){let n=ui(i);X1(n);let r=[n[tn.ExtraData][0],n[tn.ExtraData][1]],o=Gi(r,e)||[];return Gi(o,t)||[]}function Gi(i,e){for(let t=e;t>-1;t--)if(typeof i[t]<"u")return i[t];throw new ue(2304,!1)}function yy(i){let[e,t]=i.split(":");return{hours:+e,minutes:+t}}var kk=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,gp={},Ok=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function J1(i,e,t,n){let r=Gk(i);e=xo(t,e)||e;let s=[],a;for(;e;)if(a=Ok.exec(e),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;e=u}else{s.push(e);break}let l=r.getTimezoneOffset();n&&(l=tE(n,l),r=Hk(r,n));let c="";return s.forEach(u=>{let h=jk(u);c+=h?h(r,t,l):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function wp(i,e,t){let n=new Date(0);return n.setFullYear(i,e,t),n.setHours(0,0,0),n}function xo(i,e){let t=G1(i);if(gp[t]??={},gp[t][e])return gp[t][e];let n="";switch(e){case"shortDate":n=tu(i,di.Short);break;case"mediumDate":n=tu(i,di.Medium);break;case"longDate":n=tu(i,di.Long);break;case"fullDate":n=tu(i,di.Full);break;case"shortTime":n=nu(i,di.Short);break;case"mediumTime":n=nu(i,di.Medium);break;case"longTime":n=nu(i,di.Long);break;case"fullTime":n=nu(i,di.Full);break;case"short":let r=xo(i,"shortTime"),o=xo(i,"shortDate");n=vp(iu(i,di.Short),[r,o]);break;case"medium":let s=xo(i,"mediumTime"),a=xo(i,"mediumDate");n=vp(iu(i,di.Medium),[s,a]);break;case"long":let l=xo(i,"longTime"),c=xo(i,"longDate");n=vp(iu(i,di.Long),[l,c]);break;case"full":let u=xo(i,"fullTime"),h=xo(i,"fullDate");n=vp(iu(i,di.Full),[u,h]);break}return n&&(gp[t][e]=n),n}function vp(i,e){return e&&(i=i.replace(/\{([^}]+)}/g,function(t,n){return e!=null&&n in e?e[n]:t})),i}function ur(i,e,t="-",n,r){let o="";(i<0||r&&i<=0)&&(r?i=-i+1:(i=-i,o=t));let s=String(i);for(;s.length<e;)s="0"+s;return n&&(s=s.slice(s.length-e)),o+s}function Lk(i,e){return ur(i,3).substring(0,e)}function hn(i,e,t=0,n=!1,r=!1){return function(o,s){let a=Fk(i,o);if((t>0||a>-t)&&(a+=t),i===3)a===0&&t===-12&&(a=12);else if(i===6)return Lk(a,e);let l=Br(s,hi.MinusSign);return ur(a,e,l,n,r)}}function Fk(i,e){switch(i){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();case 3:return e.getHours();case 4:return e.getMinutes();case 5:return e.getSeconds();case 6:return e.getMilliseconds();case 7:return e.getDay();default:throw new ue(2301,!1)}}function Ft(i,e,t=Gn.Format,n=!1){return function(r,o){return Vk(r,o,i,e,t,n)}}function Vk(i,e,t,n,r,o){switch(t){case 2:return $1(e,r,n)[i.getMonth()];case 1:return W1(e,r,n)[i.getDay()];case 0:let s=i.getHours(),a=i.getMinutes();if(o){let c=K1(e),u=Q1(e,r,n),h=c.findIndex(d=>{if(Array.isArray(d)){let[p,g]=d,f=s>=p.hours&&a>=p.minutes,m=s<g.hours||s===g.hours&&a<g.minutes;if(p.hours<g.hours){if(f&&m)return!0}else if(f||m)return!0}else if(d.hours===s&&d.minutes===a)return!0;return!1});if(h!==-1)return u[h]}return q1(e,r,n)[s<12?0:1];case 3:return Y1(e,n)[i.getFullYear()<=0?0:1];default:let l=t;throw new ue(2302,!1)}}function yp(i){return function(e,t,n){let r=-1*n,o=Br(t,hi.MinusSign),s=r>0?Math.floor(r/60):Math.ceil(r/60);switch(i){case 0:return(r>=0?"+":"")+ur(s,2,o)+ur(Math.abs(r%60),2,o);case 1:return"GMT"+(r>=0?"+":"")+ur(s,1,o);case 2:return"GMT"+(r>=0?"+":"")+ur(s,2,o)+":"+ur(Math.abs(r%60),2,o);case 3:return n===0?"Z":(r>=0?"+":"")+ur(s,2,o)+":"+ur(Math.abs(r%60),2,o);default:throw new ue(2310,!1)}}}var Bk=0,bp=4;function zk(i){let e=wp(i,Bk,1).getDay();return wp(i,0,1+(e<=bp?bp:bp+7)-e)}function eE(i){let e=i.getDay(),t=e===0?-3:bp-e;return wp(i.getFullYear(),i.getMonth(),i.getDate()+t)}function _y(i,e=!1){return function(t,n){let r;if(e){let o=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,s=t.getDate();r=1+Math.floor((s+o)/7)}else{let o=eE(t),s=zk(o.getFullYear()),a=o.getTime()-s.getTime();r=1+Math.round(a/6048e5)}return ur(r,i,Br(n,hi.MinusSign))}}function _p(i,e=!1){return function(t,n){let o=eE(t).getFullYear();return ur(o,i,Br(n,hi.MinusSign),e)}}var by={};function jk(i){if(by[i])return by[i];let e;switch(i){case"G":case"GG":case"GGG":e=Ft(3,Nt.Abbreviated);break;case"GGGG":e=Ft(3,Nt.Wide);break;case"GGGGG":e=Ft(3,Nt.Narrow);break;case"y":e=hn(0,1,0,!1,!0);break;case"yy":e=hn(0,2,0,!0,!0);break;case"yyy":e=hn(0,3,0,!1,!0);break;case"yyyy":e=hn(0,4,0,!1,!0);break;case"Y":e=_p(1);break;case"YY":e=_p(2,!0);break;case"YYY":e=_p(3);break;case"YYYY":e=_p(4);break;case"M":case"L":e=hn(1,1,1);break;case"MM":case"LL":e=hn(1,2,1);break;case"MMM":e=Ft(2,Nt.Abbreviated);break;case"MMMM":e=Ft(2,Nt.Wide);break;case"MMMMM":e=Ft(2,Nt.Narrow);break;case"LLL":e=Ft(2,Nt.Abbreviated,Gn.Standalone);break;case"LLLL":e=Ft(2,Nt.Wide,Gn.Standalone);break;case"LLLLL":e=Ft(2,Nt.Narrow,Gn.Standalone);break;case"w":e=_y(1);break;case"ww":e=_y(2);break;case"W":e=_y(1,!0);break;case"d":e=hn(2,1);break;case"dd":e=hn(2,2);break;case"c":case"cc":e=hn(7,1);break;case"ccc":e=Ft(1,Nt.Abbreviated,Gn.Standalone);break;case"cccc":e=Ft(1,Nt.Wide,Gn.Standalone);break;case"ccccc":e=Ft(1,Nt.Narrow,Gn.Standalone);break;case"cccccc":e=Ft(1,Nt.Short,Gn.Standalone);break;case"E":case"EE":case"EEE":e=Ft(1,Nt.Abbreviated);break;case"EEEE":e=Ft(1,Nt.Wide);break;case"EEEEE":e=Ft(1,Nt.Narrow);break;case"EEEEEE":e=Ft(1,Nt.Short);break;case"a":case"aa":case"aaa":e=Ft(0,Nt.Abbreviated);break;case"aaaa":e=Ft(0,Nt.Wide);break;case"aaaaa":e=Ft(0,Nt.Narrow);break;case"b":case"bb":case"bbb":e=Ft(0,Nt.Abbreviated,Gn.Standalone,!0);break;case"bbbb":e=Ft(0,Nt.Wide,Gn.Standalone,!0);break;case"bbbbb":e=Ft(0,Nt.Narrow,Gn.Standalone,!0);break;case"B":case"BB":case"BBB":e=Ft(0,Nt.Abbreviated,Gn.Format,!0);break;case"BBBB":e=Ft(0,Nt.Wide,Gn.Format,!0);break;case"BBBBB":e=Ft(0,Nt.Narrow,Gn.Format,!0);break;case"h":e=hn(3,1,-12);break;case"hh":e=hn(3,2,-12);break;case"H":e=hn(3,1);break;case"HH":e=hn(3,2);break;case"m":e=hn(4,1);break;case"mm":e=hn(4,2);break;case"s":e=hn(5,1);break;case"ss":e=hn(5,2);break;case"S":e=hn(6,1);break;case"SS":e=hn(6,2);break;case"SSS":e=hn(6,3);break;case"Z":case"ZZ":case"ZZZ":e=yp(0);break;case"ZZZZZ":e=yp(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=yp(1);break;case"OOOO":case"ZZZZ":case"zzzz":e=yp(2);break;default:return null}return by[i]=e,e}function tE(i,e){i=i.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+i)/6e4;return isNaN(t)?e:t}function Uk(i,e){return i=new Date(i.getTime()),i.setMinutes(i.getMinutes()+e),i}function Hk(i,e,t){let r=i.getTimezoneOffset(),o=tE(e,r);return Uk(i,-1*(o-r))}function Gk(i){if(B1(i))return i;if(typeof i=="number"&&!isNaN(i))return new Date(i);if(typeof i=="string"){if(i=i.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(i)){let[r,o=1,s=1]=i.split("-").map(a=>+a);return wp(r,o-1,s)}let t=parseFloat(i);if(!isNaN(i-t))return new Date(t);let n;if(n=i.match(kk))return qk(n)}let e=new Date(i);if(!B1(e))throw new ue(2311,!1);return e}function qk(i){let e=new Date(0),t=0,n=0,r=i[8]?e.setUTCFullYear:e.setFullYear,o=i[8]?e.setUTCHours:e.setHours;i[9]&&(t=Number(i[9]+i[10]),n=Number(i[9]+i[11])),r.call(e,Number(i[1]),Number(i[2])-1,Number(i[3]));let s=Number(i[4]||0)-t,a=Number(i[5]||0)-n,l=Number(i[6]||0),c=Math.floor(parseFloat("0."+(i[7]||0))*1e3);return o.call(e,s,a,l,c),e}function B1(i){return i instanceof Date&&!isNaN(i.valueOf())}var Wk=/^(\d+)?\.((\d+)(-(\d+))?)?$/,z1=22,xp=".",ru="0",$k=";",Yk=",",wy="#";function Zk(i,e,t,n,r,o,s=!1){let a="",l=!1;if(!isFinite(i))a=Br(t,hi.Infinity);else{let c=Qk(i);s&&(c=Kk(c));let u=e.minInt,h=e.minFrac,d=e.maxFrac;if(o){let y=o.match(Wk);if(y===null)throw new ue(2306,!1);let x=y[1],_=y[3],S=y[5];x!=null&&(u=xy(x)),_!=null&&(h=xy(_)),S!=null?d=xy(S):_!=null&&h>d&&(d=h)}Jk(c,h,d);let p=c.digits,g=c.integerLen,f=c.exponent,m=[];for(l=p.every(y=>!y);g<u;g++)p.unshift(0);for(;g<0;g++)p.unshift(0);g>0?m=p.splice(g,p.length):(m=p,p=[0]);let v=[];for(p.length>=e.lgSize&&v.unshift(p.splice(-e.lgSize,p.length).join(""));p.length>e.gSize;)v.unshift(p.splice(-e.gSize,p.length).join(""));p.length&&v.unshift(p.join("")),a=v.join(Br(t,n)),m.length&&(a+=Br(t,r)+m.join("")),f&&(a+=Br(t,hi.Exponential)+"+"+f)}return i<0&&!l?a=e.negPre+a+e.negSuf:a=e.posPre+a+e.posSuf,a}function nE(i,e,t){let n=Z1(e,My.Decimal),r=Xk(n,Br(e,hi.MinusSign));return Zk(i,r,e,hi.Group,hi.Decimal,t)}function Xk(i,e="-"){let t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},n=i.split($k),r=n[0],o=n[1],s=r.indexOf(xp)!==-1?r.split(xp):[r.substring(0,r.lastIndexOf(ru)+1),r.substring(r.lastIndexOf(ru)+1)],a=s[0],l=s[1]||"";t.posPre=a.substring(0,a.indexOf(wy));for(let u=0;u<l.length;u++){let h=l.charAt(u);h===ru?t.minFrac=t.maxFrac=u+1:h===wy?t.maxFrac=u+1:t.posSuf+=h}let c=a.split(Yk);if(t.gSize=c[1]?c[1].length:0,t.lgSize=c[2]||c[1]?(c[2]||c[1]).length:0,o){let u=r.length-t.posPre.length-t.posSuf.length,h=o.indexOf(wy);t.negPre=o.substring(0,h).replace(/'/g,""),t.negSuf=o.slice(h+u).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}function Kk(i){if(i.digits[0]===0)return i;let e=i.digits.length-i.integerLen;return i.exponent?i.exponent+=2:(e===0?i.digits.push(0,0):e===1&&i.digits.push(0),i.integerLen+=2),i}function Qk(i){let e=Math.abs(i)+"",t=0,n,r,o,s,a;for((r=e.indexOf(xp))>-1&&(e=e.replace(xp,"")),(o=e.search(/e/i))>0?(r<0&&(r=o),r+=+e.slice(o+1),e=e.substring(0,o)):r<0&&(r=e.length),o=0;e.charAt(o)===ru;o++);if(o===(a=e.length))n=[0],r=1;else{for(a--;e.charAt(a)===ru;)a--;for(r-=o,n=[],s=0;o<=a;o++,s++)n[s]=Number(e.charAt(o))}return r>z1&&(n=n.splice(0,z1-1),t=r-1,r=1),{digits:n,exponent:t,integerLen:r}}function Jk(i,e,t){if(e>t)throw new ue(2307,!1);let n=i.digits,r=n.length-i.integerLen,o=Math.min(Math.max(e,r),t),s=o+i.integerLen,a=n[s];if(s>0){n.splice(Math.max(i.integerLen,s));for(let h=s;h<n.length;h++)n[h]=0}else{r=Math.max(0,r),i.integerLen=1,n.length=Math.max(1,s=o+1),n[0]=0;for(let h=1;h<s;h++)n[h]=0}if(a>=5)if(s-1<0){for(let h=0;h>s;h--)n.unshift(0),i.integerLen++;n.unshift(1),i.integerLen++}else n[s-1]++;for(;r<Math.max(0,o);r++)n.push(0);let l=o!==0,c=e+i.integerLen,u=n.reduceRight(function(h,d,p,g){return d=d+h,g[p]=d<10?d:d-10,l&&(g[p]===0&&p>=c?g.pop():l=!1),d>=10?1:0},0);u&&(n.unshift(u),i.integerLen++)}function xy(i){let e=parseInt(i);if(isNaN(e))throw new ue(2305,!1);return e}var Sy=/\s+/,j1=[],Dy=(()=>{class i{_ngEl;_renderer;initialClasses=j1;rawClass;stateMap=new Map;constructor(t,n){this._ngEl=t,this._renderer=n}set klass(t){this.initialClasses=t!=null?t.trim().split(Sy):j1}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(Sy):t}ngDoCheck(){for(let n of this.initialClasses)this._updateState(n,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let n of t)this._updateState(n,!0);else if(t!=null)for(let n of Object.keys(t))this._updateState(n,!!t[n]);this._applyStateDiff()}_updateState(t,n){let r=this.stateMap.get(t);r!==void 0?(r.enabled!==n&&(r.changed=!0,r.enabled=n),r.touched=!0):this.stateMap.set(t,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let n=t[0],r=t[1];r.changed?(this._toggleClass(n,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),r.touched=!1}}_toggleClass(t,n){t=t.trim(),t.length>0&&t.split(Sy).forEach(r=>{n?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static \u0275fac=function(n){return new(n||i)(se(Fn),se(Xs))};static \u0275dir=en({type:i,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return i})();var Sp=class{$implicit;ngForOf;index;count;constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},pi=(()=>{class i{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,n,r){this._viewContainer=t,this._template=n,this._differs=r}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let n=this._viewContainer;t.forEachOperation((r,o,s)=>{if(r.previousIndex==null)n.createEmbeddedView(this._template,new Sp(r.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)n.remove(o===null?void 0:o);else if(o!==null){let a=n.get(o);n.move(a,s),U1(a,r)}});for(let r=0,o=n.length;r<o;r++){let a=n.get(r).context;a.index=r,a.count=o,a.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{let o=n.get(r.currentIndex);U1(o,r)})}static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||i)(se(go),se(os),se(fy))};static \u0275dir=en({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return i})();function U1(i,e){i.context.$implicit=e.item}var _n=(()=>{class i{_viewContainer;_context=new Cp;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,n){this._viewContainer=t,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){H1(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){H1(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||i)(se(go),se(os))};static \u0275dir=en({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return i})(),Cp=class{$implicit=null;ngIf=null};function H1(i,e){if(i&&!i.createEmbeddedView)throw new ue(2020,!1)}var ou=(()=>{class i{_ngEl;_differs;_renderer;_ngStyle=null;_differ=null;constructor(t,n,r){this._ngEl=t,this._differs=n,this._renderer=r}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){let t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,n){let[r,o]=t.split("."),s=r.indexOf("-")===-1?void 0:rr.DashCase;n!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,o?`${n}${o}`:n,s):this._renderer.removeStyle(this._ngEl.nativeElement,r,s)}_applyChanges(t){t.forEachRemovedItem(n=>this._setStyle(n.key,null)),t.forEachAddedItem(n=>this._setStyle(n.key,n.currentValue)),t.forEachChangedItem(n=>this._setStyle(n.key,n.currentValue))}static \u0275fac=function(n){return new(n||i)(se(Fn),se(my),se(Xs))};static \u0275dir=en({type:i,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}})}return i})();function Iy(i,e){return new ue(2100,!1)}var Cy=class{createSubscription(e,t,n){return yn(()=>e.subscribe({next:t,error:n}))}dispose(e){yn(()=>e.unsubscribe())}},Ey=class{createSubscription(e,t,n){return e.then(r=>t?.(r),r=>n?.(r)),{unsubscribe:()=>{t=null,n=null}}}dispose(e){e.unsubscribe()}},eO=new Ey,tO=new Cy,su=(()=>{class i{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;applicationErrorHandler=oe(Kn);constructor(t){this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){if(!this._obj){if(t)try{this.markForCheckOnValueUpdate=!1,this._subscribe(t)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,n=>this._updateLatestValue(t,n),n=>this.applicationErrorHandler(n))}_selectStrategy(t){if(yo(t))return eO;if(lp(t))return tO;throw Iy(i,t)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,n){t===this._obj&&(this._latestValue=n,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(n){return new(n||i)(se(ls,16))};static \u0275pipe=ar({name:"async",type:i,pure:!1})}return i})();var nO="mediumDate",iE=new we(""),rE=new we(""),Ty=(()=>{class i{locale;defaultTimezone;defaultOptions;constructor(t,n,r){this.locale=t,this.defaultTimezone=n,this.defaultOptions=r}transform(t,n,r,o){if(t==null||t===""||t!==t)return null;try{let s=n??this.defaultOptions?.dateFormat??nO,a=r??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return J1(t,s,o||this.locale,a)}catch(s){throw Iy(i,s.message)}}static \u0275fac=function(n){return new(n||i)(se(hl,16),se(iE,24),se(rE,24))};static \u0275pipe=ar({name:"date",type:i,pure:!0})}return i})();var Ay=(()=>{class i{_locale;constructor(t){this._locale=t}transform(t,n,r){if(!iO(t))return null;r||=this._locale;try{let o=rO(t);return nE(o,r,n)}catch(o){throw Iy(i,o.message)}}static \u0275fac=function(n){return new(n||i)(se(hl,16))};static \u0275pipe=ar({name:"number",type:i,pure:!0})}return i})();function iO(i){return!(i==null||i===""||i!==i)}function rO(i){if(typeof i=="string"&&!isNaN(Number(i)-parseFloat(i)))return Number(i);if(typeof i!="number")throw new ue(2309,!1);return i}var ke=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=vo({type:i});static \u0275inj=Er({})}return i})();function au(i,e){e=encodeURIComponent(e);for(let t of i.split(";")){let n=t.indexOf("="),[r,o]=n==-1?[t,""]:[t.slice(0,n),t.slice(n+1)];if(r.trim()===e)return decodeURIComponent(o)}return null}var Js=class{};var oE="browser";var Mp=new we(""),Oy=(()=>{class i{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,n){this._zone=n,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,n,r,o){return this._findPluginFor(n).addEventListener(t,n,r,o)}getZone(){return this._zone}_findPluginFor(t){let n=this._eventNameToPlugin.get(t);if(n)return n;if(n=this._plugins.find(o=>o.supports(t)),!n)throw new ue(5101,!1);return this._eventNameToPlugin.set(t,n),n}static \u0275fac=function(n){return new(n||i)(Ce(Mp),Ce(zt))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),lu=class{_doc;constructor(e){this._doc=e}manager},Ry="ng-app-id";function sE(i){for(let e of i)e.remove()}function aE(i,e){let t=e.createElement("style");return t.textContent=i,t}function oO(i,e,t,n){let r=i.head?.querySelectorAll(`style[${Ry}="${e}"],link[${Ry}="${e}"]`);if(r)for(let o of r)o.removeAttribute(Ry),o instanceof HTMLLinkElement?n.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&t.set(o.textContent,{usage:0,elements:[o]})}function Ny(i,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",i),t}var Ly=(()=>{class i{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,n,r,o={}){this.doc=t,this.appId=n,this.nonce=r,oO(t,n,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,n){for(let r of t)this.addUsage(r,this.inline,aE);n?.forEach(r=>this.addUsage(r,this.external,Ny))}removeStyles(t,n){for(let r of t)this.removeUsage(r,this.inline);n?.forEach(r=>this.removeUsage(r,this.external))}addUsage(t,n,r){let o=n.get(t);o?o.usage++:n.set(t,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,r(t,this.doc)))})}removeUsage(t,n){let r=n.get(t);r&&(r.usage--,r.usage<=0&&(sE(r.elements),n.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])sE(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[n,{elements:r}]of this.inline)r.push(this.addElement(t,aE(n,this.doc)));for(let[n,{elements:r}]of this.external)r.push(this.addElement(t,Ny(n,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,n){return this.nonce&&n.setAttribute("nonce",this.nonce),t.appendChild(n)}static \u0275fac=function(n){return new(n||i)(Ce(Bt),Ce(qh),Ce($h,8),Ce(cl))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),Py={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Fy=/%COMP%/g;var cE="%COMP%",sO=`_nghost-${cE}`,aO=`_ngcontent-${cE}`,lO=!0,cO=new we("",{providedIn:"root",factory:()=>lO});function uO(i){return aO.replace(Fy,i)}function dO(i){return sO.replace(Fy,i)}function uE(i,e){return e.map(t=>t.replace(Fy,i))}var Vy=(()=>{class i{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,n,r,o,s,a,l,c=null,u=null){this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=!1,this.defaultRenderer=new cu(t,s,l,this.platformIsServer,this.tracingService)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;let r=this.getOrCreateRenderer(t,n);return r instanceof Ep?r.applyToHost(t):r instanceof uu&&r.applyStyles(),r}getOrCreateRenderer(t,n){let r=this.rendererByCompId,o=r.get(n.id);if(!o){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,h=this.platformIsServer,d=this.tracingService;switch(n.encapsulation){case uo.Emulated:o=new Ep(l,c,n,this.appId,u,s,a,h,d);break;case uo.ShadowDom:return new ky(l,c,t,n,s,a,this.nonce,h,d);default:o=new uu(l,c,n,u,s,a,h,d);break}r.set(n.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(n){return new(n||i)(Ce(Oy),Ce(Ly),Ce(qh),Ce(cO),Ce(Bt),Ce(cl),Ce(zt),Ce($h),Ce(Yc,8))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),cu=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,n,r,o){this.eventManager=e,this.doc=t,this.ngZone=n,this.platformIsServer=r,this.tracingService=o}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(Py[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(lE(e)?e.content:e).appendChild(t)}insertBefore(e,t,n){e&&(lE(e)?e.content:e).insertBefore(t,n)}removeChild(e,t){t.remove()}selectRootElement(e,t){let n=typeof e=="string"?this.doc.querySelector(e):e;if(!n)throw new ue(-5104,!1);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;let o=Py[r];o?e.setAttributeNS(o,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){let r=Py[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&(rr.DashCase|rr.Important)?e.style.setProperty(t,n,r&rr.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&rr.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e!=null&&(e[t]=n)}setValue(e,t){e.nodeValue=t}listen(e,t,n,r){if(typeof e=="string"&&(e=Hi().getGlobalEventTarget(this.doc,e),!e))throw new ue(5102,!1);let o=this.decoratePreventDefault(n);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(e,t,o)),this.eventManager.addEventListener(e,t,o,r)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;e(t)===!1&&t.preventDefault()}}};function lE(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var ky=class extends cu{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,n,r,o,s,a,l,c){super(e,o,s,l,c),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=r.styles;u=uE(r.id,u);for(let d of u){let p=document.createElement("style");a&&p.setAttribute("nonce",a),p.textContent=d,this.shadowRoot.appendChild(p)}let h=r.getExternalStyles?.();if(h)for(let d of h){let p=Ny(d,o);a&&p.setAttribute("nonce",a),this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},uu=class extends cu{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,n,r,o,s,a,l,c){super(e,o,s,a,l),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r;let u=n.styles;this.styles=c?uE(c,u):u,this.styleUrls=n.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Kh.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Ep=class extends uu{contentAttr;hostAttr;constructor(e,t,n,r,o,s,a,l,c){let u=r+"-"+n.id;super(e,t,n,o,s,a,l,c,u),this.contentAttr=uO(u),this.hostAttr=dO(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}};var Dp=class i extends eu{supportsDOMEvents=!0;static makeCurrent(){gy(new i)}onAndCancel(e,t,n,r){return e.addEventListener(t,n,r),()=>{e.removeEventListener(t,n,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=hO();return t==null?null:pO(t)}resetBaseElement(){du=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return au(document.cookie,e)}},du=null;function hO(){return du=du||document.head.querySelector("base"),du?du.getAttribute("href"):null}function pO(i){return new URL(i,document.baseURI).pathname}var fO=(()=>{class i{build(){return new XMLHttpRequest}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),hE=(()=>{class i extends lu{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,r,o){return t.addEventListener(n,r,o),()=>this.removeEventListener(t,n,r,o)}removeEventListener(t,n,r,o){return t.removeEventListener(n,r,o)}static \u0275fac=function(n){return new(n||i)(Ce(Bt))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),dE=["alt","control","meta","shift"],mO={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},gO={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},pE=(()=>{class i extends lu{constructor(t){super(t)}supports(t){return i.parseEventName(t)!=null}addEventListener(t,n,r,o){let s=i.parseEventName(n),a=i.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Hi().onAndCancel(t,s.domEventName,a,o))}static parseEventName(t){let n=t.toLowerCase().split("."),r=n.shift();if(n.length===0||!(r==="keydown"||r==="keyup"))return null;let o=i._normalizeKey(n.pop()),s="",a=n.indexOf("code");if(a>-1&&(n.splice(a,1),s="code."),dE.forEach(c=>{let u=n.indexOf(c);u>-1&&(n.splice(u,1),s+=c+".")}),s+=o,n.length!=0||o.length===0)return null;let l={};return l.domEventName=r,l.fullKey=s,l}static matchEventFullKeyCode(t,n){let r=mO[t.key]||t.key,o="";return n.indexOf("code.")>-1&&(r=t.code,o="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),dE.forEach(s=>{if(s!==r){let a=gO[s];a(t)&&(o+=s+".")}}),o+=r,o===n)}static eventCallback(t,n,r){return o=>{i.matchEventFullKeyCode(o,t)&&r.runGuarded(()=>n(o))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(n){return new(n||i)(Ce(Bt))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})();function By(i,e,t){let n=ne({rootComponent:i,platformRef:t?.platformRef},vO(e));return R1(n)}function vO(i){return{appProviders:[...xO,...i?.providers??[]],platformProviders:wO}}function yO(){Dp.makeCurrent()}function _O(){return new Cr}function bO(){return w0(document),document}var wO=[{provide:cl,useValue:oE},{provide:Wh,useValue:yO,multi:!0},{provide:Bt,useFactory:bO}];var xO=[{provide:xc,useValue:"root"},{provide:Cr,useFactory:_O},{provide:Mp,useClass:hE,multi:!0,deps:[Bt]},{provide:Mp,useClass:pE,multi:!0,deps:[Bt]},Vy,Ly,Oy,{provide:qs,useExisting:Vy},{provide:Js,useClass:fO},[]];var gl=class{},hu=class{},us=class i{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let n=t.indexOf(":");if(n>0){let r=t.slice(0,n),o=t.slice(n+1).trim();this.addHeaderEntry(r,o)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,n)=>{this.addHeaderEntry(n,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,n])=>{this.setHeaderEntries(t,n)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new i;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(e.name,t);let r=(e.op==="a"?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":let o=e.value;if(!o)this.headers.delete(t),this.normalizedNames.delete(t);else{let s=this.headers.get(t);if(!s)return;s=s.filter(a=>o.indexOf(a)===-1),s.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,s)}break}}addHeaderEntry(e,t){let n=e.toLowerCase();this.maybeSetNormalizedName(e,n),this.headers.has(n)?this.headers.get(n).push(t):this.headers.set(n,[t])}setHeaderEntries(e,t){let n=(Array.isArray(t)?t:[t]).map(o=>o.toString()),r=e.toLowerCase();this.headers.set(r,n),this.maybeSetNormalizedName(e,r)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var Tp=class{encodeKey(e){return fE(e)}encodeValue(e){return fE(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function SO(i,e){let t=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(r=>{let o=r.indexOf("="),[s,a]=o==-1?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,o)),e.decodeValue(r.slice(o+1))],l=t.get(s)||[];l.push(a),t.set(s,l)}),t}var CO=/%(\d[a-f0-9])/gi,EO={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function fE(i){return encodeURIComponent(i).replace(CO,(e,t)=>EO[t]??e)}function Ip(i){return`${i}`}var dr=class i{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new Tp,e.fromString){if(e.fromObject)throw new ue(2805,!1);this.map=SO(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let n=e.fromObject[t],r=Array.isArray(n)?n.map(Ip):[Ip(n)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(n=>{let r=e[n];Array.isArray(r)?r.forEach(o=>{t.push({param:n,value:o,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(n=>t+"="+this.encoder.encodeValue(n)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new i({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(Ip(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let n=this.map.get(e.param)||[],r=n.indexOf(Ip(e.value));r!==-1&&n.splice(r,1),n.length>0?this.map.set(e.param,n):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var Ap=class{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function MO(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function mE(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function gE(i){return typeof Blob<"u"&&i instanceof Blob}function vE(i){return typeof FormData<"u"&&i instanceof FormData}function DO(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}var yE="Content-Type",_E="Accept",bE="X-Request-URL",wE="text/plain",xE="application/json",IO=`${xE}, ${wE}, */*`,fl=class i{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(e,t,n,r){this.url=t,this.method=e.toUpperCase();let o;if(MO(this.method)||r?(this.body=n!==void 0?n:null,o=r):o=n,o){if(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.keepalive=!!o.keepalive,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),o.priority&&(this.priority=o.priority),o.cache&&(this.cache=o.cache),o.credentials&&(this.credentials=o.credentials),typeof o.timeout=="number"){if(o.timeout<1||!Number.isInteger(o.timeout))throw new ue(2822,"");this.timeout=o.timeout}o.mode&&(this.mode=o.mode),o.redirect&&(this.redirect=o.redirect),o.integrity&&(this.integrity=o.integrity),o.referrer&&(this.referrer=o.referrer),this.transferCache=o.transferCache}if(this.headers??=new us,this.context??=new Ap,!this.params)this.params=new dr,this.urlWithParams=t;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),l=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+l+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||mE(this.body)||gE(this.body)||vE(this.body)||DO(this.body)?this.body:this.body instanceof dr?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||vE(this.body)?null:gE(this.body)?this.body.type||null:mE(this.body)?null:typeof this.body=="string"?wE:this.body instanceof dr?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?xE:null}clone(e={}){let t=e.method||this.method,n=e.url||this.url,r=e.responseType||this.responseType,o=e.keepalive??this.keepalive,s=e.priority||this.priority,a=e.cache||this.cache,l=e.mode||this.mode,c=e.redirect||this.redirect,u=e.credentials||this.credentials,h=e.referrer||this.referrer,d=e.integrity||this.integrity,p=e.transferCache??this.transferCache,g=e.timeout??this.timeout,f=e.body!==void 0?e.body:this.body,m=e.withCredentials??this.withCredentials,v=e.reportProgress??this.reportProgress,y=e.headers||this.headers,x=e.params||this.params,_=e.context??this.context;return e.setHeaders!==void 0&&(y=Object.keys(e.setHeaders).reduce((S,M)=>S.set(M,e.setHeaders[M]),y)),e.setParams&&(x=Object.keys(e.setParams).reduce((S,M)=>S.set(M,e.setParams[M]),x)),new i(t,n,f,{params:x,headers:y,context:_,reportProgress:v,responseType:r,withCredentials:m,transferCache:p,keepalive:o,cache:a,priority:s,timeout:g,mode:l,redirect:c,credentials:u,referrer:h,integrity:d})}},ea=(function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i})(ea||{}),vl=class{headers;status;statusText;url;ok;type;redirected;constructor(e,t=200,n="OK"){this.headers=e.headers||new us,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.redirected=e.redirected,this.ok=this.status>=200&&this.status<300}},Rp=class i extends vl{constructor(e={}){super(e)}type=ea.ResponseHeader;clone(e={}){return new i({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},pu=class i extends vl{body;constructor(e={}){super(e),this.body=e.body!==void 0?e.body:null}type=ea.Response;clone(e={}){return new i({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0,redirected:e.redirected??this.redirected})}},ml=class extends vl{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},TO=200,AO=204;function zy(i,e){return{body:e,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials,credentials:i.credentials,transferCache:i.transferCache,timeout:i.timeout,keepalive:i.keepalive,priority:i.priority,cache:i.cache,mode:i.mode,redirect:i.redirect,integrity:i.integrity,referrer:i.referrer}}var Np=(()=>{class i{handler;constructor(t){this.handler=t}request(t,n,r={}){let o;if(t instanceof fl)o=t;else{let l;r.headers instanceof us?l=r.headers:l=new us(r.headers);let c;r.params&&(r.params instanceof dr?c=r.params:c=new dr({fromObject:r.params})),o=new fl(t,n,r.body!==void 0?r.body:null,{headers:l,context:r.context,params:c,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive,priority:r.priority,cache:r.cache,mode:r.mode,redirect:r.redirect,credentials:r.credentials,referrer:r.referrer,integrity:r.integrity,timeout:r.timeout})}let s=Be(o).pipe(Wo(l=>this.handler.handle(l)));if(t instanceof fl||r.observe==="events")return s;let a=s.pipe(zn(l=>l instanceof pu));switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return a.pipe(ze(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new ue(2806,!1);return l.body}));case"blob":return a.pipe(ze(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new ue(2807,!1);return l.body}));case"text":return a.pipe(ze(l=>{if(l.body!==null&&typeof l.body!="string")throw new ue(2808,!1);return l.body}));case"json":default:return a.pipe(ze(l=>l.body))}case"response":return a;default:throw new ue(2809,!1)}}delete(t,n={}){return this.request("DELETE",t,n)}get(t,n={}){return this.request("GET",t,n)}head(t,n={}){return this.request("HEAD",t,n)}jsonp(t,n){return this.request("JSONP",t,{params:new dr().append(n,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,n={}){return this.request("OPTIONS",t,n)}patch(t,n,r={}){return this.request("PATCH",t,zy(r,n))}post(t,n,r={}){return this.request("POST",t,zy(r,n))}put(t,n,r={}){return this.request("PUT",t,zy(r,n))}static \u0275fac=function(n){return new(n||i)(Ce(gl))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})();var RO=new we("");function PO(i,e){return e(i)}function NO(i,e,t){return(n,r)=>kn(t,()=>e(n,o=>i(o,r)))}var SE=new we(""),CE=new we(""),EE=new we("",{providedIn:"root",factory:()=>!0});var Pp=(()=>{class i extends gl{backend;injector;chain=null;pendingTasks=oe(fh);contributeToStability=oe(EE);constructor(t,n){super(),this.backend=t,this.injector=n}handle(t){if(this.chain===null){let n=Array.from(new Set([...this.injector.get(SE),...this.injector.get(CE,[])]));this.chain=n.reduceRight((r,o)=>NO(r,o,this.injector),PO)}if(this.contributeToStability){let n=this.pendingTasks.add();return this.chain(t,r=>this.backend.handle(r)).pipe(Ns(n))}else return this.chain(t,n=>this.backend.handle(n))}static \u0275fac=function(n){return new(n||i)(Ce(hu),Ce(mn))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})();var kO=/^\)\]\}',?\n/,OO=RegExp(`^${bE}:`,"m");function LO(i){return"responseURL"in i&&i.responseURL?i.responseURL:OO.test(i.getAllResponseHeaders())?i.getResponseHeader(bE):null}var jy=(()=>{class i{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new ue(-2800,!1);let n=this.xhrFactory;return Be(null).pipe(jn(()=>new ct(o=>{let s=n.build();if(s.open(t.method,t.urlWithParams),t.withCredentials&&(s.withCredentials=!0),t.headers.forEach((m,v)=>s.setRequestHeader(m,v.join(","))),t.headers.has(_E)||s.setRequestHeader(_E,IO),!t.headers.has(yE)){let m=t.detectContentTypeHeader();m!==null&&s.setRequestHeader(yE,m)}if(t.timeout&&(s.timeout=t.timeout),t.responseType){let m=t.responseType.toLowerCase();s.responseType=m!=="json"?m:"text"}let a=t.serializeBody(),l=null,c=()=>{if(l!==null)return l;let m=s.statusText||"OK",v=new us(s.getAllResponseHeaders()),y=LO(s)||t.url;return l=new Rp({headers:v,status:s.status,statusText:m,url:y}),l},u=()=>{let{headers:m,status:v,statusText:y,url:x}=c(),_=null;v!==AO&&(_=typeof s.response>"u"?s.responseText:s.response),v===0&&(v=_?TO:0);let S=v>=200&&v<300;if(t.responseType==="json"&&typeof _=="string"){let M=_;_=_.replace(kO,"");try{_=_!==""?JSON.parse(_):null}catch(R){_=M,S&&(S=!1,_={error:R,text:_})}}S?(o.next(new pu({body:_,headers:m,status:v,statusText:y,url:x||void 0})),o.complete()):o.error(new ml({error:_,headers:m,status:v,statusText:y,url:x||void 0}))},h=m=>{let{url:v}=c(),y=new ml({error:m,status:s.status||0,statusText:s.statusText||"Unknown Error",url:v||void 0});o.error(y)},d=h;t.timeout&&(d=m=>{let{url:v}=c(),y=new ml({error:new DOMException("Request timed out","TimeoutError"),status:s.status||0,statusText:s.statusText||"Request timeout",url:v||void 0});o.error(y)});let p=!1,g=m=>{p||(o.next(c()),p=!0);let v={type:ea.DownloadProgress,loaded:m.loaded};m.lengthComputable&&(v.total=m.total),t.responseType==="text"&&s.responseText&&(v.partialText=s.responseText),o.next(v)},f=m=>{let v={type:ea.UploadProgress,loaded:m.loaded};m.lengthComputable&&(v.total=m.total),o.next(v)};return s.addEventListener("load",u),s.addEventListener("error",h),s.addEventListener("timeout",d),s.addEventListener("abort",h),t.reportProgress&&(s.addEventListener("progress",g),a!==null&&s.upload&&s.upload.addEventListener("progress",f)),s.send(a),o.next({type:ea.Sent}),()=>{s.removeEventListener("error",h),s.removeEventListener("abort",h),s.removeEventListener("load",u),s.removeEventListener("timeout",d),t.reportProgress&&(s.removeEventListener("progress",g),a!==null&&s.upload&&s.upload.removeEventListener("progress",f)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(n){return new(n||i)(Ce(Js))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),ME=new we(""),FO="XSRF-TOKEN",VO=new we("",{providedIn:"root",factory:()=>FO}),BO="X-XSRF-TOKEN",zO=new we("",{providedIn:"root",factory:()=>BO}),fu=class{},jO=(()=>{class i{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,n){this.doc=t,this.cookieName=n}getToken(){let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=au(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(n){return new(n||i)(Ce(Bt),Ce(VO))};static \u0275prov=he({token:i,factory:i.\u0275fac})}return i})();function UO(i,e){let t=i.url.toLowerCase();if(!oe(ME)||i.method==="GET"||i.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(i);let n=oe(fu).getToken(),r=oe(zO);return n!=null&&!i.headers.has(r)&&(i=i.clone({headers:i.headers.set(r,n)})),e(i)}function Uy(...i){let e=[Np,jy,Pp,{provide:gl,useExisting:Pp},{provide:hu,useFactory:()=>oe(RO,{optional:!0})??oe(jy)},{provide:SE,useValue:UO,multi:!0},{provide:ME,useValue:!0},{provide:fu,useClass:jO}];for(let t of i)e.push(...t.\u0275providers);return Dr(e)}var DE=(()=>{class i{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(n){return new(n||i)(Ce(Bt))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Hy=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:function(n){let r=null;return n?r=new(n||i):r=Ce(GO),r},providedIn:"root"})}return i})(),GO=(()=>{class i extends Hy{_doc;constructor(t){super(),this._doc=t}sanitize(t,n){if(n==null)return null;switch(t){case sr.NONE:return n;case sr.HTML:return fo(n,"HTML")?Or(n):Zh(this._doc,String(n)).toString();case sr.STYLE:return fo(n,"Style")?Or(n):n;case sr.SCRIPT:if(fo(n,"Script"))return Or(n);throw new ue(5200,!1);case sr.URL:return fo(n,"URL")?Or(n):Uc(String(n));case sr.RESOURCE_URL:if(fo(n,"ResourceURL"))return Or(n);throw new ue(5201,!1);default:throw new ue(5202,!1)}}bypassSecurityTrustHtml(t){return E0(t)}bypassSecurityTrustStyle(t){return M0(t)}bypassSecurityTrustScript(t){return D0(t)}bypassSecurityTrustUrl(t){return I0(t)}bypassSecurityTrustResourceUrl(t){return T0(t)}static \u0275fac=function(n){return new(n||i)(Ce(Bt))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Je="primary",Tu=Symbol("RouteTitle"),Yy=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function ia(i){return new Yy(i)}function LE(i,e,t){let n=t.path.split("/");if(n.length>i.length||t.pathMatch==="full"&&(e.hasChildren()||n.length<i.length))return null;let r={};for(let o=0;o<n.length;o++){let s=n[o],a=i[o];if(s[0]===":")r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:i.slice(0,n.length),posParams:r}}function qO(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;++t)if(!zr(i[t],e[t]))return!1;return!0}function zr(i,e){let t=i?Zy(i):void 0,n=e?Zy(e):void 0;if(!t||!n||t.length!=n.length)return!1;let r;for(let o=0;o<t.length;o++)if(r=t[o],!FE(i[r],e[r]))return!1;return!0}function Zy(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function FE(i,e){if(Array.isArray(i)&&Array.isArray(e)){if(i.length!==e.length)return!1;let t=[...i].sort(),n=[...e].sort();return t.every((r,o)=>n[o]===r)}else return i===e}function VE(i){return i.length>0?i[i.length-1]:null}function Eo(i){return fg(i)?i:yo(i)?Qt(Promise.resolve(i)):Be(i)}var WO={exact:zE,subset:jE},BE={exact:$O,subset:YO,ignored:()=>!0};function TE(i,e,t){return WO[t.paths](i.root,e.root,t.matrixParams)&&BE[t.queryParams](i.queryParams,e.queryParams)&&!(t.fragment==="exact"&&i.fragment!==e.fragment)}function $O(i,e){return zr(i,e)}function zE(i,e,t){if(!ta(i.segments,e.segments)||!Lp(i.segments,e.segments,t)||i.numberOfChildren!==e.numberOfChildren)return!1;for(let n in e.children)if(!i.children[n]||!zE(i.children[n],e.children[n],t))return!1;return!0}function YO(i,e){return Object.keys(e).length<=Object.keys(i).length&&Object.keys(e).every(t=>FE(i[t],e[t]))}function jE(i,e,t){return UE(i,e,e.segments,t)}function UE(i,e,t,n){if(i.segments.length>t.length){let r=i.segments.slice(0,t.length);return!(!ta(r,t)||e.hasChildren()||!Lp(r,t,n))}else if(i.segments.length===t.length){if(!ta(i.segments,t)||!Lp(i.segments,t,n))return!1;for(let r in e.children)if(!i.children[r]||!jE(i.children[r],e.children[r],n))return!1;return!0}else{let r=t.slice(0,i.segments.length),o=t.slice(i.segments.length);return!ta(i.segments,r)||!Lp(i.segments,r,n)||!i.children[Je]?!1:UE(i.children[Je],e,o,n)}}function Lp(i,e,t){return e.every((n,r)=>BE[t](i[r].parameters,n.parameters))}var Ur=class{root;queryParams;fragment;_queryParamMap;constructor(e=new St([],{}),t={},n=null){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap??=ia(this.queryParams),this._queryParamMap}toString(){return KO.serialize(this)}},St=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Fp(this)}},ds=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=ia(this.parameters),this._parameterMap}toString(){return GE(this)}};function ZO(i,e){return ta(i,e)&&i.every((t,n)=>zr(t.parameters,e[n].parameters))}function ta(i,e){return i.length!==e.length?!1:i.every((t,n)=>t.path===e[n].path)}function XO(i,e){let t=[];return Object.entries(i.children).forEach(([n,r])=>{n===Je&&(t=t.concat(e(r,n)))}),Object.entries(i.children).forEach(([n,r])=>{n!==Je&&(t=t.concat(e(r,n)))}),t}var Au=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>new ra,providedIn:"root"})}return i})(),ra=class{parse(e){let t=new Ky(e);return new Ur(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${mu(e.root,!0)}`,n=e2(e.queryParams),r=typeof e.fragment=="string"?`#${QO(e.fragment)}`:"";return`${t}${n}${r}`}},KO=new ra;function Fp(i){return i.segments.map(e=>GE(e)).join("/")}function mu(i,e){if(!i.hasChildren())return Fp(i);if(e){let t=i.children[Je]?mu(i.children[Je],!1):"",n=[];return Object.entries(i.children).forEach(([r,o])=>{r!==Je&&n.push(`${r}:${mu(o,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}else{let t=XO(i,(n,r)=>r===Je?[mu(i.children[Je],!1)]:[`${r}:${mu(n,!1)}`]);return Object.keys(i.children).length===1&&i.children[Je]!=null?`${Fp(i)}/${t[0]}`:`${Fp(i)}/(${t.join("//")})`}}function HE(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function kp(i){return HE(i).replace(/%3B/gi,";")}function QO(i){return encodeURI(i)}function Xy(i){return HE(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Vp(i){return decodeURIComponent(i)}function AE(i){return Vp(i.replace(/\+/g,"%20"))}function GE(i){return`${Xy(i.path)}${JO(i.parameters)}`}function JO(i){return Object.entries(i).map(([e,t])=>`;${Xy(e)}=${Xy(t)}`).join("")}function e2(i){let e=Object.entries(i).map(([t,n])=>Array.isArray(n)?n.map(r=>`${kp(t)}=${kp(r)}`).join("&"):`${kp(t)}=${kp(n)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var t2=/^[^\/()?;#]+/;function Gy(i){let e=i.match(t2);return e?e[0]:""}var n2=/^[^\/()?;=#]+/;function i2(i){let e=i.match(n2);return e?e[0]:""}var r2=/^[^=?&#]+/;function o2(i){let e=i.match(r2);return e?e[0]:""}var s2=/^[^&#]+/;function a2(i){let e=i.match(s2);return e?e[0]:""}var Ky=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new St([],{}):new St([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[Je]=new St(e,t)),n}parseSegment(){let e=Gy(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new ue(4009,!1);return this.capture(e),new ds(Vp(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=i2(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let r=Gy(this.remaining);r&&(n=r,this.capture(n))}e[Vp(t)]=Vp(n)}parseQueryParam(e){let t=o2(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let s=a2(this.remaining);s&&(n=s,this.capture(n))}let r=AE(t),o=AE(n);if(e.hasOwnProperty(r)){let s=e[r];Array.isArray(s)||(s=[s],e[r]=s),s.push(o)}else e[r]=o}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=Gy(this.remaining),r=this.remaining[n.length];if(r!=="/"&&r!==")"&&r!==";")throw new ue(4010,!1);let o;n.indexOf(":")>-1?(o=n.slice(0,n.indexOf(":")),this.capture(o),this.capture(":")):e&&(o=Je);let s=this.parseChildren();t[o]=Object.keys(s).length===1?s[Je]:new St([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new ue(4011,!1)}};function qE(i){return i.segments.length>0?new St([],{[Je]:i}):i}function WE(i){let e={};for(let[n,r]of Object.entries(i.children)){let o=WE(r);if(n===Je&&o.segments.length===0&&o.hasChildren())for(let[s,a]of Object.entries(o.children))e[s]=a;else(o.segments.length>0||o.hasChildren())&&(e[n]=o)}let t=new St(i.segments,e);return l2(t)}function l2(i){if(i.numberOfChildren===1&&i.children[Je]){let e=i.children[Je];return new St(i.segments.concat(e.segments),e.children)}return i}function xl(i){return i instanceof Ur}function $E(i,e,t=null,n=null){let r=YE(i);return ZE(r,e,t,n)}function YE(i){let e;function t(o){let s={};for(let l of o.children){let c=t(l);s[l.outlet]=c}let a=new St(o.url,s);return o===i&&(e=a),a}let n=t(i.root),r=qE(n);return e??r}function ZE(i,e,t,n){let r=i;for(;r.parent;)r=r.parent;if(e.length===0)return qy(r,r,r,t,n);let o=c2(e);if(o.toRoot())return qy(r,r,new St([],{}),t,n);let s=u2(o,r,i),a=s.processChildren?vu(s.segmentGroup,s.index,o.commands):KE(s.segmentGroup,s.index,o.commands);return qy(r,s.segmentGroup,a,t,n)}function Bp(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function bu(i){return typeof i=="object"&&i!=null&&i.outlets}function qy(i,e,t,n,r){let o={};n&&Object.entries(n).forEach(([l,c])=>{o[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;i===e?s=t:s=XE(i,e,t);let a=qE(WE(s));return new Ur(a,o,r)}function XE(i,e,t){let n={};return Object.entries(i.children).forEach(([r,o])=>{o===e?n[r]=t:n[r]=XE(o,e,t)}),new St(i.segments,n)}var zp=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&Bp(n[0]))throw new ue(4003,!1);let r=n.find(bu);if(r&&r!==VE(n))throw new ue(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function c2(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new zp(!0,0,i);let e=0,t=!1,n=i.reduce((r,o,s)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let a={};return Object.entries(o.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...r,{outlets:a}]}if(o.segmentPath)return[...r,o.segmentPath]}return typeof o!="string"?[...r,o]:s===0?(o.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?t=!0:a===".."?e++:a!=""&&r.push(a))}),r):[...r,o]},[]);return new zp(t,e,n)}var bl=class{segmentGroup;processChildren;index;constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}};function u2(i,e,t){if(i.isAbsolute)return new bl(e,!0,0);if(!t)return new bl(e,!1,NaN);if(t.parent===null)return new bl(t,!0,0);let n=Bp(i.commands[0])?0:1,r=t.segments.length-1+n;return d2(t,r,i.numberOfDoubleDots)}function d2(i,e,t){let n=i,r=e,o=t;for(;o>r;){if(o-=r,n=n.parent,!n)throw new ue(4005,!1);r=n.segments.length}return new bl(n,!1,r-o)}function h2(i){return bu(i[0])?i[0].outlets:{[Je]:i}}function KE(i,e,t){if(i??=new St([],{}),i.segments.length===0&&i.hasChildren())return vu(i,e,t);let n=p2(i,e,t),r=t.slice(n.commandIndex);if(n.match&&n.pathIndex<i.segments.length){let o=new St(i.segments.slice(0,n.pathIndex),{});return o.children[Je]=new St(i.segments.slice(n.pathIndex),i.children),vu(o,0,r)}else return n.match&&r.length===0?new St(i.segments,{}):n.match&&!i.hasChildren()?Qy(i,e,t):n.match?vu(i,0,r):Qy(i,e,t)}function vu(i,e,t){if(t.length===0)return new St(i.segments,{});{let n=h2(t),r={};if(Object.keys(n).some(o=>o!==Je)&&i.children[Je]&&i.numberOfChildren===1&&i.children[Je].segments.length===0){let o=vu(i.children[Je],e,t);return new St(i.segments,o.children)}return Object.entries(n).forEach(([o,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(r[o]=KE(i.children[o],e,s))}),Object.entries(i.children).forEach(([o,s])=>{n[o]===void 0&&(r[o]=s)}),new St(i.segments,r)}}function p2(i,e,t){let n=0,r=e,o={match:!1,pathIndex:0,commandIndex:0};for(;r<i.segments.length;){if(n>=t.length)return o;let s=i.segments[r],a=t[n];if(bu(a))break;let l=`${a}`,c=n<t.length-1?t[n+1]:null;if(r>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!PE(l,c,s))return o;n+=2}else{if(!PE(l,{},s))return o;n++}r++}return{match:!0,pathIndex:r,commandIndex:n}}function Qy(i,e,t){let n=i.segments.slice(0,e),r=0;for(;r<t.length;){let o=t[r];if(bu(o)){let l=f2(o.outlets);return new St(n,l)}if(r===0&&Bp(t[0])){let l=i.segments[e];n.push(new ds(l.path,RE(t[0]))),r++;continue}let s=bu(o)?o.outlets[Je]:`${o}`,a=r<t.length-1?t[r+1]:null;s&&a&&Bp(a)?(n.push(new ds(s,RE(a))),r+=2):(n.push(new ds(s,{})),r++)}return new St(n,{})}function f2(i){let e={};return Object.entries(i).forEach(([t,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(e[t]=Qy(new St([],{}),0,n))}),e}function RE(i){let e={};return Object.entries(i).forEach(([t,n])=>e[t]=`${n}`),e}function PE(i,e,t){return i==t.path&&zr(e,t.parameters)}var yu="imperative",Mn=(function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i})(Mn||{}),Di=class{id;url;constructor(e,t){this.id=e,this.url=t}},oa=class extends Di{type=Mn.NavigationStart;navigationTrigger;restoredState;constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},So=class extends Di{urlAfterRedirects;type=Mn.NavigationEnd;constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ei=(function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i[i.Aborted=4]="Aborted",i})(ei||{}),wu=(function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i})(wu||{}),jr=class extends Di{reason;code;type=Mn.NavigationCancel;constructor(e,t,n,r){super(e,t),this.reason=n,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Co=class extends Di{reason;code;type=Mn.NavigationSkipped;constructor(e,t,n,r){super(e,t),this.reason=n,this.code=r}},Sl=class extends Di{error;target;type=Mn.NavigationError;constructor(e,t,n,r){super(e,t),this.error=n,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},xu=class extends Di{urlAfterRedirects;state;type=Mn.RoutesRecognized;constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},jp=class extends Di{urlAfterRedirects;state;type=Mn.GuardsCheckStart;constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Up=class extends Di{urlAfterRedirects;state;shouldActivate;type=Mn.GuardsCheckEnd;constructor(e,t,n,r,o){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Hp=class extends Di{urlAfterRedirects;state;type=Mn.ResolveStart;constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Gp=class extends Di{urlAfterRedirects;state;type=Mn.ResolveEnd;constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},qp=class{route;type=Mn.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Wp=class{route;type=Mn.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},$p=class{snapshot;type=Mn.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Yp=class{snapshot;type=Mn.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Zp=class{snapshot;type=Mn.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Xp=class{snapshot;type=Mn.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Su=class{},Cl=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function m2(i){return!(i instanceof Su)&&!(i instanceof Cl)}function g2(i,e){return i.providers&&!i._injector&&(i._injector=$c(i.providers,e,`Route: ${i.path}`)),i._injector??e}function hr(i){return i.outlet||Je}function v2(i,e){let t=i.filter(n=>hr(n)===e);return t.push(...i.filter(n=>hr(n)!==e)),t}function Dl(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let e=i.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Kp=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Dl(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new Il(this.rootInjector)}},Il=(()=>{class i{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,n){let r=this.getOrCreateContext(t);r.outlet=n,this.contexts.set(t,r)}onChildOutletDestroyed(t){let n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new Kp(this.rootInjector),this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(n){return new(n||i)(Ce(mn))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Qp=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Jy(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){let t=Jy(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=e_(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return e_(e,this._root).map(t=>t.value)}};function Jy(i,e){if(i===e.value)return e;for(let t of e.children){let n=Jy(i,t);if(n)return n}return null}function e_(i,e){if(i===e.value)return[e];for(let t of e.children){let n=e_(i,t);if(n.length)return n.unshift(e),n}return[]}var Mi=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function _l(i){let e={};return i&&i.children.forEach(t=>e[t.value.outlet]=t),e}var Cu=class extends Qp{snapshot;constructor(e,t){super(e),this.snapshot=t,l_(this,e)}toString(){return this.snapshot.toString()}};function QE(i){let e=y2(i),t=new st([new ds("",{})]),n=new st({}),r=new st({}),o=new st({}),s=new st(""),a=new hs(t,n,o,s,r,Je,i,e.root);return a.snapshot=e.root,new Cu(new Mi(a,[]),e)}function y2(i){let e={},t={},n={},o=new na([],e,n,"",t,Je,i,null,{});return new Eu("",new Mi(o,[]))}var hs=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,n,r,o,s,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=n,this.fragmentSubject=r,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(ze(c=>c[Tu]))??Be(void 0),this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ze(e=>ia(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ze(e=>ia(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Jp(i,e,t="emptyOnly"){let n,{routeConfig:r}=i;return e!==null&&(t==="always"||r?.path===""||!e.component&&!e.routeConfig?.loadComponent)?n={params:ne(ne({},e.params),i.params),data:ne(ne({},e.data),i.data),resolve:ne(ne(ne(ne({},i.data),e.data),r?.data),i._resolvedData)}:n={params:ne({},i.params),data:ne({},i.data),resolve:ne(ne({},i.data),i._resolvedData??{})},r&&eM(r)&&(n.resolve[Tu]=r.title),n}var na=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Tu]}constructor(e,t,n,r,o,s,a,l,c){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=ia(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=ia(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(n=>n.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Eu=class extends Qp{url;constructor(e,t){super(t),this.url=e,l_(this,t)}toString(){return JE(this._root)}};function l_(i,e){e.value._routerState=i,e.children.forEach(t=>l_(i,t))}function JE(i){let e=i.children.length>0?` { ${i.children.map(JE).join(", ")} } `:"";return`${i.value}${e}`}function Wy(i){if(i.snapshot){let e=i.snapshot,t=i._futureSnapshot;i.snapshot=t,zr(e.queryParams,t.queryParams)||i.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&i.fragmentSubject.next(t.fragment),zr(e.params,t.params)||i.paramsSubject.next(t.params),qO(e.url,t.url)||i.urlSubject.next(t.url),zr(e.data,t.data)||i.dataSubject.next(t.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function t_(i,e){let t=zr(i.params,e.params)&&ZO(i.url,e.url),n=!i.parent!=!e.parent;return t&&!n&&(!i.parent||t_(i.parent,e.parent))}function eM(i){return typeof i.title=="string"||i.title===null}var tM=new we(""),Ru=(()=>{class i{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Je;activateEvents=new xt;deactivateEvents=new xt;attachEvents=new xt;detachEvents=new xt;routerOutletData=A1(void 0);parentContexts=oe(Il);location=oe(go);changeDetector=oe(ls);inputBinder=oe(rf,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:n,previousValue:r}=t.name;if(n)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ue(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ue(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ue(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,n){this.activated=t,this._activatedRoute=n,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,n){if(this.isActivated)throw new ue(4013,!1);this._activatedRoute=t;let r=this.location,s=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new n_(t,a,r.injector,this.routerOutletData);this.activated=r.createComponent(s,{index:r.length,injector:l,environmentInjector:n}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(n){return new(n||i)};static \u0275dir=en({type:i,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[po]})}return i})(),n_=class{route;childContexts;parent;outletData;constructor(e,t,n,r){this.route=e,this.childContexts=t,this.parent=n,this.outletData=r}get(e,t){return e===hs?this.route:e===Il?this.childContexts:e===tM?this.outletData:this.parent.get(e,t)}},rf=new we("");var c_=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Pe({type:i,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(n,r){n&1&&Te(0,"router-outlet")},dependencies:[Ru],encapsulation:2})}return i})();function u_(i){let e=i.children&&i.children.map(u_),t=e?Ve(ne({},i),{children:e}):ne({},i);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Je&&(t.component=c_),t}function _2(i,e,t){let n=Mu(i,e._root,t?t._root:void 0);return new Cu(n,e)}function Mu(i,e,t){if(t&&i.shouldReuseRoute(e.value,t.value.snapshot)){let n=t.value;n._futureSnapshot=e.value;let r=b2(i,e,t);return new Mi(n,r)}else{if(i.shouldAttach(e.value)){let o=i.retrieve(e.value);if(o!==null){let s=o.route;return s.value._futureSnapshot=e.value,s.children=e.children.map(a=>Mu(i,a)),s}}let n=w2(e.value),r=e.children.map(o=>Mu(i,o));return new Mi(n,r)}}function b2(i,e,t){return e.children.map(n=>{for(let r of t.children)if(i.shouldReuseRoute(n.value,r.value.snapshot))return Mu(i,n,r);return Mu(i,n)})}function w2(i){return new hs(new st(i.url),new st(i.params),new st(i.queryParams),new st(i.fragment),new st(i.data),i.outlet,i.component,i)}var El=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},nM="ngNavigationCancelingError";function ef(i,e){let{redirectTo:t,navigationBehaviorOptions:n}=xl(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=iM(!1,ei.Redirect);return r.url=t,r.navigationBehaviorOptions=n,r}function iM(i,e){let t=new Error(`NavigationCancelingError: ${i||""}`);return t[nM]=!0,t.cancellationCode=e,t}function x2(i){return rM(i)&&xl(i.url)}function rM(i){return!!i&&i[nM]}var S2=(i,e,t,n)=>ze(r=>(new i_(e,r.targetRouterState,r.currentRouterState,t,n).activate(i),r)),i_=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,n,r,o){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r,this.inputBindingEnabled=o}activate(e){let t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Wy(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){let r=_l(t);e.children.forEach(o=>{let s=o.value.outlet;this.deactivateRoutes(o,r[s],n),delete r[s]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,n)})}deactivateRoutes(e,t,n){let r=e.value,o=t?t.value:null;if(r===o)if(r.component){let s=n.getContext(r.outlet);s&&this.deactivateChildRoutes(e,t,s.children)}else this.deactivateChildRoutes(e,t,n);else o&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,o=_l(e);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);if(n&&n.outlet){let s=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,o=_l(e);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,t,n){let r=_l(t);e.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],n),this.forwardEvent(new Xp(o.value.snapshot))}),e.children.length&&this.forwardEvent(new Yp(e.value.snapshot))}activateRoutes(e,t,n){let r=e.value,o=t?t.value:null;if(Wy(r),r===o)if(r.component){let s=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,s.children)}else this.activateChildRoutes(e,t,n);else if(r.component){let s=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),Wy(a.route.value),this.activateChildRoutes(e,null,s.children)}else s.attachRef=null,s.route=r,s.outlet&&s.outlet.activateWith(r,s.injector),this.activateChildRoutes(e,null,s.children)}else this.activateChildRoutes(e,null,n)}},tf=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},wl=class{component;route;constructor(e,t){this.component=e,this.route=t}};function C2(i,e,t){let n=i._root,r=e?e._root:null;return gu(n,r,t,[n.value])}function E2(i){let e=i.routeConfig?i.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:i,guards:e}}function Tl(i,e){let t=Symbol(),n=e.get(i,t);return n===t?typeof i=="function"&&!Pg(i)?i:e.get(i):n}function gu(i,e,t,n,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=_l(e);return i.children.forEach(s=>{M2(s,o[s.value.outlet],t,n.concat([s.value]),r),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>_u(a,t.getContext(s),r)),r}function M2(i,e,t,n,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=i.value,s=e?e.value:null,a=t?t.getContext(i.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){let l=D2(s,o,o.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new tf(n)):(o.data=s.data,o._resolvedData=s._resolvedData),o.component?gu(i,e,a?a.children:null,n,r):gu(i,e,t,n,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new wl(a.outlet.component,s))}else s&&_u(e,a,r),r.canActivateChecks.push(new tf(n)),o.component?gu(i,null,a?a.children:null,n,r):gu(i,null,t,n,r);return r}function D2(i,e,t){if(typeof t=="function")return t(i,e);switch(t){case"pathParamsChange":return!ta(i.url,e.url);case"pathParamsOrQueryParamsChange":return!ta(i.url,e.url)||!zr(i.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!t_(i,e)||!zr(i.queryParams,e.queryParams);case"paramsChange":default:return!t_(i,e)}}function _u(i,e,t){let n=_l(i),r=i.value;Object.entries(n).forEach(([o,s])=>{r.component?e?_u(s,e.children.getContext(o),t):_u(s,null,t):_u(s,e,t)}),r.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new wl(e.outlet.component,r)):t.canDeactivateChecks.push(new wl(null,r)):t.canDeactivateChecks.push(new wl(null,r))}function Pu(i){return typeof i=="function"}function I2(i){return typeof i=="boolean"}function T2(i){return i&&Pu(i.canLoad)}function A2(i){return i&&Pu(i.canActivate)}function R2(i){return i&&Pu(i.canActivateChild)}function P2(i){return i&&Pu(i.canDeactivate)}function N2(i){return i&&Pu(i.canMatch)}function oM(i){return i instanceof ro||i?.name==="EmptyError"}var Op=Symbol("INITIAL_VALUE");function Ml(){return jn(i=>Wd(i.map(e=>e.pipe(oo(1),yg(Op)))).pipe(ze(e=>{for(let t of e)if(t!==!0){if(t===Op)return Op;if(t===!1||k2(t))return t}return!0}),zn(e=>e!==Op),oo(1)))}function k2(i){return xl(i)||i instanceof El}function O2(i,e){return fn(t=>{let{targetSnapshot:n,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=t;return s.length===0&&o.length===0?Be(Ve(ne({},t),{guardsResult:!0})):L2(s,n,r,i).pipe(fn(a=>a&&I2(a)?F2(n,o,i,e):Be(a)),ze(a=>Ve(ne({},t),{guardsResult:a})))})}function L2(i,e,t,n){return Qt(i).pipe(fn(r=>U2(r.component,r.route,t,e,n)),so(r=>r!==!0,!0))}function F2(i,e,t,n){return Qt(e).pipe(Wo(r=>ja(B2(r.route.parent,n),V2(r.route,n),j2(i,r.path,t),z2(i,r.route,t))),so(r=>r!==!0,!0))}function V2(i,e){return i!==null&&e&&e(new Zp(i)),Be(!0)}function B2(i,e){return i!==null&&e&&e(new $p(i)),Be(!0)}function z2(i,e,t){let n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||n.length===0)return Be(!0);let r=n.map(o=>gc(()=>{let s=Dl(e)??t,a=Tl(o,s),l=A2(a)?a.canActivate(e,i):kn(s,()=>a(e,i));return Eo(l).pipe(so())}));return Be(r).pipe(Ml())}function j2(i,e,t){let n=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(s=>E2(s)).filter(s=>s!==null).map(s=>gc(()=>{let a=s.guards.map(l=>{let c=Dl(s.node)??t,u=Tl(l,c),h=R2(u)?u.canActivateChild(n,i):kn(c,()=>u(n,i));return Eo(h).pipe(so())});return Be(a).pipe(Ml())}));return Be(o).pipe(Ml())}function U2(i,e,t,n,r){let o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!o||o.length===0)return Be(!0);let s=o.map(a=>{let l=Dl(e)??r,c=Tl(a,l),u=P2(c)?c.canDeactivate(i,e,t,n):kn(l,()=>c(i,e,t,n));return Eo(u).pipe(so())});return Be(s).pipe(Ml())}function H2(i,e,t,n){let r=e.canLoad;if(r===void 0||r.length===0)return Be(!0);let o=r.map(s=>{let a=Tl(s,i),l=T2(a)?a.canLoad(e,t):kn(i,()=>a(e,t));return Eo(l)});return Be(o).pipe(Ml(),sM(n))}function sM(i){return ug(En(e=>{if(typeof e!="boolean")throw ef(i,e)}),ze(e=>e===!0))}function G2(i,e,t,n){let r=e.canMatch;if(!r||r.length===0)return Be(!0);let o=r.map(s=>{let a=Tl(s,i),l=N2(a)?a.canMatch(e,t):kn(i,()=>a(e,t));return Eo(l)});return Be(o).pipe(Ml(),sM(n))}var Du=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},Iu=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function yl(i){return za(new Du(i))}function q2(i){return za(new ue(4e3,!1))}function W2(i){return za(iM(!1,ei.GuardRejected))}var r_=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),r.numberOfChildren===0)return Be(n);if(r.numberOfChildren>1||!r.children[Je])return q2(`${e.redirectTo}`);r=r.children[Je]}}applyRedirectCommands(e,t,n,r,o){return $2(t,r,o).pipe(ze(s=>{if(s instanceof Ur)throw new Iu(s);let a=this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),e,n);if(s[0]==="/")throw new Iu(a);return a}))}applyRedirectCreateUrlTree(e,t,n,r){let o=this.createSegmentGroup(e,t.root,n,r);return new Ur(o,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let n={};return Object.entries(e).forEach(([r,o])=>{if(typeof o=="string"&&o[0]===":"){let a=o.substring(1);n[r]=t[a]}else n[r]=o}),n}createSegmentGroup(e,t,n,r){let o=this.createSegments(e,t.segments,n,r),s={};return Object.entries(t.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(e,l,n,r)}),new St(o,s)}createSegments(e,t,n,r){return t.map(o=>o.path[0]===":"?this.findPosParam(e,o,r):this.findOrReturn(o,n))}findPosParam(e,t,n){let r=n[t.path.substring(1)];if(!r)throw new ue(4001,!1);return r}findOrReturn(e,t){let n=0;for(let r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}};function $2(i,e,t){if(typeof i=="string")return Be(i);let n=i,{queryParams:r,fragment:o,routeConfig:s,url:a,outlet:l,params:c,data:u,title:h}=e;return Eo(kn(t,()=>n({params:c,data:u,queryParams:r,fragment:o,routeConfig:s,url:a,outlet:l,title:h})))}var o_={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Y2(i,e,t,n,r){let o=aM(i,e,t);return o.matched?(n=g2(e,n),G2(n,e,t,r).pipe(ze(s=>s===!0?o:ne({},o_)))):Be(o)}function aM(i,e,t){if(e.path==="**")return Z2(t);if(e.path==="")return e.pathMatch==="full"&&(i.hasChildren()||t.length>0)?ne({},o_):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let r=(e.matcher||LE)(t,i,e);if(!r)return ne({},o_);let o={};Object.entries(r.posParams??{}).forEach(([a,l])=>{o[a]=l.path});let s=r.consumed.length>0?ne(ne({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:s,positionalParamSegments:r.posParams??{}}}function Z2(i){return{matched:!0,parameters:i.length>0?VE(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function NE(i,e,t,n){return t.length>0&&Q2(i,t,n)?{segmentGroup:new St(e,K2(n,new St(t,i.children))),slicedSegments:[]}:t.length===0&&J2(i,t,n)?{segmentGroup:new St(i.segments,X2(i,t,n,i.children)),slicedSegments:t}:{segmentGroup:new St(i.segments,i.children),slicedSegments:t}}function X2(i,e,t,n){let r={};for(let o of t)if(of(i,e,o)&&!n[hr(o)]){let s=new St([],{});r[hr(o)]=s}return ne(ne({},n),r)}function K2(i,e){let t={};t[Je]=e;for(let n of i)if(n.path===""&&hr(n)!==Je){let r=new St([],{});t[hr(n)]=r}return t}function Q2(i,e,t){return t.some(n=>of(i,e,n)&&hr(n)!==Je)}function J2(i,e,t){return t.some(n=>of(i,e,n))}function of(i,e,t){return(i.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function eL(i,e,t){return e.length===0&&!i.children[t]}var s_=class{};function tL(i,e,t,n,r,o,s="emptyOnly"){return new a_(i,e,t,n,r,s,o).recognize()}var nL=31,a_=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,n,r,o,s,a){this.injector=e,this.configLoader=t,this.rootComponentType=n,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new r_(this.urlSerializer,this.urlTree)}noMatchError(e){return new ue(4002,`'${e.segmentGroup}'`)}recognize(){let e=NE(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(ze(({children:t,rootSnapshot:n})=>{let r=new Mi(n,t),o=new Eu("",r),s=$E(n,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),{state:o,tree:s}}))}match(e){let t=new na([],Object.freeze({}),Object.freeze(ne({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Je,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,Je,t).pipe(ze(n=>({children:n,rootSnapshot:t})),qo(n=>{if(n instanceof Iu)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof Du?this.noMatchError(n):n}))}processSegmentGroup(e,t,n,r,o){return n.segments.length===0&&n.hasChildren()?this.processChildren(e,t,n,o):this.processSegment(e,t,n,n.segments,r,!0,o).pipe(ze(s=>s instanceof Mi?[s]:[]))}processChildren(e,t,n,r){let o=[];for(let s of Object.keys(n.children))s==="primary"?o.unshift(s):o.push(s);return Qt(o).pipe(Wo(s=>{let a=n.children[s],l=v2(t,s);return this.processSegmentGroup(e,l,a,s,r)}),vg((s,a)=>(s.push(...a),s)),$o(null),gg(),fn(s=>{if(s===null)return yl(n);let a=lM(s);return iL(a),Be(a)}))}processSegment(e,t,n,r,o,s,a){return Qt(t).pipe(Wo(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,n,r,o,s,a).pipe(qo(c=>{if(c instanceof Du)return Be(null);throw c}))),so(l=>!!l),qo(l=>{if(oM(l))return eL(n,r,o)?Be(new s_):yl(n);throw l}))}processSegmentAgainstRoute(e,t,n,r,o,s,a,l){return hr(n)!==s&&(s===Je||!of(r,o,n))?yl(r):n.redirectTo===void 0?this.matchSegmentAgainstRoute(e,r,n,o,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,n,o,s,l):yl(r)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,o,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:h,remainingSegments:d}=aM(t,r,o);if(!l)return yl(t);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>nL&&(this.allowRedirects=!1));let p=new na(o,c,Object.freeze(ne({},this.urlTree.queryParams)),this.urlTree.fragment,kE(r),hr(r),r.component??r._loadedComponent??null,r,OE(r)),g=Jp(p,a,this.paramsInheritanceStrategy);return p.params=Object.freeze(g.params),p.data=Object.freeze(g.data),this.applyRedirects.applyRedirectCommands(u,r.redirectTo,h,p,e).pipe(jn(m=>this.applyRedirects.lineralizeSegments(r,m)),fn(m=>this.processSegment(e,n,t,m.concat(d),s,!1,a)))}matchSegmentAgainstRoute(e,t,n,r,o,s){let a=Y2(t,n,r,e,this.urlSerializer);return n.path==="**"&&(t.children={}),a.pipe(jn(l=>l.matched?(e=n._injector??e,this.getChildConfig(e,n,r).pipe(jn(({routes:c})=>{let u=n._loadedInjector??e,{parameters:h,consumedSegments:d,remainingSegments:p}=l,g=new na(d,h,Object.freeze(ne({},this.urlTree.queryParams)),this.urlTree.fragment,kE(n),hr(n),n.component??n._loadedComponent??null,n,OE(n)),f=Jp(g,s,this.paramsInheritanceStrategy);g.params=Object.freeze(f.params),g.data=Object.freeze(f.data);let{segmentGroup:m,slicedSegments:v}=NE(t,d,p,c);if(v.length===0&&m.hasChildren())return this.processChildren(u,c,m,g).pipe(ze(x=>new Mi(g,x)));if(c.length===0&&v.length===0)return Be(new Mi(g,[]));let y=hr(n)===o;return this.processSegment(u,c,m,v,y?Je:o,!0,g).pipe(ze(x=>new Mi(g,x instanceof Mi?[x]:[])))}))):yl(t)))}getChildConfig(e,t,n){return t.children?Be({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Be({routes:t._loadedRoutes,injector:t._loadedInjector}):H2(e,t,n,this.urlSerializer).pipe(fn(r=>r?this.configLoader.loadChildren(e,t).pipe(En(o=>{t._loadedRoutes=o.routes,t._loadedInjector=o.injector})):W2(t))):Be({routes:[],injector:e})}};function iL(i){i.sort((e,t)=>e.value.outlet===Je?-1:t.value.outlet===Je?1:e.value.outlet.localeCompare(t.value.outlet))}function rL(i){let e=i.value.routeConfig;return e&&e.path===""}function lM(i){let e=[],t=new Set;for(let n of i){if(!rL(n)){e.push(n);continue}let r=e.find(o=>n.value.routeConfig===o.value.routeConfig);r!==void 0?(r.children.push(...n.children),t.add(r)):e.push(n)}for(let n of t){let r=lM(n.children);e.push(new Mi(n.value,r))}return e.filter(n=>!t.has(n))}function kE(i){return i.data||{}}function OE(i){return i.resolve||{}}function oL(i,e,t,n,r,o){return fn(s=>tL(i,e,t,n,s.extractedUrl,r,o).pipe(ze(({state:a,tree:l})=>Ve(ne({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function sL(i,e){return fn(t=>{let{targetSnapshot:n,guards:{canActivateChecks:r}}=t;if(!r.length)return Be(t);let o=new Set(r.map(l=>l.route)),s=new Set;for(let l of o)if(!s.has(l))for(let c of cM(l))s.add(c);let a=0;return Qt(s).pipe(Wo(l=>o.has(l)?aL(l,n,i,e):(l.data=Jp(l,l.parent,i).resolve,Be(void 0))),En(()=>a++),Ua(1),fn(l=>a===s.size?Be(t):si))})}function cM(i){let e=i.children.map(t=>cM(t)).flat();return[i,...e]}function aL(i,e,t,n){let r=i.routeConfig,o=i._resolve;return r?.title!==void 0&&!eM(r)&&(o[Tu]=r.title),gc(()=>(i.data=Jp(i,i.parent,t).resolve,lL(o,i,e,n).pipe(ze(s=>(i._resolvedData=s,i.data=ne(ne({},i.data),s),null)))))}function lL(i,e,t,n){let r=Zy(i);if(r.length===0)return Be({});let o={};return Qt(r).pipe(fn(s=>cL(i[s],e,t,n).pipe(so(),En(a=>{if(a instanceof El)throw ef(new ra,a);o[s]=a}))),Ua(1),ze(()=>o),qo(s=>oM(s)?si:za(s)))}function cL(i,e,t,n){let r=Dl(e)??n,o=Tl(i,r),s=o.resolve?o.resolve(e,t):kn(r,()=>o(e,t));return Eo(s)}function $y(i){return jn(e=>{let t=i(e);return t?Qt(t).pipe(ze(()=>e)):Be(e)})}var d_=(()=>{class i{buildTitle(t){let n,r=t.root;for(;r!==void 0;)n=this.getResolvedTitleForRoute(r)??n,r=r.children.find(o=>o.outlet===Je);return n}getResolvedTitleForRoute(t){return t.data[Tu]}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>oe(uM),providedIn:"root"})}return i})(),uM=(()=>{class i extends d_{title;constructor(t){super(),this.title=t}updateTitle(t){let n=this.buildTitle(t);n!==void 0&&this.title.setTitle(n)}static \u0275fac=function(n){return new(n||i)(Ce(DE))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Nu=new we("",{providedIn:"root",factory:()=>({})}),ku=new we(""),dM=(()=>{class i{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=oe(ny);loadComponent(t,n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Be(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let r=Eo(kn(t,()=>n.loadComponent())).pipe(ze(pM),jn(fM),En(s=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=s}),Ns(()=>{this.componentLoaders.delete(n)})),o=new Ba(r,()=>new Tt).pipe(Va());return this.componentLoaders.set(n,o),o}loadChildren(t,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return Be({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);let o=hM(n,this.compiler,t,this.onLoadEndListener).pipe(Ns(()=>{this.childrenLoaders.delete(n)})),s=new Ba(o,()=>new Tt).pipe(Va());return this.childrenLoaders.set(n,s),s}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function hM(i,e,t,n){return Eo(kn(t,()=>i.loadChildren())).pipe(ze(pM),jn(fM),fn(r=>r instanceof sp||Array.isArray(r)?Be(r):Qt(e.compileModuleAsync(r))),ze(r=>{n&&n(i);let o,s,a=!1;return Array.isArray(r)?(s=r,a=!0):(o=r.create(t).injector,s=o.get(ku,[],{optional:!0,self:!0}).flat()),{routes:s.map(u_),injector:o}}))}function uL(i){return i&&typeof i=="object"&&"default"in i}function pM(i){return uL(i)?i.default:i}function fM(i){return Be(i)}var sf=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>oe(dL),providedIn:"root"})}return i})(),dL=(()=>{class i{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),mM=new we("");var gM=new we(""),vM=(()=>{class i{currentNavigation=at(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new Tt;transitionAbortWithErrorSubject=new Tt;configLoader=oe(dM);environmentInjector=oe(mn);destroyRef=oe(co);urlSerializer=oe(Au);rootContexts=oe(Il);location=oe(pl);inputBindingEnabled=oe(rf,{optional:!0})!==null;titleStrategy=oe(d_);options=oe(Nu,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=oe(sf);createViewTransition=oe(mM,{optional:!0});navigationErrorHandler=oe(gM,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Be(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=r=>this.events.next(new qp(r)),n=r=>this.events.next(new Wp(r));this.configLoader.onLoadEndListener=n,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let n=++this.navigationId;yn(()=>{this.transitions?.next(Ve(ne({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:n}))})}setupNavigations(t){return this.transitions=new st(null),this.transitions.pipe(zn(n=>n!==null),jn(n=>{let r=!1;return Be(n).pipe(jn(o=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",ei.SupersededByNewNavigation),si;this.currentTransition=n,this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?Ve(ne({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>o.abortController.abort()});let s=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),a=o.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!s&&a!=="reload")return this.events.next(new Co(o.id,this.urlSerializer.serialize(o.rawUrl),"",wu.IgnoredSameUrlNavigation)),o.resolve(!1),si;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return Be(o).pipe(jn(l=>(this.events.next(new oa(l.id,this.urlSerializer.serialize(l.extractedUrl),l.source,l.restoredState)),l.id!==this.navigationId?si:Promise.resolve(l))),oL(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),En(l=>{n.targetSnapshot=l.targetSnapshot,n.urlAfterRedirects=l.urlAfterRedirects,this.currentNavigation.update(u=>(u.finalUrl=l.urlAfterRedirects,u));let c=new xu(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}));if(s&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:l,extractedUrl:c,source:u,restoredState:h,extras:d}=o,p=new oa(l,this.urlSerializer.serialize(c),u,h);this.events.next(p);let g=QE(this.rootComponentType).snapshot;return this.currentTransition=n=Ve(ne({},o),{targetSnapshot:g,urlAfterRedirects:c,extras:Ve(ne({},d),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(f=>(f.finalUrl=c,f)),Be(n)}else return this.events.next(new Co(o.id,this.urlSerializer.serialize(o.extractedUrl),"",wu.IgnoredByUrlHandlingStrategy)),o.resolve(!1),si}),En(o=>{let s=new jp(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(s)}),ze(o=>(this.currentTransition=n=Ve(ne({},o),{guards:C2(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),n)),O2(this.environmentInjector,o=>this.events.next(o)),En(o=>{if(n.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw ef(this.urlSerializer,o.guardsResult);let s=new Up(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(s)}),zn(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",ei.GuardRejected),!1)),$y(o=>{if(o.guards.canActivateChecks.length!==0)return Be(o).pipe(En(s=>{let a=new Hp(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),jn(s=>{let a=!1;return Be(s).pipe(sL(this.paramsInheritanceStrategy,this.environmentInjector),En({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(s,"",ei.NoDataFromResolver)}}))}),En(s=>{let a=new Gp(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}))}),$y(o=>{let s=a=>{let l=[];if(a.routeConfig?.loadComponent){let c=Dl(a)??this.environmentInjector;l.push(this.configLoader.loadComponent(c,a.routeConfig).pipe(En(u=>{a.component=u}),ze(()=>{})))}for(let c of a.children)l.push(...s(c));return l};return Wd(s(o.targetSnapshot.root)).pipe($o(null),oo(1))}),$y(()=>this.afterPreactivation()),jn(()=>{let{currentSnapshot:o,targetSnapshot:s}=n,a=this.createViewTransition?.(this.environmentInjector,o.root,s.root);return a?Qt(a).pipe(ze(()=>n)):Be(n)}),ze(o=>{let s=_2(t.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=n=Ve(ne({},o),{targetRouterState:s}),this.currentNavigation.update(a=>(a.targetRouterState=s,a)),n}),En(()=>{this.events.next(new Su)}),S2(this.rootContexts,t.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),oo(1),Ha(new ct(o=>{let s=n.abortController.signal,a=()=>o.next();return s.addEventListener("abort",a),()=>s.removeEventListener("abort",a)}).pipe(zn(()=>!r&&!n.targetRouterState),En(()=>{this.cancelNavigationTransition(n,n.abortController.signal.reason+"",ei.Aborted)}))),En({next:o=>{r=!0,this.lastSuccessfulNavigation=yn(this.currentNavigation),this.events.next(new So(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),Ha(this.transitionAbortWithErrorSubject.pipe(En(o=>{throw o}))),Ns(()=>{r||this.cancelNavigationTransition(n,"",ei.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),qo(o=>{if(this.destroyed)return n.resolve(!1),si;if(r=!0,rM(o))this.events.next(new jr(n.id,this.urlSerializer.serialize(n.extractedUrl),o.message,o.cancellationCode)),x2(o)?this.events.next(new Cl(o.url,o.navigationBehaviorOptions)):n.resolve(!1);else{let s=new Sl(n.id,this.urlSerializer.serialize(n.extractedUrl),o,n.targetSnapshot??void 0);try{let a=kn(this.environmentInjector,()=>this.navigationErrorHandler?.(s));if(a instanceof El){let{message:l,cancellationCode:c}=ef(this.urlSerializer,a);this.events.next(new jr(n.id,this.urlSerializer.serialize(n.extractedUrl),l,c)),this.events.next(new Cl(a.redirectTo,a.navigationBehaviorOptions))}else throw this.events.next(s),o}catch(a){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(a)}}return si}))}))}cancelNavigationTransition(t,n,r){let o=new jr(t.id,this.urlSerializer.serialize(t.extractedUrl),n,r);this.events.next(o),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),n=yn(this.currentNavigation),r=n?.targetBrowserUrl??n?.extractedUrl;return t.toString()!==r?.toString()&&!n?.extras.skipLocationChange}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function hL(i){return i!==yu}var yM=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>oe(pL),providedIn:"root"})}return i})(),nf=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},pL=(()=>{class i extends nf{static \u0275fac=(()=>{let t;return function(r){return(t||(t=ss(i)))(r||i)}})();static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),_M=(()=>{class i{urlSerializer=oe(Au);options=oe(Nu,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=oe(pl);urlHandlingStrategy=oe(sf);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Ur;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:n,targetBrowserUrl:r}){let o=t!==void 0?this.urlHandlingStrategy.merge(t,n):n,s=r??o;return s instanceof Ur?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:t,finalUrl:n,initialUrl:r}){n&&t?(this.currentUrlTree=n,this.rawUrlTree=this.urlHandlingStrategy.merge(n,r),this.routerState=t):this.rawUrlTree=r}routerState=QE(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:()=>oe(fL),providedIn:"root"})}return i})(),fL=(()=>{class i extends _M{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(n=>{n.type==="popstate"&&setTimeout(()=>{t(n.url,n.state,"popstate")})})}handleRouterEvent(t,n){t instanceof oa?this.updateStateMemento():t instanceof Co?this.commitTransition(n):t instanceof xu?this.urlUpdateStrategy==="eager"&&(n.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof Su?(this.commitTransition(n),this.urlUpdateStrategy==="deferred"&&!n.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof jr&&t.code!==ei.SupersededByNewNavigation&&t.code!==ei.Redirect?this.restoreHistory(n):t instanceof Sl?this.restoreHistory(n,!0):t instanceof So&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:n,id:r}){let{replaceUrl:o,state:s}=n;if(this.location.isCurrentPathEqualTo(t)||o){let a=this.browserPageId,l=ne(ne({},s),this.generateNgRouterState(r,a));this.location.replaceState(t,"",l)}else{let a=ne(ne({},s),this.generateNgRouterState(r,this.browserPageId+1));this.location.go(t,"",a)}}restoreHistory(t,n=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,o=this.currentPageId-r;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===t.finalUrl&&o===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(n&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,n){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:n}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(r){return(t||(t=ss(i)))(r||i)}})();static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function h_(i,e){i.events.pipe(zn(t=>t instanceof So||t instanceof jr||t instanceof Sl||t instanceof Co),ze(t=>t instanceof So||t instanceof Co?0:(t instanceof jr?t.code===ei.Redirect||t.code===ei.SupersededByNewNavigation:!1)?2:1),zn(t=>t!==2),oo(1)).subscribe(()=>{e()})}var mL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},gL={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Hr=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=oe(ap);stateManager=oe(_M);options=oe(Nu,{optional:!0})||{};pendingTasks=oe(Nr);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=oe(vM);urlSerializer=oe(Au);location=oe(pl);urlHandlingStrategy=oe(sf);injector=oe(mn);_events=new Tt;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=oe(yM);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=oe(ku,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!oe(rf,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new an;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(n=>{try{let r=this.navigationTransitions.currentTransition,o=yn(this.navigationTransitions.currentNavigation);if(r!==null&&o!==null){if(this.stateManager.handleRouterEvent(n,o),n instanceof jr&&n.code!==ei.Redirect&&n.code!==ei.SupersededByNewNavigation)this.navigated=!0;else if(n instanceof So)this.navigated=!0;else if(n instanceof Cl){let s=n.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(n.url,r.currentRawUrl),l=ne({browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||hL(r.source)},s);this.scheduleNavigation(a,yu,null,l,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}m2(n)&&this._events.next(n)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),yu,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,n,r)=>{this.navigateToSyncWithBrowser(t,r,n)})}navigateToSyncWithBrowser(t,n,r){let o={replaceUrl:!0},s=r?.navigationId?r:null;if(r){let l=ne({},r);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let a=this.parseUrl(t);this.scheduleNavigation(a,n,s,o).catch(l=>{this.disposed||this.injector.get(Kn)(l)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return yn(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(u_),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,n={}){let{relativeTo:r,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:l}=n,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=ne(ne({},this.currentUrlTree.queryParams),o);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=o||null}u!==null&&(u=this.removeEmptyProps(u));let h;try{let d=r?r.snapshot:this.routerState.snapshot.root;h=YE(d)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),h=this.currentUrlTree.root}return ZE(h,t,u,c??null)}navigateByUrl(t,n={skipLocationChange:!1}){let r=xl(t)?t:this.parseUrl(t),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,yu,null,n)}navigate(t,n={skipLocationChange:!1}){return vL(t),this.navigateByUrl(this.createUrlTree(t,n),n)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,n){let r;if(n===!0?r=ne({},mL):n===!1?r=ne({},gL):r=n,xl(t))return TE(this.currentUrlTree,t,r);let o=this.parseUrl(t);return TE(this.currentUrlTree,o,r)}removeEmptyProps(t){return Object.entries(t).reduce((n,[r,o])=>(o!=null&&(n[r]=o),n),{})}scheduleNavigation(t,n,r,o,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((h,d)=>{a=h,l=d});let u=this.pendingTasks.add();return h_(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:o,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(h=>Promise.reject(h))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function vL(i){for(let e=0;e<i.length;e++)if(i[e]==null)throw new ue(4008,!1)}var _L=new we("");function p_(i,...e){return Dr([{provide:ku,multi:!0,useValue:i},[],{provide:hs,useFactory:bL,deps:[Hr]},{provide:cp,multi:!0,useFactory:wL},e.map(t=>t.\u0275providers)])}function bL(i){return i.routerState.root}function wL(){let i=oe(ki);return e=>{let t=i.get(_o);if(e!==t.components[0])return;let n=i.get(Hr),r=i.get(xL);i.get(SL)===1&&n.initialNavigation(),i.get(CL,null,{optional:!0})?.setUpPreloading(),i.get(_L,null,{optional:!0})?.init(),n.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var xL=new we("",{factory:()=>new Tt}),SL=new we("",{providedIn:"root",factory:()=>1});var CL=new we("");var af=class i{static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-welcome-pane"]],decls:5,vars:0,consts:[[1,"welcome"]],template:function(t,n){t&1&&(Zt(0,"div",0)(1,"h1"),A(2,"WIP"),jt(),Zt(3,"p"),A(4,"Enjoy your Dungeons & Dragons adventure!"),jt()())},dependencies:[ke],encapsulation:2})};var IM=(()=>{class i{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,n){this._renderer=t,this._elementRef=n}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(n){return new(n||i)(se(Xs),se(Fn))};static \u0275dir=en({type:i})}return i})(),TM=(()=>{class i extends IM{static \u0275fac=(()=>{let t;return function(r){return(t||(t=ss(i)))(r||i)}})();static \u0275dir=en({type:i,features:[lr]})}return i})(),ju=new we(""),ML={provide:ju,useExisting:Li(()=>v_),multi:!0},v_=(()=>{class i extends TM{writeValue(t){this.setProperty("checked",t)}static \u0275fac=(()=>{let t;return function(r){return(t||(t=ss(i)))(r||i)}})();static \u0275dir=en({type:i,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,r){n&1&&Y("change",function(s){return r.onChange(s.target.checked)})("blur",function(){return r.onTouched()})},standalone:!1,features:[bo([ML]),lr]})}return i})(),DL={provide:ju,useExisting:Li(()=>Gr),multi:!0};function IL(){let i=Hi()?Hi().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var TL=new we(""),Gr=(()=>{class i extends IM{_compositionMode;_composing=!1;constructor(t,n,r){super(t,n),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!IL())}writeValue(t){let n=t??"";this.setProperty("value",n)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(n){return new(n||i)(se(Xs),se(Fn),se(TL,8))};static \u0275dir=en({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,r){n&1&&Y("input",function(s){return r._handleInput(s.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(s){return r._compositionEnd(s.target.value)})},standalone:!1,features:[bo([DL]),lr]})}return i})();function AL(i){return i==null||RL(i)===0}function RL(i){return i==null?null:Array.isArray(i)||typeof i=="string"?i.length:i instanceof Set?i.size:null}var y_=new we(""),AM=new we("");function PL(i){return AL(i.value)?{required:!0}:null}function bM(i){return null}function RM(i){return i!=null}function PM(i){return yo(i)?Qt(i):i}function NM(i){let e={};return i.forEach(t=>{e=t!=null?ne(ne({},e),t):e}),Object.keys(e).length===0?null:e}function kM(i,e){return e.map(t=>t(i))}function NL(i){return!i.validate}function OM(i){return i.map(e=>NL(e)?e:t=>e.validate(t))}function kL(i){if(!i)return null;let e=i.filter(RM);return e.length==0?null:function(t){return NM(kM(t,e))}}function __(i){return i!=null?kL(OM(i)):null}function OL(i){if(!i)return null;let e=i.filter(RM);return e.length==0?null:function(t){let n=kM(t,e).map(PM);return mg(n).pipe(ze(NM))}}function b_(i){return i!=null?OL(OM(i)):null}function wM(i,e){return i===null?[e]:Array.isArray(i)?[...i,e]:[i,e]}function LL(i){return i._rawValidators}function FL(i){return i._rawAsyncValidators}function m_(i){return i?Array.isArray(i)?i:[i]:[]}function cf(i,e){return Array.isArray(i)?i.includes(e):i===e}function xM(i,e){let t=m_(e);return m_(i).forEach(r=>{cf(t,r)||t.push(r)}),t}function SM(i,e){return m_(e).filter(t=>!cf(i,t))}var uf=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=__(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=b_(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Pl=class extends uf{name;get formDirective(){return null}get path(){return null}},zu=class extends uf{_parent=null;name=null;valueAccessor=null},df=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},VL={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},qne=Ve(ne({},VL),{"[class.ng-submitted]":"isSubmitted"}),fs=(()=>{class i extends df{constructor(t){super(t)}static \u0275fac=function(n){return new(n||i)(se(zu,2))};static \u0275dir=en({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,r){n&2&&Ze("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[lr]})}return i})(),LM=(()=>{class i extends df{constructor(t){super(t)}static \u0275fac=function(n){return new(n||i)(se(Pl,10))};static \u0275dir=en({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,r){n&2&&Ze("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},standalone:!1,features:[lr]})}return i})();var Ou="VALID",lf="INVALID",Al="PENDING",Lu="DISABLED",ps=class{},hf=class extends ps{value;source;constructor(e,t){super(),this.value=e,this.source=t}},Vu=class extends ps{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},Bu=class extends ps{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},Rl=class extends ps{status;source;constructor(e,t){super(),this.status=e,this.source=t}},g_=class extends ps{source;constructor(e){super(),this.source=e}},pf=class extends ps{source;constructor(e){super(),this.source=e}};function FM(i){return(gf(i)?i.validators:i)||null}function BL(i){return Array.isArray(i)?__(i):i||null}function VM(i,e){return(gf(e)?e.asyncValidators:i)||null}function zL(i){return Array.isArray(i)?b_(i):i||null}function gf(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function jL(i,e,t){let n=i.controls;if(!(e?Object.keys(n):n).length)throw new ue(1e3,"");if(!n[t])throw new ue(1001,"")}function UL(i,e,t){i._forEachChild((n,r)=>{if(t[r]===void 0)throw new ue(1002,"")})}var ff=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return yn(this.statusReactive)}set status(e){yn(()=>this.statusReactive.set(e))}_status=Vr(()=>this.statusReactive());statusReactive=at(void 0);get valid(){return this.status===Ou}get invalid(){return this.status===lf}get pending(){return this.status==Al}get disabled(){return this.status===Lu}get enabled(){return this.status!==Lu}errors;get pristine(){return yn(this.pristineReactive)}set pristine(e){yn(()=>this.pristineReactive.set(e))}_pristine=Vr(()=>this.pristineReactive());pristineReactive=at(!0);get dirty(){return!this.pristine}get touched(){return yn(this.touchedReactive)}set touched(e){yn(()=>this.touchedReactive.set(e))}_touched=Vr(()=>this.touchedReactive());touchedReactive=at(!1);get untouched(){return!this.touched}_events=new Tt;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(xM(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(xM(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(SM(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(SM(e,this._rawAsyncValidators))}hasValidator(e){return cf(this._rawValidators,e)}hasAsyncValidator(e){return cf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Ve(ne({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new Bu(!0,n))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new Bu(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Ve(ne({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new Vu(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new Vu(!0,n))}markAsPending(e={}){this.status=Al;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Rl(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Ve(ne({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Lu,this.errors=null,this._forEachChild(r=>{r.disable(Ve(ne({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new hf(this.value,n)),this._events.next(new Rl(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ve(ne({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ou,this._forEachChild(n=>{n.enable(Ve(ne({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Ve(ne({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ou||this.status===Al)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new hf(this.value,t)),this._events.next(new Rl(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Ve(ne({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Lu:Ou}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Al,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let n=PM(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,r)=>n&&n._find(r),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new Rl(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new xt,this.statusChanges=new xt}_calculateStatus(){return this._allControlsDisabled()?Lu:this.errors?lf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Al)?Al:this._anyControlsHaveStatus(lf)?lf:Ou}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),r=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new Vu(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Bu(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){gf(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=BL(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=zL(this._rawAsyncValidators)}},mf=class extends ff{constructor(e,t,n){super(FM(t),VM(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){UL(this,!0,e),Object.keys(e).forEach(n=>{jL(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(n=>{let r=this.controls[n];r&&r.patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e?e[r]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new pf(this))}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,n)=>n._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,n]of Object.entries(this.controls))if(this.contains(t)&&e(n))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,n,r)=>((n.enabled||this.disabled)&&(t[r]=n.value),t))}_reduceChildren(e,t){let n=e;return this._forEachChild((r,o)=>{n=t(n,r,o)}),n}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var w_=new we("",{providedIn:"root",factory:()=>x_}),x_="always";function HL(i,e){return[...e.path,i]}function BM(i,e,t=x_){zM(i,e),e.valueAccessor.writeValue(i.value),(i.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(i.disabled),qL(i,e),$L(i,e),WL(i,e),GL(i,e)}function CM(i,e){i.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function GL(i,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(t),e._registerOnDestroy(()=>{i._unregisterOnDisabledChange(t)})}}function zM(i,e){let t=LL(i);e.validator!==null?i.setValidators(wM(t,e.validator)):typeof t=="function"&&i.setValidators([t]);let n=FL(i);e.asyncValidator!==null?i.setAsyncValidators(wM(n,e.asyncValidator)):typeof n=="function"&&i.setAsyncValidators([n]);let r=()=>i.updateValueAndValidity();CM(e._rawValidators,r),CM(e._rawAsyncValidators,r)}function qL(i,e){e.valueAccessor.registerOnChange(t=>{i._pendingValue=t,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&jM(i,e)})}function WL(i,e){e.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&jM(i,e),i.updateOn!=="submit"&&i.markAsTouched()})}function jM(i,e){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function $L(i,e){let t=(n,r)=>{e.valueAccessor.writeValue(n),r&&e.viewToModelUpdate(n)};i.registerOnChange(t),e._registerOnDestroy(()=>{i._unregisterOnChange(t)})}function YL(i,e){i==null,zM(i,e)}function ZL(i,e){if(!i.hasOwnProperty("model"))return!1;let t=i.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function XL(i){return Object.getPrototypeOf(i.constructor)===TM}function KL(i,e){i._syncPendingControls(),e.forEach(t=>{let n=t.control;n.updateOn==="submit"&&n._pendingChange&&(t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function QL(i,e){if(!e)return null;Array.isArray(e);let t,n,r;return e.forEach(o=>{o.constructor===Gr?t=o:XL(o)?n=o:r=o}),r||n||t||null}var JL={provide:Pl,useExisting:Li(()=>S_)},Fu=Promise.resolve(),S_=(()=>{class i extends Pl{callSetDisabledState;get submitted(){return yn(this.submittedReactive)}_submitted=Vr(()=>this.submittedReactive());submittedReactive=at(!1);_directives=new Set;form;ngSubmit=new xt;options;constructor(t,n,r){super(),this.callSetDisabledState=r,this.form=new mf({},__(t),b_(n))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Fu.then(()=>{let n=this._findContainer(t.path);t.control=n.registerControl(t.name,t.control),BM(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Fu.then(()=>{let n=this._findContainer(t.path);n&&n.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Fu.then(()=>{let n=this._findContainer(t.path),r=new mf({});YL(r,t),n.registerControl(t.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Fu.then(()=>{let n=this._findContainer(t.path);n&&n.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,n){Fu.then(()=>{this.form.get(t.path).setValue(n)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),KL(this.form,this._directives),this.ngSubmit.emit(t),this.form._events.next(new g_(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static \u0275fac=function(n){return new(n||i)(se(y_,10),se(AM,10),se(w_,8))};static \u0275dir=en({type:i,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(n,r){n&1&&Y("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[bo([JL]),lr]})}return i})();function EM(i,e){let t=i.indexOf(e);t>-1&&i.splice(t,1)}function MM(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var eF=class extends ff{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,n){super(FM(t),VM(n,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),gf(t)&&(t.nonNullable||t.initialValueIsDefault)&&(MM(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1,t?.emitEvent!==!1&&this._events.next(new pf(this))}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){EM(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){EM(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){MM(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var tF={provide:zu,useExisting:Li(()=>Mo)},DM=Promise.resolve(),Mo=(()=>{class i extends zu{_changeDetectorRef;callSetDisabledState;control=new eF;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new xt;constructor(t,n,r,o,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=t,this._setValidators(n),this._setAsyncValidators(r),this.valueAccessor=QL(this,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),ZL(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){BM(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){DM.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let n=t.isDisabled.currentValue,r=n!==0&&fp(n);DM.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?HL(t,this._parent):[t]}static \u0275fac=function(n){return new(n||i)(se(Pl,9),se(y_,10),se(AM,10),se(ju,10),se(ls,8),se(w_,8))};static \u0275dir=en({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[bo([tF]),lr,po]})}return i})();var UM=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275dir=en({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return i})();var nF=(()=>{class i{_validator=bM;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let n=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(n),this._validator=this._enabled?this.createValidator(n):bM,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(n){return new(n||i)};static \u0275dir=en({type:i,features:[po]})}return i})();var iF={provide:y_,useExisting:Li(()=>C_),multi:!0};var C_=(()=>{class i extends nF{required;inputName="required";normalizeInput=fp;createValidator=t=>PL;enabled(t){return t}static \u0275fac=(()=>{let t;return function(r){return(t||(t=ss(i)))(r||i)}})();static \u0275dir=en({type:i,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(n,r){n&2&&Jn("required",r._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[bo([iF]),lr]})}return i})();var rF=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=vo({type:i});static \u0275inj=Er({})}return i})();var ms=(()=>{class i{static withConfig(t){return{ngModule:i,providers:[{provide:w_,useValue:t.callSetDisabledState??x_}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=vo({type:i});static \u0275inj=Er({imports:[rF]})}return i})();var yf=(t=>(t.METAL_BUTTON="METAL_BUTTON",t.OLD_RADIO_BUTTON="OLD_RADIO_BUTTON",t))(yf||{}),oF=["sounds/bong_001.ogg","sounds/click_002.ogg","sounds/click_003.ogg","sounds/click_005.ogg","sfx/click_empty.ogg","sfx/right_click.ogg","sounds/glass_002.ogg","sounds/switch_select_001.ogg","sounds/type/type_001.ogg","sounds/type/type_002.ogg","sounds/type/type_003.ogg","sounds/dice_checks/dice_success.ogg","sounds/dice_checks/dice_failure.ogg","sfx/equip.ogg","sfx/unequip.ogg"],HM="dnd-ai:sound-effects-enabled",Dn=class i{canUseStorage=typeof window<"u"&&typeof window.localStorage<"u";defaultTypeVolume=.55;soundEnabled=!0;typeAudio;cache=new Map;preloadPromise=null;effectsEnabledSubject=new st(!0);effectsEnabled$=this.effectsEnabledSubject.asObservable();constructor(){this.soundEnabled=this.restoreSetting(),this.effectsEnabledSubject.next(this.soundEnabled),this.typeAudio=new Audio("sounds/type/type_002.ogg"),this.typeAudio.volume=this.defaultTypeVolume}preloadAll(){if(this.preloadPromise)return this.preloadPromise;let e=[...new Set(oF)];return this.preloadPromise=Promise.allSettled(e.map(t=>this.preloadOne(t))).then(()=>{}),this.preloadPromise}has(e){return this.cache.has(e)}preloadOne(e){return this.cache.has(e)?Promise.resolve():new Promise(t=>{let n=new Audio(e),r=()=>{s();try{n.currentTime=0}catch{}this.cache.set(e,n),t()},o=()=>{s(),t()},s=()=>{n.removeEventListener("canplaythrough",r),n.removeEventListener("loadeddata",r),n.removeEventListener("error",o)};n.preload="auto",n.addEventListener("canplaythrough",r,{once:!0}),n.addEventListener("loadeddata",r,{once:!0}),n.addEventListener("error",o,{once:!0}),n.load()})}playHoverSound(){this.play("sounds/switch_select_001.ogg",.2)}playClickSound(e="METAL_BUTTON"){switch(e){case"METAL_BUTTON":this.play("sounds/click/metal_button_down.ogg");break;case"OLD_RADIO_BUTTON":this.play("sounds/click/old_radio_button_down.ogg");break}}playMouseUpSound(e="METAL_BUTTON"){switch(e){case"METAL_BUTTON":this.play("sounds/click/metal_button_up.ogg");break;case"OLD_RADIO_BUTTON":this.play("sounds/click/old_radio_button_up.ogg");break}}playEmptyClickSound(){this.play("sfx/click_empty.ogg",1)}playRightClickSound(){this.play("sfx/right_click.ogg",1)}playCancelSound(){this.play("sounds/glass_002.ogg")}playSendMessageSound(){this.play("sounds/bong_001.ogg")}playRollDiceSound(){this.play("sounds/click_002.ogg")}playClickSuggestionSound(){this.play("sounds/switch_001.ogg")}playDiceNoDcSound(){this.play("sounds/dice_checks/dice_no_dc.ogg",1)}playDiceSuccessSound(){this.play("sounds/dice_checks/dice_success.ogg",1)}playDiceFailureSound(){this.play("sounds/dice_checks/dice_failure.ogg",1)}playScrollSound(){this.play("sounds/scroll_003.ogg")}playTypeSound(){if(this.soundEnabled)try{this.typeAudio.currentTime=0,this.typeAudio.play()}catch{}}play(e,t=1){if(this.soundEnabled)try{let r=(this.cache.get(e)??new Audio(e)).cloneNode(!0);r.volume=t,r.play()}catch{}}playEquipSound(){this.play("sfx/equip.ogg",1)}playUnequipSound(){this.play("sfx/unequip.ogg",1)}isSoundEffectsEnabled(){return this.soundEnabled}setSoundEffectsEnabled(e){this.soundEnabled=e,this.persistSetting(e),this.effectsEnabledSubject.next(e)}restoreSetting(){if(!this.canUseStorage)return!0;try{let e=window.localStorage.getItem(HM);return e===null?!0:e==="true"}catch{return!0}}persistSetting(e){if(this.canUseStorage)try{window.localStorage.setItem(HM,String(e))}catch{}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var Gt=class i{constructor(e){this.soundService=e}isDown=!1;clickSoundType="METAL_BUTTON";onMouseEnter(){this.isDown||this.soundService.playHoverSound()}onClick(){this.soundService.playClickSound(this.clickSoundType),this.isDown=!0}onMouseUp(){this.soundService.playMouseUpSound(this.clickSoundType),this.isDown=!1}onDocumentMouseUp(){this.isDown&&(this.isDown=!1)}static \u0275fac=function(t){return new(t||i)(se(Dn))};static \u0275dir=en({type:i,selectors:[["","clickableDivWithSound",""]],hostBindings:function(t,n){t&1&&Y("mouseenter",function(){return n.onMouseEnter()})("mousedown",function(){return n.onClick()})("mouseup",function(){return n.onMouseUp()})("mouseup",function(){return n.onDocumentMouseUp()},Si)},inputs:{clickSoundType:"clickSoundType"}})};var M_=(O=>(O.Initiative="INITIATIVE",O.Strength="STRENGTH",O.Dexterity="DEXTERITY",O.Constitution="CONSTITUTION",O.Intelligence="INTELLIGENCE",O.Wisdom="WISDOM",O.Charisma="CHARISMA",O.StrengthSave="STRENGTH SAVE",O.DexteritySave="DEXTERITY SAVE",O.ConstitutionSave="CONSTITUTION SAVE",O.IntelligenceSave="INTELLIGENCE SAVE",O.WisdomSave="WISDOM SAVE",O.CharismaSave="CHARISMA SAVE",O.Acrobatics="ACROBATICS",O.AnimalHandling="ANIMAL HANDLING",O.Arcana="ARCANA",O.Athletics="ATHLETICS",O.Deception="DECEPTION",O.History="HISTORY",O.Insight="INSIGHT",O.Intimidation="INTIMIDATION",O.Investigation="INVESTIGATION",O.Medicine="MEDICINE",O.Nature="NATURE",O.Perception="PERCEPTION",O.Performance="PERFORMANCE",O.Persuasion="PERSUASION",O.Religion="RELIGION",O.SleightOfHand="SLEIGHT OF HAND",O.Stealth="STEALTH",O.Survival="SURVIVAL",O.THIEVES_TOOLS="THIEVES' TOOLS",O))(M_||{}),E_=class{Initiative=["INITIATIVE"];Strength=["STRENGTH","STR"];Dexterity=["DEXTERITY","DEX"];Constitution=["CONSTITUTION","CON"];Intelligence=["INTELLIGENCE","INT"];Wisdom=["WISDOM","WIS"];Charisma=["CHARISMA","CHA"];StrengthSave=["STRENGTH SAVE","STR SAVE"];DexteritySave=["DEXTERITY SAVE","DEX SAVE"];ConstitutionSave=["CONSTITUTION SAVE","CON SAVE"];IntelligenceSave=["INTELLIGENCE SAVE","INT SAVE"];WisdomSave=["WISDOM SAVE","WIS SAVE"];CharismaSave=["CHARISMA SAVE","CHA SAVE"];Acrobatics=["ACROBATICS","DEXTERITY (ACROBATICS)","DEX (ACROBATICS)"];AnimalHandling=["ANIMAL HANDLING","WISDOM (ANIMAL HANDLING)","WIS (ANIMAL HANDLING)","ANIMAL_HANDLING","WISDOM (ANIMAL_HANDLING)","WIS (ANIMAL_HANDLING)"];Arcana=["ARCANA","INTELLIGENCE (ARCANA)","INT (ARCANA)"];Athletics=["ATHLETICS","STRENGTH (ATHLETICS)","STR (ATHLETICS)"];Deception=["DECEPTION","CHARISMA (DECEPTION)","CHA (DECEPTION)"];History=["HISTORY","INTELLIGENCE (HISTORY)","INT (HISTORY)"];Insight=["INSIGHT","WISDOM (INSIGHT)","WIS (INSIGHT)"];Intimidation=["INTIMIDATION","CHARISMA (INTIMIDATION)","CHA (INTIMIDATION)"];Investigation=["INVESTIGATION","INTELLIGENCE (INVESTIGATION)","INT (INVESTIGATION)"];Medicine=["MEDICINE","WISDOM (MEDICINE)","WIS (MEDICINE)"];Nature=["NATURE","INTELLIGENCE (NATURE)","INT (NATURE)"];Perception=["PERCEPTION","WISDOM (PERCEPTION)","WIS (PERCEPTION)"];Performance=["PERFORMANCE","CHARISMA (PERFORMANCE)","CHA (PERFORMANCE)"];Persuasion=["PERSUASION","CHARISMA (PERSUASION)","CHA (PERSUASION)"];Religion=["RELIGION","WISDOM (RELIGION)","WIS (RELIGION)"];SleightOfHand=["SLEIGHT OF HAND","DEXTERITY (SLEIGHT OF HAND)","DEX (SLEIGHT OF HAND)","SLEIGHT_OF_HAND","DEXTERITY (SLEIGHT_OF_HAND)","DEX (SLEIGHT_OF_HAND)"];Stealth=["STEALTH","DEXTERITY (STEALTH)","DEX (STEALTH)"];Survival=["SURVIVAL","WISDOM (SURVIVAL)","WIS (SURVIVAL)"];THIEVES_TOOLS=["THIEVES TOOLS","THIEVES_TOOLS","THIEVES' TOOLS"]};function sF(i){let e=new E_;for(let[t,n]of Object.entries(e))if(n.includes(i.toUpperCase()))return M_[t];return null}function GM(i){return i.replace(/\[\s*([A-Z][A-Z _'-]*?)(?:\s*\(\s*([^)]+?)\s*\))?\s*:\s*(\d+)\s*\]/gi,"").replace(/\[\s*INITIATIVE\s*\]/gi,"").trim()}function _f(i){let e=i.match(/\[\s*([A-Z][A-Z _'-]*?)(?:\s*\(\s*([^)]+?)\s*\))?\s*:\s*(\d+)\s*\]/i),t=e?parseInt(e[3],10):null;if(e&&t!==null){let o=(e[2]??e[1]).trim().toUpperCase();return console.log("cleanAndTryGetRollCheckName Detected dice roll request:",o,"DC:",t),{isRequired:!0,checkType:sF(o),dc:t}}return i.match(/\[\s*INITIATIVE\s*\]/i)?(console.log("cleanAndTryGetRollCheckName Detected initiative roll request with no DC"),{isRequired:!0,checkType:"INITIATIVE",dc:null}):{isRequired:!1,checkType:null,dc:null}}var qt=class{character_id=0;hp=0;character_background={avatar_url:"",name:"",race:"",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:0};character_level=1;classes=[];proficiency_bonus=Math.floor((this.character_level-1)/4)+2;stats={strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10};passive_checks={perception:10,investigation:10,insight:10};saving_throws={strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0};skills={acrobatics:0,animal_handling:0,arcana:0,athletics:0,deception:0,history:0,insight:0,intimidation:0,investigation:0,medicine:0,nature:0,perception:0,performance:0,persuasion:0,religion:0,sleight_of_hand:0,stealth:0,survival:0};inventory=[];currencies={cp:0,sp:0,ep:0,gp:0,pp:0};constructor(e){console.log("Constructing CharacterSheet from JSON object:",e),e&&this.updateCharacterSheetFromJsonObject(e)}longRest(){this.hp=this.getFullHP()}getFullHP(){return this.character_background.base_hp+this.getStatModifier(this.stats.constitution)}get initiative_bonus(){return this.getStatModifier(this.stats.dexterity)}get ac(){let e=this.getStatModifier(this.stats.dexterity),t=this.inventory.filter(s=>!!s.equipped&&!!s.can_equip&&(s.armor_type_id===1||s.armor_type_id===2||s.armor_type_id===3)&&typeof s.armor_class=="number"),n=this.inventory.filter(s=>!!s.equipped&&!!s.can_equip&&(typeof s.item_type=="string"&&s.item_type.toLowerCase()==="shield"||s.armor_type_id===4));if(t.length===0){let s=10+e,a=0;for(let l of n){let c=typeof l.armor_class=="number"?l.armor_class??0:2;c>a&&(a=c)}return s+a}let r=10+e;for(let s of t){let a=s.armor_class??0,l=10+e;switch(s.armor_type_id){case 1:l=a+e;break;case 2:l=a+Math.min(e,2);break;case 3:l=a;break;default:l=10+e}l>r&&(r=l)}let o=0;for(let s of n){let a=typeof s.armor_class=="number"?s.armor_class??0:2;a>o&&(o=a)}return r+o}getStatModifier(e){return Math.floor((e-10)/2)}getModifierFromCheckableDiceRoll(e){switch(e){case"INITIATIVE":return this.initiative_bonus;case"STRENGTH":return this.getStatModifier(this.stats.strength);case"DEXTERITY":return this.getStatModifier(this.stats.dexterity);case"CONSTITUTION":return this.getStatModifier(this.stats.constitution);case"INTELLIGENCE":return this.getStatModifier(this.stats.intelligence);case"WISDOM":return this.getStatModifier(this.stats.wisdom);case"CHARISMA":return this.getStatModifier(this.stats.charisma);case"STRENGTH SAVE":return this.saving_throws.strength;case"DEXTERITY SAVE":return this.saving_throws.dexterity;case"CONSTITUTION SAVE":return this.saving_throws.constitution;case"INTELLIGENCE SAVE":return this.saving_throws.intelligence;case"WISDOM SAVE":return this.saving_throws.wisdom;case"CHARISMA SAVE":return this.saving_throws.charisma;case"ACROBATICS":return this.skills.acrobatics;case"ANIMAL HANDLING":return this.skills.animal_handling;case"ARCANA":return this.skills.arcana;case"ATHLETICS":return this.skills.athletics;case"DECEPTION":return this.skills.deception;case"HISTORY":return this.skills.history;case"INSIGHT":return this.skills.insight;case"INTIMIDATION":return this.skills.intimidation;case"INVESTIGATION":return this.skills.investigation;case"MEDICINE":return this.skills.medicine;case"NATURE":return this.skills.nature;case"PERCEPTION":return this.skills.perception;case"PERFORMANCE":return this.skills.performance;case"PERSUASION":return this.skills.persuasion;case"RELIGION":return this.skills.religion;case"SLEIGHT OF HAND":return this.skills.sleight_of_hand;case"STEALTH":return this.skills.stealth;case"SURVIVAL":return this.skills.survival;case"THIEVES' TOOLS":return this.getStatModifier(this.stats.dexterity);default:return console.warn("Unrecognized check type:",e),0}}updateCharacterSheetFromJsonObject(e){if(console.log("\u{1F426}\u{1F426}\u{1F426} Updating CharacterSheet from JSON object:",e),!e.character_id){console.log("JSON object does not have character_id; skipping update.");return}try{let t=e??{};if(this.character_id=t.character_id??this.character_id,Object.assign(this.character_background,t.character_background??{}),console.log("\u{1F498} Updating HP from JSON object:",this.hp),this.hp=t.hp??this.hp,console.log("\u{1F498} Updated HP is now:",this.hp),this.classes=Array.isArray(t.classes)?[...t.classes]:this.classes,this.character_level=t.character_level??this.character_level,this.proficiency_bonus=t.proficiency_bonus??this.proficiency_bonus,Object.assign(this.stats,t.stats??{}),Object.assign(this.passive_checks,t.passive_checks??{}),Object.assign(this.saving_throws,t.saving_throws??{}),Object.assign(this.skills,t.skills??{}),t.inventory!==void 0){let n=this.parseInventory(t.inventory);this.inventory=n}Object.assign(this.currencies,t.currencies??{})}catch(t){console.error("Failed to update character sheet from JSON object:",t)}}parseInventory(e){if(Array.isArray(e))return e;if(typeof e=="string")try{let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}return[]}toJSON(){return{hp:this.hp,ac:this.ac,initiative_bonus:this.initiative_bonus,character_id:this.character_id,character_background:this.character_background,character_level:this.character_level,classes:this.classes,proficiency_bonus:this.proficiency_bonus,stats:this.stats,passive_checks:this.passive_checks,saving_throws:this.saving_throws,skills:this.skills,inventory:this.inventory,currencies:this.currencies}}};var qM=[new qt({character_id:133053421,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/44474/891/1581111423-133053421.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Bobby",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:12},character_level:1,classes:["Barbarian 1"],proficiency_bonus:2,stats:{strength:16,dexterity:14,constitution:14,intelligence:10,wisdom:10,charisma:11},passive_checks:{perception:12,investigation:10,insight:10},saving_throws:{strength:5,dexterity:2,constitution:4,intelligence:0,wisdom:0,charisma:0},skills:{acrobatics:4,animal_handling:2,arcana:0,athletics:5,deception:0,history:0,insight:0,intimidation:2,investigation:0,medicine:0,nature:2,perception:2,performance:0,persuasion:2,religion:0,sleight_of_hand:2,stealth:4,survival:0},inventory:[{item_name:"Potion of Healing",item_type:"Potion",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Handaxe",item_type:"Handaxe",quantity:1,damage:"1d6",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Handaxe",item_type:"Handaxe",quantity:1,damage:"1d6",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Handaxe",item_type:"Handaxe",quantity:1,damage:"1d6",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Handaxe",item_type:"Handaxe",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Greataxe",item_type:"Greataxe",quantity:1,damage:"1d12",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:2,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:15,ep:0,pp:0}}),new qt({character_id:133054584,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/44474/898/1581111423-133054584.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Diana",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:8},character_level:1,classes:["Monk 1"],proficiency_bonus:2,stats:{strength:10,dexterity:17,constitution:14,intelligence:10,wisdom:14,charisma:10},passive_checks:{perception:14,investigation:12,insight:14},saving_throws:{strength:2,dexterity:5,constitution:2,intelligence:0,wisdom:2,charisma:0},skills:{acrobatics:5,animal_handling:4,arcana:0,athletics:0,deception:0,history:0,insight:4,intimidation:0,investigation:2,medicine:2,nature:2,perception:4,performance:0,persuasion:0,religion:0,sleight_of_hand:3,stealth:5,survival:2},inventory:[{item_name:"Potion of Healing",item_type:"Potion",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Quarterstaff",item_type:"Quarterstaff",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Cartographer's Tools",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:2,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:10,ep:0,pp:0}}),new qt({character_id:133055442,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/44474/907/1581111423-133055442.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Eric",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:10},character_level:1,classes:["Fighter 1"],proficiency_bonus:2,stats:{strength:17,dexterity:12,constitution:14,intelligence:14,wisdom:10,charisma:8},passive_checks:{perception:12,investigation:14,insight:12},saving_throws:{strength:5,dexterity:1,constitution:4,intelligence:2,wisdom:0,charisma:-1},skills:{acrobatics:3,animal_handling:0,arcana:2,athletics:5,deception:-1,history:4,insight:2,intimidation:-1,investigation:4,medicine:0,nature:2,perception:2,performance:1,persuasion:1,religion:2,sleight_of_hand:1,stealth:1,survival:0},inventory:[{item_name:"Potion of Healing",item_type:"Potion",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Shield",item_type:"Shield",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:4,armor_class:2},{item_name:"Chain Mail",item_type:"Heavy Armor",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:3,armor_class:16},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Longsword",item_type:"Longsword",quantity:1,damage:"1d8",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Crossbow, Heavy",item_type:"Crossbow, Heavy",quantity:1,damage:"1d10",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Crossbow Bolt Case",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Bolts",item_type:"Gear",quantity:20,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:2,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:13,ep:0,pp:0}}),new qt({character_id:133056493,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/44474/916/1581111423-133056493.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Hank",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:10},character_level:1,classes:["Ranger 1"],proficiency_bonus:2,stats:{strength:14,dexterity:14,constitution:14,intelligence:10,wisdom:14,charisma:10},passive_checks:{perception:14,investigation:10,insight:14},saving_throws:{strength:4,dexterity:4,constitution:2,intelligence:0,wisdom:2,charisma:0},skills:{acrobatics:4,animal_handling:2,arcana:0,athletics:4,deception:0,history:0,insight:4,intimidation:0,investigation:0,medicine:2,nature:0,perception:4,performance:0,persuasion:0,religion:0,sleight_of_hand:2,stealth:4,survival:4},inventory:[{item_name:"Potion of Healing",item_type:"Potion",quantity:2,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Studded Leather",item_type:"Light Armor",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:1,armor_class:12},{item_name:"Shortsword",item_type:"Shortsword",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Longbow",item_type:"Longbow",quantity:1,damage:"1d8",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Sprig of Mistletoe",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:2,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:34,ep:0,pp:0}}),new qt({character_id:133057712,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/44474/926/1581111423-133057712.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Niko",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:8},character_level:1,classes:["Cleric 1"],proficiency_bonus:2,stats:{strength:14,dexterity:10,constitution:13,intelligence:8,wisdom:16,charisma:14},passive_checks:{perception:15,investigation:9,insight:15},saving_throws:{strength:2,dexterity:0,constitution:1,intelligence:-1,wisdom:5,charisma:4},skills:{acrobatics:0,animal_handling:3,arcana:-1,athletics:2,deception:2,history:-1,insight:5,intimidation:2,investigation:-1,medicine:5,nature:-1,perception:5,performance:2,persuasion:4,religion:1,sleight_of_hand:0,stealth:0,survival:3},inventory:[{item_name:"Scale Mail",item_type:"Medium Armor",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:2,armor_class:14},{item_name:"Mace",item_type:"Mace",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Amulet",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Healer's Kit",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations",item_type:"Gear",quantity:7,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Robe",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Blanket",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Lamp",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Holy Water",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:2,ep:0,pp:0}}),new qt({character_id:133058471,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/44474/928/1581111423-133058471.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Presto",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:6},character_level:1,classes:["Wizard 1"],proficiency_bonus:2,stats:{strength:8,dexterity:14,constitution:12,intelligence:17,wisdom:10,charisma:14},passive_checks:{perception:12,investigation:15,insight:12},saving_throws:{strength:-1,dexterity:2,constitution:1,intelligence:5,wisdom:2,charisma:2},skills:{acrobatics:4,animal_handling:0,arcana:5,athletics:-1,deception:2,history:5,insight:2,intimidation:2,investigation:5,medicine:0,nature:3,perception:2,performance:2,persuasion:4,religion:3,sleight_of_hand:4,stealth:2,survival:0},inventory:[{item_name:"Potion of Healing",item_type:"Potion",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Quarterstaff",item_type:"Quarterstaff",quantity:1,damage:"1d6",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Spellbook",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:3,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Parchment",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Calligrapher's Supplies",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Robe",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Robe",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Lamp",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Fine Clothes",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Parchment",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Book",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Lamp",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Ink Pen",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Ink",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Parchment",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Book",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Lamp",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Ink Pen",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Ink",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:38,ep:0,pp:0}}),new qt({character_id:133059215,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/44474/937/1581111423-133059215.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Sheila",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:8},character_level:1,classes:["Rogue 1"],proficiency_bonus:2,stats:{strength:8,dexterity:15,constitution:12,intelligence:14,wisdom:14,charisma:12},passive_checks:{perception:14,investigation:12,insight:14},saving_throws:{strength:-1,dexterity:4,constitution:1,intelligence:4,wisdom:2,charisma:1},skills:{acrobatics:4,animal_handling:4,arcana:2,athletics:-1,deception:1,history:2,insight:4,intimidation:1,investigation:2,medicine:2,nature:4,perception:4,performance:1,persuasion:1,religion:2,sleight_of_hand:6,stealth:6,survival:2},inventory:[{item_name:"Potion of Healing",item_type:"Potion",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Leather",item_type:"Light Armor",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:1,armor_class:11},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Shortbow",item_type:"Shortbow",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Shortsword",item_type:"Shortsword",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Quiver",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Thieves' Tools",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Arrows",item_type:"Gear",quantity:20,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Oil",item_type:"Gear",quantity:7,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Ball Bearings",item_type:"Gear",quantity:1e3,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations",item_type:"Gear",quantity:5,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bell",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Hooded Lantern",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Candle",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Crowbar",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:0,ep:0,pp:0}}),new qt({character_id:107164636,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/36660/39/1581111423-107164636.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Astarion",race:"High Elf",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:8},character_level:1,classes:["Rogue 1"],proficiency_bonus:2,stats:{strength:8,dexterity:17,constitution:14,intelligence:13,wisdom:13,charisma:10},passive_checks:{perception:13,investigation:11,insight:11},saving_throws:{strength:-1,dexterity:5,constitution:2,intelligence:3,wisdom:1,charisma:0},skills:{acrobatics:5,animal_handling:1,arcana:1,athletics:-1,deception:2,history:3,insight:1,intimidation:0,investigation:1,medicine:1,nature:1,perception:3,performance:0,persuasion:2,religion:1,sleight_of_hand:7,stealth:7,survival:1},inventory:[{item_name:"Leather",item_type:"Light Armor",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:1,armor_class:11},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Dagger",item_type:"Dagger",quantity:1,damage:"1d4",can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Shortbow",item_type:"Shortbow",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Arrows",item_type:"Gear",quantity:20,damage:null,can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Disguise Kit",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Thieves' Tools",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Mess Kit",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations (1 day)",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope, Hempen (50 feet)",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:0,ep:0,pp:0}}),new qt({character_id:107165979,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/36660/42/1581111423-107165979.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Gale",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:6},character_level:1,classes:["Wizard 1"],proficiency_bonus:2,stats:{strength:9,dexterity:14,constitution:15,intelligence:16,wisdom:11,charisma:13},passive_checks:{perception:10,investigation:15,insight:12},saving_throws:{strength:-1,dexterity:2,constitution:2,intelligence:5,wisdom:2,charisma:1},skills:{acrobatics:2,animal_handling:0,arcana:5,athletics:-1,deception:1,history:5,insight:2,intimidation:1,investigation:5,medicine:0,nature:3,perception:0,performance:1,persuasion:1,religion:3,sleight_of_hand:2,stealth:2,survival:0},inventory:[{item_name:"Quarterstaff",item_type:"Quarterstaff",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Clothes, Common",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Component Pouch",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Spellbook",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Ink (1 ounce bottle)",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Ink Pen",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Lantern, Hooded",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Mess Kit",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations (1 day)",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope, Hempen (50 feet)",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:0,ep:0,pp:0}}),new qt({character_id:107606626,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/36660/44/1581111423-107606626.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Karlach",race:"Tiefling",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:12},character_level:1,classes:["Barbarian 1"],proficiency_bonus:2,stats:{strength:17,dexterity:13,constitution:15,intelligence:8,wisdom:12,charisma:10},passive_checks:{perception:13,investigation:9,insight:11},saving_throws:{strength:5,dexterity:1,constitution:4,intelligence:-1,wisdom:1,charisma:0},skills:{acrobatics:1,animal_handling:3,arcana:-1,athletics:5,deception:0,history:-1,insight:1,intimidation:2,investigation:-1,medicine:1,nature:-1,perception:3,performance:0,persuasion:0,religion:-1,sleight_of_hand:1,stealth:1,survival:1},inventory:[{item_name:"Studded Leather",item_type:"",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:1,armor_class:12},{item_name:"Javelin",item_type:"Javelin",quantity:4,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Greataxe",item_type:"Greataxe",quantity:1,damage:"1d12",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Clothes, Common",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Mess Kit",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations (1 day)",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope, Hempen (50 feet)",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:0,ep:0,pp:0}}),new qt({character_id:107607297,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/36660/52/1581111423-107607297.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Lae\u2019zel",race:"Githyanki",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:10},character_level:1,classes:["Fighter 1"],proficiency_bonus:2,stats:{strength:17,dexterity:13,constitution:15,intelligence:10,wisdom:12,charisma:8},passive_checks:{perception:11,investigation:10,insight:11},saving_throws:{strength:5,dexterity:1,constitution:4,intelligence:0,wisdom:1,charisma:-1},skills:{acrobatics:3,animal_handling:1,arcana:2,athletics:5,deception:-1,history:0,insight:1,intimidation:1,investigation:0,medicine:1,nature:0,perception:1,performance:-1,persuasion:-1,religion:0,sleight_of_hand:1,stealth:1,survival:3},inventory:[{item_name:"Chain Mail",item_type:"",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:3,armor_class:16},{item_name:"Greatsword",item_type:"Greatsword",quantity:1,damage:"2d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Clothes, Common",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Bedroll",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Mess Kit",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations (1 day)",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope, Hempen (50 feet)",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:0,ep:0,pp:0}}),new qt({character_id:107609898,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/36660/58/1581111423-107609898.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Shadowheart",race:"High Half-Elf",gender:null,faith:"Shar",age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:8},character_level:1,classes:["Cleric 1"],proficiency_bonus:2,stats:{strength:12,dexterity:14,constitution:14,intelligence:10,wisdom:16,charisma:10},passive_checks:{perception:13,investigation:10,insight:15},saving_throws:{strength:1,dexterity:2,constitution:2,intelligence:0,wisdom:5,charisma:2},skills:{acrobatics:2,animal_handling:3,arcana:0,athletics:1,deception:0,history:2,insight:5,intimidation:0,investigation:0,medicine:5,nature:0,perception:3,performance:0,persuasion:0,religion:2,sleight_of_hand:2,stealth:2,survival:3},inventory:[{item_name:"Shield",item_type:"Shield",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:4,armor_class:2},{item_name:"Chain Shirt",item_type:"Medium Armor",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:2,armor_class:13},{item_name:"Mace",item_type:"Mace",quantity:1,damage:"1d6",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Clothes, Common",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Alms Box",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Blanket",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Candle",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations (1 day)",item_type:"Gear",quantity:2,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Block of Incense",item_type:"Gear",quantity:2,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Censer",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Vestments",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:0,ep:0,pp:0}}),new qt({character_id:107693030,character_background:{avatar_url:"https://www.dndbeyond.com/avatars/36660/65/1581111423-107693030.jpeg?width=150&height=150&fit=crop&quality=95&auto=webp",name:"Wyll",race:"Human",gender:null,faith:null,age:null,hair:null,eyes:null,skin:null,height:null,weight:null,base_hp:8},character_level:1,classes:["Warlock 1"],proficiency_bonus:2,stats:{strength:9,dexterity:13,constitution:15,intelligence:14,wisdom:11,charisma:16},passive_checks:{perception:10,investigation:12,insight:10},saving_throws:{strength:-1,dexterity:1,constitution:2,intelligence:2,wisdom:2,charisma:5},skills:{acrobatics:1,animal_handling:2,arcana:4,athletics:-1,deception:3,history:2,insight:0,intimidation:5,investigation:2,medicine:0,nature:2,perception:0,performance:3,persuasion:3,religion:2,sleight_of_hand:1,stealth:1,survival:2},inventory:[{item_name:"Padded",item_type:"",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:1,armor_class:11},{item_name:"Rapier",item_type:"Rapier",quantity:1,damage:"1d8",can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Backpack",item_type:"Gear",quantity:1,damage:null,can_equip:!0,equipped:!0,armor_type_id:null,armor_class:null},{item_name:"Clothes, Common",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Mason's Tools",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Crowbar",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Hammer",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Piton",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rations (1 day)",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Rope, Hempen (50 feet)",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Tinderbox",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Torch",item_type:"Gear",quantity:10,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null},{item_name:"Waterskin",item_type:"Gear",quantity:1,damage:null,can_equip:!1,equipped:!1,armor_type_id:null,armor_class:null}],currencies:{cp:0,sp:0,gp:0,ep:0,pp:0}})];var WM=[{title:"Debug Dungeon",image_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/debug_dungeon.webp",campaign_url:"https://homebrewery.naturalcrit.com/download/zzovUKZx7smX"},{title:"Lost Mine of Phandelver",image_url:"https://5e.tools/img/covers/LMoP.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/lost_mine_of_phandelver.md"},{title:"Dragon of Icespire Peak",image_url:"https://5e.tools/img/covers/DIP.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/dragon_of_icespire_peak.md"},{title:"Peril in Pinebrook",image_url:"https://5e.tools/img/covers/PiP.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/peril_in_pinebrook.md"},{title:"Below the Shallows",image_url:"https://raw.githubusercontent.com/TheGiddyLimit/homebrew-img/refs/heads/main/img/ObojimaTallGrass/cover.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/below_the_shallows.md"},{title:"Candlekeep Mysteries - Kandlekeep Dekonstruktion",image_url:"https://5e.tools/img/covers/CM.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/candlekeep_mysteries_kandlekeep_dekonstruktion.md"},{title:"Eberron: Forgotten Relics",image_url:"https://5e.tools/img/covers/ERLW.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/eberron_%20forgotten_relics.md"},{title:"Curse of Strahd",image_url:"https://5e.tools/img/covers/CoS.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/curse_of_strahd.md"},{title:"Waterdeep: Dragon Heist",image_url:"https://5e.tools/img/covers/WDH.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/waterdeep_dragon_heist.md"},{title:"Ghost of Saltmarsh",image_url:"https://5e.tools/img/covers/GoS.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/ghosts_of_saltmarsh.md"},{title:"The Wild Beyond the Witchlight",image_url:"https://5e.tools/img/covers/WBtW.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/the_wild_beyond_the_witchlight.md"},{title:"Storm King's Thunder",image_url:"https://5e.tools/img/covers/SKT.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/storm_kings_thunder.md"},{title:"Tomb of Annihilation",image_url:"https://5e.tools/img/covers/ToA.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/tomb_of_annihilation.md"},{title:"Journeys through the Radiant Citadel",image_url:"https://5e.tools/img/covers/JttRC.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/journeys_through_the_radiant_citadel.md"},{title:"Keys from the Golden Vault",image_url:"https://5e.tools/img/covers/KftGV.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/keys_from_the_golden_vault.md"},{title:"Chains of Asmodeus",image_url:"https://5e.tools/img/covers/CoA.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/chains_of_asmodeus.md"},{title:"Icewind Dale: Rime of the Frostmaiden",image_url:"https://5e.tools/img/covers/IDRotF.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/icewind_dale_rime_of_the_frostmaiden.md"},{title:"The Wild Sheep Chase",image_url:"https://raw.githubusercontent.com/TheGiddyLimit/homebrew-img/main/img/WSC/cover.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/the_wild_sheep_chase.md"},{title:"A Most Potent Brew",image_url:"https://raw.githubusercontent.com/TheGiddyLimit/homebrew-img/main/img/AMostPotentBrew/cover.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/a_most_potent_brew.md"},{title:"The Secret of Skyhorn Lighthouse",image_url:"https://raw.githubusercontent.com/TheGiddyLimit/homebrew/master/_img/TSSL/TSSL-cover.webp",campaign_url:"https://storage.googleapis.com/dnd_adk_static_contents/campaigns/the_secret_of_skyhorn_lighthouse.md"}];var bf=class i{constructor(e){this.http=e}endpoint="https://getcharacter-etwxihe6aq-uc.a.run.app";getCharacterSheet(e){let t=new dr().set("characterId",String(e));return this.http.get(this.endpoint,{params:t}).pipe(ze(n=>new qt(n)))}static \u0275fac=function(t){return new(t||i)(Ce(Np))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var Wt=class i{isInitialized=!1;hasNewUpdates=!1;characterSubject=new st(new qt);character$=this.characterSubject.asObservable();getCharacterSheet(){return this.characterSubject.getValue()}getCharacterName(){return this.getCharacterSheet().character_background.name||"Unnamed Character"}getCharacterLevel(){return this.getCharacterSheet().character_level||1}_emitChangesForUI(e){this.characterSubject.next(e)}setInventory(e){let t=this.getCharacterSheet();t.inventory=[...e??[]],this.hasNewUpdates=!0,this._emitChangesForUI(t)}setCurrencies(e){let t=this.getCharacterSheet(),r=ne(ne(ne({},{cp:0,sp:0,ep:0,gp:0,pp:0}),t.currencies??{}),e);t.currencies=ne({},r),this.hasNewUpdates=!0,this._emitChangesForUI(t)}updateCharacterFromObject(e){let t=this.getCharacterSheet();t.updateCharacterSheetFromJsonObject(e),this._emitChangesForUI(t)}updateCharacterSheetFromList(e){let n=e[0];if(!n)return;let r=this.getCharacterSheet();r.updateCharacterSheetFromJsonObject(n),this._emitChangesForUI(r),this.isInitialized=!0,this.hasNewUpdates=!1}updateCharacterFromManyResponses(e){return _e(this,null,function*(){Array.isArray(e)||(e=[e]);for(let t of e){let n=t?.actions?.stateDelta;if(!n)continue;let r=n.character_sheet_list;if(r)try{this.updateCharacterSheetFromList(r)}catch(o){console.warn("Failed to parse character_sheet_json_string",o)}}})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var Wr=class i{stateSubject=new st(null);state$=this.stateSubject.asObservable();queue=[];activeResolver=null;alert(e,t="Notice",n="OK"){return new Promise(r=>{this.enqueue({kind:"alert",title:t,message:e,confirmText:n},r)})}confirm(e,t="Confirm",n="OK",r="Cancel"){return new Promise(o=>{this.enqueue({kind:"confirm",title:t,message:e,confirmText:n,cancelText:r},o)})}confirmCurrent(){if(this.activeResolver){let t=this.stateSubject.getValue()?.kind==="confirm"?!0:void 0;this.activeResolver(t)}this.clearAndNext()}cancelCurrent(){this.activeResolver&&this.activeResolver(!1),this.clearAndNext()}enqueue(e,t){if(!this.stateSubject.getValue()&&!this.activeResolver){this.activeResolver=t,this.stateSubject.next(e);return}this.queue.push({config:e,resolve:t})}clearAndNext(){this.stateSubject.next(null),this.activeResolver=null;let e=this.queue.shift();e&&(this.activeResolver=e.resolve,this.stateSubject.next(e.config))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var wf="dm_agent",lF="user",I_="current_location",T_="current_campaign_time",Uu="simulation_sequences",$M="dialogue",YM="name",Hu="suggestions",ZM="scene_entities",XM="combatant_list";var A_="journal_entries",xf="is_in_combat",Sf="combat_turn_number",KM="END_TURN",$r=class i{constructor(e,t){this.characterSheetService=e;this.modal=t}serverAddress="http://localhost:8080";SERVER_ADDRESS_KEY="server_address";_userId=lF;get userId(){return this._userId}SESSIONS_KEY="saved_sessions";getServerAddress(){let e=this.loadStoredServerAddress();return e&&(this.serverAddress=e),this.serverAddress}setServerAddress(e){let t=(e||"").trim();t&&(/^https?:\/\//i.test(t)?this.serverAddress=t:this.serverAddress="http://"+t,this.persistServerAddress(this.serverAddress))}createSession(e,t,n,r){return _e(this,null,function*(){r.longRest(),console.log("Creating session with ID:",e,t,n);let o=`${this.getServerAddress()}/apps/${wf}/users/${encodeURIComponent(this.userId)}/sessions`;console.log("Character sheet after long rest:",r);let a=yield fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,state:{campaign_name:t,campaign_url:n,character_sheet_list:[r]}})});if(!a.ok)throw new Error(`createSession failed: ${a.status}`);let l=yield a.json().catch(()=>({}));try{this.upsertSavedSession({campaignName:t,sessionId:e,campaignUrl:n,characterName:this.characterSheetService.getCharacterName()||"Unknown",characterLevel:this.characterSheetService.getCharacterLevel()||1,currentLocation:"Unknown",currentCampaignTime:"Unknown",createdAt:new Date,lastPlayedAt:new Date})}catch(c){console.warn("Failed to persist session to localStorage",c)}return l})}sendMessage(e,t,n){return _e(this,null,function*(){let r;if(!this.characterSheetService.isInitialized)return console.warn("Character sheet is not initialized."),[];n||(n={}),r={app_name:wf,user_id:this.userId,session_id:t,new_message:{role:"user",parts:[{text:JSON.stringify(e)}]},stateDelta:n},console.log("Sending message payload:",r);let o=`${this.getServerAddress()}/run`,s=yield fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw new Error(`run failed: ${s.status}`);let a=yield s.json();return Array.isArray(a)?a:[a]})}getSessionStateFromDb(e){return _e(this,null,function*(){let t=`${this.getServerAddress()}/apps/${wf}/users/${encodeURIComponent(this.userId)}/sessions/${encodeURIComponent(e)}`;try{let n=yield fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw yield this.modal.alert(`Failed to load session state (HTTP ${n.status}). Please try again.`),new Error(`getSessionStateFromDb failed: ${n.status}`);return console.log("Fetched session history:",n),yield n.json()}catch(n){throw console.error("Error fetching session state:",n),yield this.modal.alert("Failed to load session state. Backend server may be unreachable. Please try again."),n}})}deleteSession(e){return _e(this,null,function*(){let t=`${this.getServerAddress()}/apps/${wf}/users/${encodeURIComponent(this.userId)}/sessions/${encodeURIComponent(e)}`,n=yield fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`deleteSession failed: ${n.status}`);let r=this.loadSavedSessions().filter(o=>o.sessionId!==e);this.persistSavedSessions(r)})}loadSavedSessions(){try{let e=localStorage.getItem(this.SESSIONS_KEY);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}persistSavedSessions(e){try{localStorage.setItem(this.SESSIONS_KEY,JSON.stringify(e))}catch(t){console.warn("Unable to write saved sessions to localStorage",t)}}loadStoredServerAddress(){try{let e=localStorage.getItem(this.SERVER_ADDRESS_KEY);return e&&e.trim()?e.trim():null}catch{return null}}persistServerAddress(e){try{localStorage.setItem(this.SERVER_ADDRESS_KEY,e)}catch(t){console.warn("Unable to persist server address",t)}}upsertSavedSession(e){let t=this.loadSavedSessions(),n=t.findIndex(r=>r.sessionId===e.sessionId);if(n>=0){let r=t[n],o=Ve(ne({},r),{characterLevel:e.characterLevel,characterName:e.characterName,currentLocation:e.currentLocation,currentCampaignTime:e.currentCampaignTime,lastPlayedAt:new Date});t[n]=o}else{let r={sessionId:e.sessionId,characterName:e.characterName,characterLevel:e.characterLevel,currentLocation:e.currentLocation,currentCampaignTime:e.currentCampaignTime,campaignName:e.campaignName||"Unknown",campaignUrl:e.campaignUrl||"",createdAt:e.createdAt||new Date,lastPlayedAt:e.lastPlayedAt||new Date};t.unshift(r)}this.persistSavedSessions(t)}parseSimulationSequencesAndSuggestionsFromResponse(e){let t={simulationSequences:[],suggestions:[]},n=e?.content?.parts;if(!Array.isArray(n)||n.length===0)return t;for(let r of n){let o=r?.text;if(!(typeof o!="string"||o.trim().length===0))try{let s=JSON.parse(o);if(s&&typeof s=="object"){let a=s[Uu],l=s[Hu];Array.isArray(a)&&(t.simulationSequences=a),Array.isArray(l)&&(t.suggestions=l)}}catch(s){console.warn("Failed to parse DM response part text as JSON",s)}}return t}static \u0275fac=function(t){return new(t||i)(Ce(Wt),Ce(Wr))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};function cF(i,e){if(i&1){let t=Qe();C(0,"div",11),Y("click",function(){let r=ve(t).$implicit,o=ie(2);return ye(o.selectCharacter(r))}),C(1,"div",12),Y("click",function(r){let o=ve(t).$implicit,s=ie(2);return ye(s.removeImportedCharacter(o,r))}),A(2,"\u{1F5D1}\uFE0F"),E(),Te(3,"img",13),C(4,"div",6),A(5),E(),C(6,"div",14),A(7),E(),C(8,"div",14),A(9),E()()}if(i&2){let t=e.$implicit,n=ie(2);Ze("selected",n.characterId===t.character_id),P(3),ae("alt",dp("",t.character_background.name," avatar"))("src",t.character_background.avatar_url,xi),P(2),Le(t.character_background.name||"ID "+t.character_id),P(2),Ge("",t.character_background.race," \u2022 ",t.classes),P(2),rt("Level ",t.character_level)}}function uF(i,e){if(i&1){let t=Qe();C(0,"div",15),Y("click",function(){let r=ve(t).$implicit,o=ie(2);return ye(o.selectCharacter(r))}),Te(1,"img",13),C(2,"div",6),A(3),E(),C(4,"div",14),A(5),E(),C(6,"div",14),A(7),E()()}if(i&2){let t=e.$implicit,n=ie(2);Ze("selected",n.characterId===t.character_id),P(),ae("alt",dp("",t.character_background.name," avatar"))("src",t.character_background.avatar_url,xi),P(2),Le(t.character_background.name),P(2),Ge("",t.character_background.race," \u2022 ",t.classes),P(2),rt("Level ",t.character_level)}}function dF(i,e){if(i&1){let t=Qe();Ci(0),C(1,"label"),A(2,"Select Character:"),E(),C(3,"div",3)(4,"div",4),Y("click",function(){ve(t);let r=ie();return ye(r.showCharacterImportModal.set(!0))}),C(5,"div",5),A(6,"+"),E(),C(7,"div",6),A(8,"Import new character"),E()(),nt(9,cF,10,9,"div",7)(10,uF,8,9,"div",8),E(),C(11,"div",9)(12,"button",10),Y("click",function(){ve(t);let r=ie();return ye(r.next())}),A(13,"Next"),E()(),Ei()}if(i&2){let t=ie();P(9),ae("ngForOf",t.importedCharacters),P(),ae("ngForOf",t.PREMADE_CHARACTERS),P(2),ae("disabled",!t.characterId)}}function hF(i,e){if(i&1){let t=Qe();C(0,"button",24),Y("click",function(r){ve(t);let o=ie().$implicit,s=ie(2);return ye(s.openCampaignUrl(o.campaign_url,r))}),A(1,"\u{1F4DD}"),E()}}function pF(i,e){if(i&1&&Te(0,"img",25),i&2){let t=ie().$implicit;ae("src",t.image_url,xi)}}function fF(i,e){i&1&&(C(0,"div",5),A(1,"+"),E())}function mF(i,e){if(i&1){let t=Qe();C(0,"div",19),Y("click",function(){let r=ve(t).$implicit,o=ie(2);return ye(o.selectCampaign(r))}),nt(1,hF,2,0,"button",20)(2,pF,1,1,"img",21)(3,fF,2,0,"div",22),C(4,"div",23),A(5),E()()}if(i&2){let t=e.$implicit,n=ie(2);Ze("selected",n.campaignUrl()===t.campaign_url&&t.campaign_url)("import",!t.image_url),P(),ae("ngIf",t.image_url&&t.campaign_url),P(),ae("ngIf",t.image_url),P(),ae("ngIf",!t.image_url),P(2),Le(t.title)}}function gF(i,e){if(i&1){let t=Qe();Ci(0),C(1,"label"),A(2,"Select Campaign:"),E(),C(3,"div",16),nt(4,mF,6,8,"div",17),E(),C(5,"div",9)(6,"button",18),Y("click",function(){ve(t);let r=ie();return ye(r.back())}),A(7,"Back"),E(),C(8,"button",10),Y("click",function(){ve(t);let r=ie();return ye(r.create())}),A(9,"Create Campaign"),E()(),Ei()}if(i&2){let t=ie();P(4),ae("ngForOf",t.campaigns),P(4),ae("disabled",!t.campaignUrl())}}function vF(i,e){if(i&1){let t=Qe();C(0,"div",26)(1,"div",27)(2,"form",28),Y("ngSubmit",function(){ve(t);let r=ie();return ye(r.importCampaign())}),C(3,"label",29),A(4,"Public Campaign URL:"),E(),C(5,"div",30)(6,"input",31),dn("ngModelChange",function(r){ve(t);let o=ie();return vn(o.importUrl,r)||(o.importUrl=r),ye(r)}),E()(),C(7,"div",9)(8,"button",32),A(9,"Import"),E(),C(10,"button",18),Y("click",function(){ve(t);let r=ie();return ye(r.showImportModal.set(!1))}),A(11,"Cancel"),E()()()()()}if(i&2){let t=ie();P(6),un("ngModel",t.importUrl)}}function yF(i,e){if(i&1){let t=Qe();C(0,"div",26)(1,"div",27)(2,"form",28),Y("ngSubmit",function(){ve(t);let r=ie();return ye(r.importCharacter())}),C(3,"label",33),A(4,"D&D Beyond Character ID:"),E(),C(5,"div",30)(6,"input",34),dn("ngModelChange",function(r){ve(t);let o=ie();return vn(o.importCharacterIdVal,r)||(o.importCharacterIdVal=r),ye(r)}),E()(),C(7,"div",9)(8,"button",32),A(9,"Import"),E(),C(10,"button",18),Y("click",function(){ve(t);let r=ie();return ye(r.showCharacterImportModal.set(!1))}),A(11,"Cancel"),E()()()()()}if(i&2){let t=ie();P(6),un("ngModel",t.importCharacterIdVal)}}var Ef=class i{constructor(e,t,n,r){this.characterImport=e;this.dm=t;this.router=n;this.modal=r}createCampaign=new xt;cancel=new xt;preSelectedCampaignIndex=1;PREMADE_CHARACTERS=qM;importedCharacters=[];step=at(1);sessionId=crypto.randomUUID();characterId=null;importCharacterIdVal=null;partyMembers=[];selectedCharacterSheet=new qt;showImportModal=at(!1);showCharacterImportModal=at(!1);importUrl=at("");campaigns=[{title:"Import your homebrew",image_url:"",campaign_url:""},...WM];campaignUrl=at(this.campaigns[this.preSelectedCampaignIndex].campaign_url);campaignName=at(this.campaigns[this.preSelectedCampaignIndex].title);ngOnInit(){let e=this.campaigns.find(t=>!!t.campaign_url);!this.campaignUrl()&&e?.campaign_url&&(this.campaignUrl.set(e.campaign_url),this.campaignName.set(e.title));try{let t=localStorage.getItem("imported_characters");if(t){let n=JSON.parse(t);Array.isArray(n)&&(this.importedCharacters=n.map(r=>new qt(r)))}}catch(t){console.warn("Failed to parse imported characters from localStorage",t),this.importedCharacters=[]}}next(){this.step.set(2)}back(){this.step.set(1)}selectCharacter(e){this.selectedCharacterSheet=e,e&&typeof e.character_id=="number"&&(this.characterId=e.character_id)}isPremadeSelected(){return this.PREMADE_CHARACTERS.some(e=>e.character_id===this.characterId)}importCharacter(){let e=Number(this.importCharacterIdVal||0);e&&this.characterImport.getCharacterSheet(e).subscribe({next:t=>{this.selectedCharacterSheet=t,this.characterId=t.character_id||e,this.upsertImportedCharacterAtFront(t),this.persistImportedCharacters(),this.showCharacterImportModal.set(!1),this.importCharacterIdVal=0},error:t=>{console.error("Failed to import character",t),this.modal.alert("Failed to import character. Please check the ID and try again.")}})}selectCampaign(e){e.title==="Import your homebrew"?this.showImportModal.set(!0):(this.campaignUrl.set(e.campaign_url),this.campaignName.set(e.title))}importCampaign(){this.campaignUrl.set(this.importUrl()),this.showImportModal.set(!1)}create(){return _e(this,null,function*(){let e=this.campaignUrl();e&&sessionStorage.setItem("campaign_url",e);try{yield this.dm.createSession(this.sessionId,this.campaignName(),e,this.selectedCharacterSheet),this.router.navigate(["/session",this.dm.userId,this.sessionId])}catch(t){console.error(t),this.modal.alert("Failed to create new session: "+t)}})}openCampaignUrl(e,t){if(t&&t.stopPropagation(),!!e){e=e.replace("homebrewery.naturalcrit.com/download/","homebrewery.naturalcrit.com/share/");try{window.open(e,"_blank","noopener")}catch(n){console.warn("Failed to open campaign URL",n)}}}upsertImportedCharacterAtFront(e){if(!e)return;let t=e.character_id;if(t==null)return;let n=this.importedCharacters.findIndex(r=>r.character_id===t);n>=0&&this.importedCharacters.splice(n,1),this.importedCharacters.unshift(e)}removeImportedCharacter(e,t){t&&t.stopPropagation();let n=this.importedCharacters.findIndex(r=>r.character_id===e.character_id);n>=0&&(this.importedCharacters.splice(n,1),this.persistImportedCharacters(),this.characterId===e.character_id&&(this.characterId=0,this.selectedCharacterSheet=new qt))}persistImportedCharacters(){try{localStorage.setItem("imported_characters",JSON.stringify(this.importedCharacters))}catch(e){console.warn("Failed to persist imported characters",e)}}static \u0275fac=function(t){return new(t||i)(se(bf),se($r),se(Hr),se(Wr))};static \u0275cmp=Pe({type:i,selectors:[["app-new-campaign-pane"]],outputs:{createCampaign:"createCampaign",cancel:"cancel"},decls:7,vars:4,consts:[[1,"big-form"],[4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"character-selector"],["clickableDivWithSound","",1,"character-box","import",3,"click"],[1,"import-icon"],[1,"name"],["clickableDivWithSound","","class","character-box imported",3,"selected","click",4,"ngFor","ngForOf"],["clickableDivWithSound","","class","character-box",3,"selected","click",4,"ngFor","ngForOf"],[1,"actions"],["clickableDivWithSound","","type","button",3,"click","disabled"],["clickableDivWithSound","",1,"character-box","imported",3,"click"],["title","Remove",1,"delete",3,"click"],[3,"src","alt"],[1,"meta"],["clickableDivWithSound","",1,"character-box",3,"click"],[1,"campaign-selector"],["clickableDivWithSound","","class","campaign-box",3,"selected","import","click",4,"ngFor","ngForOf"],["clickableDivWithSound","","type","button",3,"click"],["clickableDivWithSound","",1,"campaign-box",3,"click"],["clickableDivWithSound","","type","button","class","open-url","title","Open campaign in new tab","aria-label","Open campaign in new tab",3,"click",4,"ngIf"],["alt","Campaign image",3,"src",4,"ngIf"],["class","import-icon",4,"ngIf"],[1,"title"],["clickableDivWithSound","","type","button","title","Open campaign in new tab","aria-label","Open campaign in new tab",1,"open-url",3,"click"],["alt","Campaign image",3,"src"],[1,"modal-overlay"],[1,"modal"],[3,"ngSubmit"],["for","importUrl"],[1,"form-group"],["id","importUrl","type","text","name","importUrl","required","",3,"ngModelChange","ngModel"],["clickableDivWithSound","","type","submit"],["for","importCharacterId"],["id","importCharacterId","type","text","name","importCharacterId","required","","placeholder","e.g., 123456789",3,"ngModelChange","ngModel"]],template:function(t,n){t&1&&(C(0,"h2"),A(1,"Start a New Campaign"),E(),C(2,"form",0),nt(3,dF,14,3,"ng-container",1)(4,gF,10,2,"ng-container",1),E(),nt(5,vF,12,1,"div",2)(6,yF,12,1,"div",2)),t&2&&(P(3),ae("ngIf",n.step()===1),P(),ae("ngIf",n.step()===2),P(),ae("ngIf",n.showImportModal()),P(),ae("ngIf",n.showCharacterImportModal()))},dependencies:[ke,pi,_n,ms,UM,Gr,fs,LM,C_,Mo,S_,Gt],styles:["[_nghost-%COMP%]{width:100%;height:100%}label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;font-weight:600}.big-form[_ngcontent-%COMP%]{width:100%;height:100%}.actions[_ngcontent-%COMP%]{margin-top:.75rem;display:flex;justify-content:flex-end;gap:.5rem}.character-selector[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;height:65%;overflow-y:scroll;border:1px solid #ccc;margin:.5rem;justify-content:center}.character-box[_ngcontent-%COMP%]{margin:.5rem;width:8rem;height:12rem;align-items:center;padding:.5rem;border:1px solid #eee;border-radius:4px;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-start;background:#2b2b2b}.character-box[_ngcontent-%COMP%]:hover{background:#4b4b4b}.character-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:60%;object-fit:cover;border-radius:2px;margin-bottom:.5rem}.character-box[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;text-align:center;margin-bottom:.25rem}.character-box[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.75rem;color:#cfcfcf;text-align:center}.character-box.import[_ngcontent-%COMP%]{justify-content:center;gap:.5rem}.character-box[_ngcontent-%COMP%]   .import-icon[_ngcontent-%COMP%]{width:3rem;height:3rem;border-radius:50%;border:2px dashed #aaa;display:flex;align-items:center;justify-content:center;font-size:1.25rem;margin-bottom:.25rem}.character-box.selected[_ngcontent-%COMP%]{outline:4px solid #ce2e50ff}.character-box.imported[_ngcontent-%COMP%]{position:relative}.character-box.imported[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]{position:absolute;top:4px;right:6px;font-size:.9rem;opacity:.7}.character-box.imported[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]:hover{opacity:1}.campaign-selector[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;height:65%;overflow-y:auto;border:1px solid #ccc;margin:.5rem;justify-content:center}.campaign-box[_ngcontent-%COMP%]{margin:.5rem .5rem .75rem;width:9rem;height:16rem;align-items:center;padding:.5rem;border:1px solid #eee;border-radius:4px;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-start;background:#2b2b2b}.campaign-box[_ngcontent-%COMP%]:hover{background:#4b4b4b}.campaign-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:80%;object-fit:cover;margin-bottom:.5rem}.campaign-box[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{white-space:normal;word-wrap:break-word;text-align:center;font-size:.76rem}.campaign-box.selected[_ngcontent-%COMP%]{outline:4px solid #ce2e50ff}.campaign-box.import[_ngcontent-%COMP%]{justify-content:center;gap:.5rem}.campaign-box[_ngcontent-%COMP%]   .import-icon[_ngcontent-%COMP%]{width:3rem;height:3rem;border-radius:50%;border:2px dashed #aaa;display:flex;align-items:center;justify-content:center;font-size:1.25rem;margin-bottom:.25rem}.campaign-box[_ngcontent-%COMP%]{position:relative}.campaign-box[_ngcontent-%COMP%]   .open-url[_ngcontent-%COMP%]{position:absolute;top:6px;right:6px;z-index:2;border:1px solid #888;background:#00000080;color:#fff;border-radius:4px;padding:2px 6px;font-size:.85rem;line-height:1}.campaign-box[_ngcontent-%COMP%]   .open-url[_ngcontent-%COMP%]:hover{background:#000000b3}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;justify-content:center;align-items:center}.modal[_ngcontent-%COMP%]{background:#1f1f23;border:1px solid #ccc;border-radius:8px;padding:1rem;width:100%;max-width:400px;gap:.5rem}.modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:.5rem}.modal[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{font-size:.6rem;display:flex;justify-content:flex-end;gap:.5rem;margin-top:1rem}"]})};function _F(i,e){if(i&1&&(C(0,"div"),A(1),E()),i&2){let t=ie().$implicit;P(),Ge("",t.currentCampaignTime," - ",t.currentLocation)}}function bF(i,e){if(i&1){let t=Qe();C(0,"div",5)(1,"div",6)(2,"span",7),A(3),E(),C(4,"div",8)(5,"div"),A(6),E(),nt(7,_F,2,2,"div",9),C(8,"div"),A(9),E(),C(10,"div"),A(11),sn(12,"date"),E()()(),C(13,"div",10)(14,"button",11),Y("click",function(){let r=ve(t).$implicit,o=ie(2);return ye(o.continueSession(r.sessionId))}),A(15,"Load"),E(),C(16,"button",12),Y("click",function(){let r=ve(t).$implicit,o=ie(2);return ye(o.onDelete(r.sessionId))}),A(17,"Delete"),E()()()}if(i&2){let t=e.$implicit;P(3),Le(t.campaignName),P(3),Ge("",t.characterName," (Level ",t.characterLevel,")"),P(),ae("ngIf",t.currentCampaignTime&&t.currentLocation),P(2),Le(t.sessionId),P(2),rt("last played: ",dl(12,6,t.lastPlayedAt,"short"))}}function wF(i,e){if(i&1&&(Ci(0),C(1,"div",3),nt(2,bF,18,9,"div",4),E(),Ei()),i&2){let t=ie();P(2),ae("ngForOf",t.sessions)}}function xF(i,e){i&1&&(C(0,"p"),A(1,"No saved sessions yet."),E())}var Mf=class i{constructor(e,t,n){this.router=e;this.dm=t;this.modal=n}sessions=[];ngOnInit(){this.sessions=this.loadFromLocalStorage()}continueSession(e){e&&this.router.navigate(["/session",this.dm.userId,e])}loadFromLocalStorage(){try{let e=localStorage.getItem("saved_sessions"),t=e?JSON.parse(e):[];return Array.isArray(t)?t.sort((n,r)=>new Date(r.lastPlayedAt).getTime()-new Date(n.lastPlayedAt).getTime()):[]}catch{return[]}}onDelete(e){return _e(this,null,function*(){if(!(!e||!(yield this.modal.confirm("Delete this session permanently?"))))try{yield this.dm.deleteSession(e),this.sessions=this.sessions.filter(n=>n.sessionId!==e)}catch(n){console.error("Failed to delete session",n),this.modal.alert("Failed to delete session. Please try again.")}})}static \u0275fac=function(t){return new(t||i)(se(Hr),se($r),se(Wr))};static \u0275cmp=Pe({type:i,selectors:[["app-continue-pane"]],decls:6,vars:2,consts:[["empty",""],[1,"continue"],[4,"ngIf","ngIfElse"],[1,"session-list"],["class","session-item",4,"ngFor","ngForOf"],[1,"session-item"],[1,"main"],[1,"campaign-name"],[1,"meta"],[4,"ngIf"],[1,"actions"],["clickableDivWithSound","","type","button",1,"btn","load",3,"click"],["clickableDivWithSound","","type","button",1,"btn","delete",3,"click"]],template:function(t,n){if(t&1&&(C(0,"div",1)(1,"h2"),A(2,"Continue"),E(),nt(3,wF,3,1,"ng-container",2)(4,xF,2,0,"ng-template",null,0,wo),E()),t&2){let r=cr(5);P(3),ae("ngIf",n.sessions.length)("ngIfElse",r)}},dependencies:[ke,pi,_n,Gt,Ty],styles:["[_nghost-%COMP%]{width:100%;height:100%}.continue[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}.session-list[_ngcontent-%COMP%]{width:97%;height:100%;overflow:auto;border:1px solid #444;border-radius:4px;margin:.5rem;padding:.5rem}.session-item[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #333;border-radius:4px;margin-bottom:.5rem;background:#2b2b2b;overflow-wrap:anywhere;display:flex;align-items:center;justify-content:space-between;gap:.75rem}.session-item[_ngcontent-%COMP%]:hover, .session-item[_ngcontent-%COMP%]:focus, .session-item[_ngcontent-%COMP%]:focus-within{background:#3a3a3a;outline:none}.main[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:0}.meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:.8rem;color:#cfcfcf;flex-wrap:wrap;opacity:.8;margin-top:.25rem}.actions[_ngcontent-%COMP%]{width:16rem;margin-right:2rem;display:flex;justify-content:flex-end;gap:.5rem;opacity:0;transition:opacity .12s ease-in-out}.session-item[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%], .session-item[_ngcontent-%COMP%]:focus   .actions[_ngcontent-%COMP%], .session-item[_ngcontent-%COMP%]:focus-within   .actions[_ngcontent-%COMP%]{opacity:1}.btn.delete[_ngcontent-%COMP%]{background:#6a2b2b}.btn.delete[_ngcontent-%COMP%]:hover, .btn.delete[_ngcontent-%COMP%]:focus{background:#7a2b2b}"]})};var Df=class i{static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-join-pane"]],decls:5,vars:0,consts:[[1,"join"]],template:function(t,n){t&1&&(Zt(0,"div",0)(1,"h2"),A(2,"Join Campaign"),jt(),Zt(3,"p"),A(4,"Coming soon\u2026"),jt()())},dependencies:[ke],encapsulation:2})};var SF=()=>({standalone:!0});function CF(i,e){if(i&1){let t=Qe();C(0,"input",10),dn("ngModelChange",function(r){ve(t);let o=ie(2);return vn(o.filter,r)||(o.filter=r),ye(r)}),Y("click",function(r){return ve(t),ye(r.stopPropagation())}),E()}if(i&2){let t=ie(2);ae("placeholder",t.searchPlaceholder),un("ngModel",t.filter),ae("disabled",t.disabled)("ngModelOptions",Un(4,SF))}}function EF(i,e){if(i&1&&(C(0,"li",11),A(1),E()),i&2){let t=ie(2);P(),Le(t.emptyMessage)}}function MF(i,e){if(i&1){let t=Qe();C(0,"li",12),Y("click",function(r){let o=ve(t).$implicit;return ie(2).onOptionClick(o),ye(r.stopPropagation())}),A(1),E()}if(i&2){let t=e.$implicit,n=e.index,r=ie(2);Ze("active",n===r.activeIndex)("selected",t.value===r.selectedValue),Jn("id",r.getOptionId(n))("aria-selected",t.value===r.selectedValue),P(),rt(" ",t.label," ")}}function DF(i,e){if(i&1&&(C(0,"div",5),nt(1,CF,1,5,"input",6),C(2,"ul",7),nt(3,EF,2,1,"li",8)(4,MF,2,7,"li",9),E()()),i&2){let t=ie();Jn("id",t.panelId),P(),ae("ngIf",t.searchable),P(),Jn("id",t.listboxId)("aria-activedescendant",t.activeOptionId),P(),ae("ngIf",!t.filteredOptions.length),P(),ae("ngForOf",t.filteredOptions)}}var If=class i{constructor(e){this.elRef=e}options=[];placeholder="Select an option";emptyMessage="No matches";searchPlaceholder="Search...";searchable=!0;disabled=!1;selectionChange=new xt;selectedValue="";dropdownOpen=!1;filter="";activeIndex=-1;listboxId=`custom-select-listbox-${Math.random().toString(36).substring(2,9)}`;panelId=`custom-select-panel-${Math.random().toString(36).substring(2,9)}`;onChange=()=>{};onTouched=()=>{};ngOnInit(){}ngOnDestroy(){}writeValue(e){this.selectedValue=e||""}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}get filteredOptions(){let e=this.filter.trim().toLowerCase();return e?this.options.filter(t=>{let n=(t.label||"").toLowerCase().includes(e),r=(t.searchTerms||"").toLowerCase().includes(e);return n||r}):this.options}get activeOptionId(){return this.activeIndex>=0?this.getOptionId(this.activeIndex):null}getOptionId(e){return`${this.listboxId}-option-${e}`}getSelectedLabel(){if(!this.selectedValue)return this.options.length?this.placeholder:this.emptyMessage;let e=this.options.find(t=>t.value===this.selectedValue);return e?e.label:this.placeholder}toggleDropdown(e){this.disabled||(e&&e.stopPropagation(),this.dropdownOpen=!this.dropdownOpen,this.dropdownOpen&&(this.prepareActiveIndex(),this.searchable&&queueMicrotask(()=>{let t=this.elRef.nativeElement.querySelector(".dropdown-panel .search-input");t?.focus(),t?.select()})))}closeDropdown(){this.dropdownOpen&&(this.dropdownOpen=!1,this.resetActiveIndex())}onOptionClick(e){this.selectedValue=e.value,this.onChange(e.value),this.onTouched(),this.selectionChange.emit(e.value),this.closeDropdown()}onKeydown(e){if(this.disabled)return;let t=this.filteredOptions.length-1;switch(e.key){case"Enter":case" ":{if(e.preventDefault(),!this.dropdownOpen)this.toggleDropdown();else if(this.activeIndex>=0&&this.activeIndex<=t){let n=this.filteredOptions[this.activeIndex];n&&this.onOptionClick(n)}break}case"ArrowUp":case"ArrowDown":{if(!this.dropdownOpen)this.toggleDropdown();else{e.preventDefault();let n=e.key==="ArrowUp";this.activeIndex=n?Math.max(0,this.activeIndex-1):Math.min(t,this.activeIndex+1),this.scrollActiveIntoView()}break}case"Escape":{this.closeDropdown();break}}}prepareActiveIndex(){let e=this.filteredOptions.findIndex(t=>t.value===this.selectedValue);this.activeIndex=e>=0?e:this.filteredOptions.length?0:-1,this.scrollActiveIntoView()}resetActiveIndex(){this.activeIndex=-1}scrollActiveIntoView(){if(this.activeIndex<0)return;let e=this.getOptionId(this.activeIndex);this.elRef.nativeElement.querySelector(`#${e}`)?.scrollIntoView({block:"nearest"})}static \u0275fac=function(t){return new(t||i)(se(Fn))};static \u0275cmp=Pe({type:i,selectors:[["app-custom-select"]],inputs:{options:"options",placeholder:"placeholder",emptyMessage:"emptyMessage",searchPlaceholder:"searchPlaceholder",searchable:"searchable",disabled:"disabled"},outputs:{selectionChange:"selectionChange"},features:[bo([{provide:ju,useExisting:Li(()=>i),multi:!0}])],decls:6,vars:10,consts:[["clickableDivWithSound","","role","combobox","aria-haspopup","listbox",1,"custom-select",3,"click","keydown"],[1,"select-display"],[1,"value"],["aria-hidden","true",1,"arrow"],["class","dropdown-panel",4,"ngIf"],[1,"dropdown-panel"],["class","search-input","type","text",3,"placeholder","ngModel","disabled","ngModelOptions","ngModelChange","click",4,"ngIf"],["role","listbox","appCustomScrollbar","",1,"options-list"],["class","option empty","aria-disabled","true",4,"ngIf"],["class","option","role","option",3,"active","selected","click",4,"ngFor","ngForOf"],["type","text",1,"search-input",3,"ngModelChange","click","placeholder","ngModel","disabled","ngModelOptions"],["aria-disabled","true",1,"option","empty"],["role","option",1,"option",3,"click"]],template:function(t,n){t&1&&(C(0,"div",0),Y("click",function(o){return n.toggleDropdown(o)})("keydown",function(o){return n.onKeydown(o)}),C(1,"div",1)(2,"span",2),A(3),E(),Te(4,"span",3),E(),nt(5,DF,5,6,"div",4),E()),t&2&&(Ze("disabled",n.disabled),Jn("aria-expanded",n.dropdownOpen)("aria-owns",n.listboxId)("aria-disabled",n.disabled)("tabindex",n.disabled?-1:0),P(2),Ze("placeholder",!n.selectedValue),P(),rt(" ",n.getSelectedLabel()," "),P(2),ae("ngIf",n.dropdownOpen))},dependencies:[ke,pi,_n,ms,Gr,fs,Mo,Gt],styles:["[_nghost-%COMP%]{display:block;width:100%}.custom-select[_ngcontent-%COMP%]{position:relative;min-width:80%;-webkit-user-select:none;user-select:none;outline:none}.custom-select.disabled[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.custom-select[_ngcontent-%COMP%]   .select-display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.35rem .5rem;border:1px solid #444;border-radius:4px;background:#111;color:#fff}.custom-select[_ngcontent-%COMP%]   .select-display[_ngcontent-%COMP%]   .value.placeholder[_ngcontent-%COMP%]{color:#aaa}.custom-select[_ngcontent-%COMP%]   .select-display[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{margin-left:.5rem;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #fff}.custom-select[_ngcontent-%COMP%]   .dropdown-panel[_ngcontent-%COMP%]{position:absolute;left:0;right:0;z-index:10;margin-top:.25rem;border:1px solid #444;border-radius:4px;background:#000;color:#fff;box-shadow:0 6px 16px #00000080;max-height:28rem;display:flex;flex-direction:column}.custom-select[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{padding:.4rem .5rem;margin:.35rem;border-radius:4px;border:1px solid #555;background:#0a0a0a;color:#fff}.custom-select[_ngcontent-%COMP%]   .options-list[_ngcontent-%COMP%]{list-style:none;margin:0;padding:.25rem .5rem .25rem 0;overflow:auto}.custom-select[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{padding:.4rem .6rem}.custom-select[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:hover, .custom-select[_ngcontent-%COMP%]   .option.active[_ngcontent-%COMP%]{background:#1a1a1a}.custom-select[_ngcontent-%COMP%]   .option.selected[_ngcontent-%COMP%]{font-weight:600}.custom-select[_ngcontent-%COMP%]   .option.empty[_ngcontent-%COMP%]{color:#aaa}"]})};var Nl="text.size",R_="graphics.crtCurve",P_="graphics.vhsChromaSmear",N_="graphics.colorGrading",k_="graphics.vignette",O_="graphics.dust",L_="graphics.reflection",F_="sound.bgmVolume";var gs=class i{constructor(e){this.sfx=e;this.sfx.effectsEnabled$.subscribe(t=>{t?t&&this.desiredActive&&this.lastSrc&&this.internalPlay(this.lastSrc,this.lastVolume,this.lastLoop):this.pauseAndReset()})}musicAudio=null;lastSrc=null;lastVolume=.45;lastLoop=!0;desiredActive=!1;ytPlayer=null;ytReadyPromise=null;ytVideoId=null;fadeRaf=null;fadeDurationMs=800;play(e,t,n=!0){typeof t>"u"||t===null?t=this.getStoredVolume():this.persistVolume(t),this.desiredActive=!0,this.lastSrc=e,this.lastVolume=t,this.lastLoop=n,this.sfx.isSoundEffectsEnabled()&&this.crossfadeToAudio(e,t,n)}stop(){this.desiredActive=!1,this.pauseAndReset()}internalPlay(e,t,n){try{(!this.musicAudio||!this.musicAudio.src.endsWith(e))&&(this.musicAudio?.pause(),this.musicAudio=new Audio(e)),this.musicAudio.loop=n,this.musicAudio.preload="auto",this.musicAudio.volume=t;let o=()=>{this.musicAudio.play().catch(()=>{let s=()=>{window.removeEventListener("pointerdown",s,!0),window.removeEventListener("keydown",s,!0);try{this.musicAudio.play()}catch{}};window.addEventListener("pointerdown",s,{once:!0,capture:!0}),window.addEventListener("keydown",s,{once:!0,capture:!0})})};this.musicAudio.load(),o()}catch{}}pauseAndReset(){try{if(this.musicAudio){this.musicAudio.pause();try{this.musicAudio.currentTime=0}catch{}}this.stopYouTubeInternal()}catch{}}playYouTube(e,t,n=!0){return _e(this,null,function*(){if(typeof t>"u"||t===null?t=this.getStoredVolume():this.persistVolume(t),this.desiredActive=!0,this.lastSrc=e,this.lastVolume=t,this.lastLoop=n,!this.sfx.isSoundEffectsEnabled())return;let r=this.extractYouTubeId(e);r&&(this.ytVideoId=r,yield this.crossfadeToYouTube(r,t,n))})}ensureYouTubeApi(){return this.ytReadyPromise?this.ytReadyPromise:(this.ytReadyPromise=new Promise(e=>{let t=window;if(t.YT&&t.YT.Player){e();return}let n=t.onYouTubeIframeAPIReady;t.onYouTubeIframeAPIReady=()=>{try{n?.()}catch{}e()};let r=document.createElement("script");r.src="https://www.youtube.com/iframe_api",document.head.appendChild(r)}),this.ytReadyPromise)}createOrLoadYtPlayer(e,t,n){return _e(this,null,function*(){let r=window,o=document.getElementById("bgm-youtube-player");if(o||(o=document.createElement("div"),o.id="bgm-youtube-player",o.style.position="fixed",o.style.left="-9999px",o.style.width="1px",o.style.height="1px",document.body.appendChild(o)),!this.ytPlayer)this.ytPlayer=new r.YT.Player("bgm-youtube-player",{width:"1",height:"1",videoId:e,playerVars:{autoplay:1,controls:0,disablekb:1,fs:0,modestbranding:1,rel:0,loop:n?1:0,playlist:e,playsinline:1,origin:window.location.origin},events:{onReady:()=>{try{this.ytPlayer.setVolume(Math.round(t*100)),this.ytPlayer.playVideo()}catch{}},onStateChange:s=>{if(s?.data===r.YT?.PlayerState?.ENDED&&n)try{this.ytPlayer.playVideo()}catch{}}}});else try{n&&this.ytPlayer.cuePlaylist({listType:"playlist",playlist:[e],index:0,suggestedQuality:"small"}),this.ytPlayer.loadVideoById(e),this.ytPlayer.setVolume(Math.round(t*100))}catch{}})}stopYouTubeInternal(){try{if(this.ytPlayer)try{this.ytPlayer.stopVideo?.()}catch{}}catch{}}extractYouTubeId(e){let t=e.trim();if(/^[a-zA-Z0-9_-]{11}$/.test(t))return t;try{let n=new URL(e);if(n.hostname.includes("youtube.com")){if(n.pathname.startsWith("/watch"))return n.searchParams.get("v");if(n.pathname.startsWith("/embed/"))return n.pathname.split("/").pop()||null}if(n.hostname==="youtu.be")return n.pathname.slice(1)||null}catch{}return null}getStoredVolume(){try{let e=window.localStorage.getItem(F_);if(!e)return .45;let t=parseFloat(e);return this.clampVolume(isNaN(t)?.45:t)}catch{return .45}}setVolume(e){e=this.clampVolume(e),this.persistVolume(e),this.lastVolume=e;try{this.musicAudio&&(this.musicAudio.volume=e)}catch{}try{this.ytPlayer&&this.ytPlayer.setVolume(Math.round(e*100))}catch{}}persistVolume(e){try{window.localStorage.setItem(F_,String(this.clampVolume(e)))}catch{}}clampVolume(e){return Math.max(0,Math.min(1,e))}cancelFade(){this.fadeRaf!==null&&(cancelAnimationFrame(this.fadeRaf),this.fadeRaf=null)}crossfade(e,t,n,r,o){this.cancelFade();let s=this.fadeDurationMs,a=null,l=!1;return new Promise(c=>_e(this,null,function*(){let u=yield r();try{u.setVol(0),u.play()}catch{}let h=d=>{a===null&&(a=d);let p=Math.min(1,(d-a)/s),g=t?t():0,f=(1-p)*g,m=p*o;try{e&&e(f)}catch{}try{u.setVol(m)}catch{}if(p<1)this.fadeRaf=requestAnimationFrame(h);else{if(!l&&n){l=!0;try{n()}catch{}}this.fadeRaf=null,c()}};this.fadeRaf=requestAnimationFrame(h)}))}crossfadeToAudio(e,t,n){return _e(this,null,function*(){let r=this.musicAudio,o=this.ytPlayer,s=()=>_e(this,null,function*(){let d=new Audio(e);d.loop=n,d.preload="auto",this.musicAudio?.pause(),this.musicAudio=d;let p=()=>{d.play().catch(()=>{let g=()=>{window.removeEventListener("pointerdown",g,!0),window.removeEventListener("keydown",g,!0);try{d.play()}catch{}};window.addEventListener("pointerdown",g,{once:!0,capture:!0}),window.addEventListener("keydown",g,{once:!0,capture:!0})})};return d.load(),{setVol:g=>{try{d.volume=this.clampVolume(g)}catch{}},getVol:()=>d.volume||0,play:()=>p()}}),a=!!r&&!r.paused&&r.volume>0,l=!!o&&!a,c=a?d=>{try{r.volume=this.clampVolume(d)}catch{}}:l?d=>{try{o.setVolume(Math.round(this.clampVolume(d)*100))}catch{}}:null,u=a?(()=>r.volume||0):l?(()=>{try{let d=o.getVolume?.();return typeof d=="number"?d/100:0}catch{return 0}}):null,h=a?(()=>{try{r.pause()}catch{}}):l?(()=>{this.stopYouTubeInternal()}):null;yield this.crossfade(c,u,h,s,t)})}crossfadeToYouTube(e,t,n){return _e(this,null,function*(){yield this.ensureYouTubeApi();let r=this.musicAudio,o=this.ytPlayer,s=()=>_e(this,null,function*(){yield this.createOrLoadYtPlayer(e,Math.max(1e-4,1e-4),n);try{this.ytPlayer?.setVolume(0)}catch{}try{this.ytPlayer?.playVideo?.()}catch{}let d=()=>{window.removeEventListener("pointerdown",d,!0),window.removeEventListener("keydown",d,!0);try{this.ytPlayer?.playVideo?.()}catch{}};return window.addEventListener("pointerdown",d,{once:!0,capture:!0}),window.addEventListener("keydown",d,{once:!0,capture:!0}),{setVol:p=>{try{this.ytPlayer?.setVolume(Math.round(this.clampVolume(p)*100))}catch{}},getVol:()=>{try{let p=this.ytPlayer?.getVolume?.();return typeof p=="number"?p/100:0}catch{return 0}},play:()=>{try{this.ytPlayer?.playVideo?.()}catch{}}}}),a=!!o&&typeof o.getPlayerState=="function",l=!!r&&!a,c=l?d=>{try{r.volume=this.clampVolume(d)}catch{}}:a?d=>{try{o.setVolume(Math.round(this.clampVolume(d)*100))}catch{}}:null,u=l?(()=>r.volume||0):a?(()=>{try{let d=o.getVolume?.();return typeof d=="number"?d/100:0}catch{return 0}}):null,h=l?(()=>{try{r.pause()}catch{}}):a?(()=>{this.stopYouTubeInternal()}):null;yield this.crossfade(c,u,h,s,t)})}static \u0275fac=function(t){return new(t||i)(Ce(Dn))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var kl=class i{static VOICE_STORAGE_KEY="speech.selectedVoiceUri";static SCREEN_READER_STORAGE_KEY="speech.screenReaderEnabled";static SPEECH_RATE_STORAGE_KEY="speech.rate";voicesSubject=new st([]);selectedVoiceUri=this.loadStoredVoicePreference();screenReaderEnabled=this.loadScreenReaderSetting();speechRate=this.loadStoredSpeechRate();currentUtterance=null;speakAfterCancelTimeoutId=null;constructor(){this.initVoicePopulation()}get speechSynth(){return typeof window>"u"?null:window.speechSynthesis??null}getVoices$(){return this.voicesSubject.asObservable()}getSelectedVoiceUri(){return this.selectedVoiceUri}setSelectedVoice(e){this.selectedVoiceUri=e,this.storeVoicePreference(e)}isScreenReaderEnabled(){return this.screenReaderEnabled}setScreenReaderEnabled(e){this.screenReaderEnabled=e,this.storeScreenReaderSetting(e),e||this.cancelAllSpeech()}getSpeechRate(){return this.speechRate}setSpeechRate(e){let t=this.clampSpeechRate(e);this.speechRate=t,this.storeSpeechRate(t)}speakMessage(e){if(!this.screenReaderEnabled)return;let t=this.speechSynth;if(!t||!e?.dialogue||typeof SpeechSynthesisUtterance>"u")return;let n=this.flattenMarkdownForSpeech(e.dialogue);if(n)try{try{t.cancel()}catch{}this.speakAfterCancelTimeoutId!==null&&(clearTimeout(this.speakAfterCancelTimeoutId),this.speakAfterCancelTimeoutId=null);let r=new SpeechSynthesisUtterance(n),o=this.resolvePreferredVoice();o?(r.voice=o,r.lang=o.lang,this.selectedVoiceUri=o.voiceURI):r.lang=typeof navigator<"u"&&navigator.language?navigator.language:"en-US",r.rate=this.speechRate,this.currentUtterance=r,r.onend=()=>{this.currentUtterance===r&&(this.currentUtterance=null)},r.onerror=()=>{this.currentUtterance===r&&(this.currentUtterance=null)},this.speakAfterCancelTimeoutId=window.setTimeout(()=>{if(this.speakAfterCancelTimeoutId=null,this.currentUtterance===r)try{t.speak(r)}catch(s){console.warn("Speech synthesis speak() failed",s)}},0)}catch(r){console.warn("Speech synthesis failed",r)}}flattenMarkdownForSpeech(e){return e?e.replace(/```[\s\S]*?```/g," ").replace(/`([^`]*)`/g,"$1").replace(/!\[[^\]]*\]\([^)]*\)/g," ").replace(/!\[[^\]]*\]\[[^\]]*\]/g," ").replace(/\[[^\]]*\]\([^)]*\)/g," ").replace(/\[[^\]]*\]\[[^\]]*\]/g," ").replace(/^\s*\[[^\]]+\]:\s*\S+.*$/gm," ").replace(/<https?:\/\/[^>]+>/gi," ").replace(/https?:\/\/\S+|www\.\S+/gi," ").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/__(.*?)__/g,"$1").replace(/_(.*?)_/g,"$1").replace(/[#>*_\-]+/g," ").replace(/<br\s*\/?\s*>/gi," ").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim():""}initVoicePopulation(){let e=this.speechSynth;if(!e)return;let t=()=>{let n=e.getVoices?.()??[];this.voicesSubject.next(n),n.length&&(this.selectedVoiceUri?n.some(o=>o.voiceURI===this.selectedVoiceUri)||(this.selectedVoiceUri=this.pickDefaultVoiceUri(n),this.storeVoicePreference(this.selectedVoiceUri)):(this.selectedVoiceUri=this.pickDefaultVoiceUri(n),this.selectedVoiceUri&&this.storeVoicePreference(this.selectedVoiceUri)))};t(),typeof e.addEventListener=="function"?e.addEventListener("voiceschanged",t):"onvoiceschanged"in e&&(e.onvoiceschanged=t)}resolvePreferredVoice(){let e=this.voicesSubject.value;if(!e?.length)return null;if(this.selectedVoiceUri){let n=e.find(r=>r.voiceURI===this.selectedVoiceUri);if(n)return n}let t=this.pickDefaultVoiceUri(e);if(t){let n=e.find(r=>r.voiceURI===t)??null;return this.selectedVoiceUri=n?.voiceURI??null,this.selectedVoiceUri&&this.storeVoicePreference(this.selectedVoiceUri),n}return null}pickDefaultVoiceUri(e){return e.length?(e.find(n=>n.default)??e[0])?.voiceURI??null:null}loadStoredVoicePreference(){let e=this.getLocalStorage();if(!e)return null;try{return e.getItem(i.VOICE_STORAGE_KEY)}catch{return null}}storeVoicePreference(e){let t=this.getLocalStorage();if(t)try{e?t.setItem(i.VOICE_STORAGE_KEY,e):t.removeItem(i.VOICE_STORAGE_KEY)}catch{}}loadScreenReaderSetting(){let e=this.getLocalStorage();if(!e)return!0;try{let t=e.getItem(i.SCREEN_READER_STORAGE_KEY);return t===null?!0:t==="true"}catch{return!0}}loadStoredSpeechRate(){let e=this.getLocalStorage();if(!e)return 1;try{let t=e.getItem(i.SPEECH_RATE_STORAGE_KEY);if(t===null)return 1;let n=parseFloat(t);return isNaN(n)?1:this.clampSpeechRate(n)}catch{return 1}}storeSpeechRate(e){let t=this.getLocalStorage();if(t)try{t.setItem(i.SPEECH_RATE_STORAGE_KEY,String(this.clampSpeechRate(e)))}catch{}}clampSpeechRate(e){let r=Math.round(e*10)/10;return Math.max(.5,Math.min(2,r))}storeScreenReaderSetting(e){let t=this.getLocalStorage();if(t)try{t.setItem(i.SCREEN_READER_STORAGE_KEY,String(e))}catch{}}getLocalStorage(){if(typeof window>"u")return null;try{return window.localStorage}catch{return null}}cancelAllSpeech(){let e=this.speechSynth;if(e){try{e.cancel()}catch{}this.speakAfterCancelTimeoutId!==null&&(clearTimeout(this.speakAfterCancelTimeoutId),this.speakAfterCancelTimeoutId=null),this.currentUtterance=null}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var Yr=()=>({standalone:!0}),aa=class i{constructor(e,t,n,r,o,s){this.router=e;this.soundService=t;this.bgmService=n;this.speechService=r;this.dmService=o;this.document=s;this.soundEffectsEnabled=this.soundService.isSoundEffectsEnabled(),this.bgmVolume=this.bgmService.getStoredVolume()}soundEffectsEnabled=!0;bgmVolume=.45;textSizeOptions=["80","90","100","110","120"];textSize="100";serverAddress="";speechVoices=[];voiceOptions=[];selectedVoiceUri="";screenReaderEnabled=!0;speechRate=1;enableCrtCurve=!0;enableVhsChroma=!0;enableColorGrading=!0;enableVignette=!0;enableDust=!0;enableReflection=!0;destroy$=new Tt;close=new xt;ngOnInit(){this.serverAddress=this.dmService.getServerAddress(),this.screenReaderEnabled=this.speechService.isScreenReaderEnabled();let e=this.speechService.getSelectedVoiceUri();e&&(this.selectedVoiceUri=e),this.speechRate=this.speechService.getSpeechRate();let n=this.loadStoredTextSize()??this.getCurrentTextSize();this.textSize=n,this.textSizeOptions.includes(n)||(this.textSizeOptions=[...this.textSizeOptions,n].sort((r,o)=>parseFloat(r)-parseFloat(o))),this.applyGlobalTextSize(n),this.enableCrtCurve=this.loadStoredBool(R_,!0),this.enableVhsChroma=this.loadStoredBool(P_,!0),this.enableColorGrading=this.loadStoredBool(N_,!0),this.enableVignette=this.loadStoredBool(k_,!0),this.enableDust=this.loadStoredBool(O_,!0),this.enableReflection=this.loadStoredBool(L_,!0),this.applyCrtCurve(this.enableCrtCurve),this.applyVhsChroma(this.enableVhsChroma),this.applyColorGrading(this.enableColorGrading),this.applyVignette(this.enableVignette),this.applyDust(this.enableDust),this.applyReflection(this.enableReflection),this.speechService.getVoices$().pipe(Ha(this.destroy$)).subscribe(r=>{this.speechVoices=r,this.voiceOptions=r.map(s=>({value:s.voiceURI,label:`${s.name} (${s.lang})`,searchTerms:`${s.name} ${s.lang}`}));let o=this.speechService.getSelectedVoiceUri();if(o&&r.some(s=>s.voiceURI===o))this.selectedVoiceUri=o;else if(r.length){let s=r[0].voiceURI;this.selectedVoiceUri=s,this.speechService.setSelectedVoice(s)}else this.selectedVoiceUri=""})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSoundEffectsToggle(e){this.soundEffectsEnabled=e,this.soundService.setSoundEffectsEnabled(e)}onTextSizeChange(e){let t=this.sanitizeTextSize(e);t&&(this.textSize=t,this.applyGlobalTextSize(t))}onVoiceChange(e){this.selectedVoiceUri=e,this.speechService.setSelectedVoice(e)}onScreenReaderToggle(e){this.screenReaderEnabled=e,this.speechService.setScreenReaderEnabled(e)}incrementBgmVolume(){let e=this.clampVolume(this.bgmVolume+.05);this.bgmVolume=e,this.bgmService.setVolume(e)}decrementBgmVolume(){let e=this.clampVolume(this.bgmVolume-.05);this.bgmVolume=e,this.bgmService.setVolume(e)}clampVolume(e){return Math.max(0,Math.min(1,Math.round(e*20)/20))}incrementSpeechRate(){let e=this.clampSpeechRate(this.speechRate+.1);this.speechRate=e,this.speechService.setSpeechRate(e)}decrementSpeechRate(){let e=this.clampSpeechRate(this.speechRate-.1);this.speechRate=e,this.speechService.setSpeechRate(e)}clampSpeechRate(e){let r=Math.round(e*10)/10;return Math.max(.5,Math.min(2,r))}applyServerAddress(){this.dmService.setServerAddress(this.serverAddress),this.serverAddress=this.dmService.getServerAddress()}onCrtCurveToggle(e){this.enableCrtCurve=e,this.applyCrtCurve(e),this.persistBool(R_,e)}onVhsChromaToggle(e){this.enableVhsChroma=e,this.applyVhsChroma(e),this.persistBool(P_,e)}onColorGradingToggle(e){this.enableColorGrading=e,this.applyColorGrading(e),this.persistBool(N_,e)}onVignetteToggle(e){this.enableVignette=e,this.applyVignette(e),this.persistBool(k_,e)}onDustToggle(e){this.enableDust=e,this.applyDust(e),this.persistBool(O_,e)}onReflectionToggle(e){this.enableReflection=e,this.applyReflection(e),this.persistBool(L_,e)}goToTitle(){if(this.close.observers.length){this.close.emit();return}this.router.navigateByUrl("/")}getCurrentTextSize(){let e=this.document?.documentElement,t=this.document?.defaultView;return!e||!t?this.textSize:t.getComputedStyle(e).getPropertyValue("--global-font-size-text").trim().replace(/[^0-9.]/g,"")||this.textSize}applyGlobalTextSize(e){let t=this.document?.documentElement;t&&(t.style.setProperty("--global-font-size-text",`${e}%`),this.persistTextSize(e))}loadStoredTextSize(){let e=this.getLocalStorage();if(!e)return null;try{let t=e.getItem(Nl);return t&&this.sanitizeTextSize(t)||null}catch{return null}}persistTextSize(e){let t=this.getLocalStorage();if(t)try{let n=this.sanitizeTextSize(e);if(!n){t.removeItem(Nl);return}t.setItem(Nl,n)}catch{}}getLocalStorage(){if(typeof window>"u")return null;try{return window.localStorage}catch{return null}}sanitizeTextSize(e){return e.trim().replace(/[^0-9.]/g,"")||""}incrementTextSize(){let e=parseFloat(this.textSize)||100,t=this.clampTextSize(e+5);this.onTextSizeChange(String(t))}decrementTextSize(){let e=parseFloat(this.textSize)||100,t=this.clampTextSize(e-5);this.onTextSizeChange(String(t))}clampTextSize(e){let r=Math.round(e);return Math.max(50,Math.min(200,r))}getCheckboxBg(e){return`url('menus/${e?"checked":"uncheck"}.webp')`}applyCrtCurve(e){let t=this.document?.documentElement;t&&(t.style.setProperty("--filter-crt-curve",e?"url(#CRTCurve)":"blur(0)"),t.style.setProperty("--monitor-frame",e?"visible":"hidden"),t.style.setProperty("--filter-screen-lines",e?"url(#screenLines)":"blur(0)"),t.style.setProperty("--filter-screen-noise",e?"url(#ScreenNoiseFilter)":"blur(0)"),e?(t.style.removeProperty("--viewport-width"),t.style.removeProperty("--viewport-height"),t.style.removeProperty("--viewport-aspect"),t.style.removeProperty("--crt-width"),t.style.removeProperty("--crt-height"),t.style.removeProperty("--crt-left"),t.style.removeProperty("--crt-top")):(t.style.setProperty("--viewport-width","100vw"),t.style.setProperty("--viewport-height","100vh"),t.style.setProperty("--viewport-aspect","auto"),t.style.setProperty("--crt-width","100%"),t.style.setProperty("--crt-height","100%"),t.style.setProperty("--crt-left","0%"),t.style.setProperty("--crt-top","0%")))}applyVhsChroma(e){let t=this.document?.documentElement;t&&t.style.setProperty("--filter-vhs-chroma",e?"url(#VHSChromaSmear)":"blur(0)")}applyColorGrading(e){let t=this.document?.documentElement;t&&t.style.setProperty("--filter-color-grading",e?"url(#ColorGrading)":"blur(0)")}applyVignette(e){let t=this.document?.documentElement;t&&t.style.setProperty("--vignette-display",e?"block":"none")}applyDust(e){let t=this.document?.documentElement;t&&t.style.setProperty("--dust-display",e?"block":"none")}applyReflection(e){let t=this.document?.documentElement;t&&t.style.setProperty("--reflection-display",e?"block":"none")}loadStoredBool(e,t){let n=this.getLocalStorage();if(!n)return t;try{let r=n.getItem(e);return r===null?t:r==="true"||r==="1"}catch{return t}}persistBool(e,t){let n=this.getLocalStorage();if(n)try{n.setItem(e,t?"true":"false")}catch{}}static \u0275fac=function(t){return new(t||i)(se(Hr),se(Dn),se(gs),se(kl),se($r),se(Bt))};static \u0275cmp=Pe({type:i,selectors:[["app-settings-pane"]],outputs:{close:"close"},decls:98,vars:59,consts:[[1,"settings-container"],[1,"section-title"],[1,"solid"],["clickableDivWithSound","",1,"form-column"],[1,"checkbox"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[1,"form-column"],["id","musicVolumeLabel"],["role","group","aria-labelledby","musicVolumeLabel",1,"text-size-controls"],["clickableDivWithSound","","type","button","aria-label","Decrease music volume",1,"text-btn",3,"click"],[1,"label","small"],["aria-live","polite",1,"text-size-readout"],["clickableDivWithSound","","type","button","aria-label","Increase music volume",1,"text-btn",3,"click"],[1,"label","large"],["clickableDivWithSound","",1,"checkbox"],["placeholder","Choose a voice","searchPlaceholder","Search voices","emptyMessage","No voices available",3,"ngModelChange","selectionChange","options","disabled","ngModel","ngModelOptions"],["id","speechSpeedLabel"],["role","group","aria-labelledby","speechSpeedLabel",1,"text-size-controls"],["clickableDivWithSound","","type","button","aria-label","Decrease speech speed",1,"text-btn",3,"click","disabled"],["clickableDivWithSound","","type","button","aria-label","Increase speech speed",1,"text-btn",3,"click","disabled"],["for","serverAddressInput"],["id","serverAddressInput","type","text","placeholder","http://localhost:8080",3,"ngModelChange","blur","ngModel","ngModelOptions"],[2,"display","flex","gap","0.5rem"],["clickableDivWithSound","","type","button",1,"text-btn",3,"click"],["id","textSizeLabel"],["role","group","aria-labelledby","textSizeLabel",1,"text-size-controls"],["clickableDivWithSound","","type","button","aria-label","Decrease text size",1,"text-btn",3,"click"],["clickableDivWithSound","","type","button","aria-label","Increase text size",1,"text-btn",3,"click"],[1,"actions"],["clickableDivWithSound","button",1,"primary",3,"click"]],template:function(t,n){t&1&&(C(0,"div",0)(1,"h2",1),A(2,"Settings"),E(),Te(3,"hr",2),C(4,"h3",1),A(5,"Sound"),E(),C(6,"div",3)(7,"label",4)(8,"input",5),dn("ngModelChange",function(o){return vn(n.soundEffectsEnabled,o)||(n.soundEffectsEnabled=o),o}),Y("ngModelChange",function(o){return n.onSoundEffectsToggle(o)}),E(),C(9,"span"),A(10,"Sound Effects"),E()()(),C(11,"div",6)(12,"label",7),A(13,"Music volume"),E(),C(14,"div",8)(15,"button",9),Y("click",function(){return n.decrementBgmVolume()}),C(16,"span",10),A(17,"-"),E()(),C(18,"div",11),A(19),sn(20,"number"),E(),C(21,"button",12),Y("click",function(){return n.incrementBgmVolume()}),C(22,"span",13),A(23,"+"),E()()()(),C(24,"div",6)(25,"label",14)(26,"input",5),dn("ngModelChange",function(o){return vn(n.screenReaderEnabled,o)||(n.screenReaderEnabled=o),o}),Y("ngModelChange",function(o){return n.onScreenReaderToggle(o)}),E(),C(27,"span"),A(28,"Enable Screen Reader"),E()(),C(29,"app-custom-select",15),dn("ngModelChange",function(o){return vn(n.selectedVoiceUri,o)||(n.selectedVoiceUri=o),o}),Y("selectionChange",function(o){return n.onVoiceChange(o)}),E(),C(30,"label",16),A(31,"Speech speed"),E(),C(32,"div",17)(33,"button",18),Y("click",function(){return n.decrementSpeechRate()}),C(34,"span",10),A(35,"-"),E()(),C(36,"div",11),A(37),sn(38,"number"),E(),C(39,"button",19),Y("click",function(){return n.incrementSpeechRate()}),C(40,"span",13),A(41,"+"),E()()()(),Te(42,"hr",2),C(43,"h3",1),A(44,"Graphics"),E(),C(45,"div",6)(46,"label",14)(47,"input",5),dn("ngModelChange",function(o){return vn(n.enableCrtCurve,o)||(n.enableCrtCurve=o),o}),Y("ngModelChange",function(o){return n.onCrtCurveToggle(o)}),E(),C(48,"span"),A(49,"CRT Curve + 4:3 viewport"),E()(),C(50,"label",14)(51,"input",5),dn("ngModelChange",function(o){return vn(n.enableVhsChroma,o)||(n.enableVhsChroma=o),o}),Y("ngModelChange",function(o){return n.onVhsChromaToggle(o)}),E(),C(52,"span"),A(53,"VHS Chroma Smear"),E()(),C(54,"label",14)(55,"input",5),dn("ngModelChange",function(o){return vn(n.enableColorGrading,o)||(n.enableColorGrading=o),o}),Y("ngModelChange",function(o){return n.onColorGradingToggle(o)}),E(),C(56,"span"),A(57,"Color Grading"),E()(),C(58,"label",14)(59,"input",5),dn("ngModelChange",function(o){return vn(n.enableVignette,o)||(n.enableVignette=o),o}),Y("ngModelChange",function(o){return n.onVignetteToggle(o)}),E(),C(60,"span"),A(61,"Vignette"),E()(),C(62,"label",14)(63,"input",5),dn("ngModelChange",function(o){return vn(n.enableDust,o)||(n.enableDust=o),o}),Y("ngModelChange",function(o){return n.onDustToggle(o)}),E(),C(64,"span"),A(65,"Dust"),E()(),C(66,"label",14)(67,"input",5),dn("ngModelChange",function(o){return vn(n.enableReflection,o)||(n.enableReflection=o),o}),Y("ngModelChange",function(o){return n.onReflectionToggle(o)}),E(),C(68,"span"),A(69,"Screen Reflection"),E()()(),Te(70,"hr",2),C(71,"h3",1),A(72,"Network"),E(),C(73,"div",6)(74,"label",20),A(75,"Server address"),E(),C(76,"input",21),dn("ngModelChange",function(o){return vn(n.serverAddress,o)||(n.serverAddress=o),o}),Y("blur",function(){return n.applyServerAddress()}),E(),C(77,"div",22)(78,"button",23),Y("click",function(){return n.applyServerAddress()}),A(79,"Apply"),E()()(),Te(80,"hr",2),C(81,"h3",1),A(82,"Text"),E(),C(83,"div",6)(84,"label",24),A(85,"Text size"),E(),C(86,"div",25)(87,"button",26),Y("click",function(){return n.decrementTextSize()}),C(88,"span",10),A(89,"A-"),E()(),C(90,"div",11),A(91),E(),C(92,"button",27),Y("click",function(){return n.incrementTextSize()}),C(93,"span",13),A(94,"A+"),E()()()(),C(95,"div",28)(96,"button",29),Y("click",function(){return n.goToTitle()}),A(97,"Go to title"),E()()()),t&2&&(P(8),gt("background-image",n.getCheckboxBg(n.soundEffectsEnabled)),un("ngModel",n.soundEffectsEnabled),ae("ngModelOptions",Un(49,Yr)),P(11),rt("",dl(20,43,n.bgmVolume*100,"1.0-0"),"%"),P(7),gt("background-image",n.getCheckboxBg(n.screenReaderEnabled)),un("ngModel",n.screenReaderEnabled),ae("ngModelOptions",Un(50,Yr)),P(3),ae("options",n.voiceOptions)("disabled",!n.screenReaderEnabled),un("ngModel",n.selectedVoiceUri),ae("ngModelOptions",Un(51,Yr)),P(4),ae("disabled",!n.screenReaderEnabled),P(4),rt("",dl(38,46,n.speechRate,"1.1-1"),"x"),P(2),ae("disabled",!n.screenReaderEnabled),P(8),gt("background-image",n.getCheckboxBg(n.enableCrtCurve)),un("ngModel",n.enableCrtCurve),ae("ngModelOptions",Un(52,Yr)),P(4),gt("background-image",n.getCheckboxBg(n.enableVhsChroma)),un("ngModel",n.enableVhsChroma),ae("ngModelOptions",Un(53,Yr)),P(4),gt("background-image",n.getCheckboxBg(n.enableColorGrading)),un("ngModel",n.enableColorGrading),ae("ngModelOptions",Un(54,Yr)),P(4),gt("background-image",n.getCheckboxBg(n.enableVignette)),un("ngModel",n.enableVignette),ae("ngModelOptions",Un(55,Yr)),P(4),gt("background-image",n.getCheckboxBg(n.enableDust)),un("ngModel",n.enableDust),ae("ngModelOptions",Un(56,Yr)),P(4),gt("background-image",n.getCheckboxBg(n.enableReflection)),un("ngModel",n.enableReflection),ae("ngModelOptions",Un(57,Yr)),P(9),un("ngModel",n.serverAddress),ae("ngModelOptions",Un(58,Yr)),P(15),rt("",n.textSize,"%"))},dependencies:[ke,ms,Gr,v_,fs,Mo,Gt,If,Ay],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto}.settings-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;box-sizing:border-box;gap:1rem;margin:1rem}.section-title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.25rem}.form-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;-webkit-user-select:none;user-select:none}.checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:24px;height:24px;margin:0;border:0;outline:none;background-color:transparent;background-repeat:no-repeat;background-position:center center;background-size:contain}.checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 2px #66afe9cc;border-radius:4px}select[_ngcontent-%COMP%]{padding:.35rem .5rem}.actions[_ngcontent-%COMP%]{margin-top:auto;display:flex;justify-content:flex-end}.primary[_ngcontent-%COMP%]{padding:.5rem .75rem;border-radius:4px}.text-size-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.text-btn[_ngcontent-%COMP%]{width:2.5rem;height:2.2rem;display:inline-flex;align-items:center;justify-content:center;border:1px solid #444;border-radius:4px;background:#111;color:#fff;-webkit-user-select:none;user-select:none}.text-btn[_ngcontent-%COMP%]:hover{background:#1a1a1a}.text-btn[_ngcontent-%COMP%]:active{background:#0f0f0f}.text-btn[_ngcontent-%COMP%]   .label.small[_ngcontent-%COMP%]{font-size:.85rem}.text-btn[_ngcontent-%COMP%]   .label.large[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600}.text-size-readout[_ngcontent-%COMP%]{min-width:3.5rem;text-align:center}"]})};var Tf=class i{constructor(e){this.bgm=e;this.randomNewSessionId=crypto.randomUUID()}selectedMenu=at("title");randomNewSessionId;ClickSoundType=yf;ngOnInit(){this.bgm.play("music/title.ogg",void 0,!0)}ngOnDestroy(){this.bgm.stop()}selectMenu(e){this.selectedMenu.set(e),e==="new"&&(this.randomNewSessionId=crypto.randomUUID())}static \u0275fac=function(t){return new(t||i)(se(gs))};static \u0275cmp=Pe({type:i,selectors:[["app-title"]],decls:33,vars:25,consts:[[1,"title-container"],[1,"sidebar"],[1,"each-button-wrapper"],["clickableDivWithSound","",1,"menu-btn",3,"mousedown","clickSoundType"],["src","menus/title_button.webp","alt","Title button",1,"image-icon"],[1,"text-in-button"],["src","menus/title_button.webp","alt","New campaign button",1,"image-icon"],["src","menus/title_button.webp","alt","Continue button",1,"image-icon"],["src","menus/title_button.webp","alt","Join button",1,"image-icon"],["src","menus/title_button.webp","alt","Settings button",1,"image-icon"],[1,"main-content"],[3,"cancel"],[3,"close"]],template:function(t,n){t&1&&(C(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),Y("mousedown",function(){return n.selectMenu("title")}),Te(4,"img",4),E(),C(5,"div",5),A(6,"TITLE"),E()(),C(7,"div",2)(8,"div",3),Y("mousedown",function(){return n.selectMenu("new")}),Te(9,"img",6),E(),C(10,"div",5),A(11,"NEW CAMPAIGN"),E()(),C(12,"div",2)(13,"div",3),Y("mousedown",function(){return n.selectMenu("continue")}),Te(14,"img",7),E(),C(15,"div",5),A(16,"CONTINUE"),E()(),C(17,"div",2)(18,"div",3),Y("mousedown",function(){return n.selectMenu("join")}),Te(19,"img",8),E(),C(20,"div",5),A(21,"JOIN CAMPAIGN"),E()(),C(22,"div",2)(23,"div",3),Y("mousedown",function(){return n.selectMenu("settings")}),Te(24,"img",9),E(),C(25,"div",5),A(26,"SETTINGS"),E()()(),C(27,"div",10),Te(28,"app-welcome-pane"),C(29,"app-new-campaign-pane",11),Y("cancel",function(){return n.selectMenu("title")}),E(),Te(30,"app-continue-pane")(31,"app-join-pane"),C(32,"app-settings-pane",12),Y("close",function(){return n.selectMenu("title")}),E()()()),t&2&&(P(3),Ze("selected",n.selectedMenu()==="title"),ae("clickSoundType",n.ClickSoundType.OLD_RADIO_BUTTON),P(5),Ze("selected",n.selectedMenu()==="new"),ae("clickSoundType",n.ClickSoundType.OLD_RADIO_BUTTON),P(5),Ze("selected",n.selectedMenu()==="continue"),ae("clickSoundType",n.ClickSoundType.OLD_RADIO_BUTTON),P(5),Ze("selected",n.selectedMenu()==="join"),ae("clickSoundType",n.ClickSoundType.OLD_RADIO_BUTTON),P(5),Ze("selected",n.selectedMenu()==="settings"),ae("clickSoundType",n.ClickSoundType.OLD_RADIO_BUTTON),P(5),gt("display",n.selectedMenu()!=="title"?"none":null),P(),gt("display",n.selectedMenu()!=="new"?"none":null),P(),gt("display",n.selectedMenu()!=="continue"?"none":null),P(),gt("display",n.selectedMenu()!=="join"?"none":null),P(),gt("display",n.selectedMenu()!=="settings"?"none":null))},dependencies:[ke,af,Ef,Mf,Df,Gt,aa],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}.title-container[_ngcontent-%COMP%]{display:flex;height:100%;width:100%;align-items:flex-start}.sidebar[_ngcontent-%COMP%]{width:25%;height:100%;padding-top:2rem;background-color:var(--sidebar-background-color);border-right:3px solid #4b4b4e;font-family:Almendra,serif}.each-button-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;height:auto}.each-button-wrapper[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]{width:100%;height:auto;aspect-ratio:auto}.each-button-wrapper[_ngcontent-%COMP%]   .image-icon[_ngcontent-%COMP%]{position:relative;width:100%;height:auto;object-fit:contain}.text-in-button[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;text-align:center;color:#b9bbbb;font-weight:600;z-index:1;pointer-events:none}.sidebar[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#2a2a2e}.sidebar[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background-color:#33343a;font-weight:600}.main-content[_ngcontent-%COMP%]{width:75%;height:100%;display:flex;flex-direction:column;padding:20px}.right-pane[_ngcontent-%COMP%]{position:fixed;right:0;top:0;width:340px;height:100%;background-color:#111214;border-left:1px solid #2a2a2e;transform:translate(100%);transition:transform .3s ease;overflow-y:auto}.right-pane.show[_ngcontent-%COMP%]{transform:translate(0)}.pane-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0}.pane-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:1rem}.pane-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}.pane-content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem;box-sizing:border-box;background:#0f0f12;color:#e8e8ee;border:1px solid #2a2a2e;border-radius:4px}.pane-content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:2px solid #4a90e2;outline-offset:1px}.pane-content[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:.5rem;padding:.5rem 1rem;background:#22252a;color:#e8e8ee;border:1px solid #2a2a2e;border-radius:4px}.pane-content[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#2a2e34}.campaign-selector[_ngcontent-%COMP%]{height:300px;overflow-y:auto;border:1px solid #2a2a2e;padding:.5rem;background:#141417}.campaign-portrait[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:.75rem;padding:.5rem;border:1px solid #2a2a2e;border-radius:4px;background:#17181c}.campaign-portrait[_ngcontent-%COMP%]:hover{background:#1b1c21}.campaign-portrait[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80px;height:80px;object-fit:cover;margin-bottom:.5rem}.campaign-portrait[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{text-align:center;font-size:.9rem;color:#e0e0e6}.campaign-portrait.selected[_ngcontent-%COMP%]{outline:2px solid #4a90e2}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center}.modal[_ngcontent-%COMP%]{background-color:#1e1f24;border:1px solid #2a2a2e;padding:1rem;border-radius:8px;max-width:400px;width:100%;color:#e8e8ee}.modal[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0}.modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:1rem}.modal[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}.modal[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem;box-sizing:border-box;background:#0f0f12;color:#e8e8ee;border:1px solid #2a2a2e;border-radius:4px}.modal[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:2px solid #4a90e2;outline-offset:1px}.modal[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:.5rem;padding:.5rem 1rem;background:#22252a;color:#e8e8ee;border:1px solid #2a2a2e;border-radius:4px}.modal[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#2a2e34}",'.menu-btn[_ngcontent-%COMP%]{--button-height: 6px;--button-side-color: #383838ff;--selected-color: rgba(11, 102, 56, .94);--selected-depth-position: 3.3px;--over-depth-position: 4.5px;--over-depth-gap: calc(var(--over-depth-position) - var(--selected-depth-position));--perspective: 180px;--normal-rotate: 8deg;--hover-translate: .8px;--hover-rotate: 12deg;aspect-ratio:62 / 42;align-items:center;justify-content:center;height:2.5rem;position:relative;margin:2px;will-change:transform;transform:perspective(var(--perspective)) rotateX(var(--normal-rotate));transition:transform 96ms cubic-bezier(.82,-.09,.69,2.93),filter 0ms ease-in-out}.menu-btn[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;border-radius:.5rem;pointer-events:none;box-shadow:0 var(--button-height) var(--button-side-color)}.menu-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(var(--hover-translate)) perspective(var(--perspective)) rotateX(var(--hover-rotate))}.menu-btn[_ngcontent-%COMP%]:hover:after{box-shadow:0 calc(var(--button-height) - .4px) var(--button-side-color);opacity:1;pointer-events:none}.menu-btn[_ngcontent-%COMP%]:active{transform:translateY(var(--over-depth-position)) perspective(var(--perspective)) rotateX(var(--hover-rotate));filter:brightness(.98)}.menu-btn[_ngcontent-%COMP%]:active:after{opacity:1;background:#00000014;box-shadow:inset 0 6px #0000008c}.menu-btn.selected[_ngcontent-%COMP%]{transform:translateY(var(--selected-depth-position)) perspective(var(--perspective)) rotateX(var(--normal-rotate))}.menu-btn.selected[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(var(--selected-depth-position)) perspective(var(--perspective)) rotateX(var(--hover-rotate))}.menu-btn.selected[_ngcontent-%COMP%]:after{box-shadow:0 0 8px var(--selected-color) inset;background-color:#c00a6e57;mix-blend-mode:difference}.menu-btn.selected[_ngcontent-%COMP%]:active{transform:translateY(calc(var(--selected-depth-position) + var(--over-depth-gap))) perspective(var(--perspective)) rotateX(var(--hover-rotate));clip-path:inset(0px 0px var(--over-depth-gap) 0px)}.menu-btn.selected[_ngcontent-%COMP%]:active:after{mix-blend-mode:multiply;box-shadow:inset 0 0 8px var(--selected-color),inset 0 4px #000c}.image-icon[_ngcontent-%COMP%]{border-radius:.275rem;overflow:hidden;width:100%;height:100%;object-fit:fill;flex:0 0 auto;-webkit-user-select:none;user-select:none;-webkit-user-drag:none;pointer-events:none}']})};function U_(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ca=U_();function oD(i){ca=i}var $u={exec:()=>null};function bt(i,e=""){let t=typeof i=="string"?i:i.source,n={replace:(r,o)=>{let s=typeof o=="string"?o:o.source;return s=s.replace(ti.caret,"$1"),t=t.replace(r,s),n},getRegex:()=>new RegExp(t,e)};return n}var ti={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:i=>new RegExp(`^( {0,3}${i})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}#`),htmlBeginRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}<(?:[a-z].*>|!--)`,"i")},IF=/^(?:[ \t]*(?:\n|$))+/,TF=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,AF=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Yu=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,RF=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,H_=/(?:[*+-]|\d{1,9}[.)])/,sD=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,aD=bt(sD).replace(/bull/g,H_).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),PF=bt(sD).replace(/bull/g,H_).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),G_=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,NF=/^[^\n]+/,q_=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,kF=bt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",q_).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),OF=bt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,H_).getRegex(),kf="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",W_=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,LF=bt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",W_).replace("tag",kf).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),lD=bt(G_).replace("hr",Yu).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kf).getRegex(),FF=bt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",lD).getRegex(),$_={blockquote:FF,code:TF,def:kF,fences:AF,heading:RF,hr:Yu,html:LF,lheading:aD,list:OF,newline:IF,paragraph:lD,table:$u,text:NF},JM=bt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Yu).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kf).getRegex(),VF=Ve(ne({},$_),{lheading:PF,table:JM,paragraph:bt(G_).replace("hr",Yu).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",JM).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kf).getRegex()}),BF=Ve(ne({},$_),{html:bt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",W_).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:$u,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:bt(G_).replace("hr",Yu).replace("heading",` *#{1,6} *[^
]`).replace("lheading",aD).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()}),zF=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,jF=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,cD=/^( {2,}|\\)\n(?!\s*$)/,UF=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Of=/[\p{P}\p{S}]/u,Y_=/[\s\p{P}\p{S}]/u,uD=/[^\s\p{P}\p{S}]/u,HF=bt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Y_).getRegex(),dD=/(?!~)[\p{P}\p{S}]/u,GF=/(?!~)[\s\p{P}\p{S}]/u,qF=/(?:[^\s\p{P}\p{S}]|~)/u,WF=bt(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),hD=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,$F=bt(hD,"u").replace(/punct/g,Of).getRegex(),YF=bt(hD,"u").replace(/punct/g,dD).getRegex(),pD="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ZF=bt(pD,"gu").replace(/notPunctSpace/g,uD).replace(/punctSpace/g,Y_).replace(/punct/g,Of).getRegex(),XF=bt(pD,"gu").replace(/notPunctSpace/g,qF).replace(/punctSpace/g,GF).replace(/punct/g,dD).getRegex(),KF=bt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,uD).replace(/punctSpace/g,Y_).replace(/punct/g,Of).getRegex(),QF=bt(/\\(punct)/,"gu").replace(/punct/g,Of).getRegex(),JF=bt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),e3=bt(W_).replace("(?:-->|$)","-->").getRegex(),t3=bt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",e3).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Rf=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,n3=bt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Rf).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),fD=bt(/^!?\[(label)\]\[(ref)\]/).replace("label",Rf).replace("ref",q_).getRegex(),mD=bt(/^!?\[(ref)\](?:\[\])?/).replace("ref",q_).getRegex(),i3=bt("reflink|nolink(?!\\()","g").replace("reflink",fD).replace("nolink",mD).getRegex(),eD=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Z_={_backpedal:$u,anyPunctuation:QF,autolink:JF,blockSkip:WF,br:cD,code:jF,del:$u,emStrongLDelim:$F,emStrongRDelimAst:ZF,emStrongRDelimUnd:KF,escape:zF,link:n3,nolink:mD,punctuation:HF,reflink:fD,reflinkSearch:i3,tag:t3,text:UF,url:$u},r3=Ve(ne({},Z_),{link:bt(/^!?\[(label)\]\((.*?)\)/).replace("label",Rf).getRegex(),reflink:bt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Rf).getRegex()}),B_=Ve(ne({},Z_),{emStrongRDelimAst:XF,emStrongLDelim:YF,url:bt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",eD).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:bt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",eD).getRegex()}),o3=Ve(ne({},B_),{br:bt(cD).replace("{2,}","*").getRegex(),text:bt(B_.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),Af={normal:$_,gfm:VF,pedantic:BF},Gu={normal:Z_,gfm:B_,breaks:o3,pedantic:r3},s3={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tD=i=>s3[i];function Zr(i,e){if(e){if(ti.escapeTest.test(i))return i.replace(ti.escapeReplace,tD)}else if(ti.escapeTestNoEncode.test(i))return i.replace(ti.escapeReplaceNoEncode,tD);return i}function nD(i){try{i=encodeURI(i).replace(ti.percentDecode,"%")}catch{return null}return i}function iD(i,e){let t=i.replace(ti.findPipe,(o,s,a)=>{let l=!1,c=s;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),n=t.split(ti.splitPipe),r=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(ti.slashPipe,"|");return n}function qu(i,e,t){let n=i.length;if(n===0)return"";let r=0;for(;r<n;){let o=i.charAt(n-r-1);if(o===e&&!t)r++;else if(o!==e&&t)r++;else break}return i.slice(0,n-r)}function a3(i,e){if(i.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<i.length;n++)if(i[n]==="\\")n++;else if(i[n]===e[0])t++;else if(i[n]===e[1]&&(t--,t<0))return n;return t>0?-2:-1}function rD(i,e,t,n,r){let o=e.href,s=e.title||null,a=i[1].replace(r.other.outputLinkReplace,"$1");n.state.inLink=!0;let l={type:i[0].charAt(0)==="!"?"image":"link",raw:t,href:o,title:s,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,l}function l3(i,e,t){let n=i.match(t.other.indentCodeCompensation);if(n===null)return e;let r=n[1];return e.split(`
`).map(o=>{let s=o.match(t.other.beginningSpace);if(s===null)return o;let[a]=s;return a.length>=r.length?o.slice(r.length):o}).join(`
`)}var Pf=class{options;rules;lexer;constructor(i){this.options=i||ca}space(i){let e=this.rules.block.newline.exec(i);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(i){let e=this.rules.block.code.exec(i);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:qu(t,`
`)}}}fences(i){let e=this.rules.block.fences.exec(i);if(e){let t=e[0],n=l3(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:n}}}heading(i){let e=this.rules.block.heading.exec(i);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let n=qu(t,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(t=n.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(i){let e=this.rules.block.hr.exec(i);if(e)return{type:"hr",raw:qu(e[0],`
`)}}blockquote(i){let e=this.rules.block.blockquote.exec(i);if(e){let t=qu(e[0],`
`).split(`
`),n="",r="",o=[];for(;t.length>0;){let s=!1,a=[],l;for(l=0;l<t.length;l++)if(this.rules.other.blockquoteStart.test(t[l]))a.push(t[l]),s=!0;else if(!s)a.push(t[l]);else break;t=t.slice(l);let c=a.join(`
`),u=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${c}`:c,r=r?`${r}
${u}`:u;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,o,!0),this.lexer.state.top=h,t.length===0)break;let d=o.at(-1);if(d?.type==="code")break;if(d?.type==="blockquote"){let p=d,g=p.raw+`
`+t.join(`
`),f=this.blockquote(g);o[o.length-1]=f,n=n.substring(0,n.length-p.raw.length)+f.raw,r=r.substring(0,r.length-p.text.length)+f.text;break}else if(d?.type==="list"){let p=d,g=p.raw+`
`+t.join(`
`),f=this.list(g);o[o.length-1]=f,n=n.substring(0,n.length-d.raw.length)+f.raw,r=r.substring(0,r.length-p.raw.length)+f.raw,t=g.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:o,text:r}}}list(i){let e=this.rules.block.list.exec(i);if(e){let t=e[1].trim(),n=t.length>1,r={type:"list",raw:"",ordered:n,start:n?+t.slice(0,-1):"",loose:!1,items:[]};t=n?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=n?t:"[*+-]");let o=this.rules.other.listItemRegex(t),s=!1;for(;i;){let l=!1,c="",u="";if(!(e=o.exec(i))||this.rules.block.hr.test(i))break;c=e[0],i=i.substring(c.length);let h=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,v=>" ".repeat(3*v.length)),d=i.split(`
`,1)[0],p=!h.trim(),g=0;if(this.options.pedantic?(g=2,u=h.trimStart()):p?g=e[1].length+1:(g=e[2].search(this.rules.other.nonSpaceChar),g=g>4?1:g,u=h.slice(g),g+=e[1].length),p&&this.rules.other.blankLine.test(d)&&(c+=d+`
`,i=i.substring(d.length+1),l=!0),!l){let v=this.rules.other.nextBulletRegex(g),y=this.rules.other.hrRegex(g),x=this.rules.other.fencesBeginRegex(g),_=this.rules.other.headingBeginRegex(g),S=this.rules.other.htmlBeginRegex(g);for(;i;){let M=i.split(`
`,1)[0],R;if(d=M,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),R=d):R=d.replace(this.rules.other.tabCharGlobal,"    "),x.test(d)||_.test(d)||S.test(d)||v.test(d)||y.test(d))break;if(R.search(this.rules.other.nonSpaceChar)>=g||!d.trim())u+=`
`+R.slice(g);else{if(p||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||x.test(h)||_.test(h)||y.test(h))break;u+=`
`+d}!p&&!d.trim()&&(p=!0),c+=M+`
`,i=i.substring(M.length+1),h=R.slice(g)}}r.loose||(s?r.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(s=!0));let f=null,m;this.options.gfm&&(f=this.rules.other.listIsTask.exec(u),f&&(m=f[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),r.items.push({type:"list_item",raw:c,task:!!f,checked:m,loose:!1,text:u,tokens:[]}),r.raw+=c}let a=r.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;r.raw=r.raw.trimEnd();for(let l=0;l<r.items.length;l++)if(this.lexer.state.top=!1,r.items[l].tokens=this.lexer.blockTokens(r.items[l].text,[]),!r.loose){let c=r.items[l].tokens.filter(h=>h.type==="space"),u=c.length>0&&c.some(h=>this.rules.other.anyLine.test(h.raw));r.loose=u}if(r.loose)for(let l=0;l<r.items.length;l++)r.items[l].loose=!0;return r}}html(i){let e=this.rules.block.html.exec(i);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(i){let e=this.rules.block.def.exec(i);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:n,title:r}}}table(i){let e=this.rules.block.table.exec(i);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=iD(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===n.length){for(let s of n)this.rules.other.tableAlignRight.test(s)?o.align.push("right"):this.rules.other.tableAlignCenter.test(s)?o.align.push("center"):this.rules.other.tableAlignLeft.test(s)?o.align.push("left"):o.align.push(null);for(let s=0;s<t.length;s++)o.header.push({text:t[s],tokens:this.lexer.inline(t[s]),header:!0,align:o.align[s]});for(let s of r)o.rows.push(iD(s,o.header.length).map((a,l)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:o.align[l]})));return o}}lheading(i){let e=this.rules.block.lheading.exec(i);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(i){let e=this.rules.block.paragraph.exec(i);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(i){let e=this.rules.block.text.exec(i);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(i){let e=this.rules.inline.escape.exec(i);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(i){let e=this.rules.inline.tag.exec(i);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(i){let e=this.rules.inline.link.exec(i);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let o=qu(t.slice(0,-1),"\\");if((t.length-o.length)%2===0)return}else{let o=a3(e[2],"()");if(o===-2)return;if(o>-1){let s=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,s).trim(),e[3]=""}}let n=e[2],r="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(n);o&&(n=o[1],r=o[3])}else r=e[3]?e[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?n=n.slice(1):n=n.slice(1,-1)),rD(e,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(i,e){let t;if((t=this.rules.inline.reflink.exec(i))||(t=this.rules.inline.nolink.exec(i))){let n=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),r=e[n.toLowerCase()];if(!r){let o=t[0].charAt(0);return{type:"text",raw:o,text:o}}return rD(t,r,t[0],this.lexer,this.rules)}}emStrong(i,e,t=""){let n=this.rules.inline.emStrongLDelim.exec(i);if(!(!n||n[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!t||this.rules.inline.punctuation.exec(t))){let r=[...n[0]].length-1,o,s,a=r,l=0,c=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,e=e.slice(-1*i.length+r);(n=c.exec(e))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(s=[...o].length,n[3]||n[4]){a+=s;continue}else if((n[5]||n[6])&&r%3&&!((r+s)%3)){l+=s;continue}if(a-=s,a>0)continue;s=Math.min(s,s+a+l);let u=[...n[0]][0].length,h=i.slice(0,r+n.index+u+s);if(Math.min(r,s)%2){let p=h.slice(1,-1);return{type:"em",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}let d=h.slice(2,-2);return{type:"strong",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(i){let e=this.rules.inline.code.exec(i);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(t),r=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return n&&r&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(i){let e=this.rules.inline.br.exec(i);if(e)return{type:"br",raw:e[0]}}del(i){let e=this.rules.inline.del.exec(i);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(i){let e=this.rules.inline.autolink.exec(i);if(e){let t,n;return e[2]==="@"?(t=e[1],n="mailto:"+t):(t=e[1],n=t),{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}url(i){let e;if(e=this.rules.inline.url.exec(i)){let t,n;if(e[2]==="@")t=e[0],n="mailto:"+t;else{let r;do r=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(r!==e[0]);t=e[0],e[1]==="www."?n="http://"+e[0]:n=e[0]}return{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(i){let e=this.rules.inline.text.exec(i);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},pr=class z_{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ca,this.options.tokenizer=this.options.tokenizer||new Pf,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:ti,block:Af.normal,inline:Gu.normal};this.options.pedantic?(t.block=Af.pedantic,t.inline=Gu.pedantic):this.options.gfm&&(t.block=Af.gfm,this.options.breaks?t.inline=Gu.breaks:t.inline=Gu.gfm),this.tokenizer.rules=t}static get rules(){return{block:Af,inline:Gu}}static lex(e,t){return new z_(t).lex(e)}static lexInline(e,t){return new z_(t).inlineTokens(e)}lex(e){e=e.replace(ti.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){for(this.options.pedantic&&(e=e.replace(ti.tabCharGlobal,"    ").replace(ti.spaceLine,""));e;){let r;if(this.options.extensions?.block?.some(s=>(r=s.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))continue;if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length);let s=t.at(-1);r.raw.length===1&&s!==void 0?s.raw+=`
`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length);let s=t.at(-1);s?.type==="paragraph"||s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+r.raw,s.text+=`
`+r.text,this.inlineQueue.at(-1).src=s.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length);let s=t.at(-1);s?.type==="paragraph"||s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+r.raw,s.text+=`
`+r.raw,this.inlineQueue.at(-1).src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title},t.push(r));continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}let o=e;if(this.options.extensions?.startBlock){let s=1/0,a=e.slice(1),l;this.options.extensions.startBlock.forEach(c=>{l=c.call({lexer:this},a),typeof l=="number"&&l>=0&&(s=Math.min(s,l))}),s<1/0&&s>=0&&(o=e.substring(0,s+1))}if(this.state.top&&(r=this.tokenizer.paragraph(o))){let s=t.at(-1);n&&s?.type==="paragraph"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):t.push(r),n=o.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length);let s=t.at(-1);s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):t.push(r);continue}if(e){let s="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(s);break}else throw new Error(s)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n=e,r=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(r=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)a.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(r=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,r.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(r=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let o=!1,s="";for(;e;){o||(s=""),o=!1;let a;if(this.options.extensions?.inline?.some(c=>(a=c.call({lexer:this},e,t))?(e=e.substring(a.raw.length),t.push(a),!0):!1))continue;if(a=this.tokenizer.escape(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.tag(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.link(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let c=t.at(-1);a.type==="text"&&c?.type==="text"?(c.raw+=a.raw,c.text+=a.text):t.push(a);continue}if(a=this.tokenizer.emStrong(e,n,s)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.codespan(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.br(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.del(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.autolink(e)){e=e.substring(a.raw.length),t.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),t.push(a);continue}let l=e;if(this.options.extensions?.startInline){let c=1/0,u=e.slice(1),h;this.options.extensions.startInline.forEach(d=>{h=d.call({lexer:this},u),typeof h=="number"&&h>=0&&(c=Math.min(c,h))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(a=this.tokenizer.inlineText(l)){e=e.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(s=a.raw.slice(-1)),o=!0;let c=t.at(-1);c?.type==="text"?(c.raw+=a.raw,c.text+=a.text):t.push(a);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}},Nf=class{options;parser;constructor(i){this.options=i||ca}space(i){return""}code({text:i,lang:e,escaped:t}){let n=(e||"").match(ti.notSpaceStart)?.[0],r=i.replace(ti.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Zr(n)+'">'+(t?r:Zr(r,!0))+`</code></pre>
`:"<pre><code>"+(t?r:Zr(r,!0))+`</code></pre>
`}blockquote({tokens:i}){return`<blockquote>
${this.parser.parse(i)}</blockquote>
`}html({text:i}){return i}def(i){return""}heading({tokens:i,depth:e}){return`<h${e}>${this.parser.parseInline(i)}</h${e}>
`}hr(i){return`<hr>
`}list(i){let e=i.ordered,t=i.start,n="";for(let s=0;s<i.items.length;s++){let a=i.items[s];n+=this.listitem(a)}let r=e?"ol":"ul",o=e&&t!==1?' start="'+t+'"':"";return"<"+r+o+`>
`+n+"</"+r+`>
`}listitem(i){let e="";if(i.task){let t=this.checkbox({checked:!!i.checked});i.loose?i.tokens[0]?.type==="paragraph"?(i.tokens[0].text=t+" "+i.tokens[0].text,i.tokens[0].tokens&&i.tokens[0].tokens.length>0&&i.tokens[0].tokens[0].type==="text"&&(i.tokens[0].tokens[0].text=t+" "+Zr(i.tokens[0].tokens[0].text),i.tokens[0].tokens[0].escaped=!0)):i.tokens.unshift({type:"text",raw:t+" ",text:t+" ",escaped:!0}):e+=t+" "}return e+=this.parser.parse(i.tokens,!!i.loose),`<li>${e}</li>
`}checkbox({checked:i}){return"<input "+(i?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:i}){return`<p>${this.parser.parseInline(i)}</p>
`}table(i){let e="",t="";for(let r=0;r<i.header.length;r++)t+=this.tablecell(i.header[r]);e+=this.tablerow({text:t});let n="";for(let r=0;r<i.rows.length;r++){let o=i.rows[r];t="";for(let s=0;s<o.length;s++)t+=this.tablecell(o[s]);n+=this.tablerow({text:t})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow({text:i}){return`<tr>
${i}</tr>
`}tablecell(i){let e=this.parser.parseInline(i.tokens),t=i.header?"th":"td";return(i.align?`<${t} align="${i.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:i}){return`<strong>${this.parser.parseInline(i)}</strong>`}em({tokens:i}){return`<em>${this.parser.parseInline(i)}</em>`}codespan({text:i}){return`<code>${Zr(i,!0)}</code>`}br(i){return"<br>"}del({tokens:i}){return`<del>${this.parser.parseInline(i)}</del>`}link({href:i,title:e,tokens:t}){let n=this.parser.parseInline(t),r=nD(i);if(r===null)return n;i=r;let o='<a href="'+i+'"';return e&&(o+=' title="'+Zr(e)+'"'),o+=">"+n+"</a>",o}image({href:i,title:e,text:t,tokens:n}){n&&(t=this.parser.parseInline(n,this.parser.textRenderer));let r=nD(i);if(r===null)return Zr(t);i=r;let o=`<img src="${i}" alt="${t}"`;return e&&(o+=` title="${Zr(e)}"`),o+=">",o}text(i){return"tokens"in i&&i.tokens?this.parser.parseInline(i.tokens):"escaped"in i&&i.escaped?i.text:Zr(i.text)}},X_=class{strong({text:i}){return i}em({text:i}){return i}codespan({text:i}){return i}del({text:i}){return i}html({text:i}){return i}text({text:i}){return i}link({text:i}){return""+i}image({text:i}){return""+i}br(){return""}},fr=class j_{options;renderer;textRenderer;constructor(e){this.options=e||ca,this.options.renderer=this.options.renderer||new Nf,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new X_}static parse(e,t){return new j_(t).parse(e)}static parseInline(e,t){return new j_(t).parseInline(e)}parse(e,t=!0){let n="";for(let r=0;r<e.length;r++){let o=e[r];if(this.options.extensions?.renderers?.[o.type]){let a=o,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){n+=l||"";continue}}let s=o;switch(s.type){case"space":{n+=this.renderer.space(s);continue}case"hr":{n+=this.renderer.hr(s);continue}case"heading":{n+=this.renderer.heading(s);continue}case"code":{n+=this.renderer.code(s);continue}case"table":{n+=this.renderer.table(s);continue}case"blockquote":{n+=this.renderer.blockquote(s);continue}case"list":{n+=this.renderer.list(s);continue}case"html":{n+=this.renderer.html(s);continue}case"def":{n+=this.renderer.def(s);continue}case"paragraph":{n+=this.renderer.paragraph(s);continue}case"text":{let a=s,l=this.renderer.text(a);for(;r+1<e.length&&e[r+1].type==="text";)a=e[++r],l+=`
`+this.renderer.text(a);t?n+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l,escaped:!0}]}):n+=l;continue}default:{let a='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(e,t=this.renderer){let n="";for(let r=0;r<e.length;r++){let o=e[r];if(this.options.extensions?.renderers?.[o.type]){let a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=a||"";continue}}let s=o;switch(s.type){case"escape":{n+=t.text(s);break}case"html":{n+=t.html(s);break}case"link":{n+=t.link(s);break}case"image":{n+=t.image(s);break}case"strong":{n+=t.strong(s);break}case"em":{n+=t.em(s);break}case"codespan":{n+=t.codespan(s);break}case"br":{n+=t.br(s);break}case"del":{n+=t.del(s);break}case"text":{n+=t.text(s);break}default:{let a='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}},Wu=class{options;block;constructor(i){this.options=i||ca}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(i){return i}postprocess(i){return i}processAllTokens(i){return i}emStrongMask(i){return i}provideLexer(){return this.block?pr.lex:pr.lexInline}provideParser(){return this.block?fr.parse:fr.parseInline}},c3=class{defaults=U_();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=fr;Renderer=Nf;TextRenderer=X_;Lexer=pr;Tokenizer=Pf;Hooks=Wu;constructor(...i){this.use(...i)}walkTokens(i,e){let t=[];for(let n of i)switch(t=t.concat(e.call(this,n)),n.type){case"table":{let r=n;for(let o of r.header)t=t.concat(this.walkTokens(o.tokens,e));for(let o of r.rows)for(let s of o)t=t.concat(this.walkTokens(s.tokens,e));break}case"list":{let r=n;t=t.concat(this.walkTokens(r.items,e));break}default:{let r=n;this.defaults.extensions?.childTokens?.[r.type]?this.defaults.extensions.childTokens[r.type].forEach(o=>{let s=r[o].flat(1/0);t=t.concat(this.walkTokens(s,e))}):r.tokens&&(t=t.concat(this.walkTokens(r.tokens,e)))}}return t}use(...i){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return i.forEach(t=>{let n=ne({},t);if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){let o=e.renderers[r.name];o?e.renderers[r.name]=function(...s){let a=r.renderer.apply(this,s);return a===!1&&(a=o.apply(this,s)),a}:e.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[r.level];o?o.unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),n.extensions=e),t.renderer){let r=this.defaults.renderer||new Nf(this.defaults);for(let o in t.renderer){if(!(o in r))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let s=o,a=t.renderer[s],l=r[s];r[s]=(...c)=>{let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u||""}}n.renderer=r}if(t.tokenizer){let r=this.defaults.tokenizer||new Pf(this.defaults);for(let o in t.tokenizer){if(!(o in r))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let s=o,a=t.tokenizer[s],l=r[s];r[s]=(...c)=>{let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u}}n.tokenizer=r}if(t.hooks){let r=this.defaults.hooks||new Wu;for(let o in t.hooks){if(!(o in r))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let s=o,a=t.hooks[s],l=r[s];Wu.passThroughHooks.has(o)?r[s]=c=>{if(this.defaults.async&&Wu.passThroughHooksRespectAsync.has(o))return _e(this,null,function*(){let h=yield a.call(r,c);return l.call(r,h)});let u=a.call(r,c);return l.call(r,u)}:r[s]=(...c)=>{if(this.defaults.async)return _e(this,null,function*(){let h=yield a.apply(r,c);return h===!1&&(h=yield l.apply(r,c)),h});let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u}}n.hooks=r}if(t.walkTokens){let r=this.defaults.walkTokens,o=t.walkTokens;n.walkTokens=function(s){let a=[];return a.push(o.call(this,s)),r&&(a=a.concat(r.call(this,s))),a}}this.defaults=ne(ne({},this.defaults),n)}),this}setOptions(i){return this.defaults=ne(ne({},this.defaults),i),this}lexer(i,e){return pr.lex(i,e??this.defaults)}parser(i,e){return fr.parse(i,e??this.defaults)}parseMarkdown(i){return(e,t)=>{let n=ne({},t),r=ne(ne({},this.defaults),n),o=this.onError(!!r.silent,!!r.async);if(this.defaults.async===!0&&n.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(r.hooks&&(r.hooks.options=r,r.hooks.block=i),r.async)return _e(this,null,function*(){let s=r.hooks?yield r.hooks.preprocess(e):e,a=yield(r.hooks?yield r.hooks.provideLexer():i?pr.lex:pr.lexInline)(s,r),l=r.hooks?yield r.hooks.processAllTokens(a):a;r.walkTokens&&(yield Promise.all(this.walkTokens(l,r.walkTokens)));let c=yield(r.hooks?yield r.hooks.provideParser():i?fr.parse:fr.parseInline)(l,r);return r.hooks?yield r.hooks.postprocess(c):c}).catch(o);try{r.hooks&&(e=r.hooks.preprocess(e));let s=(r.hooks?r.hooks.provideLexer():i?pr.lex:pr.lexInline)(e,r);r.hooks&&(s=r.hooks.processAllTokens(s)),r.walkTokens&&this.walkTokens(s,r.walkTokens);let a=(r.hooks?r.hooks.provideParser():i?fr.parse:fr.parseInline)(s,r);return r.hooks&&(a=r.hooks.postprocess(a)),a}catch(s){return o(s)}}}onError(i,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,i){let n="<p>An error occurred:</p><pre>"+Zr(t.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(t);throw t}}},la=new c3;function Dt(i,e){return la.parse(i,e)}Dt.options=Dt.setOptions=function(i){return la.setOptions(i),Dt.defaults=la.defaults,oD(Dt.defaults),Dt};Dt.getDefaults=U_;Dt.defaults=ca;Dt.use=function(...i){return la.use(...i),Dt.defaults=la.defaults,oD(Dt.defaults),Dt};Dt.walkTokens=function(i,e){return la.walkTokens(i,e)};Dt.parseInline=la.parseInline;Dt.Parser=fr;Dt.parser=fr.parse;Dt.Renderer=Nf;Dt.TextRenderer=X_;Dt.Lexer=pr;Dt.lexer=pr.lex;Dt.Tokenizer=Pf;Dt.Hooks=Wu;Dt.parse=Dt;var Mre=Dt.options,Dre=Dt.setOptions,Ire=Dt.use,Tre=Dt.walkTokens,Are=Dt.parseInline;var Rre=fr.parse,Pre=pr.lex;var Lf=class i{transform(e){if(!e)return"";let t=Dt.parse(e),n=r=>r&&r.replace(/<p(\s[^>]*)?>/,(o,s)=>(s?/style\s*=/.test(s):!1)?o.replace(/style\s*=\s*"(.*?)"/i,(l,c)=>`style="display:inline; ${c}"`):`<p${s||""} style="display:inline;">`);return t&&typeof t.then=="function"?t.then(r=>n(r)):n(t)}static \u0275fac=function(t){return new(t||i)};static \u0275pipe=ar({name:"markdown",type:i,pure:!0})};var Ff=class i{constructor(e){this.characterSheetService=e;this.loadFromStorage()}static STORAGE_KEY="speakerColorMap.v1";colorMap={};narratorColor="#b47ce9ff";playerColor="#d0d0d5";getColorForSpeaker(e){let t=(e||"").trim();if(!t)return this.defaultColor();let n=t.toLowerCase();if(n==="narrator")return this.narratorColor;let r=(this.characterSheetService.getCharacterName()||"").trim();if(r&&n===r.toLowerCase())return this.playerColor;let o=this.colorMap[n];if(o)return o;let s=this.generatePleasantColor();return console.log(`Assigned color ${s} to speaker "${t}"`),this.colorMap[n]=s,this.saveToStorage(),s}generatePleasantColor(){let e=Math.floor(Math.random()*360),t=60+Math.floor(Math.random()*20),n=60+Math.floor(Math.random()*15);return this.hslToHex(e,t,n)}hslToHex(e,t,n){t/=100,n/=100;let r=l=>(l+e/30)%12,o=t*Math.min(n,1-n),s=l=>n-o*Math.max(-1,Math.min(r(l)-3,Math.min(9-r(l),1))),a=l=>Math.round(255*l).toString(16).padStart(2,"0");return`#${a(s(0))}${a(s(8))}${a(s(4))}`}defaultColor(){return"#b8e977ff"}loadFromStorage(){try{let e=localStorage.getItem(i.STORAGE_KEY);if(e){let t=JSON.parse(e);t&&typeof t=="object"&&(this.colorMap=t)}}catch{this.colorMap={}}}saveToStorage(){try{localStorage.setItem(i.STORAGE_KEY,JSON.stringify(this.colorMap))}catch{}}static \u0275fac=function(t){return new(t||i)(Ce(Wt))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var vs=class i{constructor(e,t){this.sanitizer=e;this.speakerColor=t}mdPipe=new Lf;escapeHtml(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}transformSimulation(e){let t=null;e.dialogue?t=this.mdPipe.transform(e.dialogue||""):t=this.mdPipe.transform("");let r=`<span class="speaker-name" style="color: ${this.speakerColor.getColorForSpeaker(e.name)}; font-weight: bold">${this.escapeHtml(e.name||"")}</span> \u2014 `;return this.sanitizer.bypassSecurityTrustHtml(r+t)}transformAny(e){if(!e)return this.sanitizer.bypassSecurityTrustHtml("");try{let t=this.mdPipe.transform(e);return this.sanitizer.bypassSecurityTrustHtml(t)}catch{return this.sanitizer.bypassSecurityTrustHtml("")}}transform(e,...t){return typeof e=="object"&&(YM in e||$M in e)?this.transformSimulation(e):this.transformAny(e)}static \u0275fac=function(t){return new(t||i)(se(Hy,16),se(Ff,16))};static \u0275pipe=ar({name:"messageHtml",type:i,pure:!0})};var Zu=class i{transform(e){if(!e)return"";let{isRequired:t,checkType:n}=_f(e);return t?`[${n}] ${GM(e)}`:e}static \u0275fac=function(t){return new(t||i)};static \u0275pipe=ar({name:"formatSuggestion",type:i,pure:!0})};var Ol=class i{src;closed=new xt;internalSrc=null;ngOnChanges(e){e.src&&(this.internalSrc=null,setTimeout(()=>{this.internalSrc=this.src},0))}onBackdropClick(){this.closed.emit()}onWindowKeydown(e){e.key==="Escape"&&this.closed.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-image-modal"]],hostBindings:function(t,n){t&1&&Y("keydown",function(o){return n.onWindowKeydown(o)},Zs)},inputs:{src:"src"},outputs:{closed:"closed"},features:[po],decls:2,vars:2,consts:[["role","dialog","aria-modal","true",1,"modal-backdrop",3,"mousedown"],["alt","image",1,"modal-image",3,"src"]],template:function(t,n){t&1&&(Zt(0,"div",0),ul("mousedown",function(){return n.onBackdropClick()}),Lr(1,"img",1),jt()),t&2&&(P(),Fr("src",n.internalSrc||void 0,xi),Jn("decoding","async"))},dependencies:[ke],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000d1;display:flex;align-items:center;justify-content:center;z-index:10}.modal-image[_ngcontent-%COMP%]{object-fit:contain;width:auto;height:auto;max-width:100%;max-height:100%;border-radius:6px;display:block;background:transparent;color:transparent;background-color:transparent;z-index:10;transition:opacity .16s ease;visibility:visible}@media (aspect-ratio > 1/1){.modal-image[_ngcontent-%COMP%]{width:65%;height:auto}}@media (aspect-ratio < 1/1){.modal-image[_ngcontent-%COMP%]{width:auto;height:65%}}"]})};var fi=class i{cursorTypeSubject=new st("normal");cursorType$=this.cursorTypeSubject.asObservable();cursorPosSubjectTvScreen=new st({x:0,y:0});cursorPosSubjectGlobal=new st({x:0,y:0});cursorPositionTvScreen$=this.cursorPosSubjectTvScreen.asObservable();cursorPositionGlobal$=this.cursorPosSubjectGlobal.asObservable();cursorImage$=this.cursorType$.pipe(ze(e=>{switch(e){case"hover_suggestion":return"cursors/hover_suggestion_64.png";case"loading":return"cursors/loading_hand_64.gif";case"normal":default:return"cursors/normal_64.png"}}));setCursor(e){this.cursorTypeSubject.next(e)}setNormal(){this.setCursor("normal")}setLoading(){this.setCursor("loading")}setHoverSuggestion(){this.setCursor("hover_suggestion")}setGlobalPosition(e,t){let n=this.cursorPosSubjectGlobal.value;n.x===e&&n.y===t||this.cursorPosSubjectGlobal.next({x:e,y:t})}setInsideTvScreenPosition(e,t){let n=this.cursorPosSubjectTvScreen.value;n.x===e&&n.y===t||this.cursorPosSubjectTvScreen.next({x:e,y:t})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var d3=["preview"];function h3(i,e){if(i&1&&(Zt(0,"div",2,0),Lr(2,"div",3),sn(3,"messageHtml"),jt()),i&2){let t=ie();gt("transform",t.transform()),P(2),Fr("innerHTML",Hn(3,3,t.content),Ys)}}var Fl=class i{constructor(e,t){this.cursorService=e;this.hostEl=t}content="";show=!1;offsetX=32;offsetY=32;previewRef;cursorX=at(0);cursorY=at(0);sub;screenRect;resizeListener=()=>this.captureScreenRect();ngOnInit(){this.sub=this.cursorService.cursorPositionTvScreen$.subscribe(e=>{this.cursorX.set(e.x),this.cursorY.set(e.y)}),this.captureScreenRect(),window.addEventListener("resize",this.resizeListener)}ngAfterViewInit(){this.captureScreenRect()}ngOnDestroy(){this.sub?.unsubscribe?.(),window.removeEventListener("resize",this.resizeListener)}captureScreenRect(){let e=document.getElementById("crtScreenDiv"),t=document.querySelector(".crt-curved-screen"),n=e??t??void 0;n&&(this.screenRect=n.getBoundingClientRect())}transform(){if(!this.show)return"translate(-9999px,-9999px)";let e=this.cursorX(),t=this.cursorY();return e+=this.offsetX,t+=this.offsetY,`translate(${e}px, ${t}px)`}static \u0275fac=function(t){return new(t||i)(se(fi),se(Fn))};static \u0275cmp=Pe({type:i,selectors:[["app-hover-preview"]],viewQuery:function(t,n){if(t&1&&At(d3,5),t&2){let r;Rt(r=Pt())&&(n.previewRef=r.first)}},inputs:{content:"content",show:"show",offsetX:"offsetX",offsetY:"offsetY"},decls:1,vars:1,consts:[["preview",""],[1,"hover-preview",3,"transform"],[1,"hover-preview"],[1,"hover-preview-inner",3,"innerHTML"]],template:function(t,n){t&1&&li(0,h3,4,5,"div",1),t&2&&ci(n.show&&n.content?0:-1)},dependencies:[ke,vs],styles:["[_nghost-%COMP%]{display:contents;pointer-events:none}.hover-preview[_ngcontent-%COMP%]{font-size:.8rem;position:fixed;left:0;top:0;z-index:9999;pointer-events:none;will-change:transform;transform:translate(0);opacity:1!important}.hover-preview-inner[_ngcontent-%COMP%]{display:block;padding:8px 10px;border:1.5px solid #888;border-radius:6px;background:#202020;color:#f2f2f2;box-shadow:0 6px 14px #00000059;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);max-width:340px;max-height:50vh;overflow:hidden;word-wrap:break-word;opacity:1!important}.hover-preview-inner[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;display:block}"]})};var Vf=class i{simulation;showDetails=!1;show(){this.showDetails=!0}hide(){this.showDetails=!1}chipHoverContent(){let e=[];return this.simulation?.action_name&&e.push(`### ${this.simulation.action_name}`),this.simulation?.target&&e.push(`**Target:** ${this.simulation.target}`),this.simulation?.expressions&&e.push(`**Expressions:** ${JSON.stringify(this.simulation.expressions,null,2)}`),this.simulation?.scratch_pad&&e.push(`**Scratch Pad:** ${this.simulation.scratch_pad}`),this.simulation?.result!==void 0&&this.simulation?.result!==null&&e.push(`**Result:** ${JSON.stringify(this.simulation.result,null,2)}`),e.join(`

`)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-action-chip"]],inputs:{simulation:"simulation"},decls:4,vars:4,consts:[[1,"action-chip-wrapper",3,"mouseenter","mouseleave"],["tabindex","0",1,"action-chip",3,"focus","blur"],[3,"show","content"]],template:function(t,n){t&1&&(C(0,"div",0),Y("mouseenter",function(){return n.show()})("mouseleave",function(){return n.hide()}),C(1,"div",1),Y("focus",function(){return n.show()})("blur",function(){return n.hide()}),A(2),E(),Te(3,"app-hover-preview",2),E()),t&2&&(P(),Jn("aria-expanded",n.showDetails),P(),rt(" ",n.simulation.action_name," "),P(),ae("show",n.showDetails)("content",n.chipHoverContent()))},dependencies:[ke,Fl],styles:["[_nghost-%COMP%]{display:inline-block}.action-chip-wrapper[_ngcontent-%COMP%]{position:relative}.action-chip[_ngcontent-%COMP%]{display:inline-block;font-size:.75rem;line-height:1;padding:.25rem .5rem;border:1px solid #555;border-radius:999px;background:#111;color:#eeeeee98;-webkit-user-select:none;user-select:none;outline:none}.action-chip[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 2px #ffffff26}"]})};var Wi=class i{constructor(e,t,n){this.dmService=e;this.characterSheetService=t;this.cursorService=n}sessionId=null;campaignName=null;currentLocation="Unknown";currentCampaignTime="Unknown";currentJournalEntries=[];currentJournalEntries$=new st([]);hasNewUpdatesToJournal=!1;isInCombat$=new st(!1);combatTurnNumber$=new st(null);sceneEntities$=new st([]);combatantList=new st([]);combinedEntities$=new st([]);initialHistorySubject=new st([]);initialHistory$=this.initialHistorySubject.asObservable();userSequencesSubject=new Tt;userSequences$=this.userSequencesSubject.asObservable();dmSequencesSubject=new Tt;dmSequences$=this.dmSequencesSubject.asObservable();suggestionsSubject=new st([]);suggestions$=this.suggestionsSubject.asObservable();seedInitialChatHistory(e,t=[]){this.initialHistorySubject.next(e||[]),this.suggestionsSubject.next(t||[])}setCampaignName(e){this.campaignName=e}setSessionId(e){this.sessionId=e}sendMessage(e){return _e(this,null,function*(){if(!this.sessionId)throw new Error("Session ID is not set.");let t={};this.characterSheetService.hasNewUpdates&&(t.character_sheet_list=[this.characterSheetService.getCharacterSheet()]),this.hasNewUpdatesToJournal&&(t.journal_entries=this.currentJournalEntries,this.hasNewUpdatesToJournal=!1);let n=yield this.dmService.sendMessage(e,this.sessionId,t);return yield this.handleGeneralWorldUpdate(n),n})}getSessionStateFromDbAndSync(e){return _e(this,null,function*(){let t=yield this.dmService.getSessionStateFromDb(e);return this.handleGeneralWorldUpdate(t),t})}handleGeneralWorldUpdate(e){return _e(this,null,function*(){Array.isArray(e)||(console.log(e),e=[e]),yield this.characterSheetService.updateCharacterFromManyResponses(e);let t={sessionId:this.sessionId,characterName:this.characterSheetService.getCharacterName()||"Unknown",characterLevel:this.characterSheetService.getCharacterLevel()||1,currentLocation:this.currentLocation,currentCampaignTime:this.currentCampaignTime};for(let n of e){let r=ne(ne({},n?.state),n?.actions?.stateDelta);t=this.updateFromStateOrDelta(r,t)}this.sessionId&&this.dmService.upsertSavedSession(t)})}updateFromStateOrDelta(e,t){if(console.log("\u{1F504} Updating session state from state/delta:",e),e?.[T_]&&(this.currentCampaignTime=e?.[T_],t.currentCampaignTime=this.currentCampaignTime,console.log("\u{1F570}\uFE0F Updating campaign time to:",this.currentCampaignTime)),e?.[I_]&&(this.currentLocation=e?.[I_],t.currentLocation=this.currentLocation,console.log("\u{1F4CD} Updating current location to:",this.currentLocation)),e?.[xf]||(this.combatTurnNumber$.next(0),this.isInCombat$.next(!1)),typeof e?.[xf]=="boolean"&&(this.isInCombat$.next(!!e?.[xf]),console.log("\u2694\uFE0F Combat state changed")),e?.[Sf]!==void 0&&e?.[Sf]!==null){let n=Number(e?.[Sf]);Number.isNaN(n)||this.combatTurnNumber$.next(n)}return e?.[A_]&&(this.currentJournalEntries=e?.[A_],this.currentJournalEntries$.next([...this.currentJournalEntries||[]]),console.log("\u{1F4D3} Updating journal entries:",this.currentJournalEntries)),this.sceneEntities$.next(e?.[ZM]),this.combatantList.next(e?.[XM]),this.recomputeCombinedEntities(e),t}recomputeCombinedEntities(e){let t=this.sceneEntities$.getValue(),n=this.combatantList.getValue();if(!t||!n||n.length===1){this.combinedEntities$.next([]);return}let r=[];for(let o of n){let s=t.find(u=>u.name===o);if(!s||s.initiative_mod===void 0)continue;let a=null,l=e?.initiative_list?.find(u=>u.name===o)?.result;l===void 0?a=-1:a=l;let c={name:s.name,stat_type:s.stat_type,hp:s.hp,max_hp:s.max_hp,ac:s.ac,initiative_mod:s.initiative_mod,result:a};r.push(c)}console.log(`\u{1F977} combinedEntities:  ${r}`),this.combinedEntities$.next(r)}destroy(){this.isInCombat$.complete(),this.combatTurnNumber$.complete(),this.sceneEntities$.complete(),this.combatantList.complete()}sendSimulationSequencesToDmAndHandleResponseInChatPane(e){return _e(this,null,function*(){this.userSequencesSubject.next(e),this.cursorService.setLoading();try{this.characterSheetService.isInitialized||console.warn("Character sheet is not initialized.");let t=yield this.sendMessage(e);for(let n of t){let{simulationSequences:r,suggestions:o}=this.dmService.parseSimulationSequencesAndSuggestionsFromResponse(n);r&&r.length&&this.dmSequencesSubject.next(r),o&&o.length&&this.suggestionsSubject.next(o)}}finally{this.cursorService.setNormal()}})}static \u0275fac=function(t){return new(t||i)(Ce($r),Ce(Wt),Ce(fi))};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var qn=class i{requestId=0;requestSubject=new Tt;eventSubject=new Tt;sendRequest(e,t){let n=this.requestId++;return new Promise(r=>{this.requestSubject.next({request:{id:n,type:e,payload:t},respond:r})})}getRequests(){return this.requestSubject.asObservable()}publish(e,t){this.eventSubject.next({type:e,payload:t})}on(e){return this.eventSubject.asObservable().pipe(zn(t=>t.type===e),ze(t=>t.payload))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var p3=["messagesContainer"],f3=(i,e)=>({"new-message":i,"old-message":e}),gD=(i,e)=>({"selected-suggestion":i,"dim-suggestion":e});function m3(i,e){if(i&1&&Te(0,"app-action-chip",18),i&2){let t=ie().$implicit;ae("simulation",t)}}function g3(i,e){i&1&&Te(0,"img",19)}function v3(i,e){if(i&1){let t=Qe();C(0,"div",14)(1,"div",15),sn(2,"messageHtml"),Y("click",function(r){ve(t);let o=ie();return ye(o.onMarkdownClick(r))}),E(),nt(3,m3,1,1,"app-action-chip",16)(4,g3,1,0,"img",17),E()}if(i&2){let t=e.$implicit,n=e.last,r=ie();ae("ngClass",Qc(6,f3,n,!n)),P(),ae("innerHTML",Hn(2,4,t),Ys),P(2),ae("ngIf",t.action_name),P(),ae("ngIf",r.showContinueIcon&&n)}}function y3(i,e){i&1&&(C(0,"div",20)(1,"span"),Te(2,"img",21),E()())}function _3(i,e){if(i&1){let t=Qe();C(0,"div",26),Y("click",function(){ve(t);let r=ie(),o=r.$implicit,s=r.index,a=ie(2);return ye(a.clickSuggestion(o,s))})("mouseenter",function(){ve(t);let r=ie(3);return ye(r.onSuggestionHover(!0))})("mouseleave",function(){ve(t);let r=ie(3);return ye(r.onSuggestionHover(!1))}),A(1),sn(2,"formatSuggestion"),E()}if(i&2){let t=ie(),n=t.$implicit,r=t.index,o=ie(2);ae("ngClass",Qc(4,gD,o.selectedSuggestionIndex===r,o.selectedSuggestionIndex!==null&&o.selectedSuggestionIndex!==r)),P(),rt(" ",r+1+". "+Hn(2,2,n)," ")}}function b3(i,e){if(i&1&&(C(0,"div",27),A(1),sn(2,"formatSuggestion"),E()),i&2){let t=ie(),n=t.$implicit,r=t.index,o=ie(2);ae("ngClass",Qc(4,gD,o.selectedSuggestionIndex===r,o.selectedSuggestionIndex!==null&&o.selectedSuggestionIndex!==r)),P(),rt(" ",r+1+". "+Hn(2,2,n)," ")}}function w3(i,e){if(i&1&&(Ci(0),nt(1,_3,3,7,"div",25)(2,b3,3,7,"ng-template",null,2,wo),Ei()),i&2){let t=e.index,n=cr(3),r=ie(2);P(),ae("ngIf",!(r.selectedSuggestionIndex!==null&&r.selectedSuggestionIndex!==t))("ngIfElse",n)}}function x3(i,e){if(i&1&&(C(0,"div",22)(1,"div",23),nt(2,w3,4,2,"ng-container",24),E()()),i&2){let t=ie();P(2),ae("ngForOf",t.latestSuggestions)}}function S3(i,e){if(i&1){let t=Qe();C(0,"app-image-modal",28),Y("closed",function(){ve(t);let r=ie();return ye(r.closeImageModal())}),E()}if(i&2){let t=ie();ae("src",t.modalUrl)}}function C3(i){return new Promise(e=>setTimeout(e,i))}var Xu=class i{constructor(e,t,n,r,o,s,a,l){this.sessionManager=e;this.mediator=t;this.soundService=n;this.speechService=r;this.cursorService=o;this.characterSheetService=s;this.ngZone=a;this.cdr=l}messagesContainer;allSimulations=[];latestSuggestions=[];_TIME_BEFORE_SCROLL_MS=200;_SCROLL_SOUND_MIN_INTERVAL=200;scrollSoundLastPlayed=0;draft="";isLoading=!1;waitingSuggestion="";pendingMessages=[];modalUrl=null;showContinueIcon=!1;selectedSuggestionIndex=null;lastTypeSoundAt=0;TYPE_SOUND_INTERVAL_MS=50;_subs=[];clearHistory(){this.allSimulations=[],this.pendingMessages=[]}ngAfterViewInit(){this.scheduleScroll();let e=this.sessionManager.initialHistory$.subscribe(s=>{this.allSimulations=[...s||[]],this.pendingMessages=[],this.scheduleScroll()});this._subs.push(e);let t=this.sessionManager.userSequences$.subscribe(s=>{if(s){this.latestSuggestions=[];for(let a of s)this.soundService.playSendMessageSound(),this.pushBubbleAndSpeak(a)}});this._subs.push(t);let n=this.sessionManager.dmSequences$.subscribe(s=>{if(s){for(let a of s)this.pendingMessages.push(a);this.showContinueIcon||this.processPendingMessages(),this.showContinueIcon=this.pendingMessages.length>0,this.isLoading=!1}});this._subs.push(n);let r=this.sessionManager.suggestions$.subscribe(s=>{this.latestSuggestions=Array.isArray(s)?[...s]:[],this.showContinueIcon=this.pendingMessages.length>0,this.isLoading=!1,this.scheduleScroll()});this._subs.push(r);let o=this.mediator.getRequests().subscribe(({request:s,respond:a})=>{s.type==="chat.getDraft"&&a({draft:this.draft}),s.type==="chat.clearDraft"&&(this.draft="",a({ok:!0}))});this._subs.push(o),setTimeout(()=>{let a=this.messagesContainer?.nativeElement?.querySelector(".custom-scrollbar-content");a&&a.addEventListener("scroll",()=>this.onMessagesScroll())},100)}ngOnDestroy(){for(let e of this._subs.splice(0))try{e.unsubscribe()}catch{}}scrollToBottom(){try{let e=this.messagesContainer?.nativeElement,n=e?.querySelector(".custom-scrollbar-content")||e;if(n)try{typeof n.scrollTo=="function"?n.scrollTo({top:n.scrollHeight,behavior:"smooth"}):n.scrollTop=n.scrollHeight}catch{n.scrollTop=n.scrollHeight}}catch{}}scheduleScroll(){setTimeout(()=>this.scrollToBottom(),this._TIME_BEFORE_SCROLL_MS)}pushBubbleAndSpeak(e){this.allSimulations.push(e),this.scheduleScroll(),this.characterSheetService.getCharacterName()!==e.name&&this.speechService.speakMessage(e)}processPendingMessages(){if(this.pendingMessages.length===0)return;let e=this.pendingMessages.shift();e&&(this.pushBubbleAndSpeak(e),this.showContinueIcon=this.pendingMessages.length>0)}acknowledgeContinuePrompt(){this.processPendingMessages()}onMessagesClick(e){this.acknowledgeContinuePrompt()}closeImageModal(){this.modalUrl=null}onMarkdownClick(e){return _e(this,null,function*(){let t=e.target;if(!t)return;let n=(s,a)=>{let l=s instanceof Element?s:s.parentElement??null;return l?l.closest(a):null},r=n(t,"img"),o=!!n(t,".dialogue-markdown");r&&o&&r.src&&(this.modalUrl=r.src)})}handleDocumentKeydown(e){e.key==="Enter"&&!e.shiftKey&&this.pendingMessages.length>0&&(e.preventDefault(),this.acknowledgeContinuePrompt())}sendFromChatBox(e){return _e(this,null,function*(){if(!e||e.trim().length===0)return;let t={name:this.characterSheetService.getCharacterName(),dialogue:e};yield this.sendSimulationSequencesToSessionManager([t])})}sendSimulationSequencesToSessionManager(e){return _e(this,null,function*(){this.draft="",requestAnimationFrame(()=>{this.latestSuggestions=[],this.cursorService.setLoading()}),this.selectedSuggestionIndex=null,this.isLoading=!0,this.sessionManager.sendSimulationSequencesToDmAndHandleResponseInChatPane(e)})}clickSuggestion(e,t){return _e(this,null,function*(){this.soundService.playClickSuggestionSound(),this.selectedSuggestionIndex=t;let n=this.latestSuggestions[t];if(!n){console.warn("Suggestion text not found for index",t);return}let{isRequired:r,checkType:o,dc:s}=_f(n);if(yield C3(1200),!r){yield this.sendSimulationSequencesToSessionManager([{name:this.characterSheetService.getCharacterName(),dialogue:e}]);return}let l=yield this.mediator.sendRequest("diceTray.rollDice",{expression:"1d20",checkType:o,dc:s});if(o!=null&&l?.rawResult!=null){let c=l.mod??0,u=l.rawResult+c,h=s!=null?u>=s?"Success":"Failure":"",d=h?`${h}`:"",p="";s?p=`Rolled ${l.rawResult} + ${c} = ${u} VS ${s} (${d})`:p=`Rolled ${l.rawResult} + ${c} = ${u}`;let g={name:this.characterSheetService.getCharacterName(),dialogue:Zu.prototype.transform(n),action_name:o,expressions:`${l.expression} + ${c}`,result:u};yield this.sendSimulationSequencesToSessionManager([g]);return}yield this.sendSimulationSequencesToSessionManager([{name:this.characterSheetService.getCharacterName(),dialogue:e}])})}onKeydown(e){if(this.pendingMessages.length>0&&e.key==="Enter"&&!e.shiftKey){e.preventDefault();return}let t=Date.now(),n=e.key.length===1,r=["Backspace","Delete","Spacebar"," "].includes(e.key);(n||r)&&t-this.lastTypeSoundAt>=this.TYPE_SOUND_INTERVAL_MS&&(this.soundService.playTypeSound(),this.lastTypeSoundAt=t),e.key==="Enter"&&!e.shiftKey&&(this.soundService.playClickSuggestionSound(),e.preventDefault(),this.sendFromChatBox(this.draft)),e.key==="-"&&e.altKey&&(this.pushBubbleAndSpeak({name:"Narrator",dialogue:"The Golem attacks you with a slam! you take _7 damage_"}),this.latestSuggestions=[],this.latestSuggestions.push("[ACROBATICS: 15] Jump on the golem"),this.latestSuggestions.push("[INVESTIGATION: 15] Look for the weak point in the golem's armor"),this.latestSuggestions.push("[ARCANA: 15] Analyze the magical aura")),e.key==="="&&e.altKey&&this.pushBubbleAndSpeak({name:"Debug",dialogue:"Debug image ![image](https://5e.tools/img/adventure/WBtW/015-map-1.1.webp)"}),e.key==="6"&&e.altKey&&(this.pushBubbleAndSpeak({name:"Debug",dialogue:"roll please"}),this.latestSuggestions||(this.latestSuggestions=[]),this.latestSuggestions.push("quick! [WIS SAVE: 15]"),this.latestSuggestions.push("quick! [DEXTERITY SAVE: 15]"),this.latestSuggestions.push("click click! [THIEVES' TOOLS: 15]"))}onMessagesScroll(){let e=Date.now();e-this.scrollSoundLastPlayed>this._SCROLL_SOUND_MIN_INTERVAL&&(this.soundService.playScrollSound(),this.scrollSoundLastPlayed=e)}onSuggestionHover(e){let t=e?"hover_suggestion":"normal";this.cursorService.setCursor(t)}static \u0275fac=function(t){return new(t||i)(se(Wi),se(qn),se(Dn),se(kl),se(fi),se(Wt),se(zt),se(ls))};static \u0275cmp=Pe({type:i,selectors:[["app-chat-component"]],viewQuery:function(t,n){if(t&1&&At(p3,5),t&2){let r;Rt(r=Pt())&&(n.messagesContainer=r.first)}},hostBindings:function(t,n){t&1&&Y("keydown",function(o){return n.handleDocumentKeydown(o)},Si)},decls:14,vars:8,consts:[["messagesContainer",""],["bottomSentinel",""],["dimSuggestionNoSound",""],["aria-live","off","customScrollbar","",1,"messages",3,"click"],["class","message",3,"ngClass",4,"ngFor","ngForOf"],["class","message loading",4,"ngIf"],[2,"height","1px"],["aria-live","off","class","suggestions",4,"ngIf"],[3,"src","closed",4,"ngIf"],[1,"input-message-bar"],["spellcheck","false","rows","1","placeholder","Type a message...",3,"ngModelChange","keydown","ngModel"],["clickableDivWithSound","",1,"menu-btn","send-button",3,"click","disabled"],["src","assets/ui/send_button_bg.webp","alt","",1,"image-icon"],[1,"send-button-label"],[1,"message",3,"ngClass"],[1,"dialogue-markdown",3,"click","innerHTML"],["style","margin-left: 2rem;",3,"simulation",4,"ngIf"],["src","next_message.webp","alt","Continue to next message","class","continue-indicator",4,"ngIf"],[2,"margin-left","2rem",3,"simulation"],["src","next_message.webp","alt","Continue to next message",1,"continue-indicator"],[1,"message","loading"],["src","busy.gif"],["aria-live","off",1,"suggestions"],[1,"suggestion-list"],[4,"ngFor","ngForOf"],["class","suggestion","clickableDivWithSound","",3,"ngClass","click","mouseenter","mouseleave",4,"ngIf","ngIfElse"],["clickableDivWithSound","",1,"suggestion",3,"click","mouseenter","mouseleave","ngClass"],[1,"suggestion",3,"ngClass"],[3,"closed","src"]],template:function(t,n){if(t&1){let r=Qe();C(0,"div",3,0),Y("click",function(s){return ve(r),ye(n.onMessagesClick(s))}),nt(2,v3,5,9,"div",4)(3,y3,3,0,"div",5),Te(4,"div",6,1),nt(6,x3,3,1,"div",7),E(),nt(7,S3,1,1,"app-image-modal",8),C(8,"div",9)(9,"textarea",10),dn("ngModelChange",function(s){return ve(r),vn(n.draft,s)||(n.draft=s),ye(s)}),Y("keydown",function(s){return ve(r),ye(n.onKeydown(s))}),E(),C(10,"button",11),Y("click",function(){return ve(r),ye(n.sendFromChatBox(n.draft))}),Te(11,"img",12),C(12,"span",13),A(13,"SEND"),E()()()}t&2&&(P(2),ae("ngForOf",n.allSimulations),P(),ae("ngIf",n.isLoading),P(3),ae("ngIf",n.latestSuggestions.length&&!n.isLoading&&!n.showContinueIcon),P(),ae("ngIf",n.modalUrl),P(2),un("ngModel",n.draft),P(),Ze("selected",n.isLoading),ae("disabled",n.isLoading))},dependencies:[ke,Dy,pi,_n,ms,Gr,fs,Mo,Gt,Ol,Vf,vs,Zu],styles:['.menu-btn[_ngcontent-%COMP%]{--button-height: 6px;--button-side-color: #383838ff;--selected-color: rgba(11, 102, 56, .94);--selected-depth-position: 3.3px;--over-depth-position: 4.5px;--over-depth-gap: calc(var(--over-depth-position) - var(--selected-depth-position));--perspective: 180px;--normal-rotate: 8deg;--hover-translate: .8px;--hover-rotate: 12deg;aspect-ratio:62 / 42;align-items:center;justify-content:center;height:2.5rem;position:relative;margin:2px;will-change:transform;transform:perspective(var(--perspective)) rotateX(var(--normal-rotate));transition:transform 96ms cubic-bezier(.82,-.09,.69,2.93),filter 0ms ease-in-out}.menu-btn[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;border-radius:.5rem;pointer-events:none;box-shadow:0 var(--button-height) var(--button-side-color)}.menu-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(var(--hover-translate)) perspective(var(--perspective)) rotateX(var(--hover-rotate))}.menu-btn[_ngcontent-%COMP%]:hover:after{box-shadow:0 calc(var(--button-height) - .4px) var(--button-side-color);opacity:1;pointer-events:none}.menu-btn[_ngcontent-%COMP%]:active{transform:translateY(var(--over-depth-position)) perspective(var(--perspective)) rotateX(var(--hover-rotate));filter:brightness(.98)}.menu-btn[_ngcontent-%COMP%]:active:after{opacity:1;background:#00000014;box-shadow:inset 0 6px #0000008c}.menu-btn.selected[_ngcontent-%COMP%]{transform:translateY(var(--selected-depth-position)) perspective(var(--perspective)) rotateX(var(--normal-rotate))}.menu-btn.selected[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(var(--selected-depth-position)) perspective(var(--perspective)) rotateX(var(--hover-rotate))}.menu-btn.selected[_ngcontent-%COMP%]:after{box-shadow:0 0 8px var(--selected-color) inset;background-color:#c00a6e57;mix-blend-mode:difference}.menu-btn.selected[_ngcontent-%COMP%]:active{transform:translateY(calc(var(--selected-depth-position) + var(--over-depth-gap))) perspective(var(--perspective)) rotateX(var(--hover-rotate));clip-path:inset(0px 0px var(--over-depth-gap) 0px)}.menu-btn.selected[_ngcontent-%COMP%]:active:after{mix-blend-mode:multiply;box-shadow:inset 0 0 8px var(--selected-color),inset 0 4px #000c}.image-icon[_ngcontent-%COMP%]{border-radius:.275rem;overflow:hidden;width:100%;height:100%;object-fit:fill;flex:0 0 auto;-webkit-user-select:none;user-select:none;-webkit-user-drag:none;pointer-events:none}[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column;--message-default-color: #d0d0d5}.messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:var(--message-default-color);position:relative;height:100%;padding-bottom:10rem;overflow-y:auto}.messages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{line-height:1.4;margin:.5rem 5rem 1rem 4rem;transition:.8s ease-in-out}.messages[_ngcontent-%COMP%]   .message.new-message[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_messageFadeIn .8s ease-out both}@keyframes _ngcontent-%COMP%_messageFadeIn{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.messages[_ngcontent-%COMP%]   .message.old-message[_ngcontent-%COMP%]{transition:opacity .8s ease-in-out}.messages[_ngcontent-%COMP%]   .message.old-message[_ngcontent-%COMP%]   .dialogue-markdown[_ngcontent-%COMP%]{opacity:.5}.dialogue-markdown[_ngcontent-%COMP%]{display:block;margin-left:1rem;pointer-events:all;padding:10px 12px;border-radius:8px;word-wrap:break-word;padding-left:calc(2rem + 12px);text-indent:-2rem}.dialogue-markdown[_ngcontent-%COMP%]  p{text-indent:0rem}.md-p-inline[_ngcontent-%COMP%]{display:inline!important;margin:0!important}.messages[_ngcontent-%COMP%]   .message.loading[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:1rem;width:2.5rem;height:2.5rem}.action-row[_ngcontent-%COMP%]{margin-left:5rem;font-size:.9rem;color:#888;padding:2px 0;font-style:italic}.messages[_ngcontent-%COMP%]   .continue-indicator[_ngcontent-%COMP%]{position:absolute;right:0rem;width:64px;height:42px;width:auto;z-index:10}.suggestions[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-width:90%;word-wrap:break-word;animation:_ngcontent-%COMP%_messageFadeIn .8s ease-out both}.suggestion[_ngcontent-%COMP%]{gap:8px;padding:8px 0;margin-left:5rem;word-wrap:break-word;width:fit-content}.suggestion[_ngcontent-%COMP%]:hover{color:#b9983d;text-decoration:underline}.suggestion.selected-suggestion[_ngcontent-%COMP%]{color:#ffd54a;font-weight:600;text-decoration:none;pointer-events:none}.suggestion.dim-suggestion[_ngcontent-%COMP%]{opacity:.4}.suggestion.dim-suggestion[_ngcontent-%COMP%]:hover{color:var(--message-default-color);opacity:.4;text-decoration:none}@media (max-width: 640px){.chat[_ngcontent-%COMP%]{padding:12px}.chat-input[_ngcontent-%COMP%]{padding:8px 10px}}.input-message-bar[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;height:5rem;width:100%;margin-top:auto;border-top:1px solid #646262;background:#242424fa;justify-content:center}.input-message-bar[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{margin:1rem;flex:1 1 auto;min-height:40px;max-height:140px;padding:8px 10px;border:1px solid #d0d0d5}.input-message-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:1rem 1rem 1rem 0;flex:0 0 auto;padding:8px 16px;box-sizing:border-box}.input-message-bar[_ngcontent-%COMP%]   button.menu-btn[_ngcontent-%COMP%]{padding:0}.send-button[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;justify-content:center;min-width:120px;height:2.5rem}.send-button[_ngcontent-%COMP%]   .send-button-label[_ngcontent-%COMP%]{font-family:Emboss;position:absolute;color:#272727;font-weight:600;pointer-events:none}']})};var Ku=class i{constructor(e,t){this.mediator=e;this.characterSheetService=t}get character(){return this.characterSheetService.getCharacterSheet()}ngOnInit(){console.log("CharacterPaneComponent initialized"),this.characterSheetService._emitChangesForUI(this.characterSheetService.getCharacterSheet()),this.mediator.getRequests().subscribe(({request:e,respond:t})=>{if(e.type==="characterPane.getModifier"){try{let n=e.payload?.checkType,o=this.characterSheetService.getCharacterSheet().getModifierFromCheckableDiceRoll(n);t({mod:o})}catch(n){t({mod:0,error:String(n)})}return}if(e.type==="updateCharacterFromResponses"){Promise.resolve(this.characterSheetService.updateCharacterFromManyResponses(e.payload)).then(()=>t({ok:!0})).catch(n=>{console.warn("updateCharacterFromResponses failed",n),t({ok:!1,error:String(n)})});return}})}dryRoll(e){return _e(this,null,function*(){let t=yield this.mediator.sendRequest("diceRoller.rollDice",{expression:"1d20"}),n=Number(t?.total??0);console.log(`Dry roll result: ${n} + ${e} = ${n+e}`)})}ngOnDestroy(){}static \u0275fac=function(t){return new(t||i)(se(qn),se(Wt))};static \u0275cmp=Pe({type:i,selectors:[["app-character-pane"]],decls:249,vars:82,consts:[[1,"section-box"],[1,"row-item"],[1,"section-title"],[1,"stats-grid"],[1,"stat-item"],[1,"stat-name"],[1,"stat-total"],["clickableDivWithSound","",1,"stat-modifier",3,"click"],["clickableDivWithSound","",1,"stat-item"],["clickableDivWithSound","",1,"skill-modifier",3,"click"],[1,"crop-text"]],template:function(t,n){t&1&&(C(0,"div",0)(1,"div",1)(2,"span"),A(3,"Initiative"),E(),C(4,"span"),A(5),E()(),C(6,"div",1)(7,"span"),A(8,"Proficiency Bonus"),E(),C(9,"span"),A(10),E()(),C(11,"div",2),A(12,"STATS"),E(),C(13,"div",3)(14,"div",4)(15,"span",5),A(16,"STR"),E(),C(17,"span",6),A(18),E(),C(19,"span",7),Y("click",function(){return n.dryRoll(n.character.getStatModifier(n.character.stats.strength))}),A(20),E()(),C(21,"div",4)(22,"span",5),A(23,"DEX"),E(),C(24,"span",6),A(25),E(),C(26,"span",7),Y("click",function(){return n.dryRoll(n.character.getStatModifier(n.character.stats.dexterity))}),A(27),E()(),C(28,"div",4)(29,"span",5),A(30,"CON"),E(),C(31,"span",6),A(32),E(),C(33,"span",7),Y("click",function(){return n.dryRoll(n.character.getStatModifier(n.character.stats.constitution))}),A(34),E()()(),C(35,"div",3)(36,"div",8)(37,"span",5),A(38,"INT"),E(),C(39,"span",6),A(40),E(),C(41,"span",7),Y("click",function(){return n.dryRoll(n.character.getStatModifier(n.character.stats.intelligence))}),A(42),E()(),C(43,"div",4)(44,"span",5),A(45,"WIS"),E(),C(46,"span",6),A(47),E(),C(48,"span",7),Y("click",function(){return n.dryRoll(n.character.getStatModifier(n.character.stats.wisdom))}),A(49),E()(),C(50,"div",4)(51,"span",5),A(52,"CHA"),E(),C(53,"span",6),A(54),E(),C(55,"span",7),Y("click",function(){return n.dryRoll(n.character.getStatModifier(n.character.stats.charisma))}),A(56),E()()()(),C(57,"div",0)(58,"div",2),A(59,"PASSIVE CHECKS"),E(),C(60,"div",1)(61,"span"),A(62,"Perception"),E(),C(63,"span"),A(64),E()(),C(65,"div",1)(66,"span"),A(67,"Investigation"),E(),C(68,"span"),A(69),E()(),C(70,"div",1)(71,"span"),A(72,"Insight"),E(),C(73,"span"),A(74),E()()(),C(75,"div",0)(76,"div",2),A(77,"SKILLS"),E(),C(78,"div",1)(79,"span"),A(80,"Acrobatics"),E(),C(81,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.acrobatics)}),A(82),E()(),C(83,"div",1)(84,"span"),A(85,"Animal Handling"),E(),C(86,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.animal_handling)}),A(87),E()(),C(88,"div",1)(89,"span"),A(90,"Arcana"),E(),C(91,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.arcana)}),A(92),E()(),C(93,"div",1)(94,"span"),A(95,"Athletics"),E(),C(96,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.athletics)}),A(97),E()(),C(98,"div",1)(99,"span"),A(100,"Deception"),E(),C(101,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.deception)}),A(102),E()(),C(103,"div",1)(104,"span"),A(105,"History"),E(),C(106,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.history)}),A(107),E()(),C(108,"div",1)(109,"span"),A(110,"Insight"),E(),C(111,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.insight)}),A(112),E()(),C(113,"div",1)(114,"span"),A(115,"Intimidation"),E(),C(116,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.intimidation)}),A(117),E()(),C(118,"div",1)(119,"span"),A(120,"Investigation"),E(),C(121,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.investigation)}),A(122),E()(),C(123,"div",1)(124,"span"),A(125,"Medicine"),E(),C(126,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.medicine)}),A(127),E()(),C(128,"div",1)(129,"span"),A(130,"Nature"),E(),C(131,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.nature)}),A(132),E()(),C(133,"div",1)(134,"span"),A(135,"Perception"),E(),C(136,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.perception)}),A(137),E()(),C(138,"div",1)(139,"span"),A(140,"Performance"),E(),C(141,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.performance)}),A(142),E()(),C(143,"div",1)(144,"span"),A(145,"Persuasion"),E(),C(146,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.persuasion)}),A(147),E()(),C(148,"div",1)(149,"span"),A(150,"Religion"),E(),C(151,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.religion)}),A(152),E()(),C(153,"div",1)(154,"span"),A(155,"Sleight of Hand"),E(),C(156,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.sleight_of_hand)}),A(157),E()(),C(158,"div",1)(159,"span"),A(160,"Stealth"),E(),C(161,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.stealth)}),A(162),E()(),C(163,"div",1)(164,"span"),A(165,"Survival"),E(),C(166,"span",9),Y("click",function(){return n.dryRoll(n.character.skills.survival)}),A(167),E()()(),C(168,"div",0)(169,"div",2),A(170,"SAVING THROWS"),E(),C(171,"div",1)(172,"span"),A(173,"STR"),E(),C(174,"span",9),Y("click",function(){return n.dryRoll(n.character.saving_throws.strength)}),A(175),E()(),C(176,"div",1)(177,"span"),A(178,"DEX"),E(),C(179,"span",9),Y("click",function(){return n.dryRoll(n.character.saving_throws.dexterity)}),A(180),E()(),C(181,"div",1)(182,"span"),A(183,"CON"),E(),C(184,"span",9),Y("click",function(){return n.dryRoll(n.character.saving_throws.constitution)}),A(185),E()(),C(186,"div",1)(187,"span"),A(188,"INT"),E(),C(189,"span",9),Y("click",function(){return n.dryRoll(n.character.saving_throws.intelligence)}),A(190),E()(),C(191,"div",1)(192,"span"),A(193,"WIS"),E(),C(194,"span",9),Y("click",function(){return n.dryRoll(n.character.saving_throws.wisdom)}),A(195),E()(),C(196,"div",1)(197,"span"),A(198,"CHA"),E(),C(199,"span",9),Y("click",function(){return n.dryRoll(n.character.saving_throws.charisma)}),A(200),E()()(),C(201,"div",0)(202,"div",2),A(203,"APPEARANCE"),E(),C(204,"div",1)(205,"span"),A(206,"Race"),E(),C(207,"span",10),A(208),E()(),C(209,"div",1)(210,"span"),A(211,"Gender"),E(),C(212,"span",10),A(213),E()(),C(214,"div",1)(215,"span"),A(216,"Faith"),E(),C(217,"span",10),A(218),E()(),C(219,"div",1)(220,"span"),A(221,"Age"),E(),C(222,"span",10),A(223),E()(),C(224,"div",1)(225,"span"),A(226,"Hair"),E(),C(227,"span",10),A(228),E()(),C(229,"div",1)(230,"span"),A(231,"Eyes"),E(),C(232,"span",10),A(233),E()(),C(234,"div",1)(235,"span"),A(236,"Skin"),E(),C(237,"span",10),A(238),E()(),C(239,"div",1)(240,"span"),A(241,"Height"),E(),C(242,"span",10),A(243),E()(),C(244,"div",1)(245,"span"),A(246,"Weight"),E(),C(247,"span",10),A(248),E()()()),t&2&&(P(5),Ge("",n.character.initiative_bonus>0?"+":"","",n.character.initiative_bonus),P(5),Ge("",n.character.proficiency_bonus>0?"+":"","",n.character.proficiency_bonus),P(8),Le(n.character.stats.strength),P(2),Ge(" ",n.character.getStatModifier(n.character.stats.strength)>0?"+":"","",n.character.getStatModifier(n.character.stats.strength)," "),P(5),Le(n.character.stats.dexterity),P(2),Ge(" ",n.character.getStatModifier(n.character.stats.dexterity)>0?"+":"","",n.character.getStatModifier(n.character.stats.dexterity)),P(5),Le(n.character.stats.constitution),P(2),Ge(" ",n.character.getStatModifier(n.character.stats.constitution)>0?"+":"","",n.character.getStatModifier(n.character.stats.constitution)),P(6),Le(n.character.stats.intelligence),P(2),Ge(" ",n.character.getStatModifier(n.character.stats.intelligence)>0?"+":"","",n.character.getStatModifier(n.character.stats.intelligence)),P(5),Le(n.character.stats.wisdom),P(2),Ge(" ",n.character.getStatModifier(n.character.stats.wisdom)>0?"+":"","",n.character.getStatModifier(n.character.stats.wisdom)),P(5),Le(n.character.stats.charisma),P(2),Ge(" ",n.character.getStatModifier(n.character.stats.charisma)>0?"+":"","",n.character.getStatModifier(n.character.stats.charisma)),P(8),Le(n.character.passive_checks.perception),P(5),Le(n.character.passive_checks.investigation),P(5),Le(n.character.passive_checks.insight),P(8),Ge("",n.character.skills.acrobatics>0?"+":"","",n.character.skills.acrobatics),P(5),Ge("",n.character.skills.animal_handling>0?"+":"","",n.character.skills.animal_handling),P(5),Ge("",n.character.skills.arcana>0?"+":"","",n.character.skills.arcana),P(5),Ge("",n.character.skills.athletics>0?"+":"","",n.character.skills.athletics),P(5),Ge("",n.character.skills.deception>0?"+":"","",n.character.skills.deception),P(5),Ge("",n.character.skills.history>0?"+":"","",n.character.skills.history),P(5),Ge("",n.character.skills.insight>0?"+":"","",n.character.skills.insight),P(5),Ge("",n.character.skills.intimidation>0?"+":"","",n.character.skills.intimidation),P(5),Ge("",n.character.skills.investigation>0?"+":"","",n.character.skills.investigation),P(5),Ge("",n.character.skills.medicine>0?"+":"","",n.character.skills.medicine),P(5),Ge("",n.character.skills.nature>0?"+":"","",n.character.skills.nature),P(5),Ge("",n.character.skills.perception>0?"+":"","",n.character.skills.perception),P(5),Ge("",n.character.skills.performance>0?"+":"","",n.character.skills.performance),P(5),Ge("",n.character.skills.persuasion>0?"+":"","",n.character.skills.persuasion),P(5),Ge("",n.character.skills.religion>0?"+":"","",n.character.skills.religion),P(5),Ge("",n.character.skills.sleight_of_hand>0?"+":"","",n.character.skills.sleight_of_hand),P(5),Ge("",n.character.skills.stealth>0?"+":"","",n.character.skills.stealth),P(5),Ge("",n.character.skills.survival>0?"+":"","",n.character.skills.survival),P(8),Ge("",n.character.saving_throws.strength>0?"+":"","",n.character.saving_throws.strength),P(5),Ge("",n.character.saving_throws.dexterity>0?"+":"","",n.character.saving_throws.dexterity),P(5),Ge("",n.character.saving_throws.constitution>0?"+":"","",n.character.saving_throws.constitution),P(5),Ge("",n.character.saving_throws.intelligence>0?"+":"","",n.character.saving_throws.intelligence),P(5),Ge("",n.character.saving_throws.wisdom>0?"+":"","",n.character.saving_throws.wisdom),P(5),Ge("",n.character.saving_throws.charisma>0?"+":"","",n.character.saving_throws.charisma),P(8),Le(n.character.character_background.race?n.character.character_background.race:"N/A"),P(5),Le(n.character.character_background.gender?n.character.character_background.gender:"N/A"),P(5),Le(n.character.character_background.faith?n.character.character_background.faith:"N/A"),P(5),Le(n.character.character_background.age?n.character.character_background.age:"N/A"),P(5),Le(n.character.character_background.hair?n.character.character_background.hair:"N/A"),P(5),Le(n.character.character_background.eyes?n.character.character_background.eyes:"N/A"),P(5),Le(n.character.character_background.skin?n.character.character_background.skin:"N/A"),P(5),Le(n.character.character_background.height?n.character.character_background.height:"N/A"),P(5),Le(n.character.character_background.weight?n.character.character_background.weight:"N/A"))},dependencies:[ke,Gt],styles:["[_nghost-%COMP%]{font-family:Arial,sans-serif;padding:.6rem;display:block}h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%]{margin:0 0 8px}.character-card[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.character-info[_ngcontent-%COMP%]{margin:.2rem 0 0 1rem;display:flex;flex-direction:column;margin-bottom:8px;gap:4px}.character-avatar[_ngcontent-%COMP%]{width:7rem;height:7rem;object-fit:cover;border:2px solid #adadadff}.section-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-wrap:wrap;margin-top:8px;border:2.5px solid #adadadff;gap:8px;padding-bottom:8px}.section-title[_ngcontent-%COMP%]{font-weight:600;font-size:.9rem;background-color:#181818;padding:4px 8px;border-bottom:2.5px solid #adadadff;text-align:center}.stats-grid[_ngcontent-%COMP%]{display:flex;font-size:.7rem;flex-direction:row;flex-wrap:wrap;align-items:center;justify-content:space-around}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.stat-name[_ngcontent-%COMP%]{font-weight:700;margin-top:8px}.stat-modifier[_ngcontent-%COMP%]{font-size:1.1rem;display:flex;padding:4px;margin:4px;width:3rem;border:2.5px solid #adadadff;border-radius:8px;align-items:center;justify-content:center}.skills-section[_ngcontent-%COMP%]{margin-top:12px;border:2.5px solid #adadadff;padding:8px}.skills-list[_ngcontent-%COMP%]{font-size:.8rem;display:flex;flex-direction:column;gap:4px}.row-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:2px 4px}.crop-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;width:10ch;text-overflow:ellipsis;text-align:end}"]})};var Qu=class i{selectPane=new xt;selectedPane=null;set currentPane(e){this.selectedPane=e}clickSelectPane(e){this.selectedPane=e,this.selectPane.emit(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-menu-pane"]],inputs:{currentPane:"currentPane"},outputs:{selectPane:"selectPane"},decls:15,vars:14,consts:[[1,"button-pane"],["clickableDivWithSound","",1,"menu-btn",3,"mousedown"],["src","menus/character.webp","alt","Character",1,"image-icon"],["src","menus/actions5.webp","alt","Actions",1,"image-icon"],["src","menus/spellbook.webp","alt","Spellbook",1,"image-icon"],["src","menus/inventory3.webp","alt","Inventory",1,"image-icon"],["src","menus/maps.webp","alt","Maps",1,"image-icon"],["src","menus/journals.webp","alt","Journals",1,"image-icon"],["src","menus/settings.webp","alt","Settings",1,"image-icon"]],template:function(t,n){t&1&&(C(0,"div",0)(1,"div",1),Y("mousedown",function(){return n.clickSelectPane("character")}),Te(2,"img",2),E(),C(3,"div",1),Y("mousedown",function(){return n.clickSelectPane("actions")}),Te(4,"img",3),E(),C(5,"div",1),Y("mousedown",function(){return n.clickSelectPane("spellbook")}),Te(6,"img",4),E(),C(7,"div",1),Y("mousedown",function(){return n.clickSelectPane("inventory")}),Te(8,"img",5),E(),C(9,"div",1),Y("mousedown",function(){return n.clickSelectPane("maps")}),Te(10,"img",6),E(),C(11,"div",1),Y("mousedown",function(){return n.clickSelectPane("journals")}),Te(12,"img",7),E(),C(13,"div",1),Y("mousedown",function(){return n.clickSelectPane("settings")}),Te(14,"img",8),E()()),t&2&&(P(),Ze("selected",n.selectedPane==="character"),P(2),Ze("selected",n.selectedPane==="actions"),P(2),Ze("selected",n.selectedPane==="spellbook"),P(2),Ze("selected",n.selectedPane==="inventory"),P(2),Ze("selected",n.selectedPane==="maps"),P(2),Ze("selected",n.selectedPane==="journals"),P(2),Ze("selected",n.selectedPane==="settings"))},dependencies:[ke,Gt],styles:['.menu-btn[_ngcontent-%COMP%]{--button-height: 6px;--button-side-color: #383838ff;--selected-color: rgba(11, 102, 56, .94);--selected-depth-position: 3.3px;--over-depth-position: 4.5px;--over-depth-gap: calc(var(--over-depth-position) - var(--selected-depth-position));--perspective: 180px;--normal-rotate: 8deg;--hover-translate: .8px;--hover-rotate: 12deg;aspect-ratio:62 / 42;align-items:center;justify-content:center;height:2.5rem;position:relative;margin:2px;will-change:transform;transform:perspective(var(--perspective)) rotateX(var(--normal-rotate));transition:transform 96ms cubic-bezier(.82,-.09,.69,2.93),filter 0ms ease-in-out}.menu-btn[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;border-radius:.5rem;pointer-events:none;box-shadow:0 var(--button-height) var(--button-side-color)}.menu-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(var(--hover-translate)) perspective(var(--perspective)) rotateX(var(--hover-rotate))}.menu-btn[_ngcontent-%COMP%]:hover:after{box-shadow:0 calc(var(--button-height) - .4px) var(--button-side-color);opacity:1;pointer-events:none}.menu-btn[_ngcontent-%COMP%]:active{transform:translateY(var(--over-depth-position)) perspective(var(--perspective)) rotateX(var(--hover-rotate));filter:brightness(.98)}.menu-btn[_ngcontent-%COMP%]:active:after{opacity:1;background:#00000014;box-shadow:inset 0 6px #0000008c}.menu-btn.selected[_ngcontent-%COMP%]{transform:translateY(var(--selected-depth-position)) perspective(var(--perspective)) rotateX(var(--normal-rotate))}.menu-btn.selected[_ngcontent-%COMP%]:hover{filter:brightness(1.2);transform:translateY(var(--selected-depth-position)) perspective(var(--perspective)) rotateX(var(--hover-rotate))}.menu-btn.selected[_ngcontent-%COMP%]:after{box-shadow:0 0 8px var(--selected-color) inset;background-color:#c00a6e57;mix-blend-mode:difference}.menu-btn.selected[_ngcontent-%COMP%]:active{transform:translateY(calc(var(--selected-depth-position) + var(--over-depth-gap))) perspective(var(--perspective)) rotateX(var(--hover-rotate));clip-path:inset(0px 0px var(--over-depth-gap) 0px)}.menu-btn.selected[_ngcontent-%COMP%]:active:after{mix-blend-mode:multiply;box-shadow:inset 0 0 8px var(--selected-color),inset 0 4px #000c}.image-icon[_ngcontent-%COMP%]{border-radius:.275rem;overflow:hidden;width:100%;height:100%;object-fit:fill;flex:0 0 auto;-webkit-user-select:none;user-select:none;-webkit-user-drag:none;pointer-events:none}',"[_nghost-%COMP%]{margin:.3rem}.button-pane[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end;overflow:hidden;padding-right:0rem;padding-bottom:1.2rem;pointer-events:none}"]})};var E3=Object.defineProperty,M3=(i,e,t)=>e in i?E3(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,D3=(i,e,t)=>(M3(i,typeof e!="symbol"?e+"":e,t),t);var ww="143",Fo="srgb",_a="srgb-linear",vD="300 es",Ms=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let n=this._listeners[e];if(n!==void 0){let r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let n=t.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}},Wn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Q_=Math.PI/180,Nb=180/Math.PI;function pd(){let i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Wn[i&255]+Wn[i>>8&255]+Wn[i>>16&255]+Wn[i>>24&255]+"-"+Wn[e&255]+Wn[e>>8&255]+"-"+Wn[e>>16&15|64]+Wn[e>>24&255]+"-"+Wn[t&63|128]+Wn[t>>8&255]+"-"+Wn[t>>16&255]+Wn[t>>24&255]+Wn[n&255]+Wn[n>>8&255]+Wn[n>>16&255]+Wn[n>>24&255]).toLowerCase()}function Ai(i,e,t){return Math.max(e,Math.min(t,i))}function I3(i,e){return(i%e+e)%e}function J_(i,e,t){return(1-t)*i+t*e}function yD(i){return(i&i-1)===0&&i!==0}function kb(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}var vt=class i{constructor(e=0,t=0){i.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),r=Math.sin(t),o=this.x-e.x,s=this.y-e.y;return this.x=o*n-s*r+e.x,this.y=o*r+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Zi=class i{constructor(){i.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,r,o,s,a,l,c){let u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=o,u[5]=l,u[6]=n,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,r=t.elements,o=this.elements,s=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],d=n[2],p=n[5],g=n[8],f=r[0],m=r[3],v=r[6],y=r[1],x=r[4],_=r[7],S=r[2],M=r[5],R=r[8];return o[0]=s*f+a*y+l*S,o[3]=s*m+a*x+l*M,o[6]=s*v+a*_+l*R,o[1]=c*f+u*y+h*S,o[4]=c*m+u*x+h*M,o[7]=c*v+u*_+h*R,o[2]=d*f+p*y+g*S,o[5]=d*m+p*x+g*M,o[8]=d*v+p*_+g*R,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-n*o*u+n*a*l+r*o*c-r*s*l}invert(){let e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*s-a*c,d=a*l-u*o,p=c*o-s*l,g=t*h+n*d+r*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/g;return e[0]=h*f,e[1]=(r*c-u*n)*f,e[2]=(a*n-r*s)*f,e[3]=d*f,e[4]=(u*t-r*l)*f,e[5]=(r*o-a*t)*f,e[6]=p*f,e[7]=(n*l-c*t)*f,e[8]=(s*t-n*o)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,o,s,a){let l=Math.cos(o),c=Math.sin(o);return this.set(n*l,n*c,-n*(l*s+c*a)+s+e,-r*c,r*l,-r*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){let n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){let t=Math.cos(e),n=Math.sin(e),r=this.elements,o=r[0],s=r[3],a=r[6],l=r[1],c=r[4],u=r[7];return r[0]=t*o+n*l,r[3]=t*s+n*c,r[6]=t*a+n*u,r[1]=-n*o+t*l,r[4]=-n*s+t*c,r[7]=-n*a+t*u,this}translate(e,t){let n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){let t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};function vI(i){for(let e=i.length-1;e>=0;--e)if(i[e]>65535)return!0;return!1}function pm(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function ba(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function um(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}var eb={[Fo]:{[_a]:ba},[_a]:{[Fo]:um}},mr={legacyMode:!0,get workingColorSpace(){return _a},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,t){if(this.legacyMode||e===t||!e||!t)return i;if(eb[e]&&eb[e][t]!==void 0){let n=eb[e][t];return i.r=n(i.r),i.g=n(i.g),i.b=n(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}},_D={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},bn={r:0,g:0,b:0},gr={h:0,s:0,l:0},Bf={h:0,s:0,l:0};function tb(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}function zf(i,e){return e.r=i.r,e.g=i.g,e.b=i.b,e}var _t=(()=>{class i{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,n===void 0&&r===void 0?this.set(t):this.setRGB(t,n,r)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=Fo){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,mr.toWorkingColorSpace(this,n),this}setRGB(t,n,r,o=_a){return this.r=t,this.g=n,this.b=r,mr.toWorkingColorSpace(this,o),this}setHSL(t,n,r,o=_a){if(t=I3(t,1),n=Ai(n,0,1),r=Ai(r,0,1),n===0)this.r=this.g=this.b=r;else{let s=r<=.5?r*(1+n):r+n-r*n,a=2*r-s;this.r=tb(a,s,t+1/3),this.g=tb(a,s,t),this.b=tb(a,s,t-1/3)}return mr.toWorkingColorSpace(this,o),this}setStyle(t,n=Fo){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let o;if(o=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s,a=o[1],l=o[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,mr.toWorkingColorSpace(this,n),r(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,mr.toWorkingColorSpace(this,n),r(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){let c=parseFloat(s[1])/360,u=parseInt(s[2],10)/100,h=parseInt(s[3],10)/100;return r(s[4]),this.setHSL(c,u,h,n)}break}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(t)){let s=o[1],a=s.length;if(a===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,mr.toWorkingColorSpace(this,n),this;if(a===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,mr.toWorkingColorSpace(this,n),this}return t&&t.length>0?this.setColorName(t,n):this}setColorName(t,n=Fo){let r=_D[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ba(t.r),this.g=ba(t.g),this.b=ba(t.b),this}copyLinearToSRGB(t){return this.r=um(t.r),this.g=um(t.g),this.b=um(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Fo){return mr.fromWorkingColorSpace(zf(this,bn),t),Ai(bn.r*255,0,255)<<16^Ai(bn.g*255,0,255)<<8^Ai(bn.b*255,0,255)<<0}getHexString(t=Fo){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=_a){mr.fromWorkingColorSpace(zf(this,bn),n);let r=bn.r,o=bn.g,s=bn.b,a=Math.max(r,o,s),l=Math.min(r,o,s),c,u,h=(l+a)/2;if(l===a)c=0,u=0;else{let d=a-l;switch(u=h<=.5?d/(a+l):d/(2-a-l),a){case r:c=(o-s)/d+(o<s?6:0);break;case o:c=(s-r)/d+2;break;case s:c=(r-o)/d+4;break}c/=6}return t.h=c,t.s=u,t.l=h,t}getRGB(t,n=_a){return mr.fromWorkingColorSpace(zf(this,bn),n),t.r=bn.r,t.g=bn.g,t.b=bn.b,t}getStyle(t=Fo){return mr.fromWorkingColorSpace(zf(this,bn),t),t!==Fo?`color(${t} ${bn.r} ${bn.g} ${bn.b})`:`rgb(${bn.r*255|0},${bn.g*255|0},${bn.b*255|0})`}offsetHSL(t,n,r){return this.getHSL(gr),gr.h+=t,gr.s+=n,gr.l+=r,this.setHSL(gr.h,gr.s,gr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(gr),t.getHSL(Bf);let r=J_(gr.h,Bf.h,n),o=J_(gr.s,Bf.s,n),s=J_(gr.l,Bf.l,n);return this.setHSL(r,o,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}return i.NAMES=_D,i})(),Vl,fm=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Vl===void 0&&(Vl=pm("canvas")),Vl.width=e.width,Vl.height=e.height;let n=Vl.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Vl}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=pm("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);let r=n.getImageData(0,0,e.width,e.height),o=r.data;for(let s=0;s<o.length;s++)o[s]=ba(o[s]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(ba(t[n]/255)*255):t[n]=ba(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},mm=class{constructor(e=null){this.isSource=!0,this.uuid=pd(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let o;if(Array.isArray(r)){o=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?o.push(nb(r[s].image)):o.push(nb(r[s]))}else o=nb(r);n.url=o}return t||(e.images[this.uuid]=n),n}};function nb(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?fm.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var T3=0,Is=(()=>{class i extends Ms{constructor(t=i.DEFAULT_IMAGE,n=i.DEFAULT_MAPPING,r=1001,o=1001,s=1006,a=1008,l=1023,c=1009,u=1,h=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:T3++}),this.uuid=pd(),this.name="",this.source=new mm(t),this.mipmaps=[],this.mapping=n,this.wrapS=r,this.wrapT=o,this.magFilter=s,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new vt(0,0),this.repeat=new vt(1,1),this.center=new vt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Zi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let n=t===void 0||typeof t=="string";if(!n&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),n||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==300)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}return i.DEFAULT_IMAGE=null,i.DEFAULT_MAPPING=300,i})(),xn=class i{constructor(e=0,t=0,n=0,r=1){i.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,r=this.z,o=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*o,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*o,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*o,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,o,s=e.elements,a=s[0],l=s[4],c=s[8],u=s[1],h=s[5],d=s[9],p=s[2],g=s[6],f=s[10];if(Math.abs(l-u)<.01&&Math.abs(c-p)<.01&&Math.abs(d-g)<.01){if(Math.abs(l+u)<.1&&Math.abs(c+p)<.1&&Math.abs(d+g)<.1&&Math.abs(a+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let v=(a+1)/2,y=(h+1)/2,x=(f+1)/2,_=(l+u)/4,S=(c+p)/4,M=(d+g)/4;return v>y&&v>x?v<.01?(n=0,r=.707106781,o=.707106781):(n=Math.sqrt(v),r=_/n,o=S/n):y>x?y<.01?(n=.707106781,r=0,o=.707106781):(r=Math.sqrt(y),n=_/r,o=M/r):x<.01?(n=.707106781,r=.707106781,o=0):(o=Math.sqrt(x),n=S/o,r=M/o),this.set(n,r,o,t),this}let m=Math.sqrt((g-d)*(g-d)+(c-p)*(c-p)+(u-l)*(u-l));return Math.abs(m)<.001&&(m=1),this.x=(g-d)/m,this.y=(c-p)/m,this.z=(u-l)/m,this.w=Math.acos((a+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Bo=class extends Ms{constructor(e,t,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new xn(0,0,e,t),this.scissorTest=!1,this.viewport=new xn(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new Is(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:1006,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new mm(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},gm=class extends Is{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Ob=class extends Is{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},wa=class{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,o,s,a){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3],d=o[s+0],p=o[s+1],g=o[s+2],f=o[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=p,e[t+2]=g,e[t+3]=f;return}if(h!==f||l!==d||c!==p||u!==g){let m=1-a,v=l*d+c*p+u*g+h*f,y=v>=0?1:-1,x=1-v*v;if(x>Number.EPSILON){let S=Math.sqrt(x),M=Math.atan2(S,v*y);m=Math.sin(m*M)/S,a=Math.sin(a*M)/S}let _=a*y;if(l=l*m+d*_,c=c*m+p*_,u=u*m+g*_,h=h*m+f*_,m===1-a){let S=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=S,c*=S,u*=S,h*=S}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,r,o,s){let a=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=o[s],d=o[s+1],p=o[s+2],g=o[s+3];return e[t]=a*g+u*h+l*p-c*d,e[t+1]=l*g+u*d+c*h-a*p,e[t+2]=c*g+u*p+a*d-l*h,e[t+3]=u*g-a*h-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=e._x,r=e._y,o=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(r/2),h=a(o/2),d=l(n/2),p=l(r/2),g=l(o/2);switch(s){case"XYZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"YXZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"ZXY":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"ZYX":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"YZX":this._x=d*u*h+c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h-d*p*g;break;case"XZY":this._x=d*u*h-c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h+d*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],r=t[4],o=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=n+a+h;if(d>0){let p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(o-c)*p,this._z=(s-r)*p}else if(n>a&&n>h){let p=2*Math.sqrt(1+n-a-h);this._w=(u-l)/p,this._x=.25*p,this._y=(r+s)/p,this._z=(o+c)/p}else if(a>h){let p=2*Math.sqrt(1+a-n-h);this._w=(o-c)/p,this._x=(r+s)/p,this._y=.25*p,this._z=(l+u)/p}else{let p=2*Math.sqrt(1+h-n-a);this._w=(s-r)/p,this._x=(o+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ai(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(n===0)return this;let r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,r=e._y,o=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+s*a+r*c-o*l,this._y=r*u+s*l+o*a-n*c,this._z=o*u+s*c+n*l-r*a,this._w=s*u-n*a-r*l-o*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let n=this._x,r=this._y,o=this._z,s=this._w,a=s*e._w+n*e._x+r*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=r,this._z=o,this;let l=1-a*a;if(l<=Number.EPSILON){let p=1-t;return this._w=p*s+t*this._w,this._x=p*n+t*this._x,this._y=p*r+t*this._y,this._z=p*o+t*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=s*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=o*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){let e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(o),n*Math.cos(o),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},H=class i{constructor(e=0,t=0,n=0){i.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(bD.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(bD.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*r,this.y=o[1]*t+o[4]*n+o[7]*r,this.z=o[2]*t+o[5]*n+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,r=this.z,o=e.elements,s=1/(o[3]*t+o[7]*n+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*r+o[12])*s,this.y=(o[1]*t+o[5]*n+o[9]*r+o[13])*s,this.z=(o[2]*t+o[6]*n+o[10]*r+o[14])*s,this}applyQuaternion(e){let t=this.x,n=this.y,r=this.z,o=e.x,s=e.y,a=e.z,l=e.w,c=l*t+s*r-a*n,u=l*n+a*t-o*r,h=l*r+o*n-s*t,d=-o*t-s*n-a*r;return this.x=c*l+d*-o+u*-a-h*-s,this.y=u*l+d*-s+h*-o-c*-a,this.z=h*l+d*-a+c*-s-u*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r,this.y=o[1]*t+o[5]*n+o[9]*r,this.z=o[2]*t+o[6]*n+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,r=e.y,o=e.z,s=t.x,a=t.y,l=t.z;return this.x=r*l-o*a,this.y=o*s-n*l,this.z=n*a-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ib.copy(this).projectOnVector(e),this.sub(ib)}reflect(e){return this.sub(ib.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(Ai(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},ib=new H,bD=new wa,xa=class{constructor(e=new H(1/0,1/0,1/0),t=new H(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,o=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){let u=e[l],h=e[l+1],d=e[l+2];u<t&&(t=u),h<n&&(n=h),d<r&&(r=d),u>o&&(o=u),h>s&&(s=h),d>a&&(a=d)}return this.min.set(t,n,r),this.max.set(o,s,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,o=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){let u=e.getX(l),h=e.getY(l),d=e.getZ(l);u<t&&(t=u),h<n&&(n=h),d<r&&(r=d),u>o&&(o=u),h>s&&(s=h),d>a&&(a=d)}return this.min.set(t,n,r),this.max.set(o,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=da.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){let o=n.attributes.position;for(let s=0,a=o.count;s<a;s++)da.fromBufferAttribute(o,s).applyMatrix4(e.matrixWorld),this.expandByPoint(da)}else n.boundingBox===null&&n.computeBoundingBox(),rb.copy(n.boundingBox),rb.applyMatrix4(e.matrixWorld),this.union(rb);let r=e.children;for(let o=0,s=r.length;o<s;o++)this.expandByObject(r[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,da),da.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ju),jf.subVectors(this.max,Ju),Bl.subVectors(e.a,Ju),zl.subVectors(e.b,Ju),jl.subVectors(e.c,Ju),ys.subVectors(zl,Bl),_s.subVectors(jl,zl),ha.subVectors(Bl,jl);let t=[0,-ys.z,ys.y,0,-_s.z,_s.y,0,-ha.z,ha.y,ys.z,0,-ys.x,_s.z,0,-_s.x,ha.z,0,-ha.x,-ys.y,ys.x,0,-_s.y,_s.x,0,-ha.y,ha.x,0];return!ob(t,Bl,zl,jl,jf)||(t=[1,0,0,0,1,0,0,0,1],!ob(t,Bl,zl,jl,jf))?!1:(Uf.crossVectors(ys,_s),t=[Uf.x,Uf.y,Uf.z],ob(t,Bl,zl,jl,jf))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return da.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(da).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Do[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Do[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Do[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Do[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Do[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Do[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Do[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Do[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Do),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Do=[new H,new H,new H,new H,new H,new H,new H,new H],da=new H,rb=new xa,Bl=new H,zl=new H,jl=new H,ys=new H,_s=new H,ha=new H,Ju=new H,jf=new H,Uf=new H,pa=new H;function ob(i,e,t,n,r){for(let o=0,s=i.length-3;o<=s;o+=3){pa.fromArray(i,o);let a=r.x*Math.abs(pa.x)+r.y*Math.abs(pa.y)+r.z*Math.abs(pa.z),l=e.dot(pa),c=t.dot(pa),u=n.dot(pa);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}var A3=new xa,wD=new H,Hf=new H,sb=new H,Sa=class{constructor(e=new H,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;t!==void 0?n.copy(t):A3.setFromPoints(e).getCenter(n);let r=0;for(let o=0,s=e.length;o<s;o++)r=Math.max(r,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){sb.subVectors(e,this.center);let t=sb.lengthSq();if(t>this.radius*this.radius){let n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.add(sb.multiplyScalar(r/n)),this.radius+=r}return this}union(e){return this.center.equals(e.center)===!0?Hf.set(0,0,1).multiplyScalar(e.radius):Hf.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(wD.copy(e.center).add(Hf)),this.expandByPoint(wD.copy(e.center).sub(Hf)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Io=new H,ab=new H,Gf=new H,bs=new H,lb=new H,qf=new H,cb=new H,Lb=class{constructor(e=new H,t=new H(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Io)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Io.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Io.copy(this.direction).multiplyScalar(t).add(this.origin),Io.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){ab.copy(e).add(t).multiplyScalar(.5),Gf.copy(t).sub(e).normalize(),bs.copy(this.origin).sub(ab);let o=e.distanceTo(t)*.5,s=-this.direction.dot(Gf),a=bs.dot(this.direction),l=-bs.dot(Gf),c=bs.lengthSq(),u=Math.abs(1-s*s),h,d,p,g;if(u>0)if(h=s*l-a,d=s*a-l,g=o*u,h>=0)if(d>=-g)if(d<=g){let f=1/u;h*=f,d*=f,p=h*(h+s*d+2*a)+d*(s*h+d+2*l)+c}else d=o,h=Math.max(0,-(s*d+a)),p=-h*h+d*(d+2*l)+c;else d=-o,h=Math.max(0,-(s*d+a)),p=-h*h+d*(d+2*l)+c;else d<=-g?(h=Math.max(0,-(-s*o+a)),d=h>0?-o:Math.min(Math.max(-o,-l),o),p=-h*h+d*(d+2*l)+c):d<=g?(h=0,d=Math.min(Math.max(-o,-l),o),p=d*(d+2*l)+c):(h=Math.max(0,-(s*o+a)),d=h>0?o:Math.min(Math.max(-o,-l),o),p=-h*h+d*(d+2*l)+c);else d=s>0?-o:o,h=Math.max(0,-(s*d+a)),p=-h*h+d*(d+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),r&&r.copy(Gf).multiplyScalar(d).add(ab),p}intersectSphere(e,t){Io.subVectors(e.center,this.origin);let n=Io.dot(this.direction),r=Io.dot(Io)-n*n,o=e.radius*e.radius;if(r>o)return null;let s=Math.sqrt(o-r),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,o,s,a,l,c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(o=(e.min.y-d.y)*u,s=(e.max.y-d.y)*u):(o=(e.max.y-d.y)*u,s=(e.min.y-d.y)*u),n>s||o>r||((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,Io)!==null}intersectTriangle(e,t,n,r,o){lb.subVectors(t,e),qf.subVectors(n,e),cb.crossVectors(lb,qf);let s=this.direction.dot(cb),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;bs.subVectors(this.origin,e);let l=a*this.direction.dot(qf.crossVectors(bs,qf));if(l<0)return null;let c=a*this.direction.dot(lb.cross(bs));if(c<0||l+c>s)return null;let u=-a*bs.dot(cb);return u<0?null:this.at(u/s,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},An=class i{constructor(){i.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,r,o,s,a,l,c,u,h,d,p,g,f,m){let v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=o,v[5]=s,v[9]=a,v[13]=l,v[2]=c,v[6]=u,v[10]=h,v[14]=d,v[3]=p,v[7]=g,v[11]=f,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new i().fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,r=1/Ul.setFromMatrixColumn(e,0).length(),o=1/Ul.setFromMatrixColumn(e,1).length(),s=1/Ul.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,n=e.x,r=e.y,o=e.z,s=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(o),h=Math.sin(o);if(e.order==="XYZ"){let d=s*u,p=s*h,g=a*u,f=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=p+g*c,t[5]=d-f*c,t[9]=-a*l,t[2]=f-d*c,t[6]=g+p*c,t[10]=s*l}else if(e.order==="YXZ"){let d=l*u,p=l*h,g=c*u,f=c*h;t[0]=d+f*a,t[4]=g*a-p,t[8]=s*c,t[1]=s*h,t[5]=s*u,t[9]=-a,t[2]=p*a-g,t[6]=f+d*a,t[10]=s*l}else if(e.order==="ZXY"){let d=l*u,p=l*h,g=c*u,f=c*h;t[0]=d-f*a,t[4]=-s*h,t[8]=g+p*a,t[1]=p+g*a,t[5]=s*u,t[9]=f-d*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){let d=s*u,p=s*h,g=a*u,f=a*h;t[0]=l*u,t[4]=g*c-p,t[8]=d*c+f,t[1]=l*h,t[5]=f*c+d,t[9]=p*c-g,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){let d=s*l,p=s*c,g=a*l,f=a*c;t[0]=l*u,t[4]=f-d*h,t[8]=g*h+p,t[1]=h,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=p*h+g,t[10]=d-f*h}else if(e.order==="XZY"){let d=s*l,p=s*c,g=a*l,f=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+f,t[5]=s*u,t[9]=p*h-g,t[2]=g*h-p,t[6]=a*u,t[10]=f*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(R3,e,P3)}lookAt(e,t,n){let r=this.elements;return Ii.subVectors(e,t),Ii.lengthSq()===0&&(Ii.z=1),Ii.normalize(),ws.crossVectors(n,Ii),ws.lengthSq()===0&&(Math.abs(n.z)===1?Ii.x+=1e-4:Ii.z+=1e-4,Ii.normalize(),ws.crossVectors(n,Ii)),ws.normalize(),Wf.crossVectors(Ii,ws),r[0]=ws.x,r[4]=Wf.x,r[8]=Ii.x,r[1]=ws.y,r[5]=Wf.y,r[9]=Ii.y,r[2]=ws.z,r[6]=Wf.z,r[10]=Ii.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,r=t.elements,o=this.elements,s=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],d=n[9],p=n[13],g=n[2],f=n[6],m=n[10],v=n[14],y=n[3],x=n[7],_=n[11],S=n[15],M=r[0],R=r[4],b=r[8],I=r[12],L=r[1],F=r[5],U=r[9],B=r[13],k=r[2],V=r[6],O=r[10],Z=r[14],K=r[3],j=r[7],$=r[11],ce=r[15];return o[0]=s*M+a*L+l*k+c*K,o[4]=s*R+a*F+l*V+c*j,o[8]=s*b+a*U+l*O+c*$,o[12]=s*I+a*B+l*Z+c*ce,o[1]=u*M+h*L+d*k+p*K,o[5]=u*R+h*F+d*V+p*j,o[9]=u*b+h*U+d*O+p*$,o[13]=u*I+h*B+d*Z+p*ce,o[2]=g*M+f*L+m*k+v*K,o[6]=g*R+f*F+m*V+v*j,o[10]=g*b+f*U+m*O+v*$,o[14]=g*I+f*B+m*Z+v*ce,o[3]=y*M+x*L+_*k+S*K,o[7]=y*R+x*F+_*V+S*j,o[11]=y*b+x*U+_*O+S*$,o[15]=y*I+x*B+_*Z+S*ce,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],r=e[8],o=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],p=e[14],g=e[3],f=e[7],m=e[11],v=e[15];return g*(+o*l*h-r*c*h-o*a*d+n*c*d+r*a*p-n*l*p)+f*(+t*l*p-t*c*d+o*s*d-r*s*p+r*c*u-o*l*u)+m*(+t*c*h-t*a*p-o*s*h+n*s*p+o*a*u-n*c*u)+v*(-r*a*u-t*l*h+t*a*d+r*s*h-n*s*d+n*l*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],g=e[12],f=e[13],m=e[14],v=e[15],y=h*m*c-f*d*c+f*l*p-a*m*p-h*l*v+a*d*v,x=g*d*c-u*m*c-g*l*p+s*m*p+u*l*v-s*d*v,_=u*f*c-g*h*c+g*a*p-s*f*p-u*a*v+s*h*v,S=g*h*l-u*f*l-g*a*d+s*f*d+u*a*m-s*h*m,M=t*y+n*x+r*_+o*S;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let R=1/M;return e[0]=y*R,e[1]=(f*d*o-h*m*o-f*r*p+n*m*p+h*r*v-n*d*v)*R,e[2]=(a*m*o-f*l*o+f*r*c-n*m*c-a*r*v+n*l*v)*R,e[3]=(h*l*o-a*d*o-h*r*c+n*d*c+a*r*p-n*l*p)*R,e[4]=x*R,e[5]=(u*m*o-g*d*o+g*r*p-t*m*p-u*r*v+t*d*v)*R,e[6]=(g*l*o-s*m*o-g*r*c+t*m*c+s*r*v-t*l*v)*R,e[7]=(s*d*o-u*l*o+u*r*c-t*d*c-s*r*p+t*l*p)*R,e[8]=_*R,e[9]=(g*h*o-u*f*o-g*n*p+t*f*p+u*n*v-t*h*v)*R,e[10]=(s*f*o-g*a*o+g*n*c-t*f*c-s*n*v+t*a*v)*R,e[11]=(u*a*o-s*h*o-u*n*c+t*h*c+s*n*p-t*a*p)*R,e[12]=S*R,e[13]=(u*f*r-g*h*r+g*n*d-t*f*d-u*n*m+t*h*m)*R,e[14]=(g*a*r-s*f*r-g*n*l+t*f*l+s*n*m-t*a*m)*R,e[15]=(s*h*r-u*a*r+u*n*l-t*h*l-s*n*d+t*a*d)*R,this}scale(e){let t=this.elements,n=e.x,r=e.y,o=e.z;return t[0]*=n,t[4]*=r,t[8]*=o,t[1]*=n,t[5]*=r,t[9]*=o,t[2]*=n,t[6]*=r,t[10]*=o,t[3]*=n,t[7]*=r,t[11]*=o,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),r=Math.sin(t),o=1-n,s=e.x,a=e.y,l=e.z,c=o*s,u=o*a;return this.set(c*s+n,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+n,u*l-r*s,0,c*l-r*a,u*l+r*s,o*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,o,s){return this.set(1,n,o,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){let r=this.elements,o=t._x,s=t._y,a=t._z,l=t._w,c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,g=o*h,f=s*u,m=s*h,v=a*h,y=l*c,x=l*u,_=l*h,S=n.x,M=n.y,R=n.z;return r[0]=(1-(f+v))*S,r[1]=(p+_)*S,r[2]=(g-x)*S,r[3]=0,r[4]=(p-_)*M,r[5]=(1-(d+v))*M,r[6]=(m+y)*M,r[7]=0,r[8]=(g+x)*R,r[9]=(m-y)*R,r[10]=(1-(d+f))*R,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){let r=this.elements,o=Ul.set(r[0],r[1],r[2]).length(),s=Ul.set(r[4],r[5],r[6]).length(),a=Ul.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],vr.copy(this);let l=1/o,c=1/s,u=1/a;return vr.elements[0]*=l,vr.elements[1]*=l,vr.elements[2]*=l,vr.elements[4]*=c,vr.elements[5]*=c,vr.elements[6]*=c,vr.elements[8]*=u,vr.elements[9]*=u,vr.elements[10]*=u,t.setFromRotationMatrix(vr),n.x=o,n.y=s,n.z=a,this}makePerspective(e,t,n,r,o,s){let a=this.elements,l=2*o/(t-e),c=2*o/(n-r),u=(t+e)/(t-e),h=(n+r)/(n-r),d=-(s+o)/(s-o),p=-2*s*o/(s-o);return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,o,s){let a=this.elements,l=1/(t-e),c=1/(n-r),u=1/(s-o),h=(t+e)*l,d=(n+r)*c,p=(s+o)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}},Ul=new H,vr=new An,R3=new H(0,0,0),P3=new H(1,1,1),ws=new H,Wf=new H,Ii=new H,xD=new An,SD=new wa,N3=(()=>{class i{constructor(t=0,n=0,r=0,o=i.DefaultOrder){this.isEuler=!0,this._x=t,this._y=n,this._z=r,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,n,r,o=this._order){return this._x=t,this._y=n,this._z=r,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,n=this._order,r=!0){let o=t.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],g=o[10];switch(n){case"XYZ":this._y=Math.asin(Ai(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,g),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(p,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Ai(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,g),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ai(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-d,g),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Ai(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(p,g),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Ai(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(l,g));break;case"XZY":this._z=Math.asin(-Ai(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,u),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-h,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,n,r){return xD.makeRotationFromQuaternion(t),this.setFromRotationMatrix(xD,n,r)}setFromVector3(t,n=this._order){return this.set(t.x,t.y,t.z,n)}reorder(t){return SD.setFromEuler(this),this.setFromQuaternion(SD,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}return i.DefaultOrder="XYZ",i.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],i})(),vm=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},k3=0,CD=new H,Hl=new wa,To=new An,$f=new H,ed=new H,O3=new H,L3=new wa,ED=new H(1,0,0),MD=new H(0,1,0),DD=new H(0,0,1),F3={type:"added"},ID={type:"removed"},eo=(()=>{class i extends Ms{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:k3++}),this.uuid=pd(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=i.DefaultUp.clone();let t=new H,n=new N3,r=new wa,o=new H(1,1,1);function s(){r.setFromEuler(n,!1)}function a(){n.setFromQuaternion(r,void 0,!1)}n._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new An},normalMatrix:{value:new Zi}}),this.matrix=new An,this.matrixWorld=new An,this.matrixAutoUpdate=i.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new vm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,n){this.quaternion.setFromAxisAngle(t,n)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,n){return Hl.setFromAxisAngle(t,n),this.quaternion.multiply(Hl),this}rotateOnWorldAxis(t,n){return Hl.setFromAxisAngle(t,n),this.quaternion.premultiply(Hl),this}rotateX(t){return this.rotateOnAxis(ED,t)}rotateY(t){return this.rotateOnAxis(MD,t)}rotateZ(t){return this.rotateOnAxis(DD,t)}translateOnAxis(t,n){return CD.copy(t).applyQuaternion(this.quaternion),this.position.add(CD.multiplyScalar(n)),this}translateX(t){return this.translateOnAxis(ED,t)}translateY(t){return this.translateOnAxis(MD,t)}translateZ(t){return this.translateOnAxis(DD,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(To.copy(this.matrixWorld).invert())}lookAt(t,n,r){t.isVector3?$f.copy(t):$f.set(t,n,r);let o=this.parent;this.updateWorldMatrix(!0,!1),ed.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?To.lookAt(ed,$f,this.up):To.lookAt($f,ed,this.up),this.quaternion.setFromRotationMatrix(To),o&&(To.extractRotation(o.matrixWorld),Hl.setFromRotationMatrix(To),this.quaternion.premultiply(Hl.invert()))}add(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(F3)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}let n=this.children.indexOf(t);return n!==-1&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(ID)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let n=this.children[t];n.parent=null,n.dispatchEvent(ID)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),To.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),To.multiply(t.parent.matrixWorld)),t.applyMatrix4(To),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,n){if(this[t]===n)return this;for(let r=0,o=this.children.length;r<o;r++){let s=this.children[r].getObjectByProperty(t,n);if(s!==void 0)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ed,t,O3),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ed,L3,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let n=this.matrixWorld.elements;return t.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(t){t(this);let n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].traverseVisible(t)}traverseAncestors(t){let n=this.parent;n!==null&&(t(n),n.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].updateMatrixWorld(t)}updateWorldMatrix(t,n){let r=this.parent;if(t===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){let o=this.children;for(let s=0,a=o.length;s<a;s++)o[s].updateWorldMatrix(!1,!0)}}toJSON(t){let n=t===void 0||typeof t=="string",r={};n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON()));function s(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=s(t.geometries,this.geometry);let l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){let c=l.shapes;if(Array.isArray(c))for(let u=0,h=c.length;u<h;u++){let d=c[u];s(t.shapes,d)}else s(t.shapes,c)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(s(t.materials,this.material[c]));o.material=l}else o.material=s(t.materials,this.material);if(this.children.length>0){o.children=[];for(let l=0;l<this.children.length;l++)o.children.push(this.children[l].toJSON(t).object)}if(this.animations.length>0){o.animations=[];for(let l=0;l<this.animations.length;l++){let c=this.animations[l];o.animations.push(s(t.animations,c))}}if(n){let l=a(t.geometries),c=a(t.materials),u=a(t.textures),h=a(t.images),d=a(t.shapes),p=a(t.skeletons),g=a(t.animations),f=a(t.nodes);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),u.length>0&&(r.textures=u),h.length>0&&(r.images=h),d.length>0&&(r.shapes=d),p.length>0&&(r.skeletons=p),g.length>0&&(r.animations=g),f.length>0&&(r.nodes=f)}return r.object=o,r;function a(l){let c=[];for(let u in l){let h=l[u];delete h.metadata,c.push(h)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,n=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),n===!0)for(let r=0;r<t.children.length;r++){let o=t.children[r];this.add(o.clone())}return this}}return i.DefaultUp=new H(0,1,0),i.DefaultMatrixAutoUpdate=!0,i})(),yr=new H,Ao=new H,ub=new H,Ro=new H,Gl=new H,ql=new H,TD=new H,db=new H,hb=new H,pb=new H,ld=class i{constructor(e=new H,t=new H,n=new H){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),yr.subVectors(e,t),r.cross(yr);let o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,t,n,r,o){yr.subVectors(r,t),Ao.subVectors(n,t),ub.subVectors(e,t);let s=yr.dot(yr),a=yr.dot(Ao),l=yr.dot(ub),c=Ao.dot(Ao),u=Ao.dot(ub),h=s*c-a*a;if(h===0)return o.set(-2,-1,-1);let d=1/h,p=(c*l-a*u)*d,g=(s*u-a*l)*d;return o.set(1-p-g,g,p)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Ro),Ro.x>=0&&Ro.y>=0&&Ro.x+Ro.y<=1}static getUV(e,t,n,r,o,s,a,l){return this.getBarycoord(e,t,n,r,Ro),l.set(0,0),l.addScaledVector(o,Ro.x),l.addScaledVector(s,Ro.y),l.addScaledVector(a,Ro.z),l}static isFrontFacing(e,t,n,r){return yr.subVectors(n,t),Ao.subVectors(e,t),yr.cross(Ao).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return yr.subVectors(this.c,this.b),Ao.subVectors(this.a,this.b),yr.cross(Ao).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return i.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return i.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,o){return i.getUV(e,this.a,this.b,this.c,t,n,r,o)}containsPoint(e){return i.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return i.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let n=this.a,r=this.b,o=this.c,s,a;Gl.subVectors(r,n),ql.subVectors(o,n),db.subVectors(e,n);let l=Gl.dot(db),c=ql.dot(db);if(l<=0&&c<=0)return t.copy(n);hb.subVectors(e,r);let u=Gl.dot(hb),h=ql.dot(hb);if(u>=0&&h<=u)return t.copy(r);let d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(n).addScaledVector(Gl,s);pb.subVectors(e,o);let p=Gl.dot(pb),g=ql.dot(pb);if(g>=0&&p<=g)return t.copy(o);let f=p*c-l*g;if(f<=0&&c>=0&&g<=0)return a=c/(c-g),t.copy(n).addScaledVector(ql,a);let m=u*g-p*h;if(m<=0&&h-u>=0&&p-g>=0)return TD.subVectors(o,r),a=(h-u)/(h-u+(p-g)),t.copy(r).addScaledVector(TD,a);let v=1/(m+f+d);return s=f*v,a=d*v,t.copy(n).addScaledVector(Gl,s).addScaledVector(ql,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},V3=0,zo=class extends Ms{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:V3++}),this.uuid=pd(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===1;continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(n.blending=this.blending),this.side!==0&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function r(o){let s=[];for(let a in o){let l=o[a];delete l.metadata,s.push(l)}return s}if(t){let o=r(e.textures),s=r(e.images);o.length>0&&(n.textures=o),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,n=null;if(t!==null){let r=t.length;n=new Array(r);for(let o=0;o!==r;++o)n[o]=t[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},ym=class extends zo{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new _t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},pn=new H,Yf=new vt,Ki=class{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,n=0;for(let r=0,o=e.length;r<o;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new _t),t[n++]=s.r,t[n++]=s.g,t[n++]=s.b}return this}copyVector2sArray(e){let t=this.array,n=0;for(let r=0,o=e.length;r<o;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new vt),t[n++]=s.x,t[n++]=s.y}return this}copyVector3sArray(e){let t=this.array,n=0;for(let r=0,o=e.length;r<o;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new H),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z}return this}copyVector4sArray(e){let t=this.array,n=0;for(let r=0,o=e.length;r<o;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new xn),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=s.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Yf.fromBufferAttribute(this,t),Yf.applyMatrix3(e),this.setXY(t,Yf.x,Yf.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)pn.fromBufferAttribute(this,t),pn.applyMatrix3(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)pn.fromBufferAttribute(this,t),pn.applyMatrix4(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)pn.fromBufferAttribute(this,t),pn.applyNormalMatrix(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)pn.fromBufferAttribute(this,t),pn.transformDirection(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==35044&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}},_m=class extends Ki{constructor(e,t,n){super(new Uint16Array(e),t,n)}},bm=class extends Ki{constructor(e,t,n){super(new Uint32Array(e),t,n)}},Tn=class extends Ki{constructor(e,t,n){super(new Float32Array(e),t,n)}},B3=0,$i=new An,fb=new eo,Wl=new H,Ti=new xa,td=new xa,In=new H,to=class i extends Ms{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:B3++}),this.uuid=pd(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vI(e)?bm:_m)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let o=new Zi().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return $i.makeRotationFromQuaternion(e),this.applyMatrix4($i),this}rotateX(e){return $i.makeRotationX(e),this.applyMatrix4($i),this}rotateY(e){return $i.makeRotationY(e),this.applyMatrix4($i),this}rotateZ(e){return $i.makeRotationZ(e),this.applyMatrix4($i),this}translate(e,t,n){return $i.makeTranslation(e,t,n),this.applyMatrix4($i),this}scale(e,t,n){return $i.makeScale(e,t,n),this.applyMatrix4($i),this}lookAt(e){return fb.lookAt(e),fb.updateMatrix(),this.applyMatrix4(fb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wl).negate(),this.translate(Wl.x,Wl.y,Wl.z),this}setFromPoints(e){let t=[];for(let n=0,r=e.length;n<r;n++){let o=e[n];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Tn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new xa);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new H(-1/0,-1/0,-1/0),new H(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){let o=t[n];Ti.setFromBufferAttribute(o),this.morphTargetsRelative?(In.addVectors(this.boundingBox.min,Ti.min),this.boundingBox.expandByPoint(In),In.addVectors(this.boundingBox.max,Ti.max),this.boundingBox.expandByPoint(In)):(this.boundingBox.expandByPoint(Ti.min),this.boundingBox.expandByPoint(Ti.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sa);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new H,1/0);return}if(e){let n=this.boundingSphere.center;if(Ti.setFromBufferAttribute(e),t)for(let o=0,s=t.length;o<s;o++){let a=t[o];td.setFromBufferAttribute(a),this.morphTargetsRelative?(In.addVectors(Ti.min,td.min),Ti.expandByPoint(In),In.addVectors(Ti.max,td.max),Ti.expandByPoint(In)):(Ti.expandByPoint(td.min),Ti.expandByPoint(td.max))}Ti.getCenter(n);let r=0;for(let o=0,s=e.count;o<s;o++)In.fromBufferAttribute(e,o),r=Math.max(r,n.distanceToSquared(In));if(t)for(let o=0,s=t.length;o<s;o++){let a=t[o],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)In.fromBufferAttribute(a,c),l&&(Wl.fromBufferAttribute(e,c),In.add(Wl)),r=Math.max(r,n.distanceToSquared(In))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.array,r=t.position.array,o=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ki(new Float32Array(4*a),4));let l=this.getAttribute("tangent").array,c=[],u=[];for(let L=0;L<a;L++)c[L]=new H,u[L]=new H;let h=new H,d=new H,p=new H,g=new vt,f=new vt,m=new vt,v=new H,y=new H;function x(L,F,U){h.fromArray(r,L*3),d.fromArray(r,F*3),p.fromArray(r,U*3),g.fromArray(s,L*2),f.fromArray(s,F*2),m.fromArray(s,U*2),d.sub(h),p.sub(h),f.sub(g),m.sub(g);let B=1/(f.x*m.y-m.x*f.y);!isFinite(B)||(v.copy(d).multiplyScalar(m.y).addScaledVector(p,-f.y).multiplyScalar(B),y.copy(p).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(B),c[L].add(v),c[F].add(v),c[U].add(v),u[L].add(y),u[F].add(y),u[U].add(y))}let _=this.groups;_.length===0&&(_=[{start:0,count:n.length}]);for(let L=0,F=_.length;L<F;++L){let U=_[L],B=U.start,k=U.count;for(let V=B,O=B+k;V<O;V+=3)x(n[V+0],n[V+1],n[V+2])}let S=new H,M=new H,R=new H,b=new H;function I(L){R.fromArray(o,L*3),b.copy(R);let F=c[L];S.copy(F),S.sub(R.multiplyScalar(R.dot(F))).normalize(),M.crossVectors(b,F);let U=M.dot(u[L])<0?-1:1;l[L*4]=S.x,l[L*4+1]=S.y,l[L*4+2]=S.z,l[L*4+3]=U}for(let L=0,F=_.length;L<F;++L){let U=_[L],B=U.start,k=U.count;for(let V=B,O=B+k;V<O;V+=3)I(n[V+0]),I(n[V+1]),I(n[V+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ki(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,p=n.count;d<p;d++)n.setXYZ(d,0,0,0);let r=new H,o=new H,s=new H,a=new H,l=new H,c=new H,u=new H,h=new H;if(e)for(let d=0,p=e.count;d<p;d+=3){let g=e.getX(d+0),f=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(t,g),o.fromBufferAttribute(t,f),s.fromBufferAttribute(t,m),u.subVectors(s,o),h.subVectors(r,o),u.cross(h),a.fromBufferAttribute(n,g),l.fromBufferAttribute(n,f),c.fromBufferAttribute(n,m),a.add(u),l.add(u),c.add(u),n.setXYZ(g,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z),n.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,p=t.count;d<p;d+=3)r.fromBufferAttribute(t,d+0),o.fromBufferAttribute(t,d+1),s.fromBufferAttribute(t,d+2),u.subVectors(s,o),h.subVectors(r,o),u.cross(h),n.setXYZ(d+0,u.x,u.y,u.z),n.setXYZ(d+1,u.x,u.y,u.z),n.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let r in n){if(e.attributes[r]===void 0)continue;let o=n[r].array,s=e.attributes[r],a=s.array,l=s.itemSize*t,c=Math.min(a.length,o.length-l);for(let u=0,h=l;u<c;u++,h++)o[h]=a[u]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)In.fromBufferAttribute(e,t),In.normalize(),e.setXYZ(t,In.x,In.y,In.z)}toNonIndexed(){function e(a,l){let c=a.array,u=a.itemSize,h=a.normalized,d=new c.constructor(l.length*u),p=0,g=0;for(let f=0,m=l.length;f<m;f++){a.isInterleavedBufferAttribute?p=l[f]*a.data.stride+a.offset:p=l[f]*u;for(let v=0;v<u;v++)d[g++]=c[p++]}return new Ki(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new i,n=this.index.array,r=this.attributes;for(let a in r){let l=r[a],c=e(l,n);t.setAttribute(a,c)}let o=this.morphAttributes;for(let a in o){let l=[],c=o[a];for(let u=0,h=c.length;u<h;u++){let d=c[u],p=e(d,n);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,l=s.length;a<l;a++){let c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let l in n){let c=n[l];e.data.attributes[l]=c.toJSON(e.data)}let r={},o=!1;for(let l in this.morphAttributes){let c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){let p=c[h];u.push(p.toJSON(e.data))}u.length>0&&(r[l]=u,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;n!==null&&this.setIndex(n.clone(t));let r=e.attributes;for(let c in r){let u=r[c];this.setAttribute(c,u.clone(t))}let o=e.morphAttributes;for(let c in o){let u=[],h=o[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let c=0,u=s.length;c<u;c++){let h=s[c];this.addGroup(h.start,h.count,h.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},AD=new An,$l=new Lb,mb=new Sa,xs=new H,Ss=new H,Cs=new H,gb=new H,vb=new H,yb=new H,Zf=new H,Xf=new H,Kf=new H,Qf=new vt,Jf=new vt,em=new vt,_b=new H,tm=new H,Xi=class extends eo{constructor(e=new to,t=new ym){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let n=e[t[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){let s=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}raycast(e,t){let n=this.geometry,r=this.material,o=this.matrixWorld;if(r===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),mb.copy(n.boundingSphere),mb.applyMatrix4(o),e.ray.intersectsSphere(mb)===!1)||(AD.copy(o).invert(),$l.copy(e.ray).applyMatrix4(AD),n.boundingBox!==null&&$l.intersectsBox(n.boundingBox)===!1))return;let s,a=n.index,l=n.attributes.position,c=n.morphAttributes.position,u=n.morphTargetsRelative,h=n.attributes.uv,d=n.attributes.uv2,p=n.groups,g=n.drawRange;if(a!==null)if(Array.isArray(r))for(let f=0,m=p.length;f<m;f++){let v=p[f],y=r[v.materialIndex],x=Math.max(v.start,g.start),_=Math.min(a.count,Math.min(v.start+v.count,g.start+g.count));for(let S=x,M=_;S<M;S+=3){let R=a.getX(S),b=a.getX(S+1),I=a.getX(S+2);s=nm(this,y,e,$l,l,c,u,h,d,R,b,I),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=v.materialIndex,t.push(s))}}else{let f=Math.max(0,g.start),m=Math.min(a.count,g.start+g.count);for(let v=f,y=m;v<y;v+=3){let x=a.getX(v),_=a.getX(v+1),S=a.getX(v+2);s=nm(this,r,e,$l,l,c,u,h,d,x,_,S),s&&(s.faceIndex=Math.floor(v/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(r))for(let f=0,m=p.length;f<m;f++){let v=p[f],y=r[v.materialIndex],x=Math.max(v.start,g.start),_=Math.min(l.count,Math.min(v.start+v.count,g.start+g.count));for(let S=x,M=_;S<M;S+=3){let R=S,b=S+1,I=S+2;s=nm(this,y,e,$l,l,c,u,h,d,R,b,I),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=v.materialIndex,t.push(s))}}else{let f=Math.max(0,g.start),m=Math.min(l.count,g.start+g.count);for(let v=f,y=m;v<y;v+=3){let x=v,_=v+1,S=v+2;s=nm(this,r,e,$l,l,c,u,h,d,x,_,S),s&&(s.faceIndex=Math.floor(v/3),t.push(s))}}}};function z3(i,e,t,n,r,o,s,a){let l;if(e.side===1?l=n.intersectTriangle(s,o,r,!0,a):l=n.intersectTriangle(r,o,s,e.side!==2,a),l===null)return null;tm.copy(a),tm.applyMatrix4(i.matrixWorld);let c=t.ray.origin.distanceTo(tm);return c<t.near||c>t.far?null:{distance:c,point:tm.clone(),object:i}}function nm(i,e,t,n,r,o,s,a,l,c,u,h){xs.fromBufferAttribute(r,c),Ss.fromBufferAttribute(r,u),Cs.fromBufferAttribute(r,h);let d=i.morphTargetInfluences;if(o&&d){Zf.set(0,0,0),Xf.set(0,0,0),Kf.set(0,0,0);for(let g=0,f=o.length;g<f;g++){let m=d[g],v=o[g];m!==0&&(gb.fromBufferAttribute(v,c),vb.fromBufferAttribute(v,u),yb.fromBufferAttribute(v,h),s?(Zf.addScaledVector(gb,m),Xf.addScaledVector(vb,m),Kf.addScaledVector(yb,m)):(Zf.addScaledVector(gb.sub(xs),m),Xf.addScaledVector(vb.sub(Ss),m),Kf.addScaledVector(yb.sub(Cs),m)))}xs.add(Zf),Ss.add(Xf),Cs.add(Kf)}i.isSkinnedMesh&&(i.boneTransform(c,xs),i.boneTransform(u,Ss),i.boneTransform(h,Cs));let p=z3(i,e,t,n,xs,Ss,Cs,_b);if(p){a&&(Qf.fromBufferAttribute(a,c),Jf.fromBufferAttribute(a,u),em.fromBufferAttribute(a,h),p.uv=ld.getUV(_b,xs,Ss,Cs,Qf,Jf,em,new vt)),l&&(Qf.fromBufferAttribute(l,c),Jf.fromBufferAttribute(l,u),em.fromBufferAttribute(l,h),p.uv2=ld.getUV(_b,xs,Ss,Cs,Qf,Jf,em,new vt));let g={a:c,b:u,c:h,normal:new H,materialIndex:0};ld.getNormal(xs,Ss,Cs,g.normal),p.face=g}return p}var ud=class i extends to{constructor(e=1,t=1,n=1,r=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:o,depthSegments:s};let a=this;r=Math.floor(r),o=Math.floor(o),s=Math.floor(s);let l=[],c=[],u=[],h=[],d=0,p=0;g("z","y","x",-1,-1,n,t,e,s,o,0),g("z","y","x",1,-1,n,t,-e,s,o,1),g("x","z","y",1,1,e,n,t,r,s,2),g("x","z","y",1,-1,e,n,-t,r,s,3),g("x","y","z",1,-1,e,t,n,r,o,4),g("x","y","z",-1,-1,e,t,-n,r,o,5),this.setIndex(l),this.setAttribute("position",new Tn(c,3)),this.setAttribute("normal",new Tn(u,3)),this.setAttribute("uv",new Tn(h,2));function g(f,m,v,y,x,_,S,M,R,b,I){let L=_/R,F=S/b,U=_/2,B=S/2,k=M/2,V=R+1,O=b+1,Z=0,K=0,j=new H;for(let $=0;$<O;$++){let ce=$*F-B;for(let W=0;W<V;W++){let le=W*L-U;j[f]=le*y,j[m]=ce*x,j[v]=k,c.push(j.x,j.y,j.z),j[f]=0,j[m]=0,j[v]=M>0?1:-1,u.push(j.x,j.y,j.z),h.push(W/R),h.push(1-$/b),Z+=1}}for(let $=0;$<b;$++)for(let ce=0;ce<R;ce++){let W=d+ce+V*$,le=d+ce+V*($+1),Ee=d+(ce+1)+V*($+1),ht=d+(ce+1)+V*$;l.push(W,le,ht),l.push(le,Ee,ht),K+=6}a.addGroup(p,K,I),p+=K,d+=Z}}static fromJSON(e){return new i(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function ic(i){let e={};for(let t in i){e[t]={};for(let n in i[t]){let r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function $n(i){let e={};for(let t=0;t<i.length;t++){let n=ic(i[t]);for(let r in n)e[r]=n[r]}return e}function j3(i){let e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}var U3={clone:ic,merge:$n},H3=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,G3=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,jo=class extends zo{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=H3,this.fragmentShader=G3,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ic(e.uniforms),this.uniformsGroups=j3(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let n={};for(let r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}},wm=class extends eo{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new An,this.projectionMatrix=new An,this.projectionMatrixInverse=new An}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},ni=class extends wm{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=Nb*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Q_*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Nb*2*Math.atan(Math.tan(Q_*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,o,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Q_*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,o=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let l=s.fullWidth,c=s.fullHeight;o+=s.offsetX*r/l,t-=s.offsetY*n/c,r*=s.width/l,n*=s.height/c}let a=this.filmOffset;a!==0&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Yl=90,Zl=1,Fb=class extends eo{constructor(e,t,n){if(super(),this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;let r=new ni(Yl,Zl,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new H(1,0,0)),this.add(r);let o=new ni(Yl,Zl,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new H(-1,0,0)),this.add(o);let s=new ni(Yl,Zl,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new H(0,1,0)),this.add(s);let a=new ni(Yl,Zl,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new H(0,-1,0)),this.add(a);let l=new ni(Yl,Zl,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new H(0,0,1)),this.add(l);let c=new ni(Yl,Zl,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new H(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();let n=this.renderTarget,[r,o,s,a,l,c]=this.children,u=e.getRenderTarget(),h=e.toneMapping,d=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;let p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=h,e.xr.enabled=d,n.texture.needsPMREMUpdate=!0}},xm=class extends Is{constructor(e,t,n,r,o,s,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:301,super(e,t,n,r,o,s,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Vb=class extends Bo{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new xm(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:1006}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ud(5,5,5),o=new jo({name:"CubemapFromEquirect",uniforms:ic(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});o.uniforms.tEquirect.value=t;let s=new Xi(r,o),a=t.minFilter;return t.minFilter===1008&&(t.minFilter=1006),new Fb(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,r){let o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,r);e.setRenderTarget(o)}},bb=new H,q3=new H,W3=new Zi,Vo=class{constructor(e=new H(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let r=bb.subVectors(n,t).cross(q3.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let n=e.delta(bb),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:t.copy(n).multiplyScalar(o).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||W3.getNormalMatrix(e),r=this.coplanarPoint(bb).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Xl=new Sa,im=new H,dd=class{constructor(e=new Vo,t=new Vo,n=new Vo,r=new Vo,o=new Vo,s=new Vo){this.planes=[e,t,n,r,o,s]}set(e,t,n,r,o,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(o),a[5].copy(s),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=this.planes,n=e.elements,r=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],g=n[10],f=n[11],m=n[12],v=n[13],y=n[14],x=n[15];return t[0].setComponents(a-r,h-l,f-d,x-m).normalize(),t[1].setComponents(a+r,h+l,f+d,x+m).normalize(),t[2].setComponents(a+o,h+c,f+p,x+v).normalize(),t[3].setComponents(a-o,h-c,f-p,x-v).normalize(),t[4].setComponents(a-s,h-u,f-g,x-y).normalize(),t[5].setComponents(a+s,h+u,f+g,x+y).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Xl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Xl)}intersectsSprite(e){return Xl.center.set(0,0,0),Xl.radius=.7071067811865476,Xl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Xl)}intersectsSphere(e){let t=this.planes,n=e.center,r=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let r=t[n];if(im.x=r.normal.x>0?e.max.x:e.min.x,im.y=r.normal.y>0?e.max.y:e.min.y,im.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(im)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function yI(){let i=null,e=!1,t=null,n=null;function r(o,s){t(o,s),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){i=o}}}function $3(i,e){let t=e.isWebGL2,n=new WeakMap;function r(c,u){let h=c.array,d=c.usage,p=i.createBuffer();i.bindBuffer(u,p),i.bufferData(u,h,d),c.onUploadCallback();let g;if(h instanceof Float32Array)g=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(h instanceof Int16Array)g=5122;else if(h instanceof Uint32Array)g=5125;else if(h instanceof Int32Array)g=5124;else if(h instanceof Int8Array)g=5120;else if(h instanceof Uint8Array)g=5121;else if(h instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:g,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function o(c,u,h){let d=u.array,p=u.updateRange;i.bindBuffer(h,c),p.count===-1?i.bufferSubData(h,0,d):(t?i.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):i.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1)}function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=n.get(c);h===void 0?n.set(c,r(c,u)):h.version<c.version&&(o(h.buffer,c,u),h.version=c.version)}return{get:s,remove:a,update:l}}var Sm=class i extends to{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};let o=e/2,s=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,u=l+1,h=e/a,d=t/l,p=[],g=[],f=[],m=[];for(let v=0;v<u;v++){let y=v*d-s;for(let x=0;x<c;x++){let _=x*h-o;g.push(_,-y,0),f.push(0,0,1),m.push(x/a),m.push(1-v/l)}}for(let v=0;v<l;v++)for(let y=0;y<a;y++){let x=y+c*v,_=y+c*(v+1),S=y+1+c*(v+1),M=y+1+c*v;p.push(x,_,M),p.push(_,S,M)}this.setIndex(p),this.setAttribute("position",new Tn(g,3)),this.setAttribute("normal",new Tn(f,3)),this.setAttribute("uv",new Tn(m,2))}static fromJSON(e){return new i(e.width,e.height,e.widthSegments,e.heightSegments)}},Y3=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Z3=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,X3=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,K3=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Q3=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,J3=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,eV="vec3 transformed = vec3( position );",tV=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,nV=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iV=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,rV=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,oV=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,sV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,aV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,lV=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,cV=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,uV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,dV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,hV=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,pV=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,fV=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,mV=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,gV=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,vV=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,yV=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,_V=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,bV="gl_FragColor = linearToOutputTexel( gl_FragColor );",wV=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,xV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,SV=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,CV=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,EV=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,MV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,DV=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,IV=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,TV=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,AV=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,RV=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,PV=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,NV=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,kV=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,OV=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,LV=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,FV=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,VV=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,BV=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,zV=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,jV=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,UV=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,HV=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,GV=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,qV=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,WV=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,$V=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,YV=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,ZV=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,XV=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,KV=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,QV=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,JV=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,eB=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,tB=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,nB=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,iB=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,rB=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,oB=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,sB=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,aB=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,lB=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,cB=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uB=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,dB=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,hB=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,pB=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,fB=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,mB=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,gB=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,vB=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,yB=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,_B=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,bB=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,wB=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,xB=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,SB=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,CB=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,EB=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,MB=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,DB=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,IB=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,TB=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,AB=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,RB=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,PB=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,NB=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,kB=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,OB=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,LB=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,FB=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,VB=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,BB=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,zB=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,jB=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,UB=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,HB=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,GB=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,qB=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,WB=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,$B=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,YB=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ZB=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,XB=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,KB=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,QB=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,JB=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,ez=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tz=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nz=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,iz=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,rz=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oz=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sz=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,az=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,lz=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cz=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,uz=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,dz=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hz=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pz=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fz=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mz=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gz=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vz=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,yz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,_z=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bz=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,wz=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ut={alphamap_fragment:Y3,alphamap_pars_fragment:Z3,alphatest_fragment:X3,alphatest_pars_fragment:K3,aomap_fragment:Q3,aomap_pars_fragment:J3,begin_vertex:eV,beginnormal_vertex:tV,bsdfs:nV,iridescence_fragment:iV,bumpmap_pars_fragment:rV,clipping_planes_fragment:oV,clipping_planes_pars_fragment:sV,clipping_planes_pars_vertex:aV,clipping_planes_vertex:lV,color_fragment:cV,color_pars_fragment:uV,color_pars_vertex:dV,color_vertex:hV,common:pV,cube_uv_reflection_fragment:fV,defaultnormal_vertex:mV,displacementmap_pars_vertex:gV,displacementmap_vertex:vV,emissivemap_fragment:yV,emissivemap_pars_fragment:_V,encodings_fragment:bV,encodings_pars_fragment:wV,envmap_fragment:xV,envmap_common_pars_fragment:SV,envmap_pars_fragment:CV,envmap_pars_vertex:EV,envmap_physical_pars_fragment:LV,envmap_vertex:MV,fog_vertex:DV,fog_pars_vertex:IV,fog_fragment:TV,fog_pars_fragment:AV,gradientmap_pars_fragment:RV,lightmap_fragment:PV,lightmap_pars_fragment:NV,lights_lambert_vertex:kV,lights_pars_begin:OV,lights_toon_fragment:FV,lights_toon_pars_fragment:VV,lights_phong_fragment:BV,lights_phong_pars_fragment:zV,lights_physical_fragment:jV,lights_physical_pars_fragment:UV,lights_fragment_begin:HV,lights_fragment_maps:GV,lights_fragment_end:qV,logdepthbuf_fragment:WV,logdepthbuf_pars_fragment:$V,logdepthbuf_pars_vertex:YV,logdepthbuf_vertex:ZV,map_fragment:XV,map_pars_fragment:KV,map_particle_fragment:QV,map_particle_pars_fragment:JV,metalnessmap_fragment:eB,metalnessmap_pars_fragment:tB,morphcolor_vertex:nB,morphnormal_vertex:iB,morphtarget_pars_vertex:rB,morphtarget_vertex:oB,normal_fragment_begin:sB,normal_fragment_maps:aB,normal_pars_fragment:lB,normal_pars_vertex:cB,normal_vertex:uB,normalmap_pars_fragment:dB,clearcoat_normal_fragment_begin:hB,clearcoat_normal_fragment_maps:pB,clearcoat_pars_fragment:fB,iridescence_pars_fragment:mB,output_fragment:gB,packing:vB,premultiplied_alpha_fragment:yB,project_vertex:_B,dithering_fragment:bB,dithering_pars_fragment:wB,roughnessmap_fragment:xB,roughnessmap_pars_fragment:SB,shadowmap_pars_fragment:CB,shadowmap_pars_vertex:EB,shadowmap_vertex:MB,shadowmask_pars_fragment:DB,skinbase_vertex:IB,skinning_pars_vertex:TB,skinning_vertex:AB,skinnormal_vertex:RB,specularmap_fragment:PB,specularmap_pars_fragment:NB,tonemapping_fragment:kB,tonemapping_pars_fragment:OB,transmission_fragment:LB,transmission_pars_fragment:FB,uv_pars_fragment:VB,uv_pars_vertex:BB,uv_vertex:zB,uv2_pars_fragment:jB,uv2_pars_vertex:UB,uv2_vertex:HB,worldpos_vertex:GB,background_vert:qB,background_frag:WB,cube_vert:$B,cube_frag:YB,depth_vert:ZB,depth_frag:XB,distanceRGBA_vert:KB,distanceRGBA_frag:QB,equirect_vert:JB,equirect_frag:ez,linedashed_vert:tz,linedashed_frag:nz,meshbasic_vert:iz,meshbasic_frag:rz,meshlambert_vert:oz,meshlambert_frag:sz,meshmatcap_vert:az,meshmatcap_frag:lz,meshnormal_vert:cz,meshnormal_frag:uz,meshphong_vert:dz,meshphong_frag:hz,meshphysical_vert:pz,meshphysical_frag:fz,meshtoon_vert:mz,meshtoon_frag:gz,points_vert:vz,points_frag:yz,shadow_vert:_z,shadow_frag:bz,sprite_vert:wz,sprite_frag:xz},me={common:{diffuse:{value:new _t(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Zi},uv2Transform:{value:new Zi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new vt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _t(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new _t(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Zi}},sprite:{diffuse:{value:new _t(16777215)},opacity:{value:1},center:{value:new vt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Zi}}},Jr={basic:{uniforms:$n([me.common,me.specularmap,me.envmap,me.aomap,me.lightmap,me.fog]),vertexShader:ut.meshbasic_vert,fragmentShader:ut.meshbasic_frag},lambert:{uniforms:$n([me.common,me.specularmap,me.envmap,me.aomap,me.lightmap,me.emissivemap,me.fog,me.lights,{emissive:{value:new _t(0)}}]),vertexShader:ut.meshlambert_vert,fragmentShader:ut.meshlambert_frag},phong:{uniforms:$n([me.common,me.specularmap,me.envmap,me.aomap,me.lightmap,me.emissivemap,me.bumpmap,me.normalmap,me.displacementmap,me.fog,me.lights,{emissive:{value:new _t(0)},specular:{value:new _t(1118481)},shininess:{value:30}}]),vertexShader:ut.meshphong_vert,fragmentShader:ut.meshphong_frag},standard:{uniforms:$n([me.common,me.envmap,me.aomap,me.lightmap,me.emissivemap,me.bumpmap,me.normalmap,me.displacementmap,me.roughnessmap,me.metalnessmap,me.fog,me.lights,{emissive:{value:new _t(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ut.meshphysical_vert,fragmentShader:ut.meshphysical_frag},toon:{uniforms:$n([me.common,me.aomap,me.lightmap,me.emissivemap,me.bumpmap,me.normalmap,me.displacementmap,me.gradientmap,me.fog,me.lights,{emissive:{value:new _t(0)}}]),vertexShader:ut.meshtoon_vert,fragmentShader:ut.meshtoon_frag},matcap:{uniforms:$n([me.common,me.bumpmap,me.normalmap,me.displacementmap,me.fog,{matcap:{value:null}}]),vertexShader:ut.meshmatcap_vert,fragmentShader:ut.meshmatcap_frag},points:{uniforms:$n([me.points,me.fog]),vertexShader:ut.points_vert,fragmentShader:ut.points_frag},dashed:{uniforms:$n([me.common,me.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ut.linedashed_vert,fragmentShader:ut.linedashed_frag},depth:{uniforms:$n([me.common,me.displacementmap]),vertexShader:ut.depth_vert,fragmentShader:ut.depth_frag},normal:{uniforms:$n([me.common,me.bumpmap,me.normalmap,me.displacementmap,{opacity:{value:1}}]),vertexShader:ut.meshnormal_vert,fragmentShader:ut.meshnormal_frag},sprite:{uniforms:$n([me.sprite,me.fog]),vertexShader:ut.sprite_vert,fragmentShader:ut.sprite_frag},background:{uniforms:{uvTransform:{value:new Zi},t2D:{value:null}},vertexShader:ut.background_vert,fragmentShader:ut.background_frag},cube:{uniforms:$n([me.envmap,{opacity:{value:1}}]),vertexShader:ut.cube_vert,fragmentShader:ut.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ut.equirect_vert,fragmentShader:ut.equirect_frag},distanceRGBA:{uniforms:$n([me.common,me.displacementmap,{referencePosition:{value:new H},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ut.distanceRGBA_vert,fragmentShader:ut.distanceRGBA_frag},shadow:{uniforms:$n([me.lights,me.fog,{color:{value:new _t(0)},opacity:{value:1}}]),vertexShader:ut.shadow_vert,fragmentShader:ut.shadow_frag}};Jr.physical={uniforms:$n([Jr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new vt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new _t(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new vt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new _t(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new _t(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ut.meshphysical_vert,fragmentShader:ut.meshphysical_frag};function Sz(i,e,t,n,r,o){let s=new _t(0),a=r===!0?0:1,l,c,u=null,h=0,d=null;function p(f,m){let v=!1,y=m.isScene===!0?m.background:null;y&&y.isTexture&&(y=e.get(y));let x=i.xr,_=x.getSession&&x.getSession();_&&_.environmentBlendMode==="additive"&&(y=null),y===null?g(s,a):y&&y.isColor&&(g(y,1),v=!0),(i.autoClear||v)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),y&&(y.isCubeTexture||y.mapping===306)?(c===void 0&&(c=new Xi(new ud(1,1,1),new jo({name:"BackgroundCubeMaterial",uniforms:ic(Jr.cube.uniforms),vertexShader:Jr.cube.vertexShader,fragmentShader:Jr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(S,M,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,(u!==y||h!==y.version||d!==i.toneMapping)&&(c.material.needsUpdate=!0,u=y,h=y.version,d=i.toneMapping),c.layers.enableAll(),f.unshift(c,c.geometry,c.material,0,0,null)):y&&y.isTexture&&(l===void 0&&(l=new Xi(new Sm(2,2),new jo({name:"BackgroundMaterial",uniforms:ic(Jr.background.uniforms),vertexShader:Jr.background.vertexShader,fragmentShader:Jr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=y,y.matrixAutoUpdate===!0&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),(u!==y||h!==y.version||d!==i.toneMapping)&&(l.material.needsUpdate=!0,u=y,h=y.version,d=i.toneMapping),l.layers.enableAll(),f.unshift(l,l.geometry,l.material,0,0,null))}function g(f,m){t.buffers.color.setClear(f.r,f.g,f.b,m,o)}return{getClearColor:function(){return s},setClearColor:function(f,m=1){s.set(f),a=m,g(s,a)},getClearAlpha:function(){return a},setClearAlpha:function(f){a=f,g(s,a)},render:p}}function Cz(i,e,t,n){let r=i.getParameter(34921),o=n.isWebGL2?null:e.get("OES_vertex_array_object"),s=n.isWebGL2||o!==null,a={},l=m(null),c=l,u=!1;function h(k,V,O,Z,K){let j=!1;if(s){let $=f(Z,O,V);c!==$&&(c=$,p(c.object)),j=v(k,Z,O,K),j&&y(k,Z,O,K)}else{let $=V.wireframe===!0;(c.geometry!==Z.id||c.program!==O.id||c.wireframe!==$)&&(c.geometry=Z.id,c.program=O.id,c.wireframe=$,j=!0)}K!==null&&t.update(K,34963),(j||u)&&(u=!1,b(k,V,O,Z),K!==null&&i.bindBuffer(34963,t.get(K).buffer))}function d(){return n.isWebGL2?i.createVertexArray():o.createVertexArrayOES()}function p(k){return n.isWebGL2?i.bindVertexArray(k):o.bindVertexArrayOES(k)}function g(k){return n.isWebGL2?i.deleteVertexArray(k):o.deleteVertexArrayOES(k)}function f(k,V,O){let Z=O.wireframe===!0,K=a[k.id];K===void 0&&(K={},a[k.id]=K);let j=K[V.id];j===void 0&&(j={},K[V.id]=j);let $=j[Z];return $===void 0&&($=m(d()),j[Z]=$),$}function m(k){let V=[],O=[],Z=[];for(let K=0;K<r;K++)V[K]=0,O[K]=0,Z[K]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:O,attributeDivisors:Z,object:k,attributes:{},index:null}}function v(k,V,O,Z){let K=c.attributes,j=V.attributes,$=0,ce=O.getAttributes();for(let W in ce)if(ce[W].location>=0){let le=K[W],Ee=j[W];if(Ee===void 0&&(W==="instanceMatrix"&&k.instanceMatrix&&(Ee=k.instanceMatrix),W==="instanceColor"&&k.instanceColor&&(Ee=k.instanceColor)),le===void 0||le.attribute!==Ee||Ee&&le.data!==Ee.data)return!0;$++}return c.attributesNum!==$||c.index!==Z}function y(k,V,O,Z){let K={},j=V.attributes,$=0,ce=O.getAttributes();for(let W in ce)if(ce[W].location>=0){let le=j[W];le===void 0&&(W==="instanceMatrix"&&k.instanceMatrix&&(le=k.instanceMatrix),W==="instanceColor"&&k.instanceColor&&(le=k.instanceColor));let Ee={};Ee.attribute=le,le&&le.data&&(Ee.data=le.data),K[W]=Ee,$++}c.attributes=K,c.attributesNum=$,c.index=Z}function x(){let k=c.newAttributes;for(let V=0,O=k.length;V<O;V++)k[V]=0}function _(k){S(k,0)}function S(k,V){let O=c.newAttributes,Z=c.enabledAttributes,K=c.attributeDivisors;O[k]=1,Z[k]===0&&(i.enableVertexAttribArray(k),Z[k]=1),K[k]!==V&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](k,V),K[k]=V)}function M(){let k=c.newAttributes,V=c.enabledAttributes;for(let O=0,Z=V.length;O<Z;O++)V[O]!==k[O]&&(i.disableVertexAttribArray(O),V[O]=0)}function R(k,V,O,Z,K,j){n.isWebGL2===!0&&(O===5124||O===5125)?i.vertexAttribIPointer(k,V,O,K,j):i.vertexAttribPointer(k,V,O,Z,K,j)}function b(k,V,O,Z){if(n.isWebGL2===!1&&(k.isInstancedMesh||Z.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();let K=Z.attributes,j=O.getAttributes(),$=V.defaultAttributeValues;for(let ce in j){let W=j[ce];if(W.location>=0){let le=K[ce];if(le===void 0&&(ce==="instanceMatrix"&&k.instanceMatrix&&(le=k.instanceMatrix),ce==="instanceColor"&&k.instanceColor&&(le=k.instanceColor)),le!==void 0){let Ee=le.normalized,ht=le.itemSize,te=t.get(le);if(te===void 0)continue;let wt=te.buffer,We=te.type,Xe=te.bytesPerElement;if(le.isInterleavedBufferAttribute){let xe=le.data,$t=xe.stride,lt=le.offset;if(xe.isInstancedInterleavedBuffer){for(let Fe=0;Fe<W.locationSize;Fe++)S(W.location+Fe,xe.meshPerAttribute);k.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let Fe=0;Fe<W.locationSize;Fe++)_(W.location+Fe);i.bindBuffer(34962,wt);for(let Fe=0;Fe<W.locationSize;Fe++)R(W.location+Fe,ht/W.locationSize,We,Ee,$t*Xe,(lt+ht/W.locationSize*Fe)*Xe)}else{if(le.isInstancedBufferAttribute){for(let xe=0;xe<W.locationSize;xe++)S(W.location+xe,le.meshPerAttribute);k.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let xe=0;xe<W.locationSize;xe++)_(W.location+xe);i.bindBuffer(34962,wt);for(let xe=0;xe<W.locationSize;xe++)R(W.location+xe,ht/W.locationSize,We,Ee,ht*Xe,ht/W.locationSize*xe*Xe)}}else if($!==void 0){let Ee=$[ce];if(Ee!==void 0)switch(Ee.length){case 2:i.vertexAttrib2fv(W.location,Ee);break;case 3:i.vertexAttrib3fv(W.location,Ee);break;case 4:i.vertexAttrib4fv(W.location,Ee);break;default:i.vertexAttrib1fv(W.location,Ee)}}}}M()}function I(){U();for(let k in a){let V=a[k];for(let O in V){let Z=V[O];for(let K in Z)g(Z[K].object),delete Z[K];delete V[O]}delete a[k]}}function L(k){if(a[k.id]===void 0)return;let V=a[k.id];for(let O in V){let Z=V[O];for(let K in Z)g(Z[K].object),delete Z[K];delete V[O]}delete a[k.id]}function F(k){for(let V in a){let O=a[V];if(O[k.id]===void 0)continue;let Z=O[k.id];for(let K in Z)g(Z[K].object),delete Z[K];delete O[k.id]}}function U(){B(),u=!0,c!==l&&(c=l,p(c.object))}function B(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:U,resetDefaultState:B,dispose:I,releaseStatesOfGeometry:L,releaseStatesOfProgram:F,initAttributes:x,enableAttribute:_,disableUnusedAttributes:M}}function Ez(i,e,t,n){let r=n.isWebGL2,o;function s(c){o=c}function a(c,u){i.drawArrays(o,c,u),t.update(u,o,1)}function l(c,u,h){if(h===0)return;let d,p;if(r)d=i,p="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](o,c,u,h),t.update(u,o,h)}this.setMode=s,this.render=a,this.renderInstances=l}function Mz(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){let R=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function o(R){if(R==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";R="mediump"}return R==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext,a=t.precision!==void 0?t.precision:"highp",l=o(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);let c=s||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=i.getParameter(34930),d=i.getParameter(35660),p=i.getParameter(3379),g=i.getParameter(34076),f=i.getParameter(34921),m=i.getParameter(36347),v=i.getParameter(36348),y=i.getParameter(36349),x=d>0,_=s||e.has("OES_texture_float"),S=x&&_,M=s?i.getParameter(36183):0;return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:o,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:g,maxAttributes:f,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:S,maxSamples:M}}function Dz(i){let e=this,t=null,n=0,r=!1,o=!1,s=new Vo,a=new Zi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d,p){let g=h.length!==0||d||n!==0||r;return r=d,t=u(h,p,0),n=h.length,g},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(h,d,p){let g=h.clippingPlanes,f=h.clipIntersection,m=h.clipShadows,v=i.get(h);if(!r||g===null||g.length===0||o&&!m)o?u(null):c();else{let y=o?0:n,x=y*4,_=v.clippingState||null;l.value=_,_=u(g,d,x,p);for(let S=0;S!==x;++S)_[S]=t[S];v.clippingState=_,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,d,p,g){let f=h!==null?h.length:0,m=null;if(f!==0){if(m=l.value,g!==!0||m===null){let v=p+f*4,y=d.matrixWorldInverse;a.getNormalMatrix(y),(m===null||m.length<v)&&(m=new Float32Array(v));for(let x=0,_=p;x!==f;++x,_+=4)s.copy(h[x]).applyMatrix4(y,a),s.normal.toArray(m,_),m[_+3]=s.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=f,e.numIntersection=0,m}}function Iz(i){let e=new WeakMap;function t(s,a){return a===303?s.mapping=301:a===304&&(s.mapping=302),s}function n(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){let a=s.mapping;if(a===303||a===304)if(e.has(s)){let l=e.get(s).texture;return t(l,s.mapping)}else{let l=s.image;if(l&&l.height>0){let c=new Vb(l.height/2);return c.fromEquirectangularTexture(i,s),e.set(s,c),s.addEventListener("dispose",r),t(c.texture,s.mapping)}else return null}}return s}function r(s){let a=s.target;a.removeEventListener("dispose",r);let l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}var Bb=class extends wm{constructor(e=-1,t=1,n=1,r=-1,o=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=o,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,o,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,o=n-e,s=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=c*this.view.offsetX,s=o+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(o,s,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},ec=4,RD=[.125,.215,.35,.446,.526,.582],ga=20,wb=new Bb,PD=new _t,xb=null,ma=(1+Math.sqrt(5))/2,Kl=1/ma,ND=[new H(1,1,1),new H(-1,1,1),new H(1,1,-1),new H(-1,1,-1),new H(0,ma,Kl),new H(0,ma,-Kl),new H(Kl,0,ma),new H(-Kl,0,ma),new H(ma,Kl,0),new H(-ma,Kl,0)],Cm=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){xb=this._renderer.getRenderTarget(),this._setSize(256);let o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=LD(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=OD(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xb),e.scissorTest=!1,rm(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===301||e.mapping===302?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),xb=this._renderer.getRenderTarget();let n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,encoding:3e3,depthBuffer:!1},r=kD(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=kD(e,t,n);let{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Tz(o)),this._blurMaterial=Az(o,e,t)}return r}_compileMaterial(e){let t=new Xi(this._lodPlanes[0],e);this._renderer.compile(t,wb)}_sceneToCubeUV(e,t,n,r){let o=new ni(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(PD),l.toneMapping=0,l.autoClear=!1;let h=new ym({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Xi(new ud,h),p=!1,g=e.background;g?g.isColor&&(h.color.copy(g),e.background=null,p=!0):(h.color.copy(PD),p=!0);for(let f=0;f<6;f++){let m=f%3;m===0?(o.up.set(0,s[f],0),o.lookAt(a[f],0,0)):m===1?(o.up.set(0,0,s[f]),o.lookAt(0,a[f],0)):(o.up.set(0,s[f],0),o.lookAt(0,0,a[f]));let v=this._cubeSize;rm(r,m*v,f>2?v:0,v,v),l.setRenderTarget(r),p&&l.render(d,o),l.render(e,o)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=c,e.background=g}_textureToCubeUV(e,t){let n=this._renderer,r=e.mapping===301||e.mapping===302;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=LD()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=OD());let o=r?this._cubemapMaterial:this._equirectMaterial,s=new Xi(this._lodPlanes[0],o),a=o.uniforms;a.envMap.value=e;let l=this._cubeSize;rm(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(s,wb)}_applyPMREM(e){let t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=ND[(r-1)%ND.length];this._blur(e,r-1,r,o,s)}t.autoClear=n}_blur(e,t,n,r,o){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,r,"latitudinal",o),this._halfBlur(s,e,n,n,r,"longitudinal",o)}_halfBlur(e,t,n,r,o,s,a){let l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,h=new Xi(this._lodPlanes[r],c),d=c.uniforms,p=this._sizeLods[n]-1,g=isFinite(o)?Math.PI/(2*p):2*Math.PI/(2*ga-1),f=o/g,m=isFinite(o)?1+Math.floor(u*f):ga;m>ga&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${ga}`);let v=[],y=0;for(let R=0;R<ga;++R){let b=R/f,I=Math.exp(-b*b/2);v.push(I),R===0?y+=I:R<m&&(y+=2*I)}for(let R=0;R<v.length;R++)v[R]=v[R]/y;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=v,d.latitudinal.value=s==="latitudinal",a&&(d.poleAxis.value=a);let{_lodMax:x}=this;d.dTheta.value=g,d.mipInt.value=x-n;let _=this._sizeLods[r],S=3*_*(r>x-ec?r-x+ec:0),M=4*(this._cubeSize-_);rm(t,S,M,3*_,2*_),l.setRenderTarget(t),l.render(h,wb)}};function Tz(i){let e=[],t=[],n=[],r=i,o=i-ec+1+RD.length;for(let s=0;s<o;s++){let a=Math.pow(2,r);t.push(a);let l=1/a;s>i-ec?l=RD[s-i+ec-1]:s===0&&(l=0),n.push(l);let c=1/(a-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,g=6,f=3,m=2,v=1,y=new Float32Array(f*g*p),x=new Float32Array(m*g*p),_=new Float32Array(v*g*p);for(let M=0;M<p;M++){let R=M%3*2/3-1,b=M>2?0:-1,I=[R,b,0,R+2/3,b,0,R+2/3,b+1,0,R,b,0,R+2/3,b+1,0,R,b+1,0];y.set(I,f*g*M),x.set(d,m*g*M);let L=[M,M,M,M,M,M];_.set(L,v*g*M)}let S=new to;S.setAttribute("position",new Ki(y,f)),S.setAttribute("uv",new Ki(x,m)),S.setAttribute("faceIndex",new Ki(_,v)),e.push(S),r>ec&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function kD(i,e,t){let n=new Bo(i,e,t);return n.texture.mapping=306,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function rm(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function Az(i,e,t){let n=new Float32Array(ga),r=new H(0,1,0);return new jo({name:"SphericalGaussianBlur",defines:{n:ga,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:xw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function OD(){return new jo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:xw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function LD(){return new jo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:xw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function xw(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Rz(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){let l=a.mapping,c=l===303||l===304,u=l===301||l===302;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new Cm(i)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{let h=a.image;if(c&&h&&h.height>0||u&&h&&r(h)){t===null&&(t=new Cm(i));let d=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",o),d.texture}else return null}}}return a}function r(a){let l=0,c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function o(a){let l=a.target;l.removeEventListener("dispose",o);let c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:s}}function Pz(i){let e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){let r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Nz(i,e,t,n){let r={},o=new WeakMap;function s(h){let d=h.target;d.index!==null&&e.remove(d.index);for(let g in d.attributes)e.remove(d.attributes[g]);d.removeEventListener("dispose",s),delete r[d.id];let p=o.get(d);p&&(e.remove(p),o.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",s),r[d.id]=!0,t.memory.geometries++),d}function l(h){let d=h.attributes;for(let g in d)e.update(d[g],34962);let p=h.morphAttributes;for(let g in p){let f=p[g];for(let m=0,v=f.length;m<v;m++)e.update(f[m],34962)}}function c(h){let d=[],p=h.index,g=h.attributes.position,f=0;if(p!==null){let y=p.array;f=p.version;for(let x=0,_=y.length;x<_;x+=3){let S=y[x+0],M=y[x+1],R=y[x+2];d.push(S,M,M,R,R,S)}}else{let y=g.array;f=g.version;for(let x=0,_=y.length/3-1;x<_;x+=3){let S=x+0,M=x+1,R=x+2;d.push(S,M,M,R,R,S)}}let m=new(vI(d)?bm:_m)(d,1);m.version=f;let v=o.get(h);v&&e.remove(v),o.set(h,m)}function u(h){let d=o.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return o.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function kz(i,e,t,n){let r=n.isWebGL2,o;function s(d){o=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function u(d,p){i.drawElements(o,p,a,d*l),t.update(p,o,1)}function h(d,p,g){if(g===0)return;let f,m;if(r)f=i,m="drawElementsInstanced";else if(f=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",f===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[m](o,p,a,d*l,g),t.update(p,o,g)}this.setMode=s,this.setIndex=c,this.render=u,this.renderInstances=h}function Oz(i){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,s,a){switch(t.calls++,s){case 4:t.triangles+=a*(o/3);break;case 1:t.lines+=a*(o/2);break;case 3:t.lines+=a*(o-1);break;case 2:t.lines+=a*o;break;case 0:t.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function Lz(i,e){return i[0]-e[0]}function Fz(i,e){return Math.abs(e[1])-Math.abs(i[1])}function Sb(i,e){let t=1,n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?t=127:n instanceof Uint8Array?t=255:n instanceof Uint16Array?t=65535:n instanceof Int16Array?t=32767:n instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),i.divideScalar(t)}function Vz(i,e,t){let n={},r=new Float32Array(8),o=new WeakMap,s=new xn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h,d){let p=c.morphTargetInfluences;if(e.isWebGL2===!0){let g=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=g!==void 0?g.length:0,m=o.get(u);if(m===void 0||m.count!==f){let x=function(){k.dispose(),o.delete(u),u.removeEventListener("dispose",x)};m!==void 0&&m.texture.dispose();let _=u.morphAttributes.position!==void 0,S=u.morphAttributes.normal!==void 0,M=u.morphAttributes.color!==void 0,R=u.morphAttributes.position||[],b=u.morphAttributes.normal||[],I=u.morphAttributes.color||[],L=0;_===!0&&(L=1),S===!0&&(L=2),M===!0&&(L=3);let F=u.attributes.position.count*L,U=1;F>e.maxTextureSize&&(U=Math.ceil(F/e.maxTextureSize),F=e.maxTextureSize);let B=new Float32Array(F*U*4*f),k=new gm(B,F,U,f);k.type=1015,k.needsUpdate=!0;let V=L*4;for(let O=0;O<f;O++){let Z=R[O],K=b[O],j=I[O],$=F*U*4*O;for(let ce=0;ce<Z.count;ce++){let W=ce*V;_===!0&&(s.fromBufferAttribute(Z,ce),Z.normalized===!0&&Sb(s,Z),B[$+W+0]=s.x,B[$+W+1]=s.y,B[$+W+2]=s.z,B[$+W+3]=0),S===!0&&(s.fromBufferAttribute(K,ce),K.normalized===!0&&Sb(s,K),B[$+W+4]=s.x,B[$+W+5]=s.y,B[$+W+6]=s.z,B[$+W+7]=0),M===!0&&(s.fromBufferAttribute(j,ce),j.normalized===!0&&Sb(s,j),B[$+W+8]=s.x,B[$+W+9]=s.y,B[$+W+10]=s.z,B[$+W+11]=j.itemSize===4?s.w:1)}}m={count:f,texture:k,size:new vt(F,U)},o.set(u,m),u.addEventListener("dispose",x)}let v=0;for(let x=0;x<p.length;x++)v+=p[x];let y=u.morphTargetsRelative?1:1-v;d.getUniforms().setValue(i,"morphTargetBaseInfluence",y),d.getUniforms().setValue(i,"morphTargetInfluences",p),d.getUniforms().setValue(i,"morphTargetsTexture",m.texture,t),d.getUniforms().setValue(i,"morphTargetsTextureSize",m.size)}else{let g=p===void 0?0:p.length,f=n[u.id];if(f===void 0||f.length!==g){f=[];for(let _=0;_<g;_++)f[_]=[_,0];n[u.id]=f}for(let _=0;_<g;_++){let S=f[_];S[0]=_,S[1]=p[_]}f.sort(Fz);for(let _=0;_<8;_++)_<g&&f[_][1]?(a[_][0]=f[_][0],a[_][1]=f[_][1]):(a[_][0]=Number.MAX_SAFE_INTEGER,a[_][1]=0);a.sort(Lz);let m=u.morphAttributes.position,v=u.morphAttributes.normal,y=0;for(let _=0;_<8;_++){let S=a[_],M=S[0],R=S[1];M!==Number.MAX_SAFE_INTEGER&&R?(m&&u.getAttribute("morphTarget"+_)!==m[M]&&u.setAttribute("morphTarget"+_,m[M]),v&&u.getAttribute("morphNormal"+_)!==v[M]&&u.setAttribute("morphNormal"+_,v[M]),r[_]=R,y+=R):(m&&u.hasAttribute("morphTarget"+_)===!0&&u.deleteAttribute("morphTarget"+_),v&&u.hasAttribute("morphNormal"+_)===!0&&u.deleteAttribute("morphNormal"+_),r[_]=0)}let x=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(i,"morphTargetBaseInfluence",x),d.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function Bz(i,e,t,n){let r=new WeakMap;function o(l){let c=n.render.frame,u=l.geometry,h=e.get(l,u);return r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),h}function s(){r=new WeakMap}function a(l){let c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:o,dispose:s}}var _I=new Is,bI=new gm,wI=new Ob,xI=new xm,FD=[],VD=[],BD=new Float32Array(16),zD=new Float32Array(9),jD=new Float32Array(4);function oc(i,e,t){let n=i[0];if(n<=0||n>0)return i;let r=e*t,o=FD[r];if(o===void 0&&(o=new Float32Array(r),FD[r]=o),e!==0){n.toArray(o,0);for(let s=1,a=0;s!==e;++s)a+=t,i[s].toArray(o,a)}return o}function ri(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function oi(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Om(i,e){let t=VD[e];t===void 0&&(t=new Int32Array(e),VD[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function zz(i,e){let t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function jz(i,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ri(t,e))return;i.uniform2fv(this.addr,e),oi(t,e)}}function Uz(i,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ri(t,e))return;i.uniform3fv(this.addr,e),oi(t,e)}}function Hz(i,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ri(t,e))return;i.uniform4fv(this.addr,e),oi(t,e)}}function Gz(i,e){let t=this.cache,n=e.elements;if(n===void 0){if(ri(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),oi(t,e)}else{if(ri(t,n))return;jD.set(n),i.uniformMatrix2fv(this.addr,!1,jD),oi(t,n)}}function qz(i,e){let t=this.cache,n=e.elements;if(n===void 0){if(ri(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),oi(t,e)}else{if(ri(t,n))return;zD.set(n),i.uniformMatrix3fv(this.addr,!1,zD),oi(t,n)}}function Wz(i,e){let t=this.cache,n=e.elements;if(n===void 0){if(ri(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),oi(t,e)}else{if(ri(t,n))return;BD.set(n),i.uniformMatrix4fv(this.addr,!1,BD),oi(t,n)}}function $z(i,e){let t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function Yz(i,e){let t=this.cache;ri(t,e)||(i.uniform2iv(this.addr,e),oi(t,e))}function Zz(i,e){let t=this.cache;ri(t,e)||(i.uniform3iv(this.addr,e),oi(t,e))}function Xz(i,e){let t=this.cache;ri(t,e)||(i.uniform4iv(this.addr,e),oi(t,e))}function Kz(i,e){let t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function Qz(i,e){let t=this.cache;ri(t,e)||(i.uniform2uiv(this.addr,e),oi(t,e))}function Jz(i,e){let t=this.cache;ri(t,e)||(i.uniform3uiv(this.addr,e),oi(t,e))}function e4(i,e){let t=this.cache;ri(t,e)||(i.uniform4uiv(this.addr,e),oi(t,e))}function t4(i,e,t){let n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2D(e||_I,r)}function n4(i,e,t){let n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||wI,r)}function i4(i,e,t){let n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||xI,r)}function r4(i,e,t){let n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||bI,r)}function o4(i){switch(i){case 5126:return zz;case 35664:return jz;case 35665:return Uz;case 35666:return Hz;case 35674:return Gz;case 35675:return qz;case 35676:return Wz;case 5124:case 35670:return $z;case 35667:case 35671:return Yz;case 35668:case 35672:return Zz;case 35669:case 35673:return Xz;case 5125:return Kz;case 36294:return Qz;case 36295:return Jz;case 36296:return e4;case 35678:case 36198:case 36298:case 36306:case 35682:return t4;case 35679:case 36299:case 36307:return n4;case 35680:case 36300:case 36308:case 36293:return i4;case 36289:case 36303:case 36311:case 36292:return r4}}function s4(i,e){i.uniform1fv(this.addr,e)}function a4(i,e){let t=oc(e,this.size,2);i.uniform2fv(this.addr,t)}function l4(i,e){let t=oc(e,this.size,3);i.uniform3fv(this.addr,t)}function c4(i,e){let t=oc(e,this.size,4);i.uniform4fv(this.addr,t)}function u4(i,e){let t=oc(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function d4(i,e){let t=oc(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function h4(i,e){let t=oc(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function p4(i,e){i.uniform1iv(this.addr,e)}function f4(i,e){i.uniform2iv(this.addr,e)}function m4(i,e){i.uniform3iv(this.addr,e)}function g4(i,e){i.uniform4iv(this.addr,e)}function v4(i,e){i.uniform1uiv(this.addr,e)}function y4(i,e){i.uniform2uiv(this.addr,e)}function _4(i,e){i.uniform3uiv(this.addr,e)}function b4(i,e){i.uniform4uiv(this.addr,e)}function w4(i,e,t){let n=e.length,r=Om(t,n);i.uniform1iv(this.addr,r);for(let o=0;o!==n;++o)t.setTexture2D(e[o]||_I,r[o])}function x4(i,e,t){let n=e.length,r=Om(t,n);i.uniform1iv(this.addr,r);for(let o=0;o!==n;++o)t.setTexture3D(e[o]||wI,r[o])}function S4(i,e,t){let n=e.length,r=Om(t,n);i.uniform1iv(this.addr,r);for(let o=0;o!==n;++o)t.setTextureCube(e[o]||xI,r[o])}function C4(i,e,t){let n=e.length,r=Om(t,n);i.uniform1iv(this.addr,r);for(let o=0;o!==n;++o)t.setTexture2DArray(e[o]||bI,r[o])}function E4(i){switch(i){case 5126:return s4;case 35664:return a4;case 35665:return l4;case 35666:return c4;case 35674:return u4;case 35675:return d4;case 35676:return h4;case 5124:case 35670:return p4;case 35667:case 35671:return f4;case 35668:case 35672:return m4;case 35669:case 35673:return g4;case 5125:return v4;case 36294:return y4;case 36295:return _4;case 36296:return b4;case 35678:case 36198:case 36298:case 36306:case 35682:return w4;case 35679:case 36299:case 36307:return x4;case 35680:case 36300:case 36308:case 36293:return S4;case 36289:case 36303:case 36311:case 36292:return C4}}var zb=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=o4(t.type)}},jb=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=E4(t.type)}},Ub=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){let r=this.seq;for(let o=0,s=r.length;o!==s;++o){let a=r[o];a.setValue(e,t[a.id],n)}}},Cb=/(\w+)(\])?(\[|\.)?/g;function UD(i,e){i.seq.push(e),i.map[e.id]=e}function M4(i,e,t){let n=i.name,r=n.length;for(Cb.lastIndex=0;;){let o=Cb.exec(n),s=Cb.lastIndex,a=o[1],l=o[2]==="]",c=o[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===r){UD(t,c===void 0?new zb(a,i,e):new jb(a,i,e));break}else{let u=t.map[a];u===void 0&&(u=new Ub(a),UD(t,u)),t=u}}}var nc=class{constructor(e,t){this.seq=[],this.map={};let n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){let o=e.getActiveUniform(t,r),s=e.getUniformLocation(t,o.name);M4(o,s,this)}}setValue(e,t,n,r){let o=this.map[t];o!==void 0&&o.setValue(e,n,r)}setOptional(e,t,n){let r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let o=0,s=t.length;o!==s;++o){let a=t[o],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){let n=[];for(let r=0,o=e.length;r!==o;++r){let s=e[r];s.id in t&&n.push(s)}return n}};function HD(i,e,t){let n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}var D4=0;function I4(i,e){let t=i.split(`
`),n=[],r=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let s=r;s<o;s++){let a=s+1;n.push(`${a===e?">":" "} ${a}: ${t[s]}`)}return n.join(`
`)}function T4(i){switch(i){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function GD(i,e,t){let n=i.getShaderParameter(e,35713),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";let o=/ERROR: 0:(\d+)/.exec(r);if(o){let s=parseInt(o[1]);return t.toUpperCase()+`

`+r+`

`+I4(i.getShaderSource(e),s)}else return r}function A4(i,e){let t=T4(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function R4(i,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function P4(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(sd).join(`
`)}function N4(i){let e=[];for(let t in i){let n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function k4(i,e){let t={},n=i.getProgramParameter(e,35721);for(let r=0;r<n;r++){let o=i.getActiveAttrib(e,r),s=o.name,a=1;o.type===35674&&(a=2),o.type===35675&&(a=3),o.type===35676&&(a=4),t[s]={type:o.type,location:i.getAttribLocation(e,s),locationSize:a}}return t}function sd(i){return i!==""}function qD(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function WD(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var O4=/^[ \t]*#include +<([\w\d./]+)>/gm;function Hb(i){return i.replace(O4,L4)}function L4(i,e){let t=ut[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Hb(t)}var F4=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,V4=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function $D(i){return i.replace(V4,SI).replace(F4,B4)}function B4(i,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),SI(i,e,t,n)}function SI(i,e,t,n){let r="";for(let o=parseInt(e);o<parseInt(t);o++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function YD(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function z4(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===1?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===2?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===3&&(e="SHADOWMAP_TYPE_VSM"),e}function j4(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV";break}return e}function U4(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case 302:e="ENVMAP_MODE_REFRACTION";break}return e}function H4(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD";break}return e}function G4(i){let e=i.envMapCubeUVHeight;if(e===null)return null;let t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function q4(i,e,t,n){let r=i.getContext(),o=t.defines,s=t.vertexShader,a=t.fragmentShader,l=z4(t),c=j4(t),u=U4(t),h=H4(t),d=G4(t),p=t.isWebGL2?"":P4(t),g=N4(o),f=r.createProgram(),m,v,y=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=[g].filter(sd).join(`
`),m.length>0&&(m+=`
`),v=[p,g].filter(sd).join(`
`),v.length>0&&(v+=`
`)):(m=[YD(t),"#define SHADER_NAME "+t.shaderName,g,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(sd).join(`
`),v=[p,YD(t),"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==0?"#define TONE_MAPPING":"",t.toneMapping!==0?ut.tonemapping_pars_fragment:"",t.toneMapping!==0?R4("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ut.encodings_pars_fragment,A4("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(sd).join(`
`)),s=Hb(s),s=qD(s,t),s=WD(s,t),a=Hb(a),a=qD(a,t),a=WD(a,t),s=$D(s),a=$D(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",t.glslVersion===vD?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===vD?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+m+s,_=y+v+a,S=HD(r,35633,x),M=HD(r,35632,_);if(r.attachShader(f,S),r.attachShader(f,M),t.index0AttributeName!==void 0?r.bindAttribLocation(f,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(f,0,"position"),r.linkProgram(f),i.debug.checkShaderErrors){let I=r.getProgramInfoLog(f).trim(),L=r.getShaderInfoLog(S).trim(),F=r.getShaderInfoLog(M).trim(),U=!0,B=!0;if(r.getProgramParameter(f,35714)===!1){U=!1;let k=GD(r,S,"vertex"),V=GD(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(f,35715)+`

Program Info Log: `+I+`
`+k+`
`+V)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(L===""||F==="")&&(B=!1);B&&(this.diagnostics={runnable:U,programLog:I,vertexShader:{log:L,prefix:m},fragmentShader:{log:F,prefix:v}})}r.deleteShader(S),r.deleteShader(M);let R;this.getUniforms=function(){return R===void 0&&(R=new nc(r,f)),R};let b;return this.getAttributes=function(){return b===void 0&&(b=k4(r,f)),b},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(f),this.program=void 0},this.name=t.shaderName,this.id=D4++,this.cacheKey=e,this.usedTimes=1,this.program=f,this.vertexShader=S,this.fragmentShader=M,this}var W4=0,Gb=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),o=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(o)===!1&&(s.add(o),o.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){let t=this.shaderCache;if(t.has(e)===!1){let n=new qb(e);t.set(e,n)}return t.get(e)}},qb=class{constructor(e){this.id=W4++,this.code=e,this.usedTimes=0}};function $4(i,e,t,n,r,o,s){let a=new vm,l=new Gb,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures,p=r.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(b,I,L,F,U){let B=F.fog,k=U.geometry,V=b.isMeshStandardMaterial?F.environment:null,O=(b.isMeshStandardMaterial?t:e).get(b.envMap||V),Z=O&&O.mapping===306?O.image.height:null,K=g[b.type];b.precision!==null&&(p=r.getMaxPrecision(b.precision),p!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",p,"instead."));let j=k.morphAttributes.position||k.morphAttributes.normal||k.morphAttributes.color,$=j!==void 0?j.length:0,ce=0;k.morphAttributes.position!==void 0&&(ce=1),k.morphAttributes.normal!==void 0&&(ce=2),k.morphAttributes.color!==void 0&&(ce=3);let W,le,Ee,ht;if(K){let xe=Jr[K];W=xe.vertexShader,le=xe.fragmentShader}else W=b.vertexShader,le=b.fragmentShader,l.update(b),Ee=l.getVertexShaderID(b),ht=l.getFragmentShaderID(b);let te=i.getRenderTarget(),wt=b.alphaTest>0,We=b.clearcoat>0,Xe=b.iridescence>0;return{isWebGL2:u,shaderID:K,shaderName:b.type,vertexShader:W,fragmentShader:le,defines:b.defines,customVertexShaderID:Ee,customFragmentShaderID:ht,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:p,instancing:U.isInstancedMesh===!0,instancingColor:U.isInstancedMesh===!0&&U.instanceColor!==null,supportsVertexTextures:d,outputEncoding:te===null?i.outputEncoding:te.isXRRenderTarget===!0?te.texture.encoding:3e3,map:!!b.map,matcap:!!b.matcap,envMap:!!O,envMapMode:O&&O.mapping,envMapCubeUVHeight:Z,lightMap:!!b.lightMap,aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===1,tangentSpaceNormalMap:b.normalMapType===0,decodeVideoTexture:!!b.map&&b.map.isVideoTexture===!0&&b.map.encoding===3001,clearcoat:We,clearcoatMap:We&&!!b.clearcoatMap,clearcoatRoughnessMap:We&&!!b.clearcoatRoughnessMap,clearcoatNormalMap:We&&!!b.clearcoatNormalMap,iridescence:Xe,iridescenceMap:Xe&&!!b.iridescenceMap,iridescenceThicknessMap:Xe&&!!b.iridescenceThicknessMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,specularIntensityMap:!!b.specularIntensityMap,specularColorMap:!!b.specularColorMap,opaque:b.transparent===!1&&b.blending===1,alphaMap:!!b.alphaMap,alphaTest:wt,gradientMap:!!b.gradientMap,sheen:b.sheen>0,sheenColorMap:!!b.sheenColorMap,sheenRoughnessMap:!!b.sheenRoughnessMap,transmission:b.transmission>0,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:!!b.normalMap&&!!k.attributes.tangent,vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&!!k.attributes.color&&k.attributes.color.itemSize===4,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.iridescenceMap||!!b.iridescenceThicknessMap||!!b.displacementMap||!!b.transmissionMap||!!b.thicknessMap||!!b.specularIntensityMap||!!b.specularColorMap||!!b.sheenColorMap||!!b.sheenRoughnessMap,uvsVertexOnly:!(b.map||b.bumpMap||b.normalMap||b.specularMap||b.alphaMap||b.emissiveMap||b.roughnessMap||b.metalnessMap||b.clearcoatNormalMap||b.iridescenceMap||b.iridescenceThicknessMap||b.transmission>0||b.transmissionMap||b.thicknessMap||b.specularIntensityMap||b.specularColorMap||b.sheen>0||b.sheenColorMap||b.sheenRoughnessMap)&&!!b.displacementMap,fog:!!B,useFog:b.fog===!0,fogExp2:B&&B.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:h,skinning:U.isSkinnedMesh===!0,morphTargets:k.morphAttributes.position!==void 0,morphNormals:k.morphAttributes.normal!==void 0,morphColors:k.morphAttributes.color!==void 0,morphTargetsCount:$,morphTextureStride:ce,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:b.dithering,shadowMapEnabled:i.shadowMap.enabled&&L.length>0,shadowMapType:i.shadowMap.type,toneMapping:b.toneMapped?i.toneMapping:0,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,doubleSided:b.side===2,flipSided:b.side===1,useDepthPacking:!!b.depthPacking,depthPacking:b.depthPacking||0,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}}function m(b){let I=[];if(b.shaderID?I.push(b.shaderID):(I.push(b.customVertexShaderID),I.push(b.customFragmentShaderID)),b.defines!==void 0)for(let L in b.defines)I.push(L),I.push(b.defines[L]);return b.isRawShaderMaterial===!1&&(v(I,b),y(I,b),I.push(i.outputEncoding)),I.push(b.customProgramCacheKey),I.join()}function v(b,I){b.push(I.precision),b.push(I.outputEncoding),b.push(I.envMapMode),b.push(I.envMapCubeUVHeight),b.push(I.combine),b.push(I.vertexUvs),b.push(I.fogExp2),b.push(I.sizeAttenuation),b.push(I.morphTargetsCount),b.push(I.morphAttributeCount),b.push(I.numDirLights),b.push(I.numPointLights),b.push(I.numSpotLights),b.push(I.numHemiLights),b.push(I.numRectAreaLights),b.push(I.numDirLightShadows),b.push(I.numPointLightShadows),b.push(I.numSpotLightShadows),b.push(I.shadowMapType),b.push(I.toneMapping),b.push(I.numClippingPlanes),b.push(I.numClipIntersection),b.push(I.depthPacking)}function y(b,I){a.disableAll(),I.isWebGL2&&a.enable(0),I.supportsVertexTextures&&a.enable(1),I.instancing&&a.enable(2),I.instancingColor&&a.enable(3),I.map&&a.enable(4),I.matcap&&a.enable(5),I.envMap&&a.enable(6),I.lightMap&&a.enable(7),I.aoMap&&a.enable(8),I.emissiveMap&&a.enable(9),I.bumpMap&&a.enable(10),I.normalMap&&a.enable(11),I.objectSpaceNormalMap&&a.enable(12),I.tangentSpaceNormalMap&&a.enable(13),I.clearcoat&&a.enable(14),I.clearcoatMap&&a.enable(15),I.clearcoatRoughnessMap&&a.enable(16),I.clearcoatNormalMap&&a.enable(17),I.iridescence&&a.enable(18),I.iridescenceMap&&a.enable(19),I.iridescenceThicknessMap&&a.enable(20),I.displacementMap&&a.enable(21),I.specularMap&&a.enable(22),I.roughnessMap&&a.enable(23),I.metalnessMap&&a.enable(24),I.gradientMap&&a.enable(25),I.alphaMap&&a.enable(26),I.alphaTest&&a.enable(27),I.vertexColors&&a.enable(28),I.vertexAlphas&&a.enable(29),I.vertexUvs&&a.enable(30),I.vertexTangents&&a.enable(31),I.uvsVertexOnly&&a.enable(32),I.fog&&a.enable(33),b.push(a.mask),a.disableAll(),I.useFog&&a.enable(0),I.flatShading&&a.enable(1),I.logarithmicDepthBuffer&&a.enable(2),I.skinning&&a.enable(3),I.morphTargets&&a.enable(4),I.morphNormals&&a.enable(5),I.morphColors&&a.enable(6),I.premultipliedAlpha&&a.enable(7),I.shadowMapEnabled&&a.enable(8),I.physicallyCorrectLights&&a.enable(9),I.doubleSided&&a.enable(10),I.flipSided&&a.enable(11),I.useDepthPacking&&a.enable(12),I.dithering&&a.enable(13),I.specularIntensityMap&&a.enable(14),I.specularColorMap&&a.enable(15),I.transmission&&a.enable(16),I.transmissionMap&&a.enable(17),I.thicknessMap&&a.enable(18),I.sheen&&a.enable(19),I.sheenColorMap&&a.enable(20),I.sheenRoughnessMap&&a.enable(21),I.decodeVideoTexture&&a.enable(22),I.opaque&&a.enable(23),b.push(a.mask)}function x(b){let I=g[b.type],L;if(I){let F=Jr[I];L=U3.clone(F.uniforms)}else L=b.uniforms;return L}function _(b,I){let L;for(let F=0,U=c.length;F<U;F++){let B=c[F];if(B.cacheKey===I){L=B,++L.usedTimes;break}}return L===void 0&&(L=new q4(i,I,b,o),c.push(L)),L}function S(b){if(--b.usedTimes===0){let I=c.indexOf(b);c[I]=c[c.length-1],c.pop(),b.destroy()}}function M(b){l.remove(b)}function R(){l.dispose()}return{getParameters:f,getProgramCacheKey:m,getUniforms:x,acquireProgram:_,releaseProgram:S,releaseShaderCache:M,programs:c,dispose:R}}function Y4(){let i=new WeakMap;function e(o){let s=i.get(o);return s===void 0&&(s={},i.set(o,s)),s}function t(o){i.delete(o)}function n(o,s,a){i.get(o)[s]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function Z4(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function ZD(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function XD(){let i=[],e=0,t=[],n=[],r=[];function o(){e=0,t.length=0,n.length=0,r.length=0}function s(h,d,p,g,f,m){let v=i[e];return v===void 0?(v={id:h.id,object:h,geometry:d,material:p,groupOrder:g,renderOrder:h.renderOrder,z:f,group:m},i[e]=v):(v.id=h.id,v.object=h,v.geometry=d,v.material=p,v.groupOrder=g,v.renderOrder=h.renderOrder,v.z=f,v.group=m),e++,v}function a(h,d,p,g,f,m){let v=s(h,d,p,g,f,m);p.transmission>0?n.push(v):p.transparent===!0?r.push(v):t.push(v)}function l(h,d,p,g,f,m){let v=s(h,d,p,g,f,m);p.transmission>0?n.unshift(v):p.transparent===!0?r.unshift(v):t.unshift(v)}function c(h,d){t.length>1&&t.sort(h||Z4),n.length>1&&n.sort(d||ZD),r.length>1&&r.sort(d||ZD)}function u(){for(let h=e,d=i.length;h<d;h++){let p=i[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:n,transparent:r,init:o,push:a,unshift:l,finish:u,sort:c}}function X4(){let i=new WeakMap;function e(n,r){let o;return i.has(n)===!1?(o=new XD,i.set(n,[o])):r>=i.get(n).length?(o=new XD,i.get(n).push(o)):o=i.get(n)[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function K4(){let i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new H,color:new _t};break;case"SpotLight":t={position:new H,direction:new H,color:new _t,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new H,color:new _t,distance:0,decay:0};break;case"HemisphereLight":t={direction:new H,skyColor:new _t,groundColor:new _t};break;case"RectAreaLight":t={color:new _t,position:new H,halfWidth:new H,halfHeight:new H};break}return i[e.id]=t,t}}}function Q4(){let i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}var J4=0;function ej(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function tj(i,e){let t=new K4,n=Q4(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)r.probe.push(new H);let o=new H,s=new An,a=new An;function l(u,h){let d=0,p=0,g=0;for(let I=0;I<9;I++)r.probe[I].set(0,0,0);let f=0,m=0,v=0,y=0,x=0,_=0,S=0,M=0;u.sort(ej);let R=h!==!0?Math.PI:1;for(let I=0,L=u.length;I<L;I++){let F=u[I],U=F.color,B=F.intensity,k=F.distance,V=F.shadow&&F.shadow.map?F.shadow.map.texture:null;if(F.isAmbientLight)d+=U.r*B*R,p+=U.g*B*R,g+=U.b*B*R;else if(F.isLightProbe)for(let O=0;O<9;O++)r.probe[O].addScaledVector(F.sh.coefficients[O],B);else if(F.isDirectionalLight){let O=t.get(F);if(O.color.copy(F.color).multiplyScalar(F.intensity*R),F.castShadow){let Z=F.shadow,K=n.get(F);K.shadowBias=Z.bias,K.shadowNormalBias=Z.normalBias,K.shadowRadius=Z.radius,K.shadowMapSize=Z.mapSize,r.directionalShadow[f]=K,r.directionalShadowMap[f]=V,r.directionalShadowMatrix[f]=F.shadow.matrix,_++}r.directional[f]=O,f++}else if(F.isSpotLight){let O=t.get(F);if(O.position.setFromMatrixPosition(F.matrixWorld),O.color.copy(U).multiplyScalar(B*R),O.distance=k,O.coneCos=Math.cos(F.angle),O.penumbraCos=Math.cos(F.angle*(1-F.penumbra)),O.decay=F.decay,F.castShadow){let Z=F.shadow,K=n.get(F);K.shadowBias=Z.bias,K.shadowNormalBias=Z.normalBias,K.shadowRadius=Z.radius,K.shadowMapSize=Z.mapSize,r.spotShadow[v]=K,r.spotShadowMap[v]=V,r.spotShadowMatrix[v]=F.shadow.matrix,M++}r.spot[v]=O,v++}else if(F.isRectAreaLight){let O=t.get(F);O.color.copy(U).multiplyScalar(B),O.halfWidth.set(F.width*.5,0,0),O.halfHeight.set(0,F.height*.5,0),r.rectArea[y]=O,y++}else if(F.isPointLight){let O=t.get(F);if(O.color.copy(F.color).multiplyScalar(F.intensity*R),O.distance=F.distance,O.decay=F.decay,F.castShadow){let Z=F.shadow,K=n.get(F);K.shadowBias=Z.bias,K.shadowNormalBias=Z.normalBias,K.shadowRadius=Z.radius,K.shadowMapSize=Z.mapSize,K.shadowCameraNear=Z.camera.near,K.shadowCameraFar=Z.camera.far,r.pointShadow[m]=K,r.pointShadowMap[m]=V,r.pointShadowMatrix[m]=F.shadow.matrix,S++}r.point[m]=O,m++}else if(F.isHemisphereLight){let O=t.get(F);O.skyColor.copy(F.color).multiplyScalar(B*R),O.groundColor.copy(F.groundColor).multiplyScalar(B*R),r.hemi[x]=O,x++}}y>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=me.LTC_FLOAT_1,r.rectAreaLTC2=me.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=me.LTC_HALF_1,r.rectAreaLTC2=me.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=p,r.ambient[2]=g;let b=r.hash;(b.directionalLength!==f||b.pointLength!==m||b.spotLength!==v||b.rectAreaLength!==y||b.hemiLength!==x||b.numDirectionalShadows!==_||b.numPointShadows!==S||b.numSpotShadows!==M)&&(r.directional.length=f,r.spot.length=v,r.rectArea.length=y,r.point.length=m,r.hemi.length=x,r.directionalShadow.length=_,r.directionalShadowMap.length=_,r.pointShadow.length=S,r.pointShadowMap.length=S,r.spotShadow.length=M,r.spotShadowMap.length=M,r.directionalShadowMatrix.length=_,r.pointShadowMatrix.length=S,r.spotShadowMatrix.length=M,b.directionalLength=f,b.pointLength=m,b.spotLength=v,b.rectAreaLength=y,b.hemiLength=x,b.numDirectionalShadows=_,b.numPointShadows=S,b.numSpotShadows=M,r.version=J4++)}function c(u,h){let d=0,p=0,g=0,f=0,m=0,v=h.matrixWorldInverse;for(let y=0,x=u.length;y<x;y++){let _=u[y];if(_.isDirectionalLight){let S=r.directional[d];S.direction.setFromMatrixPosition(_.matrixWorld),o.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(o),S.direction.transformDirection(v),d++}else if(_.isSpotLight){let S=r.spot[g];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(v),S.direction.setFromMatrixPosition(_.matrixWorld),o.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(o),S.direction.transformDirection(v),g++}else if(_.isRectAreaLight){let S=r.rectArea[f];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(v),a.identity(),s.copy(_.matrixWorld),s.premultiply(v),a.extractRotation(s),S.halfWidth.set(_.width*.5,0,0),S.halfHeight.set(0,_.height*.5,0),S.halfWidth.applyMatrix4(a),S.halfHeight.applyMatrix4(a),f++}else if(_.isPointLight){let S=r.point[p];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(v),p++}else if(_.isHemisphereLight){let S=r.hemi[m];S.direction.setFromMatrixPosition(_.matrixWorld),S.direction.transformDirection(v),m++}}}return{setup:l,setupView:c,state:r}}function KD(i,e){let t=new tj(i,e),n=[],r=[];function o(){n.length=0,r.length=0}function s(u){n.push(u)}function a(u){r.push(u)}function l(u){t.setup(n,u)}function c(u){t.setupView(n,u)}return{init:o,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:s,pushShadow:a}}function nj(i,e){let t=new WeakMap;function n(o,s=0){let a;return t.has(o)===!1?(a=new KD(i,e),t.set(o,[a])):s>=t.get(o).length?(a=new KD(i,e),t.get(o).push(a)):a=t.get(o)[s],a}function r(){t=new WeakMap}return{get:n,dispose:r}}var Wb=class extends zo{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},$b=class extends zo{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new H,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},ij=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,rj=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function oj(i,e,t){let n=new dd,r=new vt,o=new vt,s=new xn,a=new Wb({depthPacking:3201}),l=new $b,c={},u=t.maxTextureSize,h={0:1,1:0,2:2},d=new jo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new vt},radius:{value:4}},vertexShader:ij,fragmentShader:rj}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let g=new to;g.setAttribute("position",new Ki(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let f=new Xi(g,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(_,S,M){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||_.length===0)return;let R=i.getRenderTarget(),b=i.getActiveCubeFace(),I=i.getActiveMipmapLevel(),L=i.state;L.setBlending(0),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);for(let F=0,U=_.length;F<U;F++){let B=_[F],k=B.shadow;if(k===void 0){console.warn("THREE.WebGLShadowMap:",B,"has no shadow.");continue}if(k.autoUpdate===!1&&k.needsUpdate===!1)continue;r.copy(k.mapSize);let V=k.getFrameExtents();if(r.multiply(V),o.copy(k.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/V.x),r.x=o.x*V.x,k.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/V.y),r.y=o.y*V.y,k.mapSize.y=o.y)),k.map===null){let Z=this.type!==3?{minFilter:1003,magFilter:1003}:{};k.map=new Bo(r.x,r.y,Z),k.map.texture.name=B.name+".shadowMap",k.camera.updateProjectionMatrix()}i.setRenderTarget(k.map),i.clear();let O=k.getViewportCount();for(let Z=0;Z<O;Z++){let K=k.getViewport(Z);s.set(o.x*K.x,o.y*K.y,o.x*K.z,o.y*K.w),L.viewport(s),k.updateMatrices(B,Z),n=k.getFrustum(),x(S,M,k.camera,B,this.type)}k.isPointLightShadow!==!0&&this.type===3&&v(k,M),k.needsUpdate=!1}m.needsUpdate=!1,i.setRenderTarget(R,b,I)};function v(_,S){let M=e.update(f);d.defines.VSM_SAMPLES!==_.blurSamples&&(d.defines.VSM_SAMPLES=_.blurSamples,p.defines.VSM_SAMPLES=_.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),_.mapPass===null&&(_.mapPass=new Bo(r.x,r.y)),d.uniforms.shadow_pass.value=_.map.texture,d.uniforms.resolution.value=_.mapSize,d.uniforms.radius.value=_.radius,i.setRenderTarget(_.mapPass),i.clear(),i.renderBufferDirect(S,null,M,d,f,null),p.uniforms.shadow_pass.value=_.mapPass.texture,p.uniforms.resolution.value=_.mapSize,p.uniforms.radius.value=_.radius,i.setRenderTarget(_.map),i.clear(),i.renderBufferDirect(S,null,M,p,f,null)}function y(_,S,M,R,b,I){let L=null,F=M.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(F!==void 0?L=F:L=M.isPointLight===!0?l:a,i.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0){let U=L.uuid,B=S.uuid,k=c[U];k===void 0&&(k={},c[U]=k);let V=k[B];V===void 0&&(V=L.clone(),k[B]=V),L=V}return L.visible=S.visible,L.wireframe=S.wireframe,I===3?L.side=S.shadowSide!==null?S.shadowSide:S.side:L.side=S.shadowSide!==null?S.shadowSide:h[S.side],L.alphaMap=S.alphaMap,L.alphaTest=S.alphaTest,L.clipShadows=S.clipShadows,L.clippingPlanes=S.clippingPlanes,L.clipIntersection=S.clipIntersection,L.displacementMap=S.displacementMap,L.displacementScale=S.displacementScale,L.displacementBias=S.displacementBias,L.wireframeLinewidth=S.wireframeLinewidth,L.linewidth=S.linewidth,M.isPointLight===!0&&L.isMeshDistanceMaterial===!0&&(L.referencePosition.setFromMatrixPosition(M.matrixWorld),L.nearDistance=R,L.farDistance=b),L}function x(_,S,M,R,b){if(_.visible===!1)return;if(_.layers.test(S.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&b===3)&&(!_.frustumCulled||n.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,_.matrixWorld);let L=e.update(_),F=_.material;if(Array.isArray(F)){let U=L.groups;for(let B=0,k=U.length;B<k;B++){let V=U[B],O=F[V.materialIndex];if(O&&O.visible){let Z=y(_,O,R,M.near,M.far,b);i.renderBufferDirect(M,null,L,Z,_,V)}}}else if(F.visible){let U=y(_,F,R,M.near,M.far,b);i.renderBufferDirect(M,null,L,U,_,null)}}let I=_.children;for(let L=0,F=I.length;L<F;L++)x(I[L],S,M,R,b)}}function sj(i,e,t){let n=t.isWebGL2;function r(){let z=!1,be=new xn,J=null,Se=new xn(0,0,0,0);return{setMask:function(fe){J!==fe&&!z&&(i.colorMask(fe,fe,fe,fe),J=fe)},setLocked:function(fe){z=fe},setClear:function(fe,Vt,Sn,rn,Uo){Uo===!0&&(fe*=rn,Vt*=rn,Sn*=rn),be.set(fe,Vt,Sn,rn),Se.equals(be)===!1&&(i.clearColor(fe,Vt,Sn,rn),Se.copy(be))},reset:function(){z=!1,J=null,Se.set(-1,0,0,0)}}}function o(){let z=!1,be=null,J=null,Se=null;return{setTest:function(fe){fe?wt(2929):We(2929)},setMask:function(fe){be!==fe&&!z&&(i.depthMask(fe),be=fe)},setFunc:function(fe){if(J!==fe){if(fe)switch(fe){case 0:i.depthFunc(512);break;case 1:i.depthFunc(519);break;case 2:i.depthFunc(513);break;case 3:i.depthFunc(515);break;case 4:i.depthFunc(514);break;case 5:i.depthFunc(518);break;case 6:i.depthFunc(516);break;case 7:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);J=fe}},setLocked:function(fe){z=fe},setClear:function(fe){Se!==fe&&(i.clearDepth(fe),Se=fe)},reset:function(){z=!1,be=null,J=null,Se=null}}}function s(){let z=!1,be=null,J=null,Se=null,fe=null,Vt=null,Sn=null,rn=null,Uo=null;return{setTest:function(Xt){z||(Xt?wt(2960):We(2960))},setMask:function(Xt){be!==Xt&&!z&&(i.stencilMask(Xt),be=Xt)},setFunc:function(Xt,io,Pi){(J!==Xt||Se!==io||fe!==Pi)&&(i.stencilFunc(Xt,io,Pi),J=Xt,Se=io,fe=Pi)},setOp:function(Xt,io,Pi){(Vt!==Xt||Sn!==io||rn!==Pi)&&(i.stencilOp(Xt,io,Pi),Vt=Xt,Sn=io,rn=Pi)},setLocked:function(Xt){z=Xt},setClear:function(Xt){Uo!==Xt&&(i.clearStencil(Xt),Uo=Xt)},reset:function(){z=!1,be=null,J=null,Se=null,fe=null,Vt=null,Sn=null,rn=null,Uo=null}}}let a=new r,l=new o,c=new s,u=new WeakMap,h=new WeakMap,d={},p={},g=new WeakMap,f=[],m=null,v=!1,y=null,x=null,_=null,S=null,M=null,R=null,b=null,I=!1,L=null,F=null,U=null,B=null,k=null,V=i.getParameter(35661),O=!1,Z=0,K=i.getParameter(7938);K.indexOf("WebGL")!==-1?(Z=parseFloat(/^WebGL (\d)/.exec(K)[1]),O=Z>=1):K.indexOf("OpenGL ES")!==-1&&(Z=parseFloat(/^OpenGL ES (\d)/.exec(K)[1]),O=Z>=2);let j=null,$={},ce=i.getParameter(3088),W=i.getParameter(2978),le=new xn().fromArray(ce),Ee=new xn().fromArray(W);function ht(z,be,J){let Se=new Uint8Array(4),fe=i.createTexture();i.bindTexture(z,fe),i.texParameteri(z,10241,9728),i.texParameteri(z,10240,9728);for(let Vt=0;Vt<J;Vt++)i.texImage2D(be+Vt,0,6408,1,1,0,6408,5121,Se);return fe}let te={};te[3553]=ht(3553,3553,1),te[34067]=ht(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),wt(2929),l.setFunc(3),Yn(!1),br(1),wt(2884),Rn(0);function wt(z){d[z]!==!0&&(i.enable(z),d[z]=!0)}function We(z){d[z]!==!1&&(i.disable(z),d[z]=!1)}function Xe(z,be){return p[z]!==be?(i.bindFramebuffer(z,be),p[z]=be,n&&(z===36009&&(p[36160]=be),z===36160&&(p[36009]=be)),!0):!1}function xe(z,be){let J=f,Se=!1;if(z)if(J=g.get(be),J===void 0&&(J=[],g.set(be,J)),z.isWebGLMultipleRenderTargets){let fe=z.texture;if(J.length!==fe.length||J[0]!==36064){for(let Vt=0,Sn=fe.length;Vt<Sn;Vt++)J[Vt]=36064+Vt;J.length=fe.length,Se=!0}}else J[0]!==36064&&(J[0]=36064,Se=!0);else J[0]!==1029&&(J[0]=1029,Se=!0);Se&&(t.isWebGL2?i.drawBuffers(J):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(J))}function $t(z){return m!==z?(i.useProgram(z),m=z,!0):!1}let lt={100:32774,101:32778,102:32779};if(n)lt[103]=32775,lt[104]=32776;else{let z=e.get("EXT_blend_minmax");z!==null&&(lt[103]=z.MIN_EXT,lt[104]=z.MAX_EXT)}let Fe={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function Rn(z,be,J,Se,fe,Vt,Sn,rn){if(z===0){v===!0&&(We(3042),v=!1);return}if(v===!1&&(wt(3042),v=!0),z!==5){if(z!==y||rn!==I){if((x!==100||M!==100)&&(i.blendEquation(32774),x=100,M=100),rn)switch(z){case 1:i.blendFuncSeparate(1,771,1,771);break;case 2:i.blendFunc(1,1);break;case 3:i.blendFuncSeparate(0,769,0,1);break;case 4:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",z);break}else switch(z){case 1:i.blendFuncSeparate(770,771,1,771);break;case 2:i.blendFunc(770,1);break;case 3:i.blendFuncSeparate(0,769,0,1);break;case 4:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",z);break}_=null,S=null,R=null,b=null,y=z,I=rn}return}fe=fe||be,Vt=Vt||J,Sn=Sn||Se,(be!==x||fe!==M)&&(i.blendEquationSeparate(lt[be],lt[fe]),x=be,M=fe),(J!==_||Se!==S||Vt!==R||Sn!==b)&&(i.blendFuncSeparate(Fe[J],Fe[Se],Fe[Vt],Fe[Sn]),_=J,S=Se,R=Vt,b=Sn),y=z,I=null}function gi(z,be){z.side===2?We(2884):wt(2884);let J=z.side===1;be&&(J=!J),Yn(J),z.blending===1&&z.transparent===!1?Rn(0):Rn(z.blending,z.blendEquation,z.blendSrc,z.blendDst,z.blendEquationAlpha,z.blendSrcAlpha,z.blendDstAlpha,z.premultipliedAlpha),l.setFunc(z.depthFunc),l.setTest(z.depthTest),l.setMask(z.depthWrite),a.setMask(z.colorWrite);let Se=z.stencilWrite;c.setTest(Se),Se&&(c.setMask(z.stencilWriteMask),c.setFunc(z.stencilFunc,z.stencilRef,z.stencilFuncMask),c.setOp(z.stencilFail,z.stencilZFail,z.stencilZPass)),kt(z.polygonOffset,z.polygonOffsetFactor,z.polygonOffsetUnits),z.alphaToCoverage===!0?wt(32926):We(32926)}function Yn(z){L!==z&&(z?i.frontFace(2304):i.frontFace(2305),L=z)}function br(z){z!==0?(wt(2884),z!==F&&(z===1?i.cullFace(1029):z===2?i.cullFace(1028):i.cullFace(1032))):We(2884),F=z}function Pn(z){z!==U&&(O&&i.lineWidth(z),U=z)}function kt(z,be,J){z?(wt(32823),(B!==be||k!==J)&&(i.polygonOffset(be,J),B=be,k=J)):We(32823)}function no(z){z?wt(3089):We(3089)}function wr(z){z===void 0&&(z=33984+V-1),j!==z&&(i.activeTexture(z),j=z)}function N(z,be){j===null&&wr();let J=$[j];J===void 0&&(J={type:void 0,texture:void 0},$[j]=J),(J.type!==z||J.texture!==be)&&(i.bindTexture(z,be||te[z]),J.type=z,J.texture=be)}function D(){let z=$[j];z!==void 0&&z.type!==void 0&&(i.bindTexture(z.type,null),z.type=void 0,z.texture=void 0)}function ee(){try{i.compressedTexImage2D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function de(){try{i.texSubImage2D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function pe(){try{i.texSubImage3D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function ge(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function Ke(){try{i.texStorage2D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function Q(){try{i.texStorage3D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function Oe(){try{i.texImage2D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function Me(){try{i.texImage3D.apply(i,arguments)}catch(z){console.error("THREE.WebGLState:",z)}}function Ae(z){le.equals(z)===!1&&(i.scissor(z.x,z.y,z.z,z.w),le.copy(z))}function De(z){Ee.equals(z)===!1&&(i.viewport(z.x,z.y,z.z,z.w),Ee.copy(z))}function ot(z,be){let J=h.get(be);J===void 0&&(J=new WeakMap,h.set(be,J));let Se=J.get(z);Se===void 0&&(Se=i.getUniformBlockIndex(be,z.name),J.set(z,Se))}function Ct(z,be){let J=h.get(be).get(z);u.get(z)!==J&&(i.uniformBlockBinding(be,J,z.__bindingPointIndex),u.set(z,J))}function nn(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},j=null,$={},p={},g=new WeakMap,f=[],m=null,v=!1,y=null,x=null,_=null,S=null,M=null,R=null,b=null,I=!1,L=null,F=null,U=null,B=null,k=null,le.set(0,0,i.canvas.width,i.canvas.height),Ee.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:wt,disable:We,bindFramebuffer:Xe,drawBuffers:xe,useProgram:$t,setBlending:Rn,setMaterial:gi,setFlipSided:Yn,setCullFace:br,setLineWidth:Pn,setPolygonOffset:kt,setScissorTest:no,activeTexture:wr,bindTexture:N,unbindTexture:D,compressedTexImage2D:ee,texImage2D:Oe,texImage3D:Me,updateUBOMapping:ot,uniformBlockBinding:Ct,texStorage2D:Ke,texStorage3D:Q,texSubImage2D:de,texSubImage3D:pe,compressedTexSubImage2D:ge,scissor:Ae,viewport:De,reset:nn}}function aj(i,e,t,n,r,o,s){let a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,f,m=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(N,D){return v?new OffscreenCanvas(N,D):pm("canvas")}function x(N,D,ee,de){let pe=1;if((N.width>de||N.height>de)&&(pe=de/Math.max(N.width,N.height)),pe<1||D===!0)if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap){let ge=D?kb:Math.floor,Ke=ge(pe*N.width),Q=ge(pe*N.height);f===void 0&&(f=y(Ke,Q));let Oe=ee?y(Ke,Q):f;return Oe.width=Ke,Oe.height=Q,Oe.getContext("2d").drawImage(N,0,0,Ke,Q),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+N.width+"x"+N.height+") to ("+Ke+"x"+Q+")."),Oe}else return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+N.width+"x"+N.height+")."),N;return N}function _(N){return yD(N.width)&&yD(N.height)}function S(N){return a?!1:N.wrapS!==1001||N.wrapT!==1001||N.minFilter!==1003&&N.minFilter!==1006}function M(N,D){return N.generateMipmaps&&D&&N.minFilter!==1003&&N.minFilter!==1006}function R(N){i.generateMipmap(N)}function b(N,D,ee,de,pe=!1){if(a===!1)return D;if(N!==null){if(i[N]!==void 0)return i[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}let ge=D;return D===6403&&(ee===5126&&(ge=33326),ee===5131&&(ge=33325),ee===5121&&(ge=33321)),D===33319&&(ee===5126&&(ge=33328),ee===5131&&(ge=33327),ee===5121&&(ge=33323)),D===6408&&(ee===5126&&(ge=34836),ee===5131&&(ge=34842),ee===5121&&(ge=de===3001&&pe===!1?35907:32856),ee===32819&&(ge=32854),ee===32820&&(ge=32855)),(ge===33325||ge===33326||ge===33327||ge===33328||ge===34842||ge===34836)&&e.get("EXT_color_buffer_float"),ge}function I(N,D,ee){return M(N,ee)===!0||N.isFramebufferTexture&&N.minFilter!==1003&&N.minFilter!==1006?Math.log2(Math.max(D.width,D.height))+1:N.mipmaps!==void 0&&N.mipmaps.length>0?N.mipmaps.length:N.isCompressedTexture&&Array.isArray(N.image)?D.mipmaps.length:1}function L(N){return N===1003||N===1004||N===1005?9728:9729}function F(N){let D=N.target;D.removeEventListener("dispose",F),B(D),D.isVideoTexture&&g.delete(D)}function U(N){let D=N.target;D.removeEventListener("dispose",U),V(D)}function B(N){let D=n.get(N);if(D.__webglInit===void 0)return;let ee=N.source,de=m.get(ee);if(de){let pe=de[D.__cacheKey];pe.usedTimes--,pe.usedTimes===0&&k(N),Object.keys(de).length===0&&m.delete(ee)}n.remove(N)}function k(N){let D=n.get(N);i.deleteTexture(D.__webglTexture);let ee=N.source,de=m.get(ee);delete de[D.__cacheKey],s.memory.textures--}function V(N){let D=N.texture,ee=n.get(N),de=n.get(D);if(de.__webglTexture!==void 0&&(i.deleteTexture(de.__webglTexture),s.memory.textures--),N.depthTexture&&N.depthTexture.dispose(),N.isWebGLCubeRenderTarget)for(let pe=0;pe<6;pe++)i.deleteFramebuffer(ee.__webglFramebuffer[pe]),ee.__webglDepthbuffer&&i.deleteRenderbuffer(ee.__webglDepthbuffer[pe]);else{if(i.deleteFramebuffer(ee.__webglFramebuffer),ee.__webglDepthbuffer&&i.deleteRenderbuffer(ee.__webglDepthbuffer),ee.__webglMultisampledFramebuffer&&i.deleteFramebuffer(ee.__webglMultisampledFramebuffer),ee.__webglColorRenderbuffer)for(let pe=0;pe<ee.__webglColorRenderbuffer.length;pe++)ee.__webglColorRenderbuffer[pe]&&i.deleteRenderbuffer(ee.__webglColorRenderbuffer[pe]);ee.__webglDepthRenderbuffer&&i.deleteRenderbuffer(ee.__webglDepthRenderbuffer)}if(N.isWebGLMultipleRenderTargets)for(let pe=0,ge=D.length;pe<ge;pe++){let Ke=n.get(D[pe]);Ke.__webglTexture&&(i.deleteTexture(Ke.__webglTexture),s.memory.textures--),n.remove(D[pe])}n.remove(D),n.remove(N)}let O=0;function Z(){O=0}function K(){let N=O;return N>=l&&console.warn("THREE.WebGLTextures: Trying to use "+N+" texture units while this GPU supports only "+l),O+=1,N}function j(N){let D=[];return D.push(N.wrapS),D.push(N.wrapT),D.push(N.magFilter),D.push(N.minFilter),D.push(N.anisotropy),D.push(N.internalFormat),D.push(N.format),D.push(N.type),D.push(N.generateMipmaps),D.push(N.premultiplyAlpha),D.push(N.flipY),D.push(N.unpackAlignment),D.push(N.encoding),D.join()}function $(N,D){let ee=n.get(N);if(N.isVideoTexture&&no(N),N.isRenderTargetTexture===!1&&N.version>0&&ee.__version!==N.version){let de=N.image;if(de===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(de.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{We(ee,N,D);return}}t.activeTexture(33984+D),t.bindTexture(3553,ee.__webglTexture)}function ce(N,D){let ee=n.get(N);if(N.version>0&&ee.__version!==N.version){We(ee,N,D);return}t.activeTexture(33984+D),t.bindTexture(35866,ee.__webglTexture)}function W(N,D){let ee=n.get(N);if(N.version>0&&ee.__version!==N.version){We(ee,N,D);return}t.activeTexture(33984+D),t.bindTexture(32879,ee.__webglTexture)}function le(N,D){let ee=n.get(N);if(N.version>0&&ee.__version!==N.version){Xe(ee,N,D);return}t.activeTexture(33984+D),t.bindTexture(34067,ee.__webglTexture)}let Ee={1e3:10497,1001:33071,1002:33648},ht={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function te(N,D,ee){if(ee?(i.texParameteri(N,10242,Ee[D.wrapS]),i.texParameteri(N,10243,Ee[D.wrapT]),(N===32879||N===35866)&&i.texParameteri(N,32882,Ee[D.wrapR]),i.texParameteri(N,10240,ht[D.magFilter]),i.texParameteri(N,10241,ht[D.minFilter])):(i.texParameteri(N,10242,33071),i.texParameteri(N,10243,33071),(N===32879||N===35866)&&i.texParameteri(N,32882,33071),(D.wrapS!==1001||D.wrapT!==1001)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(N,10240,L(D.magFilter)),i.texParameteri(N,10241,L(D.minFilter)),D.minFilter!==1003&&D.minFilter!==1006&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let de=e.get("EXT_texture_filter_anisotropic");if(D.type===1015&&e.has("OES_texture_float_linear")===!1||a===!1&&D.type===1016&&e.has("OES_texture_half_float_linear")===!1)return;(D.anisotropy>1||n.get(D).__currentAnisotropy)&&(i.texParameterf(N,de.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,r.getMaxAnisotropy())),n.get(D).__currentAnisotropy=D.anisotropy)}}function wt(N,D){let ee=!1;N.__webglInit===void 0&&(N.__webglInit=!0,D.addEventListener("dispose",F));let de=D.source,pe=m.get(de);pe===void 0&&(pe={},m.set(de,pe));let ge=j(D);if(ge!==N.__cacheKey){pe[ge]===void 0&&(pe[ge]={texture:i.createTexture(),usedTimes:0},s.memory.textures++,ee=!0),pe[ge].usedTimes++;let Ke=pe[N.__cacheKey];Ke!==void 0&&(pe[N.__cacheKey].usedTimes--,Ke.usedTimes===0&&k(D)),N.__cacheKey=ge,N.__webglTexture=pe[ge].texture}return ee}function We(N,D,ee){let de=3553;D.isDataArrayTexture&&(de=35866),D.isData3DTexture&&(de=32879);let pe=wt(N,D),ge=D.source;if(t.activeTexture(33984+ee),t.bindTexture(de,N.__webglTexture),ge.version!==ge.__currentVersion||pe===!0){i.pixelStorei(37440,D.flipY),i.pixelStorei(37441,D.premultiplyAlpha),i.pixelStorei(3317,D.unpackAlignment),i.pixelStorei(37443,0);let Ke=S(D)&&_(D.image)===!1,Q=x(D.image,Ke,!1,u);Q=wr(D,Q);let Oe=_(Q)||a,Me=o.convert(D.format,D.encoding),Ae=o.convert(D.type),De=b(D.internalFormat,Me,Ae,D.encoding,D.isVideoTexture);te(de,D,Oe);let ot,Ct=D.mipmaps,nn=a&&D.isVideoTexture!==!0,z=ge.__currentVersion===void 0||pe===!0,be=I(D,Q,Oe);if(D.isDepthTexture)De=6402,a?D.type===1015?De=36012:D.type===1014?De=33190:D.type===1020?De=35056:De=33189:D.type===1015&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),D.format===1026&&De===6402&&D.type!==1012&&D.type!==1014&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),D.type=1014,Ae=o.convert(D.type)),D.format===1027&&De===6402&&(De=34041,D.type!==1020&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),D.type=1020,Ae=o.convert(D.type))),z&&(nn?t.texStorage2D(3553,1,De,Q.width,Q.height):t.texImage2D(3553,0,De,Q.width,Q.height,0,Me,Ae,null));else if(D.isDataTexture)if(Ct.length>0&&Oe){nn&&z&&t.texStorage2D(3553,be,De,Ct[0].width,Ct[0].height);for(let J=0,Se=Ct.length;J<Se;J++)ot=Ct[J],nn?t.texSubImage2D(3553,J,0,0,ot.width,ot.height,Me,Ae,ot.data):t.texImage2D(3553,J,De,ot.width,ot.height,0,Me,Ae,ot.data);D.generateMipmaps=!1}else nn?(z&&t.texStorage2D(3553,be,De,Q.width,Q.height),t.texSubImage2D(3553,0,0,0,Q.width,Q.height,Me,Ae,Q.data)):t.texImage2D(3553,0,De,Q.width,Q.height,0,Me,Ae,Q.data);else if(D.isCompressedTexture){nn&&z&&t.texStorage2D(3553,be,De,Ct[0].width,Ct[0].height);for(let J=0,Se=Ct.length;J<Se;J++)ot=Ct[J],D.format!==1023?Me!==null?nn?t.compressedTexSubImage2D(3553,J,0,0,ot.width,ot.height,Me,ot.data):t.compressedTexImage2D(3553,J,De,ot.width,ot.height,0,ot.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):nn?t.texSubImage2D(3553,J,0,0,ot.width,ot.height,Me,Ae,ot.data):t.texImage2D(3553,J,De,ot.width,ot.height,0,Me,Ae,ot.data)}else if(D.isDataArrayTexture)nn?(z&&t.texStorage3D(35866,be,De,Q.width,Q.height,Q.depth),t.texSubImage3D(35866,0,0,0,0,Q.width,Q.height,Q.depth,Me,Ae,Q.data)):t.texImage3D(35866,0,De,Q.width,Q.height,Q.depth,0,Me,Ae,Q.data);else if(D.isData3DTexture)nn?(z&&t.texStorage3D(32879,be,De,Q.width,Q.height,Q.depth),t.texSubImage3D(32879,0,0,0,0,Q.width,Q.height,Q.depth,Me,Ae,Q.data)):t.texImage3D(32879,0,De,Q.width,Q.height,Q.depth,0,Me,Ae,Q.data);else if(D.isFramebufferTexture){if(z)if(nn)t.texStorage2D(3553,be,De,Q.width,Q.height);else{let J=Q.width,Se=Q.height;for(let fe=0;fe<be;fe++)t.texImage2D(3553,fe,De,J,Se,0,Me,Ae,null),J>>=1,Se>>=1}}else if(Ct.length>0&&Oe){nn&&z&&t.texStorage2D(3553,be,De,Ct[0].width,Ct[0].height);for(let J=0,Se=Ct.length;J<Se;J++)ot=Ct[J],nn?t.texSubImage2D(3553,J,0,0,Me,Ae,ot):t.texImage2D(3553,J,De,Me,Ae,ot);D.generateMipmaps=!1}else nn?(z&&t.texStorage2D(3553,be,De,Q.width,Q.height),t.texSubImage2D(3553,0,0,0,Me,Ae,Q)):t.texImage2D(3553,0,De,Me,Ae,Q);M(D,Oe)&&R(de),ge.__currentVersion=ge.version,D.onUpdate&&D.onUpdate(D)}N.__version=D.version}function Xe(N,D,ee){if(D.image.length!==6)return;let de=wt(N,D),pe=D.source;if(t.activeTexture(33984+ee),t.bindTexture(34067,N.__webglTexture),pe.version!==pe.__currentVersion||de===!0){i.pixelStorei(37440,D.flipY),i.pixelStorei(37441,D.premultiplyAlpha),i.pixelStorei(3317,D.unpackAlignment),i.pixelStorei(37443,0);let ge=D.isCompressedTexture||D.image[0].isCompressedTexture,Ke=D.image[0]&&D.image[0].isDataTexture,Q=[];for(let J=0;J<6;J++)!ge&&!Ke?Q[J]=x(D.image[J],!1,!0,c):Q[J]=Ke?D.image[J].image:D.image[J],Q[J]=wr(D,Q[J]);let Oe=Q[0],Me=_(Oe)||a,Ae=o.convert(D.format,D.encoding),De=o.convert(D.type),ot=b(D.internalFormat,Ae,De,D.encoding),Ct=a&&D.isVideoTexture!==!0,nn=pe.__currentVersion===void 0||de===!0,z=I(D,Oe,Me);te(34067,D,Me);let be;if(ge){Ct&&nn&&t.texStorage2D(34067,z,ot,Oe.width,Oe.height);for(let J=0;J<6;J++){be=Q[J].mipmaps;for(let Se=0;Se<be.length;Se++){let fe=be[Se];D.format!==1023?Ae!==null?Ct?t.compressedTexSubImage2D(34069+J,Se,0,0,fe.width,fe.height,Ae,fe.data):t.compressedTexImage2D(34069+J,Se,ot,fe.width,fe.height,0,fe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ct?t.texSubImage2D(34069+J,Se,0,0,fe.width,fe.height,Ae,De,fe.data):t.texImage2D(34069+J,Se,ot,fe.width,fe.height,0,Ae,De,fe.data)}}}else{be=D.mipmaps,Ct&&nn&&(be.length>0&&z++,t.texStorage2D(34067,z,ot,Q[0].width,Q[0].height));for(let J=0;J<6;J++)if(Ke){Ct?t.texSubImage2D(34069+J,0,0,0,Q[J].width,Q[J].height,Ae,De,Q[J].data):t.texImage2D(34069+J,0,ot,Q[J].width,Q[J].height,0,Ae,De,Q[J].data);for(let Se=0;Se<be.length;Se++){let fe=be[Se].image[J].image;Ct?t.texSubImage2D(34069+J,Se+1,0,0,fe.width,fe.height,Ae,De,fe.data):t.texImage2D(34069+J,Se+1,ot,fe.width,fe.height,0,Ae,De,fe.data)}}else{Ct?t.texSubImage2D(34069+J,0,0,0,Ae,De,Q[J]):t.texImage2D(34069+J,0,ot,Ae,De,Q[J]);for(let Se=0;Se<be.length;Se++){let fe=be[Se];Ct?t.texSubImage2D(34069+J,Se+1,0,0,Ae,De,fe.image[J]):t.texImage2D(34069+J,Se+1,ot,Ae,De,fe.image[J])}}}M(D,Me)&&R(34067),pe.__currentVersion=pe.version,D.onUpdate&&D.onUpdate(D)}N.__version=D.version}function xe(N,D,ee,de,pe){let ge=o.convert(ee.format,ee.encoding),Ke=o.convert(ee.type),Q=b(ee.internalFormat,ge,Ke,ee.encoding);n.get(D).__hasExternalTextures||(pe===32879||pe===35866?t.texImage3D(pe,0,Q,D.width,D.height,D.depth,0,ge,Ke,null):t.texImage2D(pe,0,Q,D.width,D.height,0,ge,Ke,null)),t.bindFramebuffer(36160,N),kt(D)?d.framebufferTexture2DMultisampleEXT(36160,de,pe,n.get(ee).__webglTexture,0,Pn(D)):i.framebufferTexture2D(36160,de,pe,n.get(ee).__webglTexture,0),t.bindFramebuffer(36160,null)}function $t(N,D,ee){if(i.bindRenderbuffer(36161,N),D.depthBuffer&&!D.stencilBuffer){let de=33189;if(ee||kt(D)){let pe=D.depthTexture;pe&&pe.isDepthTexture&&(pe.type===1015?de=36012:pe.type===1014&&(de=33190));let ge=Pn(D);kt(D)?d.renderbufferStorageMultisampleEXT(36161,ge,de,D.width,D.height):i.renderbufferStorageMultisample(36161,ge,de,D.width,D.height)}else i.renderbufferStorage(36161,de,D.width,D.height);i.framebufferRenderbuffer(36160,36096,36161,N)}else if(D.depthBuffer&&D.stencilBuffer){let de=Pn(D);ee&&kt(D)===!1?i.renderbufferStorageMultisample(36161,de,35056,D.width,D.height):kt(D)?d.renderbufferStorageMultisampleEXT(36161,de,35056,D.width,D.height):i.renderbufferStorage(36161,34041,D.width,D.height),i.framebufferRenderbuffer(36160,33306,36161,N)}else{let de=D.isWebGLMultipleRenderTargets===!0?D.texture:[D.texture];for(let pe=0;pe<de.length;pe++){let ge=de[pe],Ke=o.convert(ge.format,ge.encoding),Q=o.convert(ge.type),Oe=b(ge.internalFormat,Ke,Q,ge.encoding),Me=Pn(D);ee&&kt(D)===!1?i.renderbufferStorageMultisample(36161,Me,Oe,D.width,D.height):kt(D)?d.renderbufferStorageMultisampleEXT(36161,Me,Oe,D.width,D.height):i.renderbufferStorage(36161,Oe,D.width,D.height)}}i.bindRenderbuffer(36161,null)}function lt(N,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,N),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),$(D.depthTexture,0);let ee=n.get(D.depthTexture).__webglTexture,de=Pn(D);if(D.depthTexture.format===1026)kt(D)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,ee,0,de):i.framebufferTexture2D(36160,36096,3553,ee,0);else if(D.depthTexture.format===1027)kt(D)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,ee,0,de):i.framebufferTexture2D(36160,33306,3553,ee,0);else throw new Error("Unknown depthTexture format")}function Fe(N){let D=n.get(N),ee=N.isWebGLCubeRenderTarget===!0;if(N.depthTexture&&!D.__autoAllocateDepthBuffer){if(ee)throw new Error("target.depthTexture not supported in Cube render targets");lt(D.__webglFramebuffer,N)}else if(ee){D.__webglDepthbuffer=[];for(let de=0;de<6;de++)t.bindFramebuffer(36160,D.__webglFramebuffer[de]),D.__webglDepthbuffer[de]=i.createRenderbuffer(),$t(D.__webglDepthbuffer[de],N,!1)}else t.bindFramebuffer(36160,D.__webglFramebuffer),D.__webglDepthbuffer=i.createRenderbuffer(),$t(D.__webglDepthbuffer,N,!1);t.bindFramebuffer(36160,null)}function Rn(N,D,ee){let de=n.get(N);D!==void 0&&xe(de.__webglFramebuffer,N,N.texture,36064,3553),ee!==void 0&&Fe(N)}function gi(N){let D=N.texture,ee=n.get(N),de=n.get(D);N.addEventListener("dispose",U),N.isWebGLMultipleRenderTargets!==!0&&(de.__webglTexture===void 0&&(de.__webglTexture=i.createTexture()),de.__version=D.version,s.memory.textures++);let pe=N.isWebGLCubeRenderTarget===!0,ge=N.isWebGLMultipleRenderTargets===!0,Ke=_(N)||a;if(pe){ee.__webglFramebuffer=[];for(let Q=0;Q<6;Q++)ee.__webglFramebuffer[Q]=i.createFramebuffer()}else{if(ee.__webglFramebuffer=i.createFramebuffer(),ge)if(r.drawBuffers){let Q=N.texture;for(let Oe=0,Me=Q.length;Oe<Me;Oe++){let Ae=n.get(Q[Oe]);Ae.__webglTexture===void 0&&(Ae.__webglTexture=i.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&N.samples>0&&kt(N)===!1){let Q=ge?D:[D];ee.__webglMultisampledFramebuffer=i.createFramebuffer(),ee.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,ee.__webglMultisampledFramebuffer);for(let Oe=0;Oe<Q.length;Oe++){let Me=Q[Oe];ee.__webglColorRenderbuffer[Oe]=i.createRenderbuffer(),i.bindRenderbuffer(36161,ee.__webglColorRenderbuffer[Oe]);let Ae=o.convert(Me.format,Me.encoding),De=o.convert(Me.type),ot=b(Me.internalFormat,Ae,De,Me.encoding),Ct=Pn(N);i.renderbufferStorageMultisample(36161,Ct,ot,N.width,N.height),i.framebufferRenderbuffer(36160,36064+Oe,36161,ee.__webglColorRenderbuffer[Oe])}i.bindRenderbuffer(36161,null),N.depthBuffer&&(ee.__webglDepthRenderbuffer=i.createRenderbuffer(),$t(ee.__webglDepthRenderbuffer,N,!0)),t.bindFramebuffer(36160,null)}}if(pe){t.bindTexture(34067,de.__webglTexture),te(34067,D,Ke);for(let Q=0;Q<6;Q++)xe(ee.__webglFramebuffer[Q],N,D,36064,34069+Q);M(D,Ke)&&R(34067),t.unbindTexture()}else if(ge){let Q=N.texture;for(let Oe=0,Me=Q.length;Oe<Me;Oe++){let Ae=Q[Oe],De=n.get(Ae);t.bindTexture(3553,De.__webglTexture),te(3553,Ae,Ke),xe(ee.__webglFramebuffer,N,Ae,36064+Oe,3553),M(Ae,Ke)&&R(3553)}t.unbindTexture()}else{let Q=3553;(N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(a?Q=N.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Q,de.__webglTexture),te(Q,D,Ke),xe(ee.__webglFramebuffer,N,D,36064,Q),M(D,Ke)&&R(Q),t.unbindTexture()}N.depthBuffer&&Fe(N)}function Yn(N){let D=_(N)||a,ee=N.isWebGLMultipleRenderTargets===!0?N.texture:[N.texture];for(let de=0,pe=ee.length;de<pe;de++){let ge=ee[de];if(M(ge,D)){let Ke=N.isWebGLCubeRenderTarget?34067:3553,Q=n.get(ge).__webglTexture;t.bindTexture(Ke,Q),R(Ke),t.unbindTexture()}}}function br(N){if(a&&N.samples>0&&kt(N)===!1){let D=N.isWebGLMultipleRenderTargets?N.texture:[N.texture],ee=N.width,de=N.height,pe=16384,ge=[],Ke=N.stencilBuffer?33306:36096,Q=n.get(N),Oe=N.isWebGLMultipleRenderTargets===!0;if(Oe)for(let Me=0;Me<D.length;Me++)t.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Me,36161,null),t.bindFramebuffer(36160,Q.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Me,3553,null,0);t.bindFramebuffer(36008,Q.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Q.__webglFramebuffer);for(let Me=0;Me<D.length;Me++){ge.push(36064+Me),N.depthBuffer&&ge.push(Ke);let Ae=Q.__ignoreDepthValues!==void 0?Q.__ignoreDepthValues:!1;if(Ae===!1&&(N.depthBuffer&&(pe|=256),N.stencilBuffer&&(pe|=1024)),Oe&&i.framebufferRenderbuffer(36008,36064,36161,Q.__webglColorRenderbuffer[Me]),Ae===!0&&(i.invalidateFramebuffer(36008,[Ke]),i.invalidateFramebuffer(36009,[Ke])),Oe){let De=n.get(D[Me]).__webglTexture;i.framebufferTexture2D(36009,36064,3553,De,0)}i.blitFramebuffer(0,0,ee,de,0,0,ee,de,pe,9728),p&&i.invalidateFramebuffer(36008,ge)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),Oe)for(let Me=0;Me<D.length;Me++){t.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Me,36161,Q.__webglColorRenderbuffer[Me]);let Ae=n.get(D[Me]).__webglTexture;t.bindFramebuffer(36160,Q.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Me,3553,Ae,0)}t.bindFramebuffer(36009,Q.__webglMultisampledFramebuffer)}}function Pn(N){return Math.min(h,N.samples)}function kt(N){let D=n.get(N);return a&&N.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&D.__useRenderToTexture!==!1}function no(N){let D=s.render.frame;g.get(N)!==D&&(g.set(N,D),N.update())}function wr(N,D){let ee=N.encoding,de=N.format,pe=N.type;return N.isCompressedTexture===!0||N.isVideoTexture===!0||N.format===1035||ee!==3e3&&(ee===3001?a===!1?e.has("EXT_sRGB")===!0&&de===1023?(N.format=1035,N.minFilter=1006,N.generateMipmaps=!1):D=fm.sRGBToLinear(D):(de!==1023||pe!==1009)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ee)),D}this.allocateTextureUnit=K,this.resetTextureUnits=Z,this.setTexture2D=$,this.setTexture2DArray=ce,this.setTexture3D=W,this.setTextureCube=le,this.rebindTextures=Rn,this.setupRenderTarget=gi,this.updateRenderTargetMipmap=Yn,this.updateMultisampleRenderTarget=br,this.setupDepthRenderbuffer=Fe,this.setupFrameBufferTexture=xe,this.useMultisampledRTT=kt}function lj(i,e,t){let n=t.isWebGL2;function r(o,s=null){let a;if(o===1009)return 5121;if(o===1017)return 32819;if(o===1018)return 32820;if(o===1010)return 5120;if(o===1011)return 5122;if(o===1012)return 5123;if(o===1013)return 5124;if(o===1014)return 5125;if(o===1015)return 5126;if(o===1016)return n?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(o===1021)return 6406;if(o===1023)return 6408;if(o===1024)return 6409;if(o===1025)return 6410;if(o===1026)return 6402;if(o===1027)return 34041;if(o===1028)return 6403;if(o===1022)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(o===1035)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(o===1029)return 36244;if(o===1030)return 33319;if(o===1031)return 33320;if(o===1033)return 36249;if(o===33776||o===33777||o===33778||o===33779)if(s===3001)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(o===33776)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===33777)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===33778)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===33779)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(o===33776)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===33777)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===33778)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===33779)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===35840||o===35841||o===35842||o===35843)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(o===35840)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===35841)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===35842)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===35843)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===36196)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===37492||o===37496)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(o===37492)return s===3001?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(o===37496)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===37808||o===37809||o===37810||o===37811||o===37812||o===37813||o===37814||o===37815||o===37816||o===37817||o===37818||o===37819||o===37820||o===37821)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(o===37808)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===37809)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===37810)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===37811)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===37812)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===37813)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===37814)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===37815)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===37816)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===37817)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===37818)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===37819)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===37820)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===37821)return s===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===36492)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(o===36492)return s===3001?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return o===1020?n?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[o]!==void 0?i[o]:null}return{convert:r}}var Yb=class extends ni{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},tc=class extends eo{constructor(){super(),this.isGroup=!0,this.type="Group"}},cj={type:"move"},cd=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new tc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new tc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new H,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new H),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new tc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new H,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new H),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,o=null,s=null,a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){s=!0;for(let f of e.hand.values()){let m=t.getJointPose(f,n);if(c.joints[f.jointName]===void 0){let y=new tc;y.matrixAutoUpdate=!1,y.visible=!1,c.joints[f.jointName]=y,c.add(y)}let v=c.joints[f.jointName];m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=m.radius),v.visible=m!==null}let u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,g=.005;c.inputState.pinching&&d>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),o!==null&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),o.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(o.linearVelocity)):l.hasLinearVelocity=!1,o.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(o.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&o!==null&&(r=o),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(cj)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=o!==null),c!==null&&(c.visible=s!==null),this}},Zb=class extends Is{constructor(e,t,n,r,o,s,a,l,c,u){if(u=u!==void 0?u:1026,u!==1026&&u!==1027)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===1026&&(n=1014),n===void 0&&u===1027&&(n=1020),super(null,r,o,s,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:1003,this.minFilter=l!==void 0?l:1003,this.flipY=!1,this.generateMipmaps=!1}},Xb=class extends Ms{constructor(e,t){super();let n=this,r=null,o=1,s=null,a="local-floor",l=null,c=null,u=null,h=null,d=null,p=null,g=t.getContextAttributes(),f=null,m=null,v=[],y=[],x=new ni;x.layers.enable(1),x.viewport=new xn;let _=new ni;_.layers.enable(2),_.viewport=new xn;let S=[x,_],M=new Yb;M.layers.enable(1),M.layers.enable(2);let R=null,b=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let $=v[j];return $===void 0&&($=new cd,v[j]=$),$.getTargetRaySpace()},this.getControllerGrip=function(j){let $=v[j];return $===void 0&&($=new cd,v[j]=$),$.getGripSpace()},this.getHand=function(j){let $=v[j];return $===void 0&&($=new cd,v[j]=$),$.getHandSpace()};function I(j){let $=y.indexOf(j.inputSource);if($===-1)return;let ce=v[$];ce!==void 0&&ce.dispatchEvent({type:j.type,data:j.inputSource})}function L(){r.removeEventListener("select",I),r.removeEventListener("selectstart",I),r.removeEventListener("selectend",I),r.removeEventListener("squeeze",I),r.removeEventListener("squeezestart",I),r.removeEventListener("squeezeend",I),r.removeEventListener("end",L),r.removeEventListener("inputsourceschange",F);for(let j=0;j<v.length;j++){let $=y[j];$!==null&&(y[j]=null,v[j].disconnect($))}R=null,b=null,e.setRenderTarget(f),d=null,h=null,u=null,r=null,m=null,K.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){o=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(j){l=j},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=function(j){return _e(this,null,function*(){if(r=j,r!==null){if(f=e.getRenderTarget(),r.addEventListener("select",I),r.addEventListener("selectstart",I),r.addEventListener("selectend",I),r.addEventListener("squeeze",I),r.addEventListener("squeezestart",I),r.addEventListener("squeezeend",I),r.addEventListener("end",L),r.addEventListener("inputsourceschange",F),g.xrCompatible!==!0&&(yield t.makeXRCompatible()),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let $={antialias:r.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:o};d=new XRWebGLLayer(r,t,$),r.updateRenderState({baseLayer:d}),m=new Bo(d.framebufferWidth,d.framebufferHeight,{format:1023,type:1009,encoding:e.outputEncoding})}else{let $=null,ce=null,W=null;g.depth&&(W=g.stencil?35056:33190,$=g.stencil?1027:1026,ce=g.stencil?1020:1014);let le={colorFormat:32856,depthFormat:W,scaleFactor:o};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(le),r.updateRenderState({layers:[h]}),m=new Bo(h.textureWidth,h.textureHeight,{format:1023,type:1009,depthTexture:new Zb(h.textureWidth,h.textureHeight,ce,void 0,void 0,void 0,void 0,void 0,void 0,$),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0});let Ee=e.properties.get(m);Ee.__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),l=null,s=yield r.requestReferenceSpace(a),K.setContext(r),K.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}})};function F(j){for(let $=0;$<j.removed.length;$++){let ce=j.removed[$],W=y.indexOf(ce);W>=0&&(y[W]=null,v[W].dispatchEvent({type:"disconnected",data:ce}))}for(let $=0;$<j.added.length;$++){let ce=j.added[$],W=y.indexOf(ce);if(W===-1){for(let Ee=0;Ee<v.length;Ee++)if(Ee>=y.length){y.push(ce),W=Ee;break}else if(y[Ee]===null){y[Ee]=ce,W=Ee;break}if(W===-1)break}let le=v[W];le&&le.dispatchEvent({type:"connected",data:ce})}}let U=new H,B=new H;function k(j,$,ce){U.setFromMatrixPosition($.matrixWorld),B.setFromMatrixPosition(ce.matrixWorld);let W=U.distanceTo(B),le=$.projectionMatrix.elements,Ee=ce.projectionMatrix.elements,ht=le[14]/(le[10]-1),te=le[14]/(le[10]+1),wt=(le[9]+1)/le[5],We=(le[9]-1)/le[5],Xe=(le[8]-1)/le[0],xe=(Ee[8]+1)/Ee[0],$t=ht*Xe,lt=ht*xe,Fe=W/(-Xe+xe),Rn=Fe*-Xe;$.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(Rn),j.translateZ(Fe),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();let gi=ht+Fe,Yn=te+Fe,br=$t-Rn,Pn=lt+(W-Rn),kt=wt*te/Yn*gi,no=We*te/Yn*gi;j.projectionMatrix.makePerspective(br,Pn,kt,no,gi,Yn)}function V(j,$){$===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices($.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(r===null)return;M.near=_.near=x.near=j.near,M.far=_.far=x.far=j.far,(R!==M.near||b!==M.far)&&(r.updateRenderState({depthNear:M.near,depthFar:M.far}),R=M.near,b=M.far);let $=j.parent,ce=M.cameras;V(M,$);for(let le=0;le<ce.length;le++)V(ce[le],$);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),j.position.copy(M.position),j.quaternion.copy(M.quaternion),j.scale.copy(M.scale),j.matrix.copy(M.matrix),j.matrixWorld.copy(M.matrixWorld);let W=j.children;for(let le=0,Ee=W.length;le<Ee;le++)W[le].updateMatrixWorld(!0);ce.length===2?k(M,x,_):M.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(h!==null)return h.fixedFoveation;if(d!==null)return d.fixedFoveation},this.setFoveation=function(j){h!==null&&(h.fixedFoveation=j),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=j)};let O=null;function Z(j,$){if(c=$.getViewerPose(l||s),p=$,c!==null){let ce=c.views;d!==null&&(e.setRenderTargetFramebuffer(m,d.framebuffer),e.setRenderTarget(m));let W=!1;ce.length!==M.cameras.length&&(M.cameras.length=0,W=!0);for(let le=0;le<ce.length;le++){let Ee=ce[le],ht=null;if(d!==null)ht=d.getViewport(Ee);else{let wt=u.getViewSubImage(h,Ee);ht=wt.viewport,le===0&&(e.setRenderTargetTextures(m,wt.colorTexture,h.ignoreDepthValues?void 0:wt.depthStencilTexture),e.setRenderTarget(m))}let te=S[le];te===void 0&&(te=new ni,te.layers.enable(le),te.viewport=new xn,S[le]=te),te.matrix.fromArray(Ee.transform.matrix),te.projectionMatrix.fromArray(Ee.projectionMatrix),te.viewport.set(ht.x,ht.y,ht.width,ht.height),le===0&&M.matrix.copy(te.matrix),W===!0&&M.cameras.push(te)}}for(let ce=0;ce<v.length;ce++){let W=y[ce],le=v[ce];W!==null&&le!==void 0&&le.update(W,$,l||s)}O&&O(j,$),p=null}let K=new yI;K.setAnimationLoop(Z),this.setAnimationLoop=function(j){O=j},this.dispose=function(){}}};function uj(i,e){function t(f,m){f.fogColor.value.copy(m.color),m.isFog?(f.fogNear.value=m.near,f.fogFar.value=m.far):m.isFogExp2&&(f.fogDensity.value=m.density)}function n(f,m,v,y,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?r(f,m):m.isMeshToonMaterial?(r(f,m),u(f,m)):m.isMeshPhongMaterial?(r(f,m),c(f,m)):m.isMeshStandardMaterial?(r(f,m),h(f,m),m.isMeshPhysicalMaterial&&d(f,m,x)):m.isMeshMatcapMaterial?(r(f,m),p(f,m)):m.isMeshDepthMaterial?r(f,m):m.isMeshDistanceMaterial?(r(f,m),g(f,m)):m.isMeshNormalMaterial?r(f,m):m.isLineBasicMaterial?(o(f,m),m.isLineDashedMaterial&&s(f,m)):m.isPointsMaterial?a(f,m,v,y):m.isSpriteMaterial?l(f,m):m.isShadowMaterial?(f.color.value.copy(m.color),f.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function r(f,m){f.opacity.value=m.opacity,m.color&&f.diffuse.value.copy(m.color),m.emissive&&f.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(f.map.value=m.map),m.alphaMap&&(f.alphaMap.value=m.alphaMap),m.bumpMap&&(f.bumpMap.value=m.bumpMap,f.bumpScale.value=m.bumpScale,m.side===1&&(f.bumpScale.value*=-1)),m.displacementMap&&(f.displacementMap.value=m.displacementMap,f.displacementScale.value=m.displacementScale,f.displacementBias.value=m.displacementBias),m.emissiveMap&&(f.emissiveMap.value=m.emissiveMap),m.normalMap&&(f.normalMap.value=m.normalMap,f.normalScale.value.copy(m.normalScale),m.side===1&&f.normalScale.value.negate()),m.specularMap&&(f.specularMap.value=m.specularMap),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest);let v=e.get(m).envMap;if(v&&(f.envMap.value=v,f.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,f.reflectivity.value=m.reflectivity,f.ior.value=m.ior,f.refractionRatio.value=m.refractionRatio),m.lightMap){f.lightMap.value=m.lightMap;let _=i.physicallyCorrectLights!==!0?Math.PI:1;f.lightMapIntensity.value=m.lightMapIntensity*_}m.aoMap&&(f.aoMap.value=m.aoMap,f.aoMapIntensity.value=m.aoMapIntensity);let y;m.map?y=m.map:m.specularMap?y=m.specularMap:m.displacementMap?y=m.displacementMap:m.normalMap?y=m.normalMap:m.bumpMap?y=m.bumpMap:m.roughnessMap?y=m.roughnessMap:m.metalnessMap?y=m.metalnessMap:m.alphaMap?y=m.alphaMap:m.emissiveMap?y=m.emissiveMap:m.clearcoatMap?y=m.clearcoatMap:m.clearcoatNormalMap?y=m.clearcoatNormalMap:m.clearcoatRoughnessMap?y=m.clearcoatRoughnessMap:m.iridescenceMap?y=m.iridescenceMap:m.iridescenceThicknessMap?y=m.iridescenceThicknessMap:m.specularIntensityMap?y=m.specularIntensityMap:m.specularColorMap?y=m.specularColorMap:m.transmissionMap?y=m.transmissionMap:m.thicknessMap?y=m.thicknessMap:m.sheenColorMap?y=m.sheenColorMap:m.sheenRoughnessMap&&(y=m.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),f.uvTransform.value.copy(y.matrix));let x;m.aoMap?x=m.aoMap:m.lightMap&&(x=m.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),f.uv2Transform.value.copy(x.matrix))}function o(f,m){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity}function s(f,m){f.dashSize.value=m.dashSize,f.totalSize.value=m.dashSize+m.gapSize,f.scale.value=m.scale}function a(f,m,v,y){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity,f.size.value=m.size*v,f.scale.value=y*.5,m.map&&(f.map.value=m.map),m.alphaMap&&(f.alphaMap.value=m.alphaMap),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),f.uvTransform.value.copy(x.matrix))}function l(f,m){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity,f.rotation.value=m.rotation,m.map&&(f.map.value=m.map),m.alphaMap&&(f.alphaMap.value=m.alphaMap),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest);let v;m.map?v=m.map:m.alphaMap&&(v=m.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),f.uvTransform.value.copy(v.matrix))}function c(f,m){f.specular.value.copy(m.specular),f.shininess.value=Math.max(m.shininess,1e-4)}function u(f,m){m.gradientMap&&(f.gradientMap.value=m.gradientMap)}function h(f,m){f.roughness.value=m.roughness,f.metalness.value=m.metalness,m.roughnessMap&&(f.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(f.metalnessMap.value=m.metalnessMap),e.get(m).envMap&&(f.envMapIntensity.value=m.envMapIntensity)}function d(f,m,v){f.ior.value=m.ior,m.sheen>0&&(f.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),f.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(f.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(f.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(f.clearcoat.value=m.clearcoat,f.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(f.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(f.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),f.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===1&&f.clearcoatNormalScale.value.negate())),m.iridescence>0&&(f.iridescence.value=m.iridescence,f.iridescenceIOR.value=m.iridescenceIOR,f.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(f.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(f.transmission.value=m.transmission,f.transmissionSamplerMap.value=v.texture,f.transmissionSamplerSize.value.set(v.width,v.height),m.transmissionMap&&(f.transmissionMap.value=m.transmissionMap),f.thickness.value=m.thickness,m.thicknessMap&&(f.thicknessMap.value=m.thicknessMap),f.attenuationDistance.value=m.attenuationDistance,f.attenuationColor.value.copy(m.attenuationColor)),f.specularIntensity.value=m.specularIntensity,f.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(f.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(f.specularColorMap.value=m.specularColorMap)}function p(f,m){m.matcap&&(f.matcap.value=m.matcap)}function g(f,m){f.referencePosition.value.copy(m.referencePosition),f.nearDistance.value=m.nearDistance,f.farDistance.value=m.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function dj(i,e,t,n){let r={},o={},s=[],a=t.isWebGL2?i.getParameter(35375):0;function l(y,x){let _=x.program;n.uniformBlockBinding(y,_)}function c(y,x){let _=r[y.id];_===void 0&&(g(y),_=u(y),r[y.id]=_,y.addEventListener("dispose",m));let S=x.program;n.updateUBOMapping(y,S);let M=e.render.frame;o[y.id]!==M&&(d(y),o[y.id]=M)}function u(y){let x=h();y.__bindingPointIndex=x;let _=i.createBuffer(),S=y.__size,M=y.usage;return i.bindBuffer(35345,_),i.bufferData(35345,S,M),i.bindBuffer(35345,null),i.bindBufferBase(35345,x,_),_}function h(){for(let y=0;y<a;y++)if(s.indexOf(y)===-1)return s.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){let x=r[y.id],_=y.uniforms,S=y.__cache;i.bindBuffer(35345,x);for(let M=0,R=_.length;M<R;M++){let b=_[M];if(p(b,M,S)===!0){let I=b.value,L=b.__offset;typeof I=="number"?(b.__data[0]=I,i.bufferSubData(35345,L,b.__data)):(b.value.isMatrix3?(b.__data[0]=b.value.elements[0],b.__data[1]=b.value.elements[1],b.__data[2]=b.value.elements[2],b.__data[3]=b.value.elements[0],b.__data[4]=b.value.elements[3],b.__data[5]=b.value.elements[4],b.__data[6]=b.value.elements[5],b.__data[7]=b.value.elements[0],b.__data[8]=b.value.elements[6],b.__data[9]=b.value.elements[7],b.__data[10]=b.value.elements[8],b.__data[11]=b.value.elements[0]):I.toArray(b.__data),i.bufferSubData(35345,L,b.__data))}}i.bindBuffer(35345,null)}function p(y,x,_){let S=y.value;if(_[x]===void 0)return typeof S=="number"?_[x]=S:_[x]=S.clone(),!0;if(typeof S=="number"){if(_[x]!==S)return _[x]=S,!0}else{let M=_[x];if(M.equals(S)===!1)return M.copy(S),!0}return!1}function g(y){let x=y.uniforms,_=0,S=16,M=0;for(let R=0,b=x.length;R<b;R++){let I=x[R],L=f(I);if(I.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=_,R>0){M=_%S;let F=S-M;M!==0&&F-L.boundary<0&&(_+=S-M,I.__offset=_)}_+=L.storage}return M=_%S,M>0&&(_+=S-M),y.__size=_,y.__cache={},this}function f(y){let x=y.value,_={boundary:0,storage:0};return typeof x=="number"?(_.boundary=4,_.storage=4):x.isVector2?(_.boundary=8,_.storage=8):x.isVector3||x.isColor?(_.boundary=16,_.storage=12):x.isVector4?(_.boundary=16,_.storage=16):x.isMatrix3?(_.boundary=48,_.storage=48):x.isMatrix4?(_.boundary=64,_.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),_}function m(y){let x=y.target;x.removeEventListener("dispose",m);let _=s.indexOf(x.__bindingPointIndex);s.splice(_,1),i.deleteBuffer(r[x.id]),delete r[x.id],delete o[x.id]}function v(){for(let y in r)i.deleteBuffer(r[y]);s=[],r={},o={}}return{bind:l,update:c,dispose:v}}function hj(){let i=pm("canvas");return i.style.display="block",i}function CI(i={}){this.isWebGLRenderer=!0;let e=i.canvas!==void 0?i.canvas:hj(),t=i.context!==void 0?i.context:null,n=i.depth!==void 0?i.depth:!0,r=i.stencil!==void 0?i.stencil:!0,o=i.antialias!==void 0?i.antialias:!1,s=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,a=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,l=i.powerPreference!==void 0?i.powerPreference:"default",c=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1,u;t!==null?u=t.getContextAttributes().alpha:u=i.alpha!==void 0?i.alpha:!1;let h=null,d=null,p=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});let f=this,m=!1,v=0,y=0,x=null,_=-1,S=null,M=new xn,R=new xn,b=null,I=e.width,L=e.height,F=1,U=null,B=null,k=new xn(0,0,I,L),V=new xn(0,0,I,L),O=!1,Z=new dd,K=!1,j=!1,$=null,ce=new An,W=new vt,le=new H,Ee={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ht(){return x===null?F:1}let te=t;function wt(T,G){for(let X=0;X<T.length;X++){let q=T[X],re=e.getContext(q,G);if(re!==null)return re}return null}try{let T={alpha:!0,depth:n,stencil:r,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${ww}`),e.addEventListener("webglcontextlost",ot,!1),e.addEventListener("webglcontextrestored",Ct,!1),e.addEventListener("webglcontextcreationerror",nn,!1),te===null){let G=["webgl2","webgl","experimental-webgl"];if(f.isWebGL1Renderer===!0&&G.shift(),te=wt(G,T),te===null)throw wt(G)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}te.getShaderPrecisionFormat===void 0&&(te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(T){throw console.error("THREE.WebGLRenderer: "+T.message),T}let We,Xe,xe,$t,lt,Fe,Rn,gi,Yn,br,Pn,kt,no,wr,N,D,ee,de,pe,ge,Ke,Q,Oe,Me;function Ae(){We=new Pz(te),Xe=new Mz(te,We,i),We.init(Xe),Q=new lj(te,We,Xe),xe=new sj(te,We,Xe),$t=new Oz,lt=new Y4,Fe=new aj(te,We,xe,lt,Xe,Q,$t),Rn=new Iz(f),gi=new Rz(f),Yn=new $3(te,Xe),Oe=new Cz(te,We,Yn,Xe),br=new Nz(te,Yn,$t,Oe),Pn=new Bz(te,br,Yn,$t),pe=new Vz(te,Xe,Fe),D=new Dz(lt),kt=new $4(f,Rn,gi,We,Xe,Oe,D),no=new uj(f,lt),wr=new X4,N=new nj(We,Xe),de=new Sz(f,Rn,xe,Pn,u,s),ee=new oj(f,Pn,Xe),Me=new dj(te,$t,Xe,xe),ge=new Ez(te,We,$t,Xe),Ke=new kz(te,We,$t,Xe),$t.programs=kt.programs,f.capabilities=Xe,f.extensions=We,f.properties=lt,f.renderLists=wr,f.shadowMap=ee,f.state=xe,f.info=$t}Ae();let De=new Xb(f,te);this.xr=De,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){let T=We.get("WEBGL_lose_context");T&&T.loseContext()},this.forceContextRestore=function(){let T=We.get("WEBGL_lose_context");T&&T.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(T){T!==void 0&&(F=T,this.setSize(I,L,!1))},this.getSize=function(T){return T.set(I,L)},this.setSize=function(T,G,X){if(De.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}I=T,L=G,e.width=Math.floor(T*F),e.height=Math.floor(G*F),X!==!1&&(e.style.width=T+"px",e.style.height=G+"px"),this.setViewport(0,0,T,G)},this.getDrawingBufferSize=function(T){return T.set(I*F,L*F).floor()},this.setDrawingBufferSize=function(T,G,X){I=T,L=G,F=X,e.width=Math.floor(T*X),e.height=Math.floor(G*X),this.setViewport(0,0,T,G)},this.getCurrentViewport=function(T){return T.copy(M)},this.getViewport=function(T){return T.copy(k)},this.setViewport=function(T,G,X,q){T.isVector4?k.set(T.x,T.y,T.z,T.w):k.set(T,G,X,q),xe.viewport(M.copy(k).multiplyScalar(F).floor())},this.getScissor=function(T){return T.copy(V)},this.setScissor=function(T,G,X,q){T.isVector4?V.set(T.x,T.y,T.z,T.w):V.set(T,G,X,q),xe.scissor(R.copy(V).multiplyScalar(F).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(T){xe.setScissorTest(O=T)},this.setOpaqueSort=function(T){U=T},this.setTransparentSort=function(T){B=T},this.getClearColor=function(T){return T.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(T=!0,G=!0,X=!0){let q=0;T&&(q|=16384),G&&(q|=256),X&&(q|=1024),te.clear(q)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ot,!1),e.removeEventListener("webglcontextrestored",Ct,!1),e.removeEventListener("webglcontextcreationerror",nn,!1),wr.dispose(),N.dispose(),lt.dispose(),Rn.dispose(),gi.dispose(),Pn.dispose(),Oe.dispose(),Me.dispose(),kt.dispose(),De.dispose(),De.removeEventListener("sessionstart",Vt),De.removeEventListener("sessionend",Sn),$&&($.dispose(),$=null),rn.stop()};function ot(T){T.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function Ct(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;let T=$t.autoReset,G=ee.enabled,X=ee.autoUpdate,q=ee.needsUpdate,re=ee.type;Ae(),$t.autoReset=T,ee.enabled=G,ee.autoUpdate=X,ee.needsUpdate=q,ee.type=re}function nn(T){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",T.statusMessage)}function z(T){let G=T.target;G.removeEventListener("dispose",z),be(G)}function be(T){J(T),lt.remove(T)}function J(T){let G=lt.get(T).programs;G!==void 0&&(G.forEach(function(X){kt.releaseProgram(X)}),T.isShaderMaterial&&kt.releaseShaderCache(T))}this.renderBufferDirect=function(T,G,X,q,re,Ne){G===null&&(G=Ee);let et=re.isMesh&&re.matrixWorld.determinant()<0,tt=zI(T,G,X,q,re);xe.setMaterial(q,et);let pt=X.index,Kt=X.attributes.position;if(pt===null){if(Kt===void 0||Kt.count===0)return}else if(pt.count===0)return;let ft=1;q.wireframe===!0&&(pt=br.getWireframeAttribute(X),ft=2),Oe.setup(re,q,tt,X,pt);let yt,Cn=ge;pt!==null&&(yt=Yn.get(pt),Cn=Ke,Cn.setIndex(yt));let Ts=pt!==null?pt.count:Kt.count,Ca=X.drawRange.start*ft,Ea=X.drawRange.count*ft,xr=Ne!==null?Ne.start*ft:0,Et=Ne!==null?Ne.count*ft:1/0,Ma=Math.max(Ca,xr),ac=Math.min(Ts,Ca+Ea,xr+Et)-1,Ni=Math.max(0,ac-Ma+1);if(Ni!==0){if(re.isMesh)q.wireframe===!0?(xe.setLineWidth(q.wireframeLinewidth*ht()),Cn.setMode(1)):Cn.setMode(4);else if(re.isLine){let Ho=q.linewidth;Ho===void 0&&(Ho=1),xe.setLineWidth(Ho*ht()),re.isLineSegments?Cn.setMode(1):re.isLineLoop?Cn.setMode(2):Cn.setMode(3)}else re.isPoints?Cn.setMode(0):re.isSprite&&Cn.setMode(4);if(re.isInstancedMesh)Cn.renderInstances(Ma,Ni,re.count);else if(X.isInstancedBufferGeometry){let Ho=Math.min(X.instanceCount,X._maxInstanceCount);Cn.renderInstances(Ma,Ni,Ho)}else Cn.render(Ma,Ni)}},this.compile=function(T,G){d=N.get(T),d.init(),g.push(d),T.traverseVisible(function(X){X.isLight&&X.layers.test(G.layers)&&(d.pushLight(X),X.castShadow&&d.pushShadow(X))}),d.setupLights(f.physicallyCorrectLights),T.traverse(function(X){let q=X.material;if(q)if(Array.isArray(q))for(let re=0;re<q.length;re++){let Ne=q[re];$m(Ne,T,X)}else $m(q,T,X)}),g.pop(),d=null};let Se=null;function fe(T){Se&&Se(T)}function Vt(){rn.stop()}function Sn(){rn.start()}let rn=new yI;rn.setAnimationLoop(fe),typeof self<"u"&&rn.setContext(self),this.setAnimationLoop=function(T){Se=T,De.setAnimationLoop(T),T===null?rn.stop():rn.start()},De.addEventListener("sessionstart",Vt),De.addEventListener("sessionend",Sn),this.render=function(T,G){if(G!==void 0&&G.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;T.autoUpdate===!0&&T.updateMatrixWorld(),G.parent===null&&G.updateMatrixWorld(),De.enabled===!0&&De.isPresenting===!0&&(De.cameraAutoUpdate===!0&&De.updateCamera(G),G=De.getCamera()),T.isScene===!0&&T.onBeforeRender(f,T,G,x),d=N.get(T,g.length),d.init(),g.push(d),ce.multiplyMatrices(G.projectionMatrix,G.matrixWorldInverse),Z.setFromProjectionMatrix(ce),j=this.localClippingEnabled,K=D.init(this.clippingPlanes,j,G),h=wr.get(T,p.length),h.init(),p.push(h),Uo(T,G,0,f.sortObjects),h.finish(),f.sortObjects===!0&&h.sort(U,B),K===!0&&D.beginShadows();let X=d.state.shadowsArray;if(ee.render(X,T,G),K===!0&&D.endShadows(),this.info.autoReset===!0&&this.info.reset(),de.render(h,T),d.setupLights(f.physicallyCorrectLights),G.isArrayCamera){let q=G.cameras;for(let re=0,Ne=q.length;re<Ne;re++){let et=q[re];Xt(h,T,et,et.viewport)}}else Xt(h,T,G);x!==null&&(Fe.updateMultisampleRenderTarget(x),Fe.updateRenderTargetMipmap(x)),T.isScene===!0&&T.onAfterRender(f,T,G),Oe.resetDefaultState(),_=-1,S=null,g.pop(),g.length>0?d=g[g.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function Uo(T,G,X,q){if(T.visible===!1)return;if(T.layers.test(G.layers)){if(T.isGroup)X=T.renderOrder;else if(T.isLOD)T.autoUpdate===!0&&T.update(G);else if(T.isLight)d.pushLight(T),T.castShadow&&d.pushShadow(T);else if(T.isSprite){if(!T.frustumCulled||Z.intersectsSprite(T)){q&&le.setFromMatrixPosition(T.matrixWorld).applyMatrix4(ce);let Ne=Pn.update(T),et=T.material;et.visible&&h.push(T,Ne,et,X,le.z,null)}}else if((T.isMesh||T.isLine||T.isPoints)&&(T.isSkinnedMesh&&T.skeleton.frame!==$t.render.frame&&(T.skeleton.update(),T.skeleton.frame=$t.render.frame),!T.frustumCulled||Z.intersectsObject(T))){q&&le.setFromMatrixPosition(T.matrixWorld).applyMatrix4(ce);let Ne=Pn.update(T),et=T.material;if(Array.isArray(et)){let tt=Ne.groups;for(let pt=0,Kt=tt.length;pt<Kt;pt++){let ft=tt[pt],yt=et[ft.materialIndex];yt&&yt.visible&&h.push(T,Ne,yt,X,le.z,ft)}}else et.visible&&h.push(T,Ne,et,X,le.z,null)}}let re=T.children;for(let Ne=0,et=re.length;Ne<et;Ne++)Uo(re[Ne],G,X,q)}function Xt(T,G,X,q){let re=T.opaque,Ne=T.transmissive,et=T.transparent;d.setupLightsView(X),Ne.length>0&&io(re,G,X),q&&xe.viewport(M.copy(q)),re.length>0&&Pi(re,G,X),Ne.length>0&&Pi(Ne,G,X),et.length>0&&Pi(et,G,X),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1)}function io(T,G,X){let q=Xe.isWebGL2;$===null&&($=new Bo(1,1,{generateMipmaps:!0,type:We.has("EXT_color_buffer_half_float")?1016:1009,minFilter:1008,samples:q&&o===!0?4:0})),f.getDrawingBufferSize(W),q?$.setSize(W.x,W.y):$.setSize(kb(W.x),kb(W.y));let re=f.getRenderTarget();f.setRenderTarget($),f.clear();let Ne=f.toneMapping;f.toneMapping=0,Pi(T,G,X),f.toneMapping=Ne,Fe.updateMultisampleRenderTarget($),Fe.updateRenderTargetMipmap($),f.setRenderTarget(re)}function Pi(T,G,X){let q=G.isScene===!0?G.overrideMaterial:null;for(let re=0,Ne=T.length;re<Ne;re++){let et=T[re],tt=et.object,pt=et.geometry,Kt=q===null?et.material:q,ft=et.group;tt.layers.test(X.layers)&&BI(tt,G,X,pt,Kt,ft)}}function BI(T,G,X,q,re,Ne){T.onBeforeRender(f,G,X,q,re,Ne),T.modelViewMatrix.multiplyMatrices(X.matrixWorldInverse,T.matrixWorld),T.normalMatrix.getNormalMatrix(T.modelViewMatrix),re.onBeforeRender(f,G,X,q,T,Ne),re.transparent===!0&&re.side===2?(re.side=1,re.needsUpdate=!0,f.renderBufferDirect(X,G,q,re,T,Ne),re.side=0,re.needsUpdate=!0,f.renderBufferDirect(X,G,q,re,T,Ne),re.side=2):f.renderBufferDirect(X,G,q,re,T,Ne),T.onAfterRender(f,G,X,q,re,Ne)}function $m(T,G,X){G.isScene!==!0&&(G=Ee);let q=lt.get(T),re=d.state.lights,Ne=d.state.shadowsArray,et=re.state.version,tt=kt.getParameters(T,re.state,Ne,G,X),pt=kt.getProgramCacheKey(tt),Kt=q.programs;q.environment=T.isMeshStandardMaterial?G.environment:null,q.fog=G.fog,q.envMap=(T.isMeshStandardMaterial?gi:Rn).get(T.envMap||q.environment),Kt===void 0&&(T.addEventListener("dispose",z),Kt=new Map,q.programs=Kt);let ft=Kt.get(pt);if(ft!==void 0){if(q.currentProgram===ft&&q.lightsStateVersion===et)return Mw(T,tt),ft}else tt.uniforms=kt.getUniforms(T),T.onBuild(X,tt,f),T.onBeforeCompile(tt,f),ft=kt.acquireProgram(tt,pt),Kt.set(pt,ft),q.uniforms=tt.uniforms;let yt=q.uniforms;(!T.isShaderMaterial&&!T.isRawShaderMaterial||T.clipping===!0)&&(yt.clippingPlanes=D.uniform),Mw(T,tt),q.needsLights=UI(T),q.lightsStateVersion=et,q.needsLights&&(yt.ambientLightColor.value=re.state.ambient,yt.lightProbe.value=re.state.probe,yt.directionalLights.value=re.state.directional,yt.directionalLightShadows.value=re.state.directionalShadow,yt.spotLights.value=re.state.spot,yt.spotLightShadows.value=re.state.spotShadow,yt.rectAreaLights.value=re.state.rectArea,yt.ltc_1.value=re.state.rectAreaLTC1,yt.ltc_2.value=re.state.rectAreaLTC2,yt.pointLights.value=re.state.point,yt.pointLightShadows.value=re.state.pointShadow,yt.hemisphereLights.value=re.state.hemi,yt.directionalShadowMap.value=re.state.directionalShadowMap,yt.directionalShadowMatrix.value=re.state.directionalShadowMatrix,yt.spotShadowMap.value=re.state.spotShadowMap,yt.spotShadowMatrix.value=re.state.spotShadowMatrix,yt.pointShadowMap.value=re.state.pointShadowMap,yt.pointShadowMatrix.value=re.state.pointShadowMatrix);let Cn=ft.getUniforms(),Ts=nc.seqWithValue(Cn.seq,yt);return q.currentProgram=ft,q.uniformsList=Ts,ft}function Mw(T,G){let X=lt.get(T);X.outputEncoding=G.outputEncoding,X.instancing=G.instancing,X.skinning=G.skinning,X.morphTargets=G.morphTargets,X.morphNormals=G.morphNormals,X.morphColors=G.morphColors,X.morphTargetsCount=G.morphTargetsCount,X.numClippingPlanes=G.numClippingPlanes,X.numIntersection=G.numClipIntersection,X.vertexAlphas=G.vertexAlphas,X.vertexTangents=G.vertexTangents,X.toneMapping=G.toneMapping}function zI(T,G,X,q,re){G.isScene!==!0&&(G=Ee),Fe.resetTextureUnits();let Ne=G.fog,et=q.isMeshStandardMaterial?G.environment:null,tt=x===null?f.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:3e3,pt=(q.isMeshStandardMaterial?gi:Rn).get(q.envMap||et),Kt=q.vertexColors===!0&&!!X.attributes.color&&X.attributes.color.itemSize===4,ft=!!q.normalMap&&!!X.attributes.tangent,yt=!!X.morphAttributes.position,Cn=!!X.morphAttributes.normal,Ts=!!X.morphAttributes.color,Ca=q.toneMapped?f.toneMapping:0,Ea=X.morphAttributes.position||X.morphAttributes.normal||X.morphAttributes.color,xr=Ea!==void 0?Ea.length:0,Et=lt.get(q),Ma=d.state.lights;if(K===!0&&(j===!0||T!==S)){let vi=T===S&&q.id===_;D.setState(q,T,vi)}let ac=!1;q.version===Et.__version?(Et.needsLights&&Et.lightsStateVersion!==Ma.state.version||Et.outputEncoding!==tt||re.isInstancedMesh&&Et.instancing===!1||!re.isInstancedMesh&&Et.instancing===!0||re.isSkinnedMesh&&Et.skinning===!1||!re.isSkinnedMesh&&Et.skinning===!0||Et.envMap!==pt||q.fog===!0&&Et.fog!==Ne||Et.numClippingPlanes!==void 0&&(Et.numClippingPlanes!==D.numPlanes||Et.numIntersection!==D.numIntersection)||Et.vertexAlphas!==Kt||Et.vertexTangents!==ft||Et.morphTargets!==yt||Et.morphNormals!==Cn||Et.morphColors!==Ts||Et.toneMapping!==Ca||Xe.isWebGL2===!0&&Et.morphTargetsCount!==xr)&&(ac=!0):(ac=!0,Et.__version=q.version);let Ni=Et.currentProgram;ac===!0&&(Ni=$m(q,G,re));let Ho=!1,lc=!1,Ym=!1,Zn=Ni.getUniforms(),cc=Et.uniforms;if(xe.useProgram(Ni.program)&&(Ho=!0,lc=!0,Ym=!0),q.id!==_&&(_=q.id,lc=!0),Ho||S!==T){if(Zn.setValue(te,"projectionMatrix",T.projectionMatrix),Xe.logarithmicDepthBuffer&&Zn.setValue(te,"logDepthBufFC",2/(Math.log(T.far+1)/Math.LN2)),S!==T&&(S=T,lc=!0,Ym=!0),q.isShaderMaterial||q.isMeshPhongMaterial||q.isMeshToonMaterial||q.isMeshStandardMaterial||q.envMap){let vi=Zn.map.cameraPosition;vi!==void 0&&vi.setValue(te,le.setFromMatrixPosition(T.matrixWorld))}(q.isMeshPhongMaterial||q.isMeshToonMaterial||q.isMeshLambertMaterial||q.isMeshBasicMaterial||q.isMeshStandardMaterial||q.isShaderMaterial)&&Zn.setValue(te,"isOrthographic",T.isOrthographicCamera===!0),(q.isMeshPhongMaterial||q.isMeshToonMaterial||q.isMeshLambertMaterial||q.isMeshBasicMaterial||q.isMeshStandardMaterial||q.isShaderMaterial||q.isShadowMaterial||re.isSkinnedMesh)&&Zn.setValue(te,"viewMatrix",T.matrixWorldInverse)}if(re.isSkinnedMesh){Zn.setOptional(te,re,"bindMatrix"),Zn.setOptional(te,re,"bindMatrixInverse");let vi=re.skeleton;vi&&(Xe.floatVertexTextures?(vi.boneTexture===null&&vi.computeBoneTexture(),Zn.setValue(te,"boneTexture",vi.boneTexture,Fe),Zn.setValue(te,"boneTextureSize",vi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let Zm=X.morphAttributes;if((Zm.position!==void 0||Zm.normal!==void 0||Zm.color!==void 0&&Xe.isWebGL2===!0)&&pe.update(re,X,q,Ni),(lc||Et.receiveShadow!==re.receiveShadow)&&(Et.receiveShadow=re.receiveShadow,Zn.setValue(te,"receiveShadow",re.receiveShadow)),lc&&(Zn.setValue(te,"toneMappingExposure",f.toneMappingExposure),Et.needsLights&&jI(cc,Ym),Ne&&q.fog===!0&&no.refreshFogUniforms(cc,Ne),no.refreshMaterialUniforms(cc,q,F,L,$),nc.upload(te,Et.uniformsList,cc,Fe)),q.isShaderMaterial&&q.uniformsNeedUpdate===!0&&(nc.upload(te,Et.uniformsList,cc,Fe),q.uniformsNeedUpdate=!1),q.isSpriteMaterial&&Zn.setValue(te,"center",re.center),Zn.setValue(te,"modelViewMatrix",re.modelViewMatrix),Zn.setValue(te,"normalMatrix",re.normalMatrix),Zn.setValue(te,"modelMatrix",re.matrixWorld),q.isShaderMaterial||q.isRawShaderMaterial){let vi=q.uniformsGroups;for(let Xm=0,HI=vi.length;Xm<HI;Xm++)if(Xe.isWebGL2){let Dw=vi[Xm];Me.update(Dw,Ni),Me.bind(Dw,Ni)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ni}function jI(T,G){T.ambientLightColor.needsUpdate=G,T.lightProbe.needsUpdate=G,T.directionalLights.needsUpdate=G,T.directionalLightShadows.needsUpdate=G,T.pointLights.needsUpdate=G,T.pointLightShadows.needsUpdate=G,T.spotLights.needsUpdate=G,T.spotLightShadows.needsUpdate=G,T.rectAreaLights.needsUpdate=G,T.hemisphereLights.needsUpdate=G}function UI(T){return T.isMeshLambertMaterial||T.isMeshToonMaterial||T.isMeshPhongMaterial||T.isMeshStandardMaterial||T.isShadowMaterial||T.isShaderMaterial&&T.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(T,G,X){lt.get(T.texture).__webglTexture=G,lt.get(T.depthTexture).__webglTexture=X;let q=lt.get(T);q.__hasExternalTextures=!0,q.__hasExternalTextures&&(q.__autoAllocateDepthBuffer=X===void 0,q.__autoAllocateDepthBuffer||We.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),q.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(T,G){let X=lt.get(T);X.__webglFramebuffer=G,X.__useDefaultFramebuffer=G===void 0},this.setRenderTarget=function(T,G=0,X=0){x=T,v=G,y=X;let q=!0;if(T){let tt=lt.get(T);tt.__useDefaultFramebuffer!==void 0?(xe.bindFramebuffer(36160,null),q=!1):tt.__webglFramebuffer===void 0?Fe.setupRenderTarget(T):tt.__hasExternalTextures&&Fe.rebindTextures(T,lt.get(T.texture).__webglTexture,lt.get(T.depthTexture).__webglTexture)}let re=null,Ne=!1,et=!1;if(T){let tt=T.texture;(tt.isData3DTexture||tt.isDataArrayTexture)&&(et=!0);let pt=lt.get(T).__webglFramebuffer;T.isWebGLCubeRenderTarget?(re=pt[G],Ne=!0):Xe.isWebGL2&&T.samples>0&&Fe.useMultisampledRTT(T)===!1?re=lt.get(T).__webglMultisampledFramebuffer:re=pt,M.copy(T.viewport),R.copy(T.scissor),b=T.scissorTest}else M.copy(k).multiplyScalar(F).floor(),R.copy(V).multiplyScalar(F).floor(),b=O;if(xe.bindFramebuffer(36160,re)&&Xe.drawBuffers&&q&&xe.drawBuffers(T,re),xe.viewport(M),xe.scissor(R),xe.setScissorTest(b),Ne){let tt=lt.get(T.texture);te.framebufferTexture2D(36160,36064,34069+G,tt.__webglTexture,X)}else if(et){let tt=lt.get(T.texture),pt=G||0;te.framebufferTextureLayer(36160,36064,tt.__webglTexture,X||0,pt)}_=-1},this.readRenderTargetPixels=function(T,G,X,q,re,Ne,et){if(!(T&&T.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let tt=lt.get(T).__webglFramebuffer;if(T.isWebGLCubeRenderTarget&&et!==void 0&&(tt=tt[et]),tt){xe.bindFramebuffer(36160,tt);try{let pt=T.texture,Kt=pt.format,ft=pt.type;if(Kt!==1023&&Q.convert(Kt)!==te.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let yt=ft===1016&&(We.has("EXT_color_buffer_half_float")||Xe.isWebGL2&&We.has("EXT_color_buffer_float"));if(ft!==1009&&Q.convert(ft)!==te.getParameter(35738)&&!(ft===1015&&(Xe.isWebGL2||We.has("OES_texture_float")||We.has("WEBGL_color_buffer_float")))&&!yt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}G>=0&&G<=T.width-q&&X>=0&&X<=T.height-re&&te.readPixels(G,X,q,re,Q.convert(Kt),Q.convert(ft),Ne)}finally{let pt=x!==null?lt.get(x).__webglFramebuffer:null;xe.bindFramebuffer(36160,pt)}}},this.copyFramebufferToTexture=function(T,G,X=0){let q=Math.pow(2,-X),re=Math.floor(G.image.width*q),Ne=Math.floor(G.image.height*q);Fe.setTexture2D(G,0),te.copyTexSubImage2D(3553,X,0,0,T.x,T.y,re,Ne),xe.unbindTexture()},this.copyTextureToTexture=function(T,G,X,q=0){let re=G.image.width,Ne=G.image.height,et=Q.convert(X.format),tt=Q.convert(X.type);Fe.setTexture2D(X,0),te.pixelStorei(37440,X.flipY),te.pixelStorei(37441,X.premultiplyAlpha),te.pixelStorei(3317,X.unpackAlignment),G.isDataTexture?te.texSubImage2D(3553,q,T.x,T.y,re,Ne,et,tt,G.image.data):G.isCompressedTexture?te.compressedTexSubImage2D(3553,q,T.x,T.y,G.mipmaps[0].width,G.mipmaps[0].height,et,G.mipmaps[0].data):te.texSubImage2D(3553,q,T.x,T.y,et,tt,G.image),q===0&&X.generateMipmaps&&te.generateMipmap(3553),xe.unbindTexture()},this.copyTextureToTexture3D=function(T,G,X,q,re=0){if(f.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Ne=T.max.x-T.min.x+1,et=T.max.y-T.min.y+1,tt=T.max.z-T.min.z+1,pt=Q.convert(q.format),Kt=Q.convert(q.type),ft;if(q.isData3DTexture)Fe.setTexture3D(q,0),ft=32879;else if(q.isDataArrayTexture)Fe.setTexture2DArray(q,0),ft=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}te.pixelStorei(37440,q.flipY),te.pixelStorei(37441,q.premultiplyAlpha),te.pixelStorei(3317,q.unpackAlignment);let yt=te.getParameter(3314),Cn=te.getParameter(32878),Ts=te.getParameter(3316),Ca=te.getParameter(3315),Ea=te.getParameter(32877),xr=X.isCompressedTexture?X.mipmaps[0]:X.image;te.pixelStorei(3314,xr.width),te.pixelStorei(32878,xr.height),te.pixelStorei(3316,T.min.x),te.pixelStorei(3315,T.min.y),te.pixelStorei(32877,T.min.z),X.isDataTexture||X.isData3DTexture?te.texSubImage3D(ft,re,G.x,G.y,G.z,Ne,et,tt,pt,Kt,xr.data):X.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),te.compressedTexSubImage3D(ft,re,G.x,G.y,G.z,Ne,et,tt,pt,xr.data)):te.texSubImage3D(ft,re,G.x,G.y,G.z,Ne,et,tt,pt,Kt,xr),te.pixelStorei(3314,yt),te.pixelStorei(32878,Cn),te.pixelStorei(3316,Ts),te.pixelStorei(3315,Ca),te.pixelStorei(32877,Ea),re===0&&q.generateMipmaps&&te.generateMipmap(ft),xe.unbindTexture()},this.initTexture=function(T){T.isCubeTexture?Fe.setTextureCube(T,0):T.isData3DTexture?Fe.setTexture3D(T,0):T.isDataArrayTexture?Fe.setTexture2DArray(T,0):Fe.setTexture2D(T,0),xe.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,xe.reset(),Oe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Kb=class extends CI{};Kb.prototype.isWebGL1Renderer=!0;var Qb=class extends eo{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}},Em=class extends Is{constructor(e,t,n,r,o,s,a,l,c){super(e,t,n,r,o,s,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}},Jb=class i extends to{constructor(e=1,t=1,n=1,r=8,o=1,s=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l};let c=this;r=Math.floor(r),o=Math.floor(o);let u=[],h=[],d=[],p=[],g=0,f=[],m=n/2,v=0;y(),s===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Tn(h,3)),this.setAttribute("normal",new Tn(d,3)),this.setAttribute("uv",new Tn(p,2));function y(){let _=new H,S=new H,M=0,R=(t-e)/n;for(let b=0;b<=o;b++){let I=[],L=b/o,F=L*(t-e)+e;for(let U=0;U<=r;U++){let B=U/r,k=B*l+a,V=Math.sin(k),O=Math.cos(k);S.x=F*V,S.y=-L*n+m,S.z=F*O,h.push(S.x,S.y,S.z),_.set(V,R,O).normalize(),d.push(_.x,_.y,_.z),p.push(B,1-L),I.push(g++)}f.push(I)}for(let b=0;b<r;b++)for(let I=0;I<o;I++){let L=f[I][b],F=f[I+1][b],U=f[I+1][b+1],B=f[I][b+1];u.push(L,F,B),u.push(F,U,B),M+=6}c.addGroup(v,M,0),v+=M}function x(_){let S=g,M=new vt,R=new H,b=0,I=_===!0?e:t,L=_===!0?1:-1;for(let U=1;U<=r;U++)h.push(0,m*L,0),d.push(0,L,0),p.push(.5,.5),g++;let F=g;for(let U=0;U<=r;U++){let B=U/r*l+a,k=Math.cos(B),V=Math.sin(B);R.x=I*V,R.y=m*L,R.z=I*k,h.push(R.x,R.y,R.z),d.push(0,L,0),M.x=k*.5+.5,M.y=V*.5*L+.5,p.push(M.x,M.y),g++}for(let U=0;U<r;U++){let B=S+U,k=F+U;_===!0?u.push(k,k+1,B):u.push(k+1,k,B),b+=3}c.addGroup(v,b,_===!0?1:2),v+=b}}static fromJSON(e){return new i(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},ew=class extends zo{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new _t(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}},tw=class extends zo{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new _t(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},nw=class extends zo{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new _t(16777215),this.specular=new _t(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},Mm=class extends eo{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new _t(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},iw=class extends Mm{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(eo.DefaultUp),this.updateMatrix(),this.groundColor=new _t(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},QD=new An,JD=new H,eI=new H,rw=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new vt(512,512),this.map=null,this.mapPass=null,this.matrix=new An,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new dd,this._frameExtents=new vt(1,1),this._viewportCount=1,this._viewports=[new xn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;JD.setFromMatrixPosition(e.matrixWorld),t.position.copy(JD),eI.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(eI),t.updateMatrixWorld(),QD.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(QD),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},ow=class extends rw{constructor(){super(new ni(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,n=Nb*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(n!==t.fov||r!==t.aspect||o!==t.far)&&(t.fov=n,t.aspect=r,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},sw=class extends Mm{constructor(e,t,n=0,r=Math.PI/3,o=0,s=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(eo.DefaultUp),this.updateMatrix(),this.target=new eo,this.distance=n,this.angle=r,this.penumbra=o,this.decay=s,this.shadow=new ow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ww}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ww);var Ds=class i{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){let e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){let e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){let t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new w);let t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new w);let n=this.elements,r=e.x,o=e.y,s=e.z;return t.x=n[0]*r+n[1]*o+n[2]*s,t.y=n[3]*r+n[4]*o+n[5]*s,t.z=n[6]*r+n[7]*o+n[8]*s,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new i);let n=this.elements,r=e.elements,o=t.elements,s=n[0],a=n[1],l=n[2],c=n[3],u=n[4],h=n[5],d=n[6],p=n[7],g=n[8],f=r[0],m=r[1],v=r[2],y=r[3],x=r[4],_=r[5],S=r[6],M=r[7],R=r[8];return o[0]=s*f+a*y+l*S,o[1]=s*m+a*x+l*M,o[2]=s*v+a*_+l*R,o[3]=c*f+u*y+h*S,o[4]=c*m+u*x+h*M,o[5]=c*v+u*_+h*R,o[6]=d*f+p*y+g*S,o[7]=d*m+p*x+g*M,o[8]=d*v+p*_+g*R,t}scale(e,t){t===void 0&&(t=new i);let n=this.elements,r=t.elements;for(let o=0;o!==3;o++)r[3*o+0]=e.x*n[3*o+0],r[3*o+1]=e.y*n[3*o+1],r[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new w);let n=3,r=4,o=[],s,a;for(s=0;s<n*r;s++)o.push(0);for(s=0;s<3;s++)for(a=0;a<3;a++)o[s+r*a]=this.elements[s+3*a];o[3]=e.x,o[7]=e.y,o[11]=e.z;let l=3,c=l,u,h=4,d;do{if(s=c-l,o[s+r*s]===0){for(a=s+1;a<c;a++)if(o[s+r*a]!==0){u=h;do d=h-u,o[d+r*s]+=o[d+r*a];while(--u);break}}if(o[s+r*s]!==0)for(a=s+1;a<c;a++){let p=o[s+r*a]/o[s+r*s];u=h;do d=h-u,o[d+r*a]=d<=s?0:o[d+r*a]-o[d+r*s]*p;while(--u)}}while(--l);if(t.z=o[2*r+3]/o[2*r+2],t.y=(o[1*r+3]-o[1*r+2]*t.z)/o[1*r+1],t.x=(o[0*r+3]-o[0*r+2]*t.z-o[0*r+1]*t.y)/o[0*r+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let n=0;n<9;n++)e+=this.elements[n]+",";return e}reverse(e){e===void 0&&(e=new i);let t=3,n=6,r=pj,o,s;for(o=0;o<3;o++)for(s=0;s<3;s++)r[o+n*s]=this.elements[o+3*s];r[3]=1,r[9]=0,r[15]=0,r[4]=0,r[10]=1,r[16]=0,r[5]=0,r[11]=0,r[17]=1;let a=3,l=a,c,u=n,h;do{if(o=l-a,r[o+n*o]===0){for(s=o+1;s<l;s++)if(r[o+n*s]!==0){c=u;do h=u-c,r[h+n*o]+=r[h+n*s];while(--c);break}}if(r[o+n*o]!==0)for(s=o+1;s<l;s++){let d=r[o+n*s]/r[o+n*o];c=u;do h=u-c,r[h+n*s]=h<=o?0:r[h+n*s]-r[h+n*o]*d;while(--c)}}while(--a);o=2;do{s=o-1;do{let d=r[o+n*s]/r[o+n*o];c=n;do h=n-c,r[h+n*s]=r[h+n*s]-r[h+n*o]*d;while(--c)}while(s--)}while(--o);o=2;do{let d=1/r[o+n*o];c=n;do h=n-c,r[h+n*o]=r[h+n*o]*d;while(--c)}while(o--);o=2;do{s=2;do{if(h=r[t+s+n*o],isNaN(h)||h===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,s,h)}while(s--)}while(o--);return e}setRotationFromQuaternion(e){let t=e.x,n=e.y,r=e.z,o=e.w,s=t+t,a=n+n,l=r+r,c=t*s,u=t*a,h=t*l,d=n*a,p=n*l,g=r*l,f=o*s,m=o*a,v=o*l,y=this.elements;return y[0]=1-(d+g),y[1]=u-v,y[2]=h+m,y[3]=u+v,y[4]=1-(c+g),y[5]=p-f,y[6]=h-m,y[7]=p+f,y[8]=1-(c+d),this}transpose(e){e===void 0&&(e=new i);let t=this.elements,n=e.elements,r;return n[0]=t[0],n[4]=t[4],n[8]=t[8],r=t[1],n[1]=t[3],n[3]=r,r=t[2],n[2]=t[6],n[6]=r,r=t[5],n[5]=t[7],n[7]=r,e}},pj=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=class i{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new i);let n=e.x,r=e.y,o=e.z,s=this.x,a=this.y,l=this.z;return t.x=a*o-l*r,t.y=l*n-s*o,t.z=s*r-a*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new i(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new i(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Ds([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){let e=this.x,t=this.y,n=this.z,r=Math.sqrt(e*e+t*t+n*n);if(r>0){let o=1/r;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new i);let t=this.x,n=this.y,r=this.z,o=Math.sqrt(t*t+n*n+r*r);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=r*o):(e.x=1,e.y=0,e.z=0),e}length(){let e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){let t=this.x,n=this.y,r=this.z,o=e.x,s=e.y,a=e.z;return Math.sqrt((o-t)*(o-t)+(s-n)*(s-n)+(a-r)*(a-r))}distanceSquared(e){let t=this.x,n=this.y,r=this.z,o=e.x,s=e.y,a=e.z;return(o-t)*(o-t)+(s-n)*(s-n)+(a-r)*(a-r)}scale(e,t){t===void 0&&(t=new i);let n=this.x,r=this.y,o=this.z;return t.x=e*n,t.y=e*r,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new i),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new i),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new i),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){let n=this.length();if(n>0){let r=fj,o=1/n;r.set(this.x*o,this.y*o,this.z*o);let s=mj;Math.abs(r.x)<.9?(s.set(1,0,0),r.cross(s,e)):(s.set(0,1,0),r.cross(s,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){let r=this.x,o=this.y,s=this.z;n.x=r+(e.x-r)*t,n.y=o+(e.y-o)*t,n.z=s+(e.z-s)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(tI),tI.almostEquals(e,t)}clone(){return new i(this.x,this.y,this.z)}};w.ZERO=new w(0,0,0);w.UNIT_X=new w(1,0,0);w.UNIT_Y=new w(0,1,0);w.UNIT_Z=new w(0,0,1);var fj=new w,mj=new w,tI=new w,Ri=class i{constructor(e){e===void 0&&(e={}),this.lowerBound=new w,this.upperBound=new w,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,r){let o=this.lowerBound,s=this.upperBound,a=n;o.copy(e[0]),a&&a.vmult(o,o),s.copy(o);for(let l=1;l<e.length;l++){let c=e[l];a&&(a.vmult(c,nI),c=nI),c.x>s.x&&(s.x=c.x),c.x<o.x&&(o.x=c.x),c.y>s.y&&(s.y=c.y),c.y<o.y&&(o.y=c.y),c.z>s.z&&(s.z=c.z),c.z<o.z&&(o.z=c.z)}return t&&(t.vadd(o,o),t.vadd(s,s)),r&&(o.x-=r,o.y-=r,o.z-=r,s.x+=r,s.y+=r,s.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new i().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){let t=this.lowerBound,n=this.upperBound,r=e.lowerBound,o=e.upperBound,s=r.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,a=r.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,l=r.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return s&&a&&l}volume(){let e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){let t=this.lowerBound,n=this.upperBound,r=e.lowerBound,o=e.upperBound;return t.x<=r.x&&n.x>=o.x&&t.y<=r.y&&n.y>=o.y&&t.z<=r.z&&n.z>=o.z}getCorners(e,t,n,r,o,s,a,l){let c=this.lowerBound,u=this.upperBound;e.copy(c),t.set(u.x,c.y,c.z),n.set(u.x,u.y,c.z),r.set(c.x,u.y,u.z),o.set(u.x,c.y,u.z),s.set(c.x,u.y,c.z),a.set(c.x,c.y,u.z),l.copy(u)}toLocalFrame(e,t){let n=iI,r=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7];this.getCorners(r,o,s,a,l,c,u,h);for(let d=0;d!==8;d++){let p=n[d];e.pointToLocal(p,p)}return t.setFromPoints(n)}toWorldFrame(e,t){let n=iI,r=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7];this.getCorners(r,o,s,a,l,c,u,h);for(let d=0;d!==8;d++){let p=n[d];e.pointToWorld(p,p)}return t.setFromPoints(n)}overlapsRay(e){let{direction:t,from:n}=e,r=1/t.x,o=1/t.y,s=1/t.z,a=(this.lowerBound.x-n.x)*r,l=(this.upperBound.x-n.x)*r,c=(this.lowerBound.y-n.y)*o,u=(this.upperBound.y-n.y)*o,h=(this.lowerBound.z-n.z)*s,d=(this.upperBound.z-n.z)*s,p=Math.max(Math.max(Math.min(a,l),Math.min(c,u)),Math.min(h,d)),g=Math.min(Math.min(Math.max(a,l),Math.max(c,u)),Math.max(h,d));return!(g<0||p>g)}},nI=new w,iI=[new w,new w,new w,new w,new w,new w,new w,new w],Dm=class{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:r}=t;if(r>n){let o=r;r=n,n=o}return this.matrix[(n*(n+1)>>1)+r-1]}set(e,t,n){let{index:r}=e,{index:o}=t;if(o>r){let s=o;o=r,r=s}this.matrix[(r*(r+1)>>1)+o-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}},Im=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return!!(n[e]!==void 0&&n[e].includes(t))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;let n=this._listeners;if(n[e]===void 0)return this;let r=n[e].indexOf(t);return r!==-1&&n[e].splice(r,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;let t=this._listeners[e.type];if(t!==void 0){e.target=this;for(let n=0,r=t.length;n<r;n++)t[n].call(this,e)}return this}},ii=class i{constructor(e,t,n,r){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),r===void 0&&(r=1),this.x=e,this.y=t,this.z=n,this.w=r}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){let n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new w),this.normalize();let t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){let n=gj,r=vj;e.tangents(n,r),this.setFromAxisAngle(n,Math.PI)}else{let n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new i);let n=this.x,r=this.y,o=this.z,s=this.w,a=e.x,l=e.y,c=e.z,u=e.w;return t.x=n*u+s*a+r*c-o*l,t.y=r*u+s*l+o*a-n*c,t.z=o*u+s*c+n*l-r*a,t.w=s*u-n*a-r*l-o*c,t}inverse(e){e===void 0&&(e=new i);let t=this.x,n=this.y,r=this.z,o=this.w;this.conjugate(e);let s=1/(t*t+n*n+r*r+o*o);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e}conjugate(e){return e===void 0&&(e=new i),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){let e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new w);let n=e.x,r=e.y,o=e.z,s=this.x,a=this.y,l=this.z,c=this.w,u=c*n+a*o-l*r,h=c*r+l*n-s*o,d=c*o+s*r-a*n,p=-s*n-a*r-l*o;return t.x=u*c+p*-s+h*-l-d*-a,t.y=h*c+p*-a+d*-s-u*-l,t.z=d*c+p*-l+u*-a-h*-s,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,r,o,s=this.x,a=this.y,l=this.z,c=this.w;switch(t){case"YZX":let u=s*a+l*c;if(u>.499&&(n=2*Math.atan2(s,c),r=Math.PI/2,o=0),u<-.499&&(n=-2*Math.atan2(s,c),r=-Math.PI/2,o=0),n===void 0){let h=s*s,d=a*a,p=l*l;n=Math.atan2(2*a*c-2*s*l,1-2*d-2*p),r=Math.asin(2*u),o=Math.atan2(2*s*c-2*a*l,1-2*h-2*p)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=r,e.x=o}setFromEuler(e,t,n,r){r===void 0&&(r="XYZ");let o=Math.cos(e/2),s=Math.cos(t/2),a=Math.cos(n/2),l=Math.sin(e/2),c=Math.sin(t/2),u=Math.sin(n/2);return r==="XYZ"?(this.x=l*s*a+o*c*u,this.y=o*c*a-l*s*u,this.z=o*s*u+l*c*a,this.w=o*s*a-l*c*u):r==="YXZ"?(this.x=l*s*a+o*c*u,this.y=o*c*a-l*s*u,this.z=o*s*u-l*c*a,this.w=o*s*a+l*c*u):r==="ZXY"?(this.x=l*s*a-o*c*u,this.y=o*c*a+l*s*u,this.z=o*s*u+l*c*a,this.w=o*s*a-l*c*u):r==="ZYX"?(this.x=l*s*a-o*c*u,this.y=o*c*a+l*s*u,this.z=o*s*u-l*c*a,this.w=o*s*a+l*c*u):r==="YZX"?(this.x=l*s*a+o*c*u,this.y=o*c*a+l*s*u,this.z=o*s*u-l*c*a,this.w=o*s*a-l*c*u):r==="XZY"&&(this.x=l*s*a-o*c*u,this.y=o*c*a-l*s*u,this.z=o*s*u+l*c*a,this.w=o*s*a+l*c*u),this}clone(){return new i(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new i);let r=this.x,o=this.y,s=this.z,a=this.w,l=e.x,c=e.y,u=e.z,h=e.w,d,p,g,f,m;return p=r*l+o*c+s*u+a*h,p<0&&(p=-p,l=-l,c=-c,u=-u,h=-h),1-p>1e-6?(d=Math.acos(p),g=Math.sin(d),f=Math.sin((1-t)*d)/g,m=Math.sin(t*d)/g):(f=1-t,m=t),n.x=f*r+m*l,n.y=f*o+m*c,n.z=f*s+m*u,n.w=f*a+m*h,n}integrate(e,t,n,r){r===void 0&&(r=new i);let o=e.x*n.x,s=e.y*n.y,a=e.z*n.z,l=this.x,c=this.y,u=this.z,h=this.w,d=t*.5;return r.x+=d*(o*h+s*u-a*c),r.y+=d*(s*h+a*l-o*u),r.z+=d*(a*h+o*c-s*l),r.w+=d*(-o*l-s*c-a*u),r}},gj=new w,vj=new w,yj={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256},Ie=(()=>{class i{constructor(t){t===void 0&&(t={}),this.id=i.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=t.collisionResponse?t.collisionResponse:!0,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:1,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,n){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,n,r,o){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}return i.idCounter=0,i.types=yj,i})(),It=class i{constructor(e){e===void 0&&(e={}),this.position=new w,this.quaternion=new ii,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return i.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return i.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new w),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,r){return r===void 0&&(r=new w),n.vsub(e,r),t.conjugate(rI),rI.vmult(r,r),r}static pointToWorldFrame(e,t,n,r){return r===void 0&&(r=new w),t.vmult(n,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new w),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,r){return r===void 0&&(r=new w),t.w*=-1,t.vmult(n,r),t.w*=-1,r}},rI=new ii,hd=class i extends Ie{constructor(e){e===void 0&&(e={});let{vertices:t=[],faces:n=[],normals:r=[],axes:o,boundingSphereRadius:s}=e;super({type:Ie.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=r,this.faceNormals.length===0&&this.computeNormals(),s?this.boundingSphereRadius=s:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=o?o.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){let e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;let r=new w;for(let o=0;o!==e.length;o++){let s=e[o],a=s.length;for(let l=0;l!==a;l++){let c=(l+1)%a;t[s[l]].vsub(t[s[c]],r),r.normalize();let u=!1;for(let h=0;h!==n.length;h++)if(n[h].almostEquals(r)||n[h].almostEquals(r)){u=!0;break}u||n.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let r=0;r<this.faces[e].length;r++)if(!this.vertices[this.faces[e][r]])throw new Error(`Vertex ${this.faces[e][r]} not found!`);let t=this.faceNormals[e]||new w;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;let n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let r=0;r<this.faces[e].length;r++)console.warn(`.vertices[${this.faces[e][r]}] = Vec3(${this.vertices[this.faces[e][r]].toString()})`)}}}getFaceNormal(e,t){let n=this.faces[e],r=this.vertices[n[0]],o=this.vertices[n[1]],s=this.vertices[n[2]];i.computeNormal(r,o,s,t)}static computeNormal(e,t,n,r){let o=new w,s=new w;t.vsub(e,s),n.vsub(t,o),o.cross(s,r),r.isZero()||r.normalize()}clipAgainstHull(e,t,n,r,o,s,a,l,c){let u=new w,h=-1,d=-Number.MAX_VALUE;for(let g=0;g<n.faces.length;g++){u.copy(n.faceNormals[g]),o.vmult(u,u);let f=u.dot(s);f>d&&(d=f,h=g)}let p=[];for(let g=0;g<n.faces[h].length;g++){let f=n.vertices[n.faces[h][g]],m=new w;m.copy(f),o.vmult(m,m),r.vadd(m,m),p.push(m)}h>=0&&this.clipFaceAgainstHull(s,e,t,p,a,l,c)}findSeparatingAxis(e,t,n,r,o,s,a,l){let c=new w,u=new w,h=new w,d=new w,p=new w,g=new w,f=Number.MAX_VALUE,m=this;if(m.uniqueAxes)for(let v=0;v!==m.uniqueAxes.length;v++){n.vmult(m.uniqueAxes[v],c);let y=m.testSepAxis(c,e,t,n,r,o);if(y===!1)return!1;y<f&&(f=y,s.copy(c))}else{let v=a?a.length:m.faces.length;for(let y=0;y<v;y++){let x=a?a[y]:y;c.copy(m.faceNormals[x]),n.vmult(c,c);let _=m.testSepAxis(c,e,t,n,r,o);if(_===!1)return!1;_<f&&(f=_,s.copy(c))}}if(e.uniqueAxes)for(let v=0;v!==e.uniqueAxes.length;v++){o.vmult(e.uniqueAxes[v],u);let y=m.testSepAxis(u,e,t,n,r,o);if(y===!1)return!1;y<f&&(f=y,s.copy(u))}else{let v=l?l.length:e.faces.length;for(let y=0;y<v;y++){let x=l?l[y]:y;u.copy(e.faceNormals[x]),o.vmult(u,u);let _=m.testSepAxis(u,e,t,n,r,o);if(_===!1)return!1;_<f&&(f=_,s.copy(u))}}for(let v=0;v!==m.uniqueEdges.length;v++){n.vmult(m.uniqueEdges[v],d);for(let y=0;y!==e.uniqueEdges.length;y++)if(o.vmult(e.uniqueEdges[y],p),d.cross(p,g),!g.almostZero()){g.normalize();let x=m.testSepAxis(g,e,t,n,r,o);if(x===!1)return!1;x<f&&(f=x,s.copy(g))}}return r.vsub(t,h),h.dot(s)>0&&s.negate(s),!0}testSepAxis(e,t,n,r,o,s){let a=this;i.project(a,e,n,r,Eb),i.project(t,e,o,s,Mb);let l=Eb[0],c=Eb[1],u=Mb[0],h=Mb[1];if(l<h||u<c)return!1;let d=l-h,p=u-c;return d<p?d:p}calculateLocalInertia(e,t){let n=new w,r=new w;this.computeLocalAABB(r,n);let o=n.x-r.x,s=n.y-r.y,a=n.z-r.z;t.x=1/12*e*(2*s*2*s+2*a*2*a),t.y=1/12*e*(2*o*2*o+2*a*2*a),t.z=1/12*e*(2*s*2*s+2*o*2*o)}getPlaneConstantOfFace(e){let t=this.faces[e],n=this.faceNormals[e],r=this.vertices[t[0]];return-n.dot(r)}clipFaceAgainstHull(e,t,n,r,o,s,a){let l=new w,c=new w,u=new w,h=new w,d=new w,p=new w,g=new w,f=new w,m=this,v=[],y=r,x=v,_=-1,S=Number.MAX_VALUE;for(let L=0;L<m.faces.length;L++){l.copy(m.faceNormals[L]),n.vmult(l,l);let F=l.dot(e);F<S&&(S=F,_=L)}if(_<0)return;let M=m.faces[_];M.connectedFaces=[];for(let L=0;L<m.faces.length;L++)for(let F=0;F<m.faces[L].length;F++)M.indexOf(m.faces[L][F])!==-1&&L!==_&&M.connectedFaces.indexOf(L)===-1&&M.connectedFaces.push(L);let R=M.length;for(let L=0;L<R;L++){let F=m.vertices[M[L]],U=m.vertices[M[(L+1)%R]];F.vsub(U,c),u.copy(c),n.vmult(u,u),t.vadd(u,u),h.copy(this.faceNormals[_]),n.vmult(h,h),t.vadd(h,h),u.cross(h,d),d.negate(d),p.copy(F),n.vmult(p,p),t.vadd(p,p);let B=M.connectedFaces[L];g.copy(this.faceNormals[B]);let k=this.getPlaneConstantOfFace(B);f.copy(g),n.vmult(f,f);let V=k-f.dot(t);for(this.clipFaceAgainstPlane(y,x,f,V);y.length;)y.shift();for(;x.length;)y.push(x.shift())}g.copy(this.faceNormals[_]);let b=this.getPlaneConstantOfFace(_);f.copy(g),n.vmult(f,f);let I=b-f.dot(t);for(let L=0;L<y.length;L++){let F=f.dot(y[L])+I;if(F<=o&&(F=o),F<=s){let U=y[L];if(F<=1e-6){let B={point:U,normal:f,depth:F};a.push(B)}}}}clipFaceAgainstPlane(e,t,n,r){let o,s,a=e.length;if(a<2)return t;let l=e[e.length-1],c=e[0];o=n.dot(l)+r;for(let u=0;u<a;u++){if(c=e[u],s=n.dot(c)+r,o<0)if(s<0){let h=new w;h.copy(c),t.push(h)}else{let h=new w;l.lerp(c,o/(o-s),h),t.push(h)}else if(s<0){let h=new w;l.lerp(c,o/(o-s),h),t.push(h),t.push(c)}l=c,o=s}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new w);let n=this.vertices,r=this.worldVertices;for(let o=0;o!==this.vertices.length;o++)t.vmult(n[o],r[o]),e.vadd(r[o],r[o]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){let n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){let o=n[r];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}computeWorldFaceNormals(e){let t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new w);let n=this.faceNormals,r=this.worldFaceNormals;for(let o=0;o!==t;o++)e.vmult(n[o],r[o]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0,t=this.vertices;for(let n=0;n!==t.length;n++){let r=t[n].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,r){let o=this.vertices,s,a,l,c,u,h,d=new w;for(let p=0;p<o.length;p++){d.copy(o[p]),t.vmult(d,d),e.vadd(d,d);let g=d;(s===void 0||g.x<s)&&(s=g.x),(c===void 0||g.x>c)&&(c=g.x),(a===void 0||g.y<a)&&(a=g.y),(u===void 0||g.y>u)&&(u=g.y),(l===void 0||g.z<l)&&(l=g.z),(h===void 0||g.z>h)&&(h=g.z)}n.set(s,a,l),r.set(c,u,h)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new w);let t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){let n=this.vertices.length,r=this.vertices;if(t){for(let o=0;o<n;o++){let s=r[o];t.vmult(s,s)}for(let o=0;o<this.faceNormals.length;o++){let s=this.faceNormals[o];t.vmult(s,s)}}if(e)for(let o=0;o<n;o++){let s=r[o];s.vadd(e,s)}}pointIsInside(e){let t=this.vertices,n=this.faces,r=this.faceNormals,o=null,s=new w;this.getAveragePointLocal(s);for(let a=0;a<this.faces.length;a++){let l=r[a],c=t[n[a][0]],u=new w;e.vsub(c,u);let h=l.dot(u),d=new w;s.vsub(c,d);let p=l.dot(d);if(h<0&&p>0||h>0&&p<0)return!1}return o?1:-1}static project(e,t,n,r,o){let s=e.vertices.length,a=_j,l=0,c=0,u=bj,h=e.vertices;u.setZero(),It.vectorToLocalFrame(n,r,t,a),It.pointToLocalFrame(n,r,u,u);let d=u.dot(a);c=l=h[0].dot(a);for(let p=1;p<s;p++){let g=h[p].dot(a);g>l&&(l=g),g<c&&(c=g)}if(c-=d,l-=d,c>l){let p=c;c=l,l=p}o[0]=l,o[1]=c}},Eb=[],Mb=[];new w;var _j=new w,bj=new w,aw=class i extends Ie{constructor(e){super({type:Ie.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){let e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,r=w,o=[new r(-e,-t,-n),new r(e,-t,-n),new r(e,t,-n),new r(-e,t,-n),new r(-e,-t,n),new r(e,-t,n),new r(e,t,n),new r(-e,t,n)],s=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],a=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],l=new hd({vertices:o,faces:s,axes:a});this.convexPolyhedronRepresentation=l,l.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new w),i.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){let r=e;n.x=1/12*t*(2*r.y*2*r.y+2*r.z*2*r.z),n.y=1/12*t*(2*r.x*2*r.x+2*r.z*2*r.z),n.z=1/12*t*(2*r.y*2*r.y+2*r.x*2*r.x)}getSideNormals(e,t){let n=e,r=this.halfExtents;if(n[0].set(r.x,0,0),n[1].set(0,r.y,0),n[2].set(0,0,r.z),n[3].set(-r.x,0,0),n[4].set(0,-r.y,0),n[5].set(0,0,-r.z),t!==void 0)for(let o=0;o!==n.length;o++)t.vmult(n[o],n[o]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){let r=this.halfExtents,o=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let s=0;s<o.length;s++)Es.set(o[s][0],o[s][1],o[s][2]),t.vmult(Es,Es),e.vadd(Es,Es),n(Es.x,Es.y,Es.z)}calculateWorldAABB(e,t,n,r){let o=this.halfExtents;Xr[0].set(o.x,o.y,o.z),Xr[1].set(-o.x,o.y,o.z),Xr[2].set(-o.x,-o.y,o.z),Xr[3].set(-o.x,-o.y,-o.z),Xr[4].set(o.x,-o.y,-o.z),Xr[5].set(o.x,o.y,-o.z),Xr[6].set(-o.x,o.y,-o.z),Xr[7].set(o.x,-o.y,o.z);let s=Xr[0];t.vmult(s,s),e.vadd(s,s),r.copy(s),n.copy(s);for(let a=1;a<8;a++){let l=Xr[a];t.vmult(l,l),e.vadd(l,l);let c=l.x,u=l.y,h=l.z;c>r.x&&(r.x=c),u>r.y&&(r.y=u),h>r.z&&(r.z=h),c<n.x&&(n.x=c),u<n.y&&(n.y=u),h<n.z&&(n.z=h)}}},Es=new w,Xr=[new w,new w,new w,new w,new w,new w,new w,new w],Sw={DYNAMIC:1,STATIC:2,KINEMATIC:4},Cw={AWAKE:0,SLEEPY:1,SLEEPING:2},He=class i extends Im{constructor(e){e===void 0&&(e={}),super(),this.id=i.idCounter++,this.index=-1,this.world=null,this.vlambda=new w,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new w,this.previousPosition=new w,this.interpolatedPosition=new w,this.initPosition=new w,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new w,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new w,this.force=new w;let t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?i.STATIC:i.DYNAMIC,typeof e.type==typeof i.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep<"u"?e.allowSleep:!0,this.sleepState=i.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit<"u"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit<"u"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new w,this.quaternion=new ii,this.initQuaternion=new ii,this.previousQuaternion=new ii,this.interpolatedQuaternion=new ii,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new w,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new w,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new w,this.invInertia=new w,this.invInertiaWorld=new Ds,this.invMassSolve=0,this.invInertiaSolve=new w,this.invInertiaWorldSolve=new Ds,this.fixedRotation=typeof e.fixedRotation<"u"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping<"u"?e.angularDamping:.01,this.linearFactor=new w(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new w(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new Ri,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new w,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){let e=this.sleepState;this.sleepState=i.AWAKE,this.wakeUpAfterNarrowphase=!1,e===i.SLEEPING&&this.dispatchEvent(i.wakeupEvent)}sleep(){this.sleepState=i.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){let t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;t===i.AWAKE&&n<r?(this.sleepState=i.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(i.sleepyEvent)):t===i.SLEEPY&&n>r?this.wakeUp():t===i.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(i.sleepEvent))}}updateSolveMassProperties(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new w),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new w),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new w),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new w),this.quaternion.vmult(e,t),t}addShape(e,t,n){let r=new w,o=new ii;return t&&r.copy(t),n&&o.copy(n),this.shapes.push(e),this.shapeOffsets.push(r),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){let t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){let e=this.shapes,t=this.shapeOffsets,n=e.length,r=0;for(let o=0;o!==n;o++){let s=e[o];s.updateBoundingSphereRadius();let a=t[o].length(),l=s.boundingSphereRadius;a+l>r&&(r=a+l)}this.boundingRadius=r}updateAABB(){let e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,r=e.length,o=wj,s=xj,a=this.quaternion,l=this.aabb,c=Sj;for(let u=0;u!==r;u++){let h=e[u];a.vmult(t[u],o),o.vadd(this.position,o),a.mult(n[u],s),h.calculateWorldAABB(o,s,c.lowerBound,c.upperBound),u===0?l.copy(c):l.extend(c)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){let t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!e)){let n=Cj,r=Ej;n.setRotationFromQuaternion(this.quaternion),n.transpose(r),n.scale(t,n),n.mmult(r,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new w),this.type!==i.DYNAMIC)return;this.sleepState===i.SLEEPING&&this.wakeUp();let n=Mj;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new w),this.type!==i.DYNAMIC)return;let n=Dj,r=Ij;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,r),this.applyForce(n,r)}applyTorque(e){this.type===i.DYNAMIC&&(this.sleepState===i.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new w),this.type!==i.DYNAMIC)return;this.sleepState===i.SLEEPING&&this.wakeUp();let n=t,r=Tj;r.copy(e),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);let o=Aj;n.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new w),this.type!==i.DYNAMIC)return;let n=Rj,r=Pj;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,r),this.applyImpulse(n,r)}updateMassProperties(){let e=Nj;this.invMass=this.mass>0?1/this.mass:0;let t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),aw.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){let n=new w;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===i.DYNAMIC||this.type===i.KINEMATIC)||this.sleepState===i.SLEEPING)return;let r=this.velocity,o=this.angularVelocity,s=this.position,a=this.force,l=this.torque,c=this.quaternion,u=this.invMass,h=this.invInertiaWorld,d=this.linearFactor,p=u*e;r.x+=a.x*p*d.x,r.y+=a.y*p*d.y,r.z+=a.z*p*d.z;let g=h.elements,f=this.angularFactor,m=l.x*f.x,v=l.y*f.y,y=l.z*f.z;o.x+=e*(g[0]*m+g[1]*v+g[2]*y),o.y+=e*(g[3]*m+g[4]*v+g[5]*y),o.z+=e*(g[6]*m+g[7]*v+g[8]*y),s.x+=r.x*e,s.y+=r.y*e,s.z+=r.z*e,c.integrate(this.angularVelocity,e,this.angularFactor,c),t&&(n?c.normalizeFast():c.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}};He.idCounter=0;He.COLLIDE_EVENT_NAME="collide";He.DYNAMIC=Sw.DYNAMIC;He.STATIC=Sw.STATIC;He.KINEMATIC=Sw.KINEMATIC;He.AWAKE=Cw.AWAKE;He.SLEEPY=Cw.SLEEPY;He.SLEEPING=Cw.SLEEPING;He.wakeupEvent={type:"wakeup"};He.sleepyEvent={type:"sleepy"};He.sleepEvent={type:"sleep"};var wj=new w,xj=new ii,Sj=new Ri,Cj=new Ds,Ej=new Ds,Koe=new Ds,Mj=new w,Dj=new w,Ij=new w,Tj=new w,Aj=new w,Rj=new w,Pj=new w,Nj=new w,lw=class{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return!((e.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&e.collisionFilterMask)===0||((e.type&He.STATIC)!==0||e.sleepState===He.SLEEPING)&&((t.type&He.STATIC)!==0||t.sleepState===He.SLEEPING))}intersectionTest(e,t,n,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,r):this.doBoundingSphereBroadphase(e,t,n,r)}doBoundingSphereBroadphase(e,t,n,r){let o=kj;t.position.vsub(e.position,o);let s=(e.boundingRadius+t.boundingRadius)**2;o.lengthSquared()<s&&(n.push(e),r.push(t))}doBoundingBoxBroadphase(e,t,n,r){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),r.push(t))}makePairsUnique(e,t){let n=Oj,r=Lj,o=Fj,s=e.length;for(let a=0;a!==s;a++)r[a]=e[a],o[a]=t[a];e.length=0,t.length=0;for(let a=0;a!==s;a++){let l=r[a].id,c=o[a].id,u=l<c?`${l},${c}`:`${c},${l}`;n[u]=a,n.keys.push(u)}for(let a=0;a!==n.keys.length;a++){let l=n.keys.pop(),c=n[l];e.push(r[c]),t.push(o[c]),delete n[l]}}setWorld(e){}static boundingSphereCheck(e,t){let n=new w;e.position.vsub(t.position,n);let r=e.shapes[0],o=t.shapes[0];return Math.pow(r.boundingSphereRadius+o.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},kj=new w;new w;new ii;new w;var Oj={keys:[]},Lj=[],Fj=[];new w;new w;new w;var Tm=class extends lw{constructor(){super()}collisionPairs(e,t,n){let r=e.bodies,o=r.length,s,a;for(let l=0;l!==o;l++)for(let c=0;c!==l;c++)s=r[l],a=r[c],this.needBroadphaseCollision(s,a)&&this.intersectionTest(s,a,t,n)}aabbQuery(e,t,n){n===void 0&&(n=[]);for(let r=0;r<e.bodies.length;r++){let o=e.bodies[r];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(t)&&n.push(o)}return n}},rc=class{constructor(){this.rayFromWorld=new w,this.rayToWorld=new w,this.hitNormalWorld=new w,this.hitPointWorld=new w,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,r,o,s,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=o,this.body=s,this.distance=a}},EI,MI,DI,II,TI,AI,RI,Ew={CLOSEST:1,ANY:2,ALL:4};EI=Ie.types.SPHERE;MI=Ie.types.PLANE;DI=Ie.types.BOX;II=Ie.types.CYLINDER;TI=Ie.types.CONVEXPOLYHEDRON;AI=Ie.types.HEIGHTFIELD;RI=Ie.types.TRIMESH;var Qi=class i{get[EI](){return this._intersectSphere}get[MI](){return this._intersectPlane}get[DI](){return this._intersectBox}get[II](){return this._intersectConvex}get[TI](){return this._intersectConvex}get[AI](){return this._intersectHeightfield}get[RI](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new w),t===void 0&&(t=new w),this.from=e.clone(),this.to=t.clone(),this.direction=new w,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=i.ANY,this.result=new rc,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||i.ANY,this.result=t.result||new rc,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(oI),Db.length=0,e.broadphase.aabbQuery(e,oI,Db),this.intersectBodies(Db),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());let n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;let r=Vj,o=Bj;for(let s=0,a=e.shapes.length;s<a;s++){let l=e.shapes[s];if(!(n&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[s],o),e.quaternion.vmult(e.shapeOffsets[s],r),r.vadd(e.position,r),this.intersectShape(l,o,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,r=e.length;!this.result.shouldStop&&n<r;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,r){let o=this.from;if(Jj(o,this.direction,n)>e.boundingSphereRadius)return;let s=this[e.type];s&&s.call(this,e,t,n,r,e)}_intersectBox(e,t,n,r,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,r,o)}_intersectPlane(e,t,n,r,o){let s=this.from,a=this.to,l=this.direction,c=new w(0,0,1);t.vmult(c,c);let u=new w;s.vsub(n,u);let h=u.dot(c);a.vsub(n,u);let d=u.dot(c);if(h*d>0||s.distanceTo(a)<h)return;let p=c.dot(l);if(Math.abs(p)<this.precision)return;let g=new w,f=new w,m=new w;s.vsub(n,g);let v=-c.dot(g)/p;l.scale(v,f),s.vadd(f,m),this.reportIntersection(c,m,o,r,-1)}getAABB(e){let{lowerBound:t,upperBound:n}=e,r=this.to,o=this.from;t.x=Math.min(r.x,o.x),t.y=Math.min(r.y,o.y),t.z=Math.min(r.z,o.z),n.x=Math.max(r.x,o.x),n.y=Math.max(r.y,o.y),n.z=Math.max(r.z,o.z)}_intersectHeightfield(e,t,n,r,o){e.data,e.elementSize;let s=zj;s.from.copy(this.from),s.to.copy(this.to),It.pointToLocalFrame(n,t,s.from,s.from),It.pointToLocalFrame(n,t,s.to,s.to),s.updateDirection();let a=jj,l,c,u,h;l=c=0,u=h=e.data.length-1;let d=new Ri;s.getAABB(d),e.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,a,!0),l=Math.max(l,a[0]),c=Math.max(c,a[1]),e.getIndexOfPosition(d.upperBound.x,d.upperBound.y,a,!0),u=Math.min(u,a[0]+1),h=Math.min(h,a[1]+1);for(let p=l;p<u;p++)for(let g=c;g<h;g++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(p,g,d),!!d.overlapsRay(s)){if(e.getConvexTrianglePillar(p,g,!1),It.pointToWorldFrame(n,t,e.pillarOffset,om),this._intersectConvex(e.pillarConvex,t,om,r,o,sI),this.result.shouldStop)return;e.getConvexTrianglePillar(p,g,!0),It.pointToWorldFrame(n,t,e.pillarOffset,om),this._intersectConvex(e.pillarConvex,t,om,r,o,sI)}}}_intersectSphere(e,t,n,r,o){let s=this.from,a=this.to,l=e.radius,c=(a.x-s.x)**2+(a.y-s.y)**2+(a.z-s.z)**2,u=2*((a.x-s.x)*(s.x-n.x)+(a.y-s.y)*(s.y-n.y)+(a.z-s.z)*(s.z-n.z)),h=(s.x-n.x)**2+(s.y-n.y)**2+(s.z-n.z)**2-l**2,d=u**2-4*c*h,p=Uj,g=Hj;if(!(d<0))if(d===0)s.lerp(a,d,p),p.vsub(n,g),g.normalize(),this.reportIntersection(g,p,o,r,-1);else{let f=(-u-Math.sqrt(d))/(2*c),m=(-u+Math.sqrt(d))/(2*c);if(f>=0&&f<=1&&(s.lerp(a,f,p),p.vsub(n,g),g.normalize(),this.reportIntersection(g,p,o,r,-1)),this.result.shouldStop)return;m>=0&&m<=1&&(s.lerp(a,m,p),p.vsub(n,g),g.normalize(),this.reportIntersection(g,p,o,r,-1))}}_intersectConvex(e,t,n,r,o,s){let a=Gj,l=aI,c=s&&s.faceList||null,u=e.faces,h=e.vertices,d=e.faceNormals,p=this.direction,g=this.from,f=this.to,m=g.distanceTo(f),v=c?c.length:u.length,y=this.result;for(let x=0;!y.shouldStop&&x<v;x++){let _=c?c[x]:x,S=u[_],M=d[_],R=t,b=n;l.copy(h[S[0]]),R.vmult(l,l),l.vadd(b,l),l.vsub(g,l),R.vmult(M,a);let I=p.dot(a);if(Math.abs(I)<this.precision)continue;let L=a.dot(l)/I;if(!(L<0)){p.scale(L,mi),mi.vadd(g,mi),_r.copy(h[S[0]]),R.vmult(_r,_r),b.vadd(_r,_r);for(let F=1;!y.shouldStop&&F<S.length-1;F++){Kr.copy(h[S[F]]),Qr.copy(h[S[F+1]]),R.vmult(Kr,Kr),R.vmult(Qr,Qr),b.vadd(Kr,Kr),b.vadd(Qr,Qr);let U=mi.distanceTo(g);!(i.pointInTriangle(mi,_r,Kr,Qr)||i.pointInTriangle(mi,Kr,_r,Qr))||U>m||this.reportIntersection(a,mi,o,r,_)}}}}_intersectTrimesh(e,t,n,r,o,s){let a=qj,l=Kj,c=Qj,u=aI,h=Wj,d=$j,p=Yj,g=Xj,f=Zj,m=e.indices;e.vertices;let v=this.from,y=this.to,x=this.direction;c.position.copy(n),c.quaternion.copy(t),It.vectorToLocalFrame(n,t,x,h),It.pointToLocalFrame(n,t,v,d),It.pointToLocalFrame(n,t,y,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,p.vsub(d,h),h.normalize();let _=d.distanceSquared(p);e.tree.rayQuery(this,c,l);for(let S=0,M=l.length;!this.result.shouldStop&&S!==M;S++){let R=l[S];e.getNormal(R,a),e.getVertex(m[R*3],_r),_r.vsub(d,u);let b=h.dot(a),I=a.dot(u)/b;if(I<0)continue;h.scale(I,mi),mi.vadd(d,mi),e.getVertex(m[R*3+1],Kr),e.getVertex(m[R*3+2],Qr);let L=mi.distanceSquared(d);!(i.pointInTriangle(mi,Kr,_r,Qr)||i.pointInTriangle(mi,_r,Kr,Qr))||L>_||(It.vectorToWorldFrame(t,a,f),It.pointToWorldFrame(n,t,mi,g),this.reportIntersection(f,g,o,r,R))}l.length=0}reportIntersection(e,t,n,r,o){let s=this.from,a=this.to,l=s.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case i.ALL:this.hasHit=!0,c.set(s,a,e,t,n,r,l),c.hasHit=!0,this.callback(c);break;case i.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(s,a,e,t,n,r,l));break;case i.ANY:this.hasHit=!0,c.hasHit=!0,c.set(s,a,e,t,n,r,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,n,r){r.vsub(t,va),n.vsub(t,nd),e.vsub(t,Ib);let o=va.dot(va),s=va.dot(nd),a=va.dot(Ib),l=nd.dot(nd),c=nd.dot(Ib),u,h;return(u=l*a-s*c)>=0&&(h=o*c-s*a)>=0&&u+h<o*l-s*s}};Qi.CLOSEST=Ew.CLOSEST;Qi.ANY=Ew.ANY;Qi.ALL=Ew.ALL;var oI=new Ri,Db=[],nd=new w,Ib=new w,Vj=new w,Bj=new ii,mi=new w,_r=new w,Kr=new w,Qr=new w;new w;new rc;var sI={faceList:[0]},om=new w,zj=new Qi,jj=[],Uj=new w,Hj=new w,Gj=new w;new w;new w;var aI=new w,qj=new w,Wj=new w,$j=new w,Yj=new w,Zj=new w,Xj=new w;new Ri;var Kj=[],Qj=new It,va=new w,sm=new w;function Jj(i,e,t){t.vsub(i,va);let n=va.dot(e);return e.scale(n,sm),sm.vadd(i,sm),t.distanceTo(sm)}var cw=class{static defaults(e,t){e===void 0&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}},Am=class{constructor(){this.spatial=new w,this.rotational=new w}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}},PI=(()=>{class i{constructor(t,n,r,o){r===void 0&&(r=-1e6),o===void 0&&(o=1e6),this.id=i.idCounter++,this.minForce=r,this.maxForce=o,this.bi=t,this.bj=n,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Am,this.jacobianElementB=new Am,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,n,r){let o=n,s=t,a=r;this.a=4/(a*(1+4*o)),this.b=4*o/(1+4*o),this.eps=4/(a*a*s*(1+4*o))}computeB(t,n,r){let o=this.computeGW(),s=this.computeGq(),a=this.computeGiMf();return-s*t-o*n-a*r}computeGq(){let t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,s=r.position,a=o.position;return t.spatial.dot(s)+n.spatial.dot(a)}computeGW(){let t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,s=r.velocity,a=o.velocity,l=r.angularVelocity,c=o.angularVelocity;return t.multiplyVectors(s,l)+n.multiplyVectors(a,c)}computeGWlambda(){let t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,s=r.vlambda,a=o.vlambda,l=r.wlambda,c=o.wlambda;return t.multiplyVectors(s,l)+n.multiplyVectors(a,c)}computeGiMf(){let t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,s=r.force,a=r.torque,l=o.force,c=o.torque,u=r.invMassSolve,h=o.invMassSolve;return s.scale(u,lI),l.scale(h,cI),r.invInertiaWorldSolve.vmult(a,uI),o.invInertiaWorldSolve.vmult(c,dI),t.multiplyVectors(lI,uI)+n.multiplyVectors(cI,dI)}computeGiMGt(){let t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,s=r.invMassSolve,a=o.invMassSolve,l=r.invInertiaWorldSolve,c=o.invInertiaWorldSolve,u=s+a;return l.vmult(t.rotational,am),u+=am.dot(t.rotational),c.vmult(n.rotational,am),u+=am.dot(n.rotational),u}addToWlambda(t){let n=this.jacobianElementA,r=this.jacobianElementB,o=this.bi,s=this.bj,a=eU;o.vlambda.addScaledVector(o.invMassSolve*t,n.spatial,o.vlambda),s.vlambda.addScaledVector(s.invMassSolve*t,r.spatial,s.vlambda),o.invInertiaWorldSolve.vmult(n.rotational,a),o.wlambda.addScaledVector(t,a,o.wlambda),s.invInertiaWorldSolve.vmult(r.rotational,a),s.wlambda.addScaledVector(t,a,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}return i.idCounter=0,i})(),lI=new w,cI=new w,uI=new w,dI=new w,am=new w,eU=new w,uw=class extends PI{constructor(e,t,n){n===void 0&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new w,this.rj=new w,this.ni=new w}computeB(e){let t=this.a,n=this.b,r=this.bi,o=this.bj,s=this.ri,a=this.rj,l=tU,c=nU,u=r.velocity,h=r.angularVelocity;r.force,r.torque;let d=o.velocity,p=o.angularVelocity;o.force,o.torque;let g=iU,f=this.jacobianElementA,m=this.jacobianElementB,v=this.ni;s.cross(v,l),a.cross(v,c),v.negate(f.spatial),l.negate(f.rotational),m.spatial.copy(v),m.rotational.copy(c),g.copy(o.position),g.vadd(a,g),g.vsub(r.position,g),g.vsub(s,g);let y=v.dot(g),x=this.restitution+1,_=x*d.dot(v)-x*u.dot(v)+p.dot(c)-h.dot(l),S=this.computeGiMf();return-y*t-_*n-e*S}getImpactVelocityAlongNormal(){let e=rU,t=oU,n=sU,r=aU,o=lU;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(r,t),e.vsub(t,o),this.ni.dot(o)}},tU=new w,nU=new w,iU=new w,rU=new w,oU=new w,sU=new w,aU=new w,lU=new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;var Rm=class extends PI{constructor(e,t,n){super(e,t,-n,n),this.ri=new w,this.rj=new w,this.t=new w}computeB(e){this.a;let t=this.b;this.bi,this.bj;let n=this.ri,r=this.rj,o=cU,s=uU,a=this.t;n.cross(a,o),r.cross(a,s);let l=this.jacobianElementA,c=this.jacobianElementB;a.negate(l.spatial),o.negate(l.rotational),c.spatial.copy(a),c.rotational.copy(s);let u=this.computeGW(),h=this.computeGiMf();return-u*t-e*h}},cU=new w,uU=new w,dm=(()=>{class i{constructor(t,n,r){r=cw.defaults(r,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=i.idCounter++,this.materials=[t,n],this.friction=r.friction,this.restitution=r.restitution,this.contactEquationStiffness=r.contactEquationStiffness,this.contactEquationRelaxation=r.contactEquationRelaxation,this.frictionEquationStiffness=r.frictionEquationStiffness,this.frictionEquationRelaxation=r.frictionEquationRelaxation}}return i.idCounter=0,i})(),hm=(()=>{class i{constructor(t){t===void 0&&(t={});let n="";typeof t=="string"&&(n=t,t={}),this.name=n,this.id=i.idCounter++,this.friction=typeof t.friction<"u"?t.friction:-1,this.restitution=typeof t.restitution<"u"?t.restitution:-1}}return i.idCounter=0,i})();new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new Qi;new w;new w;new w;new w(1,0,0),new w(0,1,0),new w(0,0,1);new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;var dw=class extends hd{constructor(e,t,n,r){if(e===void 0&&(e=1),t===void 0&&(t=1),n===void 0&&(n=1),r===void 0&&(r=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");let o=r,s=[],a=[],l=[],c=[],u=[],h=Math.cos,d=Math.sin;s.push(new w(-t*d(0),-n*.5,t*h(0))),c.push(0),s.push(new w(-e*d(0),n*.5,e*h(0))),u.push(1);for(let g=0;g<o;g++){let f=2*Math.PI/o*(g+1),m=2*Math.PI/o*(g+.5);g<o-1?(s.push(new w(-t*d(f),-n*.5,t*h(f))),c.push(2*g+2),s.push(new w(-e*d(f),n*.5,e*h(f))),u.push(2*g+3),l.push([2*g,2*g+1,2*g+3,2*g+2])):l.push([2*g,2*g+1,1,0]),(o%2===1||g<o/2)&&a.push(new w(-d(m),0,h(m)))}l.push(c),a.push(new w(0,1,0));let p=[];for(let g=0;g<u.length;g++)p.push(u[u.length-g-1]);l.push(p),super({vertices:s,faces:l,axes:a}),this.type=Ie.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=r}},ya=class extends Ie{constructor(){super({type:Ie.types.PLANE}),this.worldNormal=new w,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){let t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new w),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,r){Po.set(0,0,1),t.vmult(Po,Po);let o=Number.MAX_VALUE;n.set(-o,-o,-o),r.set(o,o,o),Po.x===1?r.x=e.x:Po.x===-1&&(n.x=e.x),Po.y===1?r.y=e.y:Po.y===-1&&(n.y=e.y),Po.z===1?r.z=e.z:Po.z===-1&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}},Po=new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new Ri;new w;new Ri;new w;new w;new w;new w;new w;new w;new w;new Ri;new w;new It;new Ri;var hw=class{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){e.enabled&&!e.bi.isTrigger&&!e.bj.isTrigger&&this.equations.push(e)}removeEquation(e){let t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}},pw=class extends hw{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0,r=this.iterations,o=this.tolerance*this.tolerance,s=this.equations,a=s.length,l=t.bodies,c=l.length,u=e,h,d,p,g,f,m;if(a!==0)for(let _=0;_!==c;_++)l[_].updateSolveMassProperties();let v=hU,y=pU,x=dU;v.length=a,y.length=a,x.length=a;for(let _=0;_!==a;_++){let S=s[_];x[_]=0,y[_]=S.computeB(u),v[_]=1/S.computeC()}if(a!==0){for(let M=0;M!==c;M++){let R=l[M],b=R.vlambda,I=R.wlambda;b.set(0,0,0),I.set(0,0,0)}for(n=0;n!==r;n++){g=0;for(let M=0;M!==a;M++){let R=s[M];h=y[M],d=v[M],m=x[M],f=R.computeGWlambda(),p=d*(h-f-R.eps*m),m+p<R.minForce?p=R.minForce-m:m+p>R.maxForce&&(p=R.maxForce-m),x[M]+=p,g+=p>0?p:-p,R.addToWlambda(p)}if(g*g<o)break}for(let M=0;M!==c;M++){let R=l[M],b=R.velocity,I=R.angularVelocity;R.vlambda.vmul(R.linearFactor,R.vlambda),b.vadd(R.vlambda,b),R.wlambda.vmul(R.angularFactor,R.wlambda),I.vadd(R.wlambda,I)}let _=s.length,S=1/u;for(;_--;)s[_].multiplier=x[_]*S}return n}},dU=[],hU=[],pU=[];He.STATIC;var fw=class{constructor(){this.objects=[],this.type=Object}release(){let e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){let t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}},mw=class extends fw{constructor(){super(...arguments),this.type=w}constructObject(){return new w}},Ht={sphereSphere:Ie.types.SPHERE,spherePlane:Ie.types.SPHERE|Ie.types.PLANE,boxBox:Ie.types.BOX|Ie.types.BOX,sphereBox:Ie.types.SPHERE|Ie.types.BOX,planeBox:Ie.types.PLANE|Ie.types.BOX,convexConvex:Ie.types.CONVEXPOLYHEDRON,sphereConvex:Ie.types.SPHERE|Ie.types.CONVEXPOLYHEDRON,planeConvex:Ie.types.PLANE|Ie.types.CONVEXPOLYHEDRON,boxConvex:Ie.types.BOX|Ie.types.CONVEXPOLYHEDRON,sphereHeightfield:Ie.types.SPHERE|Ie.types.HEIGHTFIELD,boxHeightfield:Ie.types.BOX|Ie.types.HEIGHTFIELD,convexHeightfield:Ie.types.CONVEXPOLYHEDRON|Ie.types.HEIGHTFIELD,sphereParticle:Ie.types.PARTICLE|Ie.types.SPHERE,planeParticle:Ie.types.PLANE|Ie.types.PARTICLE,boxParticle:Ie.types.BOX|Ie.types.PARTICLE,convexParticle:Ie.types.PARTICLE|Ie.types.CONVEXPOLYHEDRON,cylinderCylinder:Ie.types.CYLINDER,sphereCylinder:Ie.types.SPHERE|Ie.types.CYLINDER,planeCylinder:Ie.types.PLANE|Ie.types.CYLINDER,boxCylinder:Ie.types.BOX|Ie.types.CYLINDER,convexCylinder:Ie.types.CONVEXPOLYHEDRON|Ie.types.CYLINDER,heightfieldCylinder:Ie.types.HEIGHTFIELD|Ie.types.CYLINDER,particleCylinder:Ie.types.PARTICLE|Ie.types.CYLINDER,sphereTrimesh:Ie.types.SPHERE|Ie.types.TRIMESH,planeTrimesh:Ie.types.PLANE|Ie.types.TRIMESH},gw=class{get[Ht.sphereSphere](){return this.sphereSphere}get[Ht.spherePlane](){return this.spherePlane}get[Ht.boxBox](){return this.boxBox}get[Ht.sphereBox](){return this.sphereBox}get[Ht.planeBox](){return this.planeBox}get[Ht.convexConvex](){return this.convexConvex}get[Ht.sphereConvex](){return this.sphereConvex}get[Ht.planeConvex](){return this.planeConvex}get[Ht.boxConvex](){return this.boxConvex}get[Ht.sphereHeightfield](){return this.sphereHeightfield}get[Ht.boxHeightfield](){return this.boxHeightfield}get[Ht.convexHeightfield](){return this.convexHeightfield}get[Ht.sphereParticle](){return this.sphereParticle}get[Ht.planeParticle](){return this.planeParticle}get[Ht.boxParticle](){return this.boxParticle}get[Ht.convexParticle](){return this.convexParticle}get[Ht.cylinderCylinder](){return this.convexConvex}get[Ht.sphereCylinder](){return this.sphereConvex}get[Ht.planeCylinder](){return this.planeConvex}get[Ht.boxCylinder](){return this.boxConvex}get[Ht.convexCylinder](){return this.convexConvex}get[Ht.heightfieldCylinder](){return this.heightfieldCylinder}get[Ht.particleCylinder](){return this.particleCylinder}get[Ht.sphereTrimesh](){return this.sphereTrimesh}get[Ht.planeTrimesh](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new mw,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,r,o,s){let a;this.contactPointPool.length?(a=this.contactPointPool.pop(),a.bi=e,a.bj=t):a=new uw(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&r.collisionResponse;let l=this.currentContactMaterial;a.restitution=l.restitution,a.setSpookParams(l.contactEquationStiffness,l.contactEquationRelaxation,this.world.dt);let c=n.material||e.material,u=r.material||t.material;return c&&u&&c.restitution>=0&&u.restitution>=0&&(a.restitution=c.restitution*u.restitution),a.si=o||n,a.sj=s||r,a}createFrictionEquationsFromContact(e,t){let n=e.bi,r=e.bj,o=e.si,s=e.sj,a=this.world,l=this.currentContactMaterial,c=l.friction,u=o.material||n.material,h=s.material||r.material;if(u&&h&&u.friction>=0&&h.friction>=0&&(c=u.friction*h.friction),c>0){let d=c*(a.frictionGravity||a.gravity).length(),p=n.invMass+r.invMass;p>0&&(p=1/p);let g=this.frictionEquationPool,f=g.length?g.pop():new Rm(n,r,d*p),m=g.length?g.pop():new Rm(n,r,d*p);return f.bi=m.bi=n,f.bj=m.bj=r,f.minForce=m.minForce=-d*p,f.maxForce=m.maxForce=d*p,f.ri.copy(e.ri),f.rj.copy(e.rj),m.ri.copy(e.ri),m.rj.copy(e.rj),e.ni.tangents(f.t,m.t),f.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,a.dt),m.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,a.dt),f.enabled=m.enabled=e.enabled,t.push(f,m),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;let n=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];fa.setZero(),Ql.setZero(),Jl.setZero();let o=t.bi;t.bj;for(let a=0;a!==e;a++)t=this.result[this.result.length-1-a],t.bi!==o?(fa.vadd(t.ni,fa),Ql.vadd(t.ri,Ql),Jl.vadd(t.rj,Jl)):(fa.vsub(t.ni,fa),Ql.vadd(t.rj,Ql),Jl.vadd(t.ri,Jl));let s=1/e;Ql.scale(s,n.ri),Jl.scale(s,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),fa.normalize(),fa.tangents(n.t,r.t)}getContacts(e,t,n,r,o,s,a){this.contactPointPool=o,this.frictionEquationPool=a,this.result=r,this.frictionResult=s;let l=gU,c=vU,u=fU,h=mU;for(let d=0,p=e.length;d!==p;d++){let g=e[d],f=t[d],m=null;g.material&&f.material&&(m=n.getContactMaterial(g.material,f.material)||null);let v=g.type&He.KINEMATIC&&f.type&He.STATIC||g.type&He.STATIC&&f.type&He.KINEMATIC||g.type&He.KINEMATIC&&f.type&He.KINEMATIC;for(let y=0;y<g.shapes.length;y++){g.quaternion.mult(g.shapeOrientations[y],l),g.quaternion.vmult(g.shapeOffsets[y],u),u.vadd(g.position,u);let x=g.shapes[y];for(let _=0;_<f.shapes.length;_++){f.quaternion.mult(f.shapeOrientations[_],c),f.quaternion.vmult(f.shapeOffsets[_],h),h.vadd(f.position,h);let S=f.shapes[_];if(!(x.collisionFilterMask&S.collisionFilterGroup&&S.collisionFilterMask&x.collisionFilterGroup)||u.distanceTo(h)>x.boundingSphereRadius+S.boundingSphereRadius)continue;let M=null;x.material&&S.material&&(M=n.getContactMaterial(x.material,S.material)||null),this.currentContactMaterial=M||m||n.defaultContactMaterial;let R=x.type|S.type,b=this[R];if(b){let I=!1;x.type<S.type?I=b.call(this,x,S,u,h,l,c,g,f,x,S,v):I=b.call(this,S,x,h,u,c,l,f,g,x,S,v),I&&v&&(n.shapeOverlapKeeper.set(x.id,S.id),n.bodyOverlapKeeper.set(g.id,f.id))}}}}}sphereSphere(e,t,n,r,o,s,a,l,c,u,h){if(h)return n.distanceSquared(r)<(e.radius+t.radius)**2;let d=this.createContactEquation(a,l,e,t,c,u);r.vsub(n,d.ni),d.ni.normalize(),d.ri.copy(d.ni),d.rj.copy(d.ni),d.ri.scale(e.radius,d.ri),d.rj.scale(-t.radius,d.rj),d.ri.vadd(n,d.ri),d.ri.vsub(a.position,d.ri),d.rj.vadd(r,d.rj),d.rj.vsub(l.position,d.rj),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}spherePlane(e,t,n,r,o,s,a,l,c,u,h){let d=this.createContactEquation(a,l,e,t,c,u);if(d.ni.set(0,0,1),s.vmult(d.ni,d.ni),d.ni.negate(d.ni),d.ni.normalize(),d.ni.scale(e.radius,d.ri),n.vsub(r,lm),d.ni.scale(d.ni.dot(lm),hI),lm.vsub(hI,d.rj),-lm.dot(d.ni)<=e.radius){if(h)return!0;let p=d.ri,g=d.rj;p.vadd(n,p),p.vsub(a.position,p),g.vadd(r,g),g.vsub(l.position,g),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}boxBox(e,t,n,r,o,s,a,l,c,u,h){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,r,o,s,a,l,e,t,h)}sphereBox(e,t,n,r,o,s,a,l,c,u,h){let d=this.v3pool,p=HU;n.vsub(r,cm),t.getSideNormals(p,s);let g=e.radius,f=!1,m=qU,v=WU,y=$U,x=null,_=0,S=0,M=0,R=null;for(let O=0,Z=p.length;O!==Z&&f===!1;O++){let K=zU;K.copy(p[O]);let j=K.length();K.normalize();let $=cm.dot(K);if($<j+g&&$>0){let ce=jU,W=UU;ce.copy(p[(O+1)%3]),W.copy(p[(O+2)%3]);let le=ce.length(),Ee=W.length();ce.normalize(),W.normalize();let ht=cm.dot(ce),te=cm.dot(W);if(ht<le&&ht>-le&&te<Ee&&te>-Ee){let wt=Math.abs($-j-g);if((R===null||wt<R)&&(R=wt,S=ht,M=te,x=j,m.copy(K),v.copy(ce),y.copy(W),_++,h))return!0}}}if(_){f=!0;let O=this.createContactEquation(a,l,e,t,c,u);m.scale(-g,O.ri),O.ni.copy(m),O.ni.negate(O.ni),m.scale(x,m),v.scale(S,v),m.vadd(v,m),y.scale(M,y),m.vadd(y,O.rj),O.ri.vadd(n,O.ri),O.ri.vsub(a.position,O.ri),O.rj.vadd(r,O.rj),O.rj.vsub(l.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}let b=d.get(),I=GU;for(let O=0;O!==2&&!f;O++)for(let Z=0;Z!==2&&!f;Z++)for(let K=0;K!==2&&!f;K++)if(b.set(0,0,0),O?b.vadd(p[0],b):b.vsub(p[0],b),Z?b.vadd(p[1],b):b.vsub(p[1],b),K?b.vadd(p[2],b):b.vsub(p[2],b),r.vadd(b,I),I.vsub(n,I),I.lengthSquared()<g*g){if(h)return!0;f=!0;let j=this.createContactEquation(a,l,e,t,c,u);j.ri.copy(I),j.ri.normalize(),j.ni.copy(j.ri),j.ri.scale(g,j.ri),j.rj.copy(b),j.ri.vadd(n,j.ri),j.ri.vsub(a.position,j.ri),j.rj.vadd(r,j.rj),j.rj.vsub(l.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}d.release(b),b=null;let L=d.get(),F=d.get(),U=d.get(),B=d.get(),k=d.get(),V=p.length;for(let O=0;O!==V&&!f;O++)for(let Z=0;Z!==V&&!f;Z++)if(O%3!==Z%3){p[Z].cross(p[O],L),L.normalize(),p[O].vadd(p[Z],F),U.copy(n),U.vsub(F,U),U.vsub(r,U);let K=U.dot(L);L.scale(K,B);let j=0;for(;j===O%3||j===Z%3;)j++;k.copy(n),k.vsub(B,k),k.vsub(F,k),k.vsub(r,k);let $=Math.abs(K),ce=k.length();if($<p[j].length()&&ce<g){if(h)return!0;f=!0;let W=this.createContactEquation(a,l,e,t,c,u);F.vadd(B,W.rj),W.rj.copy(W.rj),k.negate(W.ni),W.ni.normalize(),W.ri.copy(W.rj),W.ri.vadd(r,W.ri),W.ri.vsub(n,W.ri),W.ri.normalize(),W.ri.scale(g,W.ri),W.ri.vadd(n,W.ri),W.ri.vsub(a.position,W.ri),W.rj.vadd(r,W.rj),W.rj.vsub(l.position,W.rj),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}}d.release(L,F,U,B,k)}planeBox(e,t,n,r,o,s,a,l,c,u,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,r,o,s,a,l,e,t,h)}convexConvex(e,t,n,r,o,s,a,l,c,u,h,d,p){let g=l5;if(!(n.distanceTo(r)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,o,r,s,g,d,p)){let f=[],m=c5;e.clipAgainstHull(n,o,t,r,s,g,-100,100,f);let v=0;for(let y=0;y!==f.length;y++){if(h)return!0;let x=this.createContactEquation(a,l,e,t,c,u),_=x.ri,S=x.rj;g.negate(x.ni),f[y].normal.negate(m),m.scale(f[y].depth,m),f[y].point.vadd(m,_),S.copy(f[y].point),_.vsub(n,_),S.vsub(r,S),_.vadd(n,_),_.vsub(a.position,_),S.vadd(r,S),S.vsub(l.position,S),this.result.push(x),v++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(x,this.frictionResult)}this.enableFrictionReduction&&v&&this.createFrictionFromAverage(v)}}sphereConvex(e,t,n,r,o,s,a,l,c,u,h){let d=this.v3pool;n.vsub(r,YU);let p=t.faceNormals,g=t.faces,f=t.vertices,m=e.radius,v=!1;for(let y=0;y!==f.length;y++){let x=f[y],_=QU;s.vmult(x,_),r.vadd(_,_);let S=KU;if(_.vsub(n,S),S.lengthSquared()<m*m){if(h)return!0;v=!0;let M=this.createContactEquation(a,l,e,t,c,u);M.ri.copy(S),M.ri.normalize(),M.ni.copy(M.ri),M.ri.scale(m,M.ri),_.vsub(r,M.rj),M.ri.vadd(n,M.ri),M.ri.vsub(a.position,M.ri),M.rj.vadd(r,M.rj),M.rj.vsub(l.position,M.rj),this.result.push(M),this.createFrictionEquationsFromContact(M,this.frictionResult);return}}for(let y=0,x=g.length;y!==x&&v===!1;y++){let _=p[y],S=g[y],M=JU;s.vmult(_,M);let R=e5;s.vmult(f[S[0]],R),R.vadd(r,R);let b=t5;M.scale(-m,b),n.vadd(b,b);let I=n5;b.vsub(R,I);let L=I.dot(M),F=i5;if(n.vsub(R,F),L<0&&F.dot(M)>0){let U=[];for(let B=0,k=S.length;B!==k;B++){let V=d.get();s.vmult(f[S[B]],V),r.vadd(V,V),U.push(V)}if(BU(U,M,n)){if(h)return!0;v=!0;let B=this.createContactEquation(a,l,e,t,c,u);M.scale(-m,B.ri),M.negate(B.ni);let k=d.get();M.scale(-L,k);let V=d.get();M.scale(-m,V),n.vsub(r,B.rj),B.rj.vadd(V,B.rj),B.rj.vadd(k,B.rj),B.rj.vadd(r,B.rj),B.rj.vsub(l.position,B.rj),B.ri.vadd(n,B.ri),B.ri.vsub(a.position,B.ri),d.release(k),d.release(V),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult);for(let O=0,Z=U.length;O!==Z;O++)d.release(U[O]);return}else for(let B=0;B!==S.length;B++){let k=d.get(),V=d.get();s.vmult(f[S[(B+1)%S.length]],k),s.vmult(f[S[(B+2)%S.length]],V),r.vadd(k,k),r.vadd(V,V);let O=ZU;V.vsub(k,O);let Z=XU;O.unit(Z);let K=d.get(),j=d.get();n.vsub(k,j);let $=j.dot(Z);Z.scale($,K),K.vadd(k,K);let ce=d.get();if(K.vsub(n,ce),$>0&&$*$<O.lengthSquared()&&ce.lengthSquared()<m*m){if(h)return!0;let W=this.createContactEquation(a,l,e,t,c,u);K.vsub(r,W.rj),K.vsub(n,W.ni),W.ni.normalize(),W.ni.scale(m,W.ri),W.rj.vadd(r,W.rj),W.rj.vsub(l.position,W.rj),W.ri.vadd(n,W.ri),W.ri.vsub(a.position,W.ri),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult);for(let le=0,Ee=U.length;le!==Ee;le++)d.release(U[le]);d.release(k),d.release(V),d.release(K),d.release(ce),d.release(j);return}d.release(k),d.release(V),d.release(K),d.release(ce),d.release(j)}for(let B=0,k=U.length;B!==k;B++)d.release(U[B])}}}planeConvex(e,t,n,r,o,s,a,l,c,u,h){let d=r5,p=o5;p.set(0,0,1),o.vmult(p,p);let g=0,f=s5;for(let m=0;m!==t.vertices.length;m++)if(d.copy(t.vertices[m]),s.vmult(d,d),r.vadd(d,d),d.vsub(n,f),p.dot(f)<=0){if(h)return!0;let v=this.createContactEquation(a,l,e,t,c,u),y=a5;p.scale(p.dot(f),y),d.vsub(y,y),y.vsub(n,v.ri),v.ni.copy(p),d.vsub(r,v.rj),v.ri.vadd(n,v.ri),v.ri.vsub(a.position,v.ri),v.rj.vadd(r,v.rj),v.rj.vsub(l.position,v.rj),this.result.push(v),g++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&g&&this.createFrictionFromAverage(g)}boxConvex(e,t,n,r,o,s,a,l,c,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,r,o,s,a,l,e,t,h)}sphereHeightfield(e,t,n,r,o,s,a,l,c,u,h){let d=t.data,p=e.radius,g=t.elementSize,f=w5,m=b5;It.pointToLocalFrame(r,s,n,m);let v=Math.floor((m.x-p)/g)-1,y=Math.ceil((m.x+p)/g)+1,x=Math.floor((m.y-p)/g)-1,_=Math.ceil((m.y+p)/g)+1;if(y<0||_<0||v>d.length||x>d[0].length)return;v<0&&(v=0),y<0&&(y=0),x<0&&(x=0),_<0&&(_=0),v>=d.length&&(v=d.length-1),y>=d.length&&(y=d.length-1),_>=d[0].length&&(_=d[0].length-1),x>=d[0].length&&(x=d[0].length-1);let S=[];t.getRectMinMax(v,x,y,_,S);let M=S[0],R=S[1];if(m.z-p>R||m.z+p<M)return;let b=this.result;for(let I=v;I<y;I++)for(let L=x;L<_;L++){let F=b.length,U=!1;if(t.getConvexTrianglePillar(I,L,!1),It.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(U=this.sphereConvex(e,t.pillarConvex,n,f,o,s,a,l,e,t,h)),h&&U||(t.getConvexTrianglePillar(I,L,!0),It.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(U=this.sphereConvex(e,t.pillarConvex,n,f,o,s,a,l,e,t,h)),h&&U))return!0;if(b.length-F>2)return}}boxHeightfield(e,t,n,r,o,s,a,l,c,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,r,o,s,a,l,e,t,h)}convexHeightfield(e,t,n,r,o,s,a,l,c,u,h){let d=t.data,p=t.elementSize,g=e.boundingSphereRadius,f=y5,m=_5,v=v5;It.pointToLocalFrame(r,s,n,v);let y=Math.floor((v.x-g)/p)-1,x=Math.ceil((v.x+g)/p)+1,_=Math.floor((v.y-g)/p)-1,S=Math.ceil((v.y+g)/p)+1;if(x<0||S<0||y>d.length||_>d[0].length)return;y<0&&(y=0),x<0&&(x=0),_<0&&(_=0),S<0&&(S=0),y>=d.length&&(y=d.length-1),x>=d.length&&(x=d.length-1),S>=d[0].length&&(S=d[0].length-1),_>=d[0].length&&(_=d[0].length-1);let M=[];t.getRectMinMax(y,_,x,S,M);let R=M[0],b=M[1];if(!(v.z-g>b||v.z+g<R))for(let I=y;I<x;I++)for(let L=_;L<S;L++){let F=!1;if(t.getConvexTrianglePillar(I,L,!1),It.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(F=this.convexConvex(e,t.pillarConvex,n,f,o,s,a,l,null,null,h,m,null)),h&&F||(t.getConvexTrianglePillar(I,L,!0),It.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(F=this.convexConvex(e,t.pillarConvex,n,f,o,s,a,l,null,null,h,m,null)),h&&F))return!0}}sphereParticle(e,t,n,r,o,s,a,l,c,u,h){let d=p5;if(d.set(0,0,1),r.vsub(n,d),d.lengthSquared()<=e.radius*e.radius){if(h)return!0;let p=this.createContactEquation(l,a,t,e,c,u);d.normalize(),p.rj.copy(d),p.rj.scale(e.radius,p.rj),p.ni.copy(d),p.ni.negate(p.ni),p.ri.set(0,0,0),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}planeParticle(e,t,n,r,o,s,a,l,c,u,h){let d=u5;d.set(0,0,1),a.quaternion.vmult(d,d);let p=d5;if(r.vsub(a.position,p),d.dot(p)<=0){if(h)return!0;let g=this.createContactEquation(l,a,t,e,c,u);g.ni.copy(d),g.ni.negate(g.ni),g.ri.set(0,0,0);let f=h5;d.scale(d.dot(r),f),r.vsub(f,f),g.rj.copy(f),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}}boxParticle(e,t,n,r,o,s,a,l,c,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,r,o,s,a,l,e,t,h)}convexParticle(e,t,n,r,o,s,a,l,c,u,h){let d=-1,p=m5,g=g5,f=null,m=f5;if(m.copy(r),m.vsub(n,m),o.conjugate(pI),pI.vmult(m,m),e.pointIsInside(m)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,o),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(o);for(let v=0,y=e.faces.length;v!==y;v++){let x=[e.worldVertices[e.faces[v][0]]],_=e.worldFaceNormals[v];r.vsub(x[0],fI);let S=-_.dot(fI);if(f===null||Math.abs(S)<Math.abs(f)){if(h)return!0;f=S,d=v,p.copy(_)}}if(d!==-1){let v=this.createContactEquation(l,a,t,e,c,u);p.scale(f,g),g.vadd(r,g),g.vsub(n,g),v.rj.copy(g),p.negate(v.ni),v.ri.set(0,0,0);let y=v.ri,x=v.rj;y.vadd(r,y),y.vsub(l.position,y),x.vadd(n,x),x.vsub(a.position,x),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,r,o,s,a,l,c,u,h){return this.convexHeightfield(t,e,r,n,s,o,l,a,c,u,h)}particleCylinder(e,t,n,r,o,s,a,l,c,u,h){return this.convexParticle(t,e,r,n,s,o,l,a,c,u,h)}sphereTrimesh(e,t,n,r,o,s,a,l,c,u,h){let d=EU,p=MU,g=DU,f=IU,m=TU,v=AU,y=kU,x=CU,_=xU,S=OU;It.pointToLocalFrame(r,s,n,m);let M=e.radius;y.lowerBound.set(m.x-M,m.y-M,m.z-M),y.upperBound.set(m.x+M,m.y+M,m.z+M),t.getTrianglesInAABB(y,S);let R=SU,b=e.radius*e.radius;for(let B=0;B<S.length;B++)for(let k=0;k<3;k++)if(t.getVertex(t.indices[S[B]*3+k],R),R.vsub(m,_),_.lengthSquared()<=b){if(x.copy(R),It.pointToWorldFrame(r,s,x,R),R.vsub(n,_),h)return!0;let V=this.createContactEquation(a,l,e,t,c,u);V.ni.copy(_),V.ni.normalize(),V.ri.copy(V.ni),V.ri.scale(e.radius,V.ri),V.ri.vadd(n,V.ri),V.ri.vsub(a.position,V.ri),V.rj.copy(R),V.rj.vsub(l.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}for(let B=0;B<S.length;B++)for(let k=0;k<3;k++){t.getVertex(t.indices[S[B]*3+k],d),t.getVertex(t.indices[S[B]*3+(k+1)%3],p),p.vsub(d,g),m.vsub(p,v);let V=v.dot(g);m.vsub(d,v);let O=v.dot(g);if(O>0&&V<0&&(m.vsub(d,v),f.copy(g),f.normalize(),O=v.dot(f),f.scale(O,v),v.vadd(d,v),v.distanceTo(m)<e.radius)){if(h)return!0;let Z=this.createContactEquation(a,l,e,t,c,u);v.vsub(m,Z.ni),Z.ni.normalize(),Z.ni.scale(e.radius,Z.ri),Z.ri.vadd(n,Z.ri),Z.ri.vsub(a.position,Z.ri),It.pointToWorldFrame(r,s,v,v),v.vsub(l.position,Z.rj),It.vectorToWorldFrame(s,Z.ni,Z.ni),It.vectorToWorldFrame(s,Z.ri,Z.ri),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult)}}let I=RU,L=PU,F=NU,U=wU;for(let B=0,k=S.length;B!==k;B++){t.getTriangleVertices(S[B],I,L,F),t.getNormal(S[B],U),m.vsub(I,v);let V=v.dot(U);if(U.scale(V,v),m.vsub(v,v),V=v.distanceTo(m),Qi.pointInTriangle(v,I,L,F)&&V<e.radius){if(h)return!0;let O=this.createContactEquation(a,l,e,t,c,u);v.vsub(m,O.ni),O.ni.normalize(),O.ni.scale(e.radius,O.ri),O.ri.vadd(n,O.ri),O.ri.vsub(a.position,O.ri),It.pointToWorldFrame(r,s,v,v),v.vsub(l.position,O.rj),It.vectorToWorldFrame(s,O.ni,O.ni),It.vectorToWorldFrame(s,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}S.length=0}planeTrimesh(e,t,n,r,o,s,a,l,c,u,h){let d=new w,p=yU;p.set(0,0,1),o.vmult(p,p);for(let g=0;g<t.vertices.length/3;g++){t.getVertex(g,d);let f=new w;f.copy(d),It.pointToWorldFrame(r,s,f,d);let m=_U;if(d.vsub(n,m),p.dot(m)<=0){if(h)return!0;let v=this.createContactEquation(a,l,e,t,c,u);v.ni.copy(p);let y=bU;p.scale(m.dot(p),y),d.vsub(y,y),v.ri.copy(y),v.ri.vsub(a.position,v.ri),v.rj.copy(d),v.rj.vsub(l.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}}},fa=new w,Ql=new w,Jl=new w,fU=new w,mU=new w,gU=new ii,vU=new ii,yU=new w,_U=new w,bU=new w,wU=new w,xU=new w;new w;var SU=new w,CU=new w,EU=new w,MU=new w,DU=new w,IU=new w,TU=new w,AU=new w,RU=new w,PU=new w,NU=new w,kU=new Ri,OU=[],lm=new w,hI=new w,LU=new w,FU=new w,VU=new w;function BU(i,e,t){let n=null,r=i.length;for(let o=0;o!==r;o++){let s=i[o],a=LU;i[(o+1)%r].vsub(s,a);let l=FU;a.cross(e,l);let c=VU;t.vsub(s,c);let u=l.dot(c);if(n===null||u>0&&n===!0||u<=0&&n===!1){n===null&&(n=u>0);continue}else return!1}return!0}var cm=new w,zU=new w,jU=new w,UU=new w,HU=[new w,new w,new w,new w,new w,new w],GU=new w,qU=new w,WU=new w,$U=new w,YU=new w,ZU=new w,XU=new w,KU=new w,QU=new w,JU=new w,e5=new w,t5=new w,n5=new w,i5=new w;new w;new w;var r5=new w,o5=new w,s5=new w,a5=new w,l5=new w,c5=new w,u5=new w,d5=new w,h5=new w,p5=new w,pI=new ii,f5=new w;new w;var m5=new w,fI=new w,g5=new w,v5=new w,y5=new w,_5=[0],b5=new w,w5=new w,Pm=class{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){let n=t;t=e,e=n}return e<<16|t}set(e,t){let n=this.getKey(e,t),r=this.current,o=0;for(;n>r[o];)o++;if(n!==r[o]){for(let s=r.length-1;s>=o;s--)r[s+1]=r[s];r[o]=n}}tick(){let e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){let n=this.current,r=this.previous,o=n.length,s=r.length,a=0;for(let l=0;l<o;l++){let c=!1,u=n[l];for(;u>r[a];)a++;c=u===r[a],c||mI(e,u)}a=0;for(let l=0;l<s;l++){let c=!1,u=r[l];for(;u>n[a];)a++;c=n[a]===u,c||mI(t,u)}}};function mI(i,e){i.push((e&4294901760)>>16,e&65535)}var Tb=(i,e)=>i<e?`${i}-${e}`:`${e}-${i}`,vw=class{constructor(){this.data={keys:[]}}get(e,t){let n=Tb(e,t);return this.data[n]}set(e,t,n){let r=Tb(e,t);this.get(e,t)||this.data.keys.push(r),this.data[r]=n}delete(e,t){let n=Tb(e,t),r=this.data.keys.indexOf(n);r!==-1&&this.data.keys.splice(r,1),delete this.data[n]}reset(){let e=this.data,t=e.keys;for(;t.length>0;){let n=t.pop();delete e[n]}}},yw=class extends Im{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new w,e.gravity&&this.gravity.copy(e.gravity),e.frictionGravity&&(this.frictionGravity=new w,this.frictionGravity.copy(e.frictionGravity)),this.broadphase=e.broadphase!==void 0?e.broadphase:new Tm,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new pw,this.constraints=[],this.narrowphase=new gw(this),this.collisionMatrix=new Dm,this.collisionMatrixPrevious=new Dm,this.bodyOverlapKeeper=new Pm,this.shapeOverlapKeeper=new Pm,this.contactmaterials=[],this.contactMaterialTable=new vw,this.defaultMaterial=new hm("default"),this.defaultContactMaterial=new dm(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){let e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){let t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof rc?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,r){return n===void 0&&(n={}),n.mode=Qi.ALL,n.from=e,n.to=t,n.callback=r,Ab.intersectWorld(this,n)}raycastAny(e,t,n,r){return n===void 0&&(n={}),n.mode=Qi.ANY,n.from=e,n.to=t,n.result=r,Ab.intersectWorld(this,n)}raycastClosest(e,t,n,r){return n===void 0&&(n={}),n.mode=Qi.CLOSEST,n.from=e,n.to=t,n.result=r,Ab.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof He&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;let t=this.bodies.length-1,n=this.bodies,r=n.indexOf(e);if(r!==-1){n.splice(r,1);for(let o=0;o!==n.length;o++)n[o].index=o;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){let t=this.bodies;for(let n=0;n<t.length;n++){let r=t[n].shapes;for(let o=0;o<r.length;o++){let s=r[o];if(s.id===e)return s}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){let t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);let n=wn.now()/1e3;if(!this.lastCallTime)this.step(e,void 0,t);else{let r=n-this.lastCallTime;this.step(e,r,t)}this.lastCallTime=n}step(e,t,n){if(n===void 0&&(n=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;let r=wn.now(),o=0;for(;this.accumulator>=e&&o<n&&(this.internalStep(e),this.accumulator-=e,o++,!(wn.now()-r>e*1e3)););this.accumulator=this.accumulator%e;let s=this.accumulator/e;for(let a=0;a!==this.bodies.length;a++){let l=this.bodies[a];l.previousPosition.lerp(l.position,s,l.interpolatedPosition),l.previousQuaternion.slerp(l.quaternion,s,l.interpolatedQuaternion),l.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;let t=this.contacts,n=M5,r=D5,o=this.bodies.length,s=this.bodies,a=this.solver,l=this.gravity,c=this.doProfiling,u=this.profile,h=He.DYNAMIC,d=-1/0,p=this.constraints,g=E5;l.length();let f=l.x,m=l.y,v=l.z,y=0;for(c&&(d=wn.now()),y=0;y!==o;y++){let U=s[y];if(U.type===h){let B=U.force,k=U.mass;B.x+=k*f,B.y+=k*m,B.z+=k*v}}for(let U=0,B=this.subsystems.length;U!==B;U++)this.subsystems[U].update();c&&(d=wn.now()),n.length=0,r.length=0,this.broadphase.collisionPairs(this,n,r),c&&(u.broadphase=wn.now()-d);let x=p.length;for(y=0;y!==x;y++){let U=p[y];if(!U.collideConnected)for(let B=n.length-1;B>=0;B-=1)(U.bodyA===n[B]&&U.bodyB===r[B]||U.bodyB===n[B]&&U.bodyA===r[B])&&(n.splice(B,1),r.splice(B,1))}this.collisionMatrixTick(),c&&(d=wn.now());let _=C5,S=t.length;for(y=0;y!==S;y++)_.push(t[y]);t.length=0;let M=this.frictionEquations.length;for(y=0;y!==M;y++)g.push(this.frictionEquations[y]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,r,this,t,_,this.frictionEquations,g),c&&(u.narrowphase=wn.now()-d),c&&(d=wn.now()),y=0;y<this.frictionEquations.length;y++)a.addEquation(this.frictionEquations[y]);let R=t.length;for(let U=0;U!==R;U++){let B=t[U],k=B.bi,V=B.bj,O=B.si,Z=B.sj,K;if(k.material&&V.material?K=this.getContactMaterial(k.material,V.material)||this.defaultContactMaterial:K=this.defaultContactMaterial,K.friction,k.material&&V.material&&(k.material.friction>=0&&V.material.friction>=0&&k.material.friction*V.material.friction,k.material.restitution>=0&&V.material.restitution>=0&&(B.restitution=k.material.restitution*V.material.restitution)),a.addEquation(B),k.allowSleep&&k.type===He.DYNAMIC&&k.sleepState===He.SLEEPING&&V.sleepState===He.AWAKE&&V.type!==He.STATIC){let j=V.velocity.lengthSquared()+V.angularVelocity.lengthSquared(),$=V.sleepSpeedLimit**2;j>=$*2&&(k.wakeUpAfterNarrowphase=!0)}if(V.allowSleep&&V.type===He.DYNAMIC&&V.sleepState===He.SLEEPING&&k.sleepState===He.AWAKE&&k.type!==He.STATIC){let j=k.velocity.lengthSquared()+k.angularVelocity.lengthSquared(),$=k.sleepSpeedLimit**2;j>=$*2&&(V.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(k,V,!0),this.collisionMatrixPrevious.get(k,V)||(id.body=V,id.contact=B,k.dispatchEvent(id),id.body=k,V.dispatchEvent(id)),this.bodyOverlapKeeper.set(k.id,V.id),this.shapeOverlapKeeper.set(O.id,Z.id)}for(this.emitContactEvents(),c&&(u.makeContactConstraints=wn.now()-d,d=wn.now()),y=0;y!==o;y++){let U=s[y];U.wakeUpAfterNarrowphase&&(U.wakeUp(),U.wakeUpAfterNarrowphase=!1)}for(x=p.length,y=0;y!==x;y++){let U=p[y];U.update();for(let B=0,k=U.equations.length;B!==k;B++){let V=U.equations[B];a.addEquation(V)}}a.solve(e,this),c&&(u.solve=wn.now()-d),a.removeAllEquations();let b=Math.pow;for(y=0;y!==o;y++){let U=s[y];if(U.type&h){let B=b(1-U.linearDamping,e),k=U.velocity;k.scale(B,k);let V=U.angularVelocity;if(V){let O=b(1-U.angularDamping,e);V.scale(O,V)}}}this.dispatchEvent(S5),c&&(d=wn.now());let I=this.stepnumber%(this.quatNormalizeSkip+1)===0,L=this.quatNormalizeFast;for(y=0;y!==o;y++)s[y].integrate(e,I,L);this.clearForces(),this.broadphase.dirty=!0,c&&(u.integrate=wn.now()-d),this.stepnumber+=1,this.dispatchEvent(x5);let F=!0;if(this.allowSleep)for(F=!1,y=0;y!==o;y++){let U=s[y];U.sleepTick(this.time),U.sleepState!==He.SLEEPING&&(F=!0)}this.hasActiveBodies=F}emitContactEvents(){let e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(No,ko),e){for(let o=0,s=No.length;o<s;o+=2)rd.bodyA=this.getBodyById(No[o]),rd.bodyB=this.getBodyById(No[o+1]),this.dispatchEvent(rd);rd.bodyA=rd.bodyB=null}if(t){for(let o=0,s=ko.length;o<s;o+=2)od.bodyA=this.getBodyById(ko[o]),od.bodyB=this.getBodyById(ko[o+1]),this.dispatchEvent(od);od.bodyA=od.bodyB=null}No.length=ko.length=0;let n=this.hasAnyEventListener("beginShapeContact"),r=this.hasAnyEventListener("endShapeContact");if((n||r)&&this.shapeOverlapKeeper.getDiff(No,ko),n){for(let o=0,s=No.length;o<s;o+=2){let a=this.getShapeById(No[o]),l=this.getShapeById(No[o+1]);Oo.shapeA=a,Oo.shapeB=l,a&&(Oo.bodyA=a.body),l&&(Oo.bodyB=l.body),this.dispatchEvent(Oo)}Oo.bodyA=Oo.bodyB=Oo.shapeA=Oo.shapeB=null}if(r){for(let o=0,s=ko.length;o<s;o+=2){let a=this.getShapeById(ko[o]),l=this.getShapeById(ko[o+1]);Lo.shapeA=a,Lo.shapeB=l,a&&(Lo.bodyA=a.body),l&&(Lo.bodyB=l.body),this.dispatchEvent(Lo)}Lo.bodyA=Lo.bodyB=Lo.shapeA=Lo.shapeB=null}}clearForces(){let e=this.bodies,t=e.length;for(let n=0;n!==t;n++){let r=e[n];r.force,r.torque,r.force.set(0,0,0),r.torque.set(0,0,0)}}};new Ri;var Ab=new Qi,wn=globalThis.performance||{};if(!wn.now){let i=Date.now();wn.timing&&wn.timing.navigationStart&&(i=wn.timing.navigationStart),wn.now=()=>Date.now()-i}new w;var x5={type:"postStep"},S5={type:"preStep"},id={type:He.COLLIDE_EVENT_NAME,body:null,contact:null},C5=[],E5=[],M5=[],D5=[],No=[],ko=[],rd={type:"beginContact",bodyA:null,bodyB:null},od={type:"endContact",bodyA:null,bodyB:null},Oo={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Lo={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Nm=class{constructor(e){typeof e=="object"&&(e=e.notation),this.set=[],this.setkeys=[],this.setid=0,this.groups=[],this.totalDice=0,this.op="",this.constant=null,this.result=[],this.error=!1,this.boost=1,this.notation="",this.vectors=[],(!e||e=="0")&&(this.error=!0),this.parseNotation(e)}parseNotation(e){if(e){let d=e.split("!").length-1||0;d>0&&(this.boost=Math.min(Math.max(d,0),3)*4),e=e.split("!").join(""),e=e.split(" ").join("");let p=e.split("(").length-1,g=e.split(")").length-1;p!=g&&(this.error=!0)}let t=this.notation.length>0?"+":"";this.notation+=t+e;let n=e.split("@"),r=n[0],o=new RegExp(/(\+|\-|\*|\/|\%|\^|){0,1}()(\d*)([a-z]+\d+|[a-z]+|)(?:\{([a-z]+)(.*?|)\}|)()/,"i"),s=new RegExp(/(\b)*(\-\d+|\d+)(\b)*/,"gi"),a,l=0,c=30,u=0,h=0;for(;!this.error&&r.length>0&&(a=o.exec(r))!==null&&l<c;){l++,r=r.substring(a[0].length);let d=a[1],p=a[2]&&a[2].length>0,g=a[3],f=a[4],m=a[5]||"",v=a[6]||"",y=a[7]&&a[7].length>0,x=!0;p&&(u+=a[2].length),v=v.split(","),(!v||v.length<1)&&(v=""),v.shift(),l==1&&r.length==0&&!f&&d&&g?(f="d20",this.op=d,this.constant=parseInt(g),g=1):l>1&&r.length==0&&!f&&(this.op=d,this.constant=parseInt(g),x=!1),x&&this.addSet(g,f,h,u,m,v,d),y&&(u-=a[7].length,h+=a[7].length)}!this.error&&n[1]&&(a=n[1].match(s))!==null&&this.result.push(...a)}stringify(e=!0){let t="";if(this.set.length<1)return t;for(let n=0;n<this.set.length;n++){let r=this.set[n];t+=n>0&&r.op?r.op:"",t+=r.num+r.type,r.func&&(t+="{",t+=r.func?r.func:"",t+=r.args?","+(Array.isArray(r.args)?r.args.join(","):r.args):"",t+="}")}return t+=this.constant?this.op+""+Math.abs(this.constant):"",e&&this.result&&this.result.length>0&&(t+="@"+this.result.join(",")),this.boost>1&&(t+="!".repeat(this.boost/4)),t}addSet(e,t,n=0,r=0,o="",s="",a="+"){e=Math.abs(parseInt(e||1));let l=a+""+t+n+r+o+s,c=this.setkeys[l]!=null,u={};c&&(u=this.set[this.setkeys[l]-1]),e>0&&(u.num=c?e+u.num:e,u.type=t,u.sid=this.setid,u.gid=n,u.glvl=r,o&&(u.func=o),s&&(u.args=s),a&&(u.op=a),c?this.set[this.setkeys[l]-1]=u:this.setkeys[l]=this.set.push(u)),c||++this.setid}static mergeNotation(e,t){return Ve(ne({},e),{constant:e.constant+t.constant,notation:e.notation+"+"+t.notation,set:[...e.set,...t.set],totalDice:e.vectors.length+t.vectors.length,vectors:[...e.vectors,...t.vectors]})}},Rb={d2:{name:"d2",labels:["1","2"],values:[1,2],inertia:8,mass:400,scale:.9,system:"dweird"},dc:{type:"d2",name:"Coin",labels:["textures/silvercoin/tail.png","textures/silvercoin/heads.png"],setBumpMaps:["textures/silvercoin/tail_bump.png","textures/silvercoin/heads_bump.png"],values:[0,1],inertia:8,mass:400,scale:.9,colorset:"coin_silver"},d1:{name:"One-sided Dice",type:"d6",labels:["1"],values:[1,1],scale:.9,system:"dweird"},d3:{name:"Three-Sided Dice",type:"d6",labels:["1","2","3"],values:[1,3],scale:.9,system:"dweird"},df:{name:"Fudge Dice",type:"d6",labels:["-","0","+"],values:[-1,1],scale:.9,system:"dweird"},d4:{name:"Four-Sided Dice",labels:["1","2","3","4"],values:[1,4],inertia:5,scale:1.2},d6:{name:"Six-Sided Dice (Numbers)",labels:["1","2","3","4","5","6"],values:[1,6],scale:.9},dpip:{name:"Six-Sided Dice (Pips)",type:"d6",labels:[`   
 \u2B24 
   `,`\u2B24  
   
  \u2B24`,`\u2B24  
 \u2B24 
  \u2B24`,`\u2B24 \u2B24
   
\u2B24 \u2B24`,`\u2B24 \u2B24
 \u2B24 
\u2B24 \u2B24`,`\u2B24 \u2B24
\u2B24 \u2B24
\u2B24 \u2B24`],values:[1,6],scale:.9,font:"monospace"},dsex:{name:"Sex-Sided Emoji Dice",type:"d6",labels:["\u{1F346}","\u{1F351}","\u{1F44C}","\u{1F4A6}","\u{1F64F}","\u{1F4A5}"],values:[1,6],scale:.9,display:"labels",system:"dweird"},dpoker:{name:"Poker Dice (9-Ace)",type:"d6",labels:["A","9","10","J","Q","K"],values:[1,6],scale:.9,display:"labels",system:"dweird",font:"Times New Roman"},dspanpoker:{name:"Spanish Poker Dice (7-Ace)",type:"d8",labels:["A","7","8","9","10","J","Q","K"],values:[1,8],display:"labels",system:"dweird",font:"Times New Roman"},disotope:{name:"Radioactive Twelve-Sided Dice",type:"d12",labels:["","","","","","","","","","","","\u2622\uFE0F"],values:[0,0,0,0,0,0,0,0,0,0,0,1],mass:350,inertia:8,scale:.9,system:"dweird"},dsuit:{name:"Four-Suited Dice",type:"d4",labels:["\u2660\uFE0F","\u2665\uFE0F","\u2666\uFE0F","\u2663\uFE0F"],values:[1,4],inertia:5,scale:1.2,display:"labels",system:"dweird"},d8:{name:"Eight-Sided Dice",labels:["1","2","3","4","5","6","7","8"],values:[1,8]},d10:{name:"Ten-Sided Dice (Single Digit)",labels:["1","2","3","4","5","6","7","8","9","0"],values:[1,10],mass:350,inertia:9,scale:.9},d100:{name:"Ten-Sided Dice (Tens Digit)",type:"d10",labels:["10","20","30","40","50","60","70","80","90","00"],values:[10,100,10],mass:350,inertia:9,scale:.9},d12:{name:"Twelve-Sided Dice",labels:["1","2","3","4","5","6","7","8","9","10","11","12"],values:[1,12],mass:350,inertia:8,scale:.9},d20:{name:"Twenty-Sided Dice",labels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],values:[1,20],mass:400,inertia:6},dabi:{name:"Star Wars RPG: Ability Dice",type:"d8",labels:["s","a",`s
a`,`s
s`,"a","s",`a
a`,""],values:[1,8],font:"SWRPG-Symbol-Regular",color:"#00FF00",colorset:"swrpg_abi",display:"labels",system:"swrpg"},ddif:{name:"Star Wars RPG: Difficulty Dice",type:"d8",labels:["t","f",`f
t`,"t","",`t
t`,`f
f`,"t"],values:[1,8],font:"SWRPG-Symbol-Regular",color:"#8000FC",colorset:"swrpg_dif",display:"labels",system:"swrpg"},dpro:{name:"Star Wars RPG: Proficiency Dice",type:"d12",labels:[`a
a`,"a",`a
a`,"x","s",`s
a`,"s",`s
a`,`s
s`,`s
a`,`s
s`,""],values:[1,12],mass:350,inertia:8,scale:.9,font:"SWRPG-Symbol-Regular",color:"#FFFF00",colorset:"swrpg_pro",display:"labels",system:"swrpg"},dcha:{name:"Star Wars RPG: Challenge Dice",type:"d12",labels:[`t
t`,"t",`t
t`,"t",`t
f`,"f",`t
f`,"f",`f
f`,"y",`f
f`,""],values:[1,12],mass:350,inertia:8,scale:.9,font:"SWRPG-Symbol-Regular",color:"#FF0000",colorset:"swrpg_cha",display:"labels",system:"swrpg"},dfor:{name:"Star Wars RPG: Force Dice",type:"d12",labels:["z",`Z
Z`,"z",`Z
Z`,"z",`Z
Z`,"z","Z","z","Z","z",`z
z`],values:[1,12],mass:350,inertia:8,scale:.9,font:"SWRPG-Symbol-Regular",color:"#FFFFFF",colorset:"swrpg_for",display:"labels",system:"swrpg"},dboo:{name:"Star Wars RPG: Boost Dice",type:"d6",labels:[`s  
  a`,`a  
  a`,"s","a","",""],values:[1,6],scale:.9,font:"SWRPG-Symbol-Regular",color:"#00FFFF",colorset:"swrpg_boo",display:"labels",system:"swrpg"},dset:{name:"Star Wars RPG: Setback Dice",type:"d6",labels:["","t","f"],values:[1,3],scale:.9,font:"SWRPG-Symbol-Regular",color:"#111111",colorset:"swrpg_set",display:"labels",system:"swrpg"},swar:{name:"Star Wars Armada: Red Attack Dice",type:"d8",labels:["F","F",`F
F`,"E","E","G","",""],values:[1,8],font:"Armada-Symbol-Regular",color:"#FF0000",colorset:"swa_red",display:"labels",system:"swarmada"},swab:{name:"Star Wars Armada: Blue Attack Dice",type:"d8",labels:["F","F","F","F","E","E","G","G"],values:[1,8],font:"Armada-Symbol-Regular",color:"#0000FF",colorset:"swa_blue",display:"labels",system:"swarmada"},swak:{name:"Star Wars Armada: Black Attack Dice",type:"d8",labels:["F","F","F","F",`F
E`,`F
E`,"",""],values:[1,8],font:"Armada-Symbol-Regular",color:"#111111",colorset:"swa_black",display:"labels",system:"swarmada"},xwatk:{name:"Star Wars X-Wing: Red Attack Dice",type:"d8",labels:["c","d","d","d","f","f","",""],values:[1,8],font:"XWing-Symbol-Regular",color:"#FF0000",colorset:"xwing_red",display:"labels",system:"xwing"},xwdef:{name:"Star Wars X-Wing: Green Defense Dice",type:"d8",labels:["e","e","e","f","f","","",""],values:[1,8],font:"XWing-Symbol-Regular",color:"#00FF00",colorset:"xwing_green",display:"labels",system:"xwing"},swlar:{name:"Star Wars Legion: Red Attack Dice",type:"d8",labels:["h","h","h","h","h","c","o",""],values:[1,8],font:"Legion-Symbol-Regular",color:"#FF0000",colorset:"swl_atkred",display:"labels",system:"legion"},swlab:{name:"Star Wars Legion: Black Attack Dice",type:"d8",labels:["h","h","h","","","c","o",""],values:[1,8],font:"Legion-Symbol-Regular",color:"#111111",colorset:"swl_atkblack",display:"labels",system:"legion"},swlaw:{name:"Star Wars Legion: White Attack Dice",type:"d8",labels:["h","","","","","c","o",""],values:[1,8],font:"Legion-Symbol-Regular",color:"#FFFFFF",colorset:"swl_atkwhite",display:"labels",system:"legion"},swldr:{name:"Star Wars Legion: Red Defense Dice",type:"d6",labels:["s","s","s","d","",""],values:[1,6],scale:.9,font:"Legion-Symbol-Regular",color:"#FF0000",colorset:"swl_defred",display:"labels",system:"legion"},swldw:{name:"Star Wars Legion: White Defense Dice",type:"d6",labels:["s","","","d","",""],values:[1,6],scale:.9,font:"Legion-Symbol-Regular",color:"#FFFFFF",colorset:"swl_defwhite",display:"labels",system:"legion"}},Yi={d4:{vertices:[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],faces:[[1,0,2,1],[0,1,3,2],[0,3,2,3],[1,2,3,4]]},d6:{vertices:[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]],faces:[[0,3,2,1,1],[1,2,6,5,2],[0,1,5,4,3],[3,7,6,2,4],[0,4,7,3,5],[4,5,6,7,6]]},d8:{vertices:[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],faces:[[0,2,4,1],[0,4,3,2],[0,3,5,3],[0,5,2,4],[1,3,4,5],[1,4,2,6],[1,2,5,7],[1,5,3,8]]},d10:{vertices:[[1,0,-.105],[.809,.5877,.105],[.309,.951,-.105],[-.309,.951,.105],[-.809,.5877,-.105],[-1,0,.105],[-.809,-.587,-.105],[-.309,-.951,.105],[.309,-.951,-.105],[.809,-.5877,.105],[0,0,-1],[0,0,1]],faces:[[5,6,7,11,0],[4,3,2,10,1],[1,2,3,11,2],[0,9,8,10,3],[7,8,9,11,4],[8,7,6,10,5],[9,0,1,11,6],[2,1,0,10,7],[3,4,5,11,8],[6,5,4,10,9]]},d12:{vertices:[[0,.618,1.618],[0,.618,-1.618],[0,-.618,1.618],[0,-.618,-1.618],[1.618,0,.618],[1.618,0,-.618],[-1.618,0,.618],[-1.618,0,-.618],[.618,1.618,0],[.618,-1.618,0],[-.618,1.618,0],[-.618,-1.618,0],[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]],faces:[[2,14,4,12,0,1],[15,9,11,19,3,2],[16,10,17,7,6,3],[6,7,19,11,18,4],[6,18,2,0,16,5],[18,11,9,14,2,6],[1,17,10,8,13,7],[1,13,5,15,3,8],[13,8,12,4,5,9],[5,4,14,9,15,10],[0,12,8,10,16,11],[3,19,7,17,1,12]]},d20:{vertices:[[-1,1.618,0],[1,1.618,0],[-1,-1.618,0],[1,-1.618,0],[0,-1,1.618],[0,1,1.618],[0,-1,-1.618],[0,1,-1.618],[1.618,0,-1],[1.618,0,1],[-1.618,0,-1],[-1.618,0,1]],faces:[[0,11,5,1],[0,5,1,2],[0,1,7,3],[0,7,10,4],[0,10,11,5],[1,5,9,6],[5,11,4,7],[11,10,2,8],[10,7,6,9],[7,1,8,10],[3,9,4,11],[3,4,2,12],[3,2,6,13],[3,6,8,14],[3,8,9,15],[4,9,5,16],[2,4,11,17],[6,2,10,18],[8,6,7,19],[9,8,1,20]]}},I5={name:"",scale:1,font:"Arial",color:"",labels:[],valueMap:[],values:[],normals:[],mass:300,inertia:13,geometry:null,display:"values",system:"d20"},_w=class{constructor(e){if(!Rb.hasOwnProperty(e))return console.error("dice type unavailable");Object.assign(this,I5,Rb[e]),this.shape=Rb[e].type||e,this.type=e,this.setLabels(this.labels),this.setValues(this.values[0],this.values[1],this.values[2]),this.setValueMap(this.valueMap),this.bumpMaps&&this.setBumpMaps(this.bumpMaps)}setValues(e=1,t=20,n=1){this.values=this.range(e,t,n)}setValueMap(e){for(let t=0;t<this.values.length;t++){let n=this.values[t];e[n]!=null&&(this.valueMap[n]=e[n])}}registerFaces(e,t="labels"){let n;if(t=="labels"?n=this.labels:n=this.normals,n.unshift(""),["d2","d10"].includes(this.shape)||n.unshift(""),this.shape=="d4"){let r=e[0],o=e[1],s=e[2],a=e[3];this.labels=[[[],[0,0,0],[o,a,s],[r,s,a],[o,r,a],[r,o,s]],[[],[0,0,0],[o,s,a],[s,r,a],[o,a,r],[s,o,r]],[[],[0,0,0],[a,s,o],[s,a,r],[a,o,r],[s,r,o]],[[],[0,0,0],[a,o,s],[r,a,s],[a,r,o],[r,s,o]]]}else Array.prototype.push.apply(n,e)}setLabels(e){this.loadTextures(e,this.registerFaces.bind(this),"labels")}setBumpMaps(e){this.loadTextures(e,this.registerFaces.bind(this),"bump")}loadTextures(e,t,n){let r=0,o=e.length,s=/\.(PNG|JPG|GIF|WEBP)$/i,a=Array(e.length),l=!1;for(let c=0;c<o;c++){if(e[c]==""||!e[c].match(s)){a[c]=e[c],++r;continue}l=!0,a[c]=new Image,a[c].onload=function(){++r>=o&&t(a,n)},a[c].src=e[c]}l||t(a,n)}range(e,t,n=1){for(var r=[e],o=e;o<t;)r.push(o+=n||1);return r}},T5={none:{name:"Plastic"},perfectmetal:{name:"Perfect Metal",color:14540253,roughness:0,metalness:1,envMapIntensity:1},metal:{name:"Metal",color:14540253,roughness:.5,metalness:.6,envMapIntensity:1},wood:{name:"Wood",color:14540253,roughness:.9,metalness:0,envMapIntensity:1},glass:{name:"Glass",color:14540253,roughness:.1,metalness:0,envMapIntensity:1}},A5={baseScale:100,bumpMapping:!0},ad=class{constructor(i){this.geometries={},this.materials_cache={},this.cache_hits=0,this.cache_misses=0,this.label_color="",this.dice_color="",this.edge_color="",this.label_outline="",this.dice_texture="",this.dice_material="",this.material_options={specular:16777215,color:11908533,shininess:5,flatShading:!0},Object.assign(this,A5,i)}updateConfig(i={}){Object.assign(this,i),i.scale&&this.scaleGeometry()}setBumpMapping(i){this.bumpMapping=i,this.materials_cache={}}create(i){let e=this.get(i);if(!e)return null;let t=this.geometries[i];if(t||(t=this.createGeometry(e.shape,e.scale*this.baseScale),this.geometries[i]=t),!t)return null;this.setMaterialInfo();let n=new Xi(t,this.createMaterials(e,this.baseScale/2,1));switch(n.result=[],n.shape=e.shape,n.rerolls=0,n.resultReason="natural",n.mass=e.mass,n.getFaceValue=function(){let r=this.resultReason,o=new H(0,0,this.shape=="d4"?-1:1),s,a=Math.PI*2,l=this.geometry.getAttribute("normal").array;for(let g=0,f=this.geometry.groups.length;g<f;++g){let m=this.geometry.groups[g];if(m.materialIndex==0)continue;let v=g*9,y=new H(l[v],l[v+1],l[v+2]).clone().applyQuaternion(this.body.quaternion).angleTo(o);y<a&&(a=y,s=m)}let c=s.materialIndex-1,u=2,h=ad.dice[this.notation.type];if(this.shape=="d4"){let g=c-1==0?5:c;return{value:c,label:h.labels[c-1][g][0],reason:r}}["d10","d2"].includes(this.shape)&&(c+=1,u-=1);let d=h.values[(c-1)%h.values.length],p=h.labels[(c-1)%(h.labels.length-2)+u];return{value:d,label:p,reason:r}},n.storeRolledValue=function(r){this.resultReason=r||this.resultReason,this.result.push(this.getFaceValue())},n.getLastValue=function(){return!this.result||this.result.length<1?{value:void 0,label:"",reason:""}:this.result[this.result.length-1]},n.ignoreLastValue=function(r){let o=this.getLastValue();o.value!==void 0&&(o.ignore=r,this.setLastValue(o))},n.setLastValue=function(r){if(!(!this.result||this.result.length<1)&&!(!r||r.length<1))return this.result[this.result.length-1]=r},e.color&&(n.material[0].color=new _t(e.color),n.material[0].emissive=new _t(e.color),n.material[0].emissiveIntensity=1,n.material[0].needsUpdate=!0),e.values.length){case 1:return this.fixmaterials(n,1);case 2:return this.fixmaterials(n,2);case 3:return this.fixmaterials(n,3);default:return n}}get(i){let e;return ad.dice.hasOwnProperty(i)?e=ad.dice[i]:(e=new _w(i),ad.dice[i]=e),e}getGeometry(i){return this.geometries[i]}scaleGeometry(){}createMaterials(i,e,t,n=!0,r=0){let o=[],s=i.labels;i.shape=="d4"&&(s=i.labels[r],e=this.baseScale/2,t=this.baseScale*2);for(var a=0;a<s.length;++a){var l;this.dice_material!="none"?(l=new tw(T5[this.dice_material]),l.envMapIntensity=0):l=new nw(this.material_options);let c;if(a==0){let u={name:"none"};this.dice_texture_rand.composite!="source-over"&&(u=this.dice_texture_rand),c=this.createTextMaterial(i,s,a,e,t,u,this.label_color_rand,this.label_outline_rand,this.edge_color_rand,n),l.map=c.composite}else if(c=this.createTextMaterial(i,s,a,e,t,this.dice_texture_rand,this.label_color_rand,this.label_outline_rand,this.dice_color_rand,n),l.map=c.composite,this.bumpMapping){{let u=.75;e>35&&(u=1),e>40&&(u=2.5),e>45&&(u=4),l.bumpScale=u}c.bump&&(l.bumpMap=c.bump),i.shape!="d4"&&i.normals[a]&&(l.bumpMap=new Is(i.normals[a]),l.bumpScale=4,l.bumpMap.needsUpdate=!0)}l.opacity=1,l.transparent=!0,l.depthTest=!1,l.needUpdate=!0,o.push(l)}return o}createTextMaterial(i,e,t,n,r,o,s,a,l,c){if(e[t]===void 0)return null;o=o||this.dice_texture_rand,s=s||this.label_color_rand,a=a||this.label_outline_rand,l=l||this.dice_color_rand,c=c??!0;let u=e[t],h=!1,d=u;u instanceof HTMLImageElement?d=u.src:u instanceof Array&&u.forEach(R=>{d+=R.src});let p=i.type+d+t+o.name+s+a+l;if(i.shape=="d4"&&(p=i.type+d+o.name+s+a+l),c&&this.materials_cache[p]!=null)return this.cache_hits++,this.materials_cache[p];let g=document.createElement("canvas"),f=g.getContext("2d",{alpha:!0});f.globalAlpha=0,f.clearRect(0,0,g.width,g.height);let m=document.createElement("canvas"),v=m.getContext("2d",{alpha:!0});v.globalAlpha=0,v.clearRect(0,0,m.width,m.height);let y;if(i.shape=="d4"?y=this.calc_texture_size(n+r)*4:y=this.calc_texture_size(n+n*2*r)*4,g.width=g.height=y,m.width=m.height=y,f.fillStyle=l,f.fillRect(0,0,g.width,g.height),v.fillStyle="#FFFFFF",v.fillRect(0,0,m.width,m.height),o.texture&&o.name!=""&&o.name!="none"?(f.globalCompositeOperation=o.composite||"source-over",f.drawImage(o.texture,0,0,g.width,g.height),f.globalCompositeOperation="source-over",o.bump&&(v.globalCompositeOperation="source-over",v.drawImage(o.bump,0,0,g.width,g.height))):f.globalCompositeOperation="source-over",f.globalCompositeOperation="source-over",f.textAlign="center",f.textBaseline="middle",v.textAlign="center",v.textBaseline="middle",i.shape!="d4"){let R={d8:{even:-7.5,odd:-127.5},d10:{all:-6},d12:{all:5},d20:{all:-7.5}}[i.shape];if(R){let b;if(R.hasOwnProperty("all")?b=R.all:t>0&&t%2!=0?b=R.odd:b=R.even,b&&b!=0){var x=g.width/2,_=g.height/2;f.translate(x,_),f.rotate(b*(Math.PI/180)),f.translate(-x,-_),v.translate(x,_),v.rotate(b*(Math.PI/180)),v.translate(-x,-_)}}if(u instanceof HTMLImageElement)h=!0,f.drawImage(u,0,0,u.width,u.height,0,0,g.width,g.height);else{let b=y/(1+2*r),I=g.height/2+10,L=g.width/2;i.shape=="d10"?(b=b*.75,I=I*1.15-10):i.shape=="d20"&&(L=L*.98),f.font=b+"pt "+i.font,v.font=b+"pt "+i.font;let F=f.measureText("M").width*1.4,U=u.split(`
`);U.length>1&&(b=b/U.length,f.font=b+"pt "+i.font,v.font=b+"pt "+i.font,F=f.measureText("M").width*1.2,I-=F*U.length/2);for(let B=0,k=U.length;B<k;B++){let V=U[B].trim();a!="none"&&a!=l&&(f.strokeStyle=a,f.lineWidth=5,f.strokeText(U[B],L,I),v.strokeStyle="#000000",v.lineWidth=5,v.strokeText(U[B],L,I),(V=="6"||V=="9")&&(f.strokeText("  .",L,I),v.strokeText("  .",L,I))),f.fillStyle=s,f.fillText(U[B],L,I),v.fillStyle="#000000",v.fillText(U[B],L,I),(V=="6"||V=="9")&&(f.fillText("  .",L,I),v.fillText("  .",L,I)),I+=F*1.5}}}else{var x=g.width/2,_=g.height/2;f.font=y/128*24+"pt "+i.font,v.font=y/128*24+"pt "+i.font;for(let I=0;I<u.length;I++){if(u[I]instanceof HTMLImageElement){let L=u[I].width/g.width;f.drawImage(u[I],0,0,u[I].width,u[I].height,100/L,25/L,60/L,60/L)}else a!="none"&&a!=l&&(f.strokeStyle=a,f.lineWidth=5,f.strokeText(u[I],x,_-y*.3),v.strokeStyle="#000000",v.lineWidth=5,v.strokeText(u[I],x,_-y*.3)),f.fillStyle=s,f.fillText(u[I],x,_-y*.3),v.fillStyle="#000000",v.fillText(u[I],x,_-y*.3);f.translate(x,_),f.rotate(Math.PI*2/3),f.translate(-x,-_),v.translate(x,_),v.rotate(Math.PI*2/3),v.translate(-x,-_)}}var S=new Em(g),M;return h?M=null:M=new Em(m),c&&(this.cache_misses++,this.materials_cache[p]={composite:S,bump:M}),{composite:S,bump:M}}applyColorSet(i){var e;this.colordata=i,this.label_color=i.foreground,this.dice_color=i.background,this.label_outline=i.outline,this.dice_texture=i.texture,this.dice_material=((e=i?.texture)==null?void 0:e.material)||"none",this.edge_color=i.hasOwnProperty("edge")?i.edge:i.background}setMaterialInfo(i=""){let e=this.colordata,t=this.dice_texture,n=this.dice_material;if(this.dice_color_rand="",this.label_color_rand="",this.label_outline_rand="",this.dice_texture_rand="",this.dice_material_rand="",this.edge_color_rand="",Array.isArray(this.dice_color)){var r=Math.floor(Math.random()*this.dice_color.length);Array.isArray(this.label_color)&&this.label_color.length==this.dice_color.length&&(this.label_color_rand=this.label_color[r],Array.isArray(this.label_outline)&&this.label_outline.length==this.label_color.length&&(this.label_outline_rand=this.label_outline[r])),Array.isArray(this.dice_texture)&&this.dice_texture.length==this.dice_color.length&&(this.dice_texture_rand=this.dice_texture[r],this.dice_material_rand=this.dice_texture_rand.material),Array.isArray(this.edge_color)&&this.edge_color.length==this.dice_color.length&&(this.edge_color_rand=this.edge_color[r]),this.dice_color_rand=this.dice_color[r]}else this.dice_color_rand=this.dice_color;if(this.edge_color_rand=="")if(Array.isArray(this.edge_color)){var r=Math.floor(Math.random()*this.edge_color.length);this.edge_color_rand=this.edge_color[r]}else this.edge_color_rand=this.edge_color;if(this.label_color_rand==""&&Array.isArray(this.label_color)){var r=this.label_color[Math.floor(Math.random()*this.label_color.length)];Array.isArray(this.label_outline)&&this.label_outline.length==this.label_color.length&&(this.label_outline_rand=this.label_outline[r]),this.label_color_rand=this.label_color[r]}else this.label_color_rand==""&&(this.label_color_rand=this.label_color);if(this.label_outline_rand==""&&Array.isArray(this.label_outline)){var r=this.label_outline[Math.floor(Math.random()*this.label_outline.length)];this.label_outline_rand=this.label_outline[r]}else this.label_outline_rand==""&&(this.label_outline_rand=this.label_outline);this.dice_texture_rand==""&&Array.isArray(this.dice_texture)?(this.dice_texture_rand=this.dice_texture[Math.floor(Math.random()*this.dice_texture.length)],this.dice_material_rand=this.dice_texture_rand.material||this.dice_material):this.dice_texture_rand==""&&(this.dice_texture_rand=this.dice_texture,this.dice_material_rand=this.dice_texture_rand.material||this.dice_material),this.dice_material_rand==""&&Array.isArray(this.dice_material)?this.dice_material_rand=this.dice_material[Math.floor(Math.random()*this.dice_material.length)]:this.dice_material_rand==""&&(this.dice_material_rand=this.dice_material),this.colordata&&this.colordata.id!=e.id&&this.applyColorSet(e,t,n)}calc_texture_size(i){return Math.pow(2,Math.floor(Math.log(i)/Math.log(2)))}createGeometry(i,e,t=!1){let n=t?"create_shape":"create_geom";switch(i){case"d2":var r=new Jb(1*e,1*e,.1*e,32);return r.cannon_shape=new dw(1*e,1*e,.1*e,8),r;case"d4":return this[n](Yi.d4.vertices,Yi.d4.faces,e,-.1,Math.PI*7/6,.96);case"d6":return this[n](Yi.d6.vertices,Yi.d6.faces,e,.1,Math.PI/4,.96);case"d8":return this[n](Yi.d8.vertices,Yi.d8.faces,e,0,-Math.PI/4/2,.965);case"d10":return this[n](Yi.d10.vertices,Yi.d10.faces,e,.3,Math.PI,.945);case"d12":return this[n](Yi.d12.vertices,Yi.d12.faces,e,.2,-Math.PI/4/2,.968);case"d20":return this[n](Yi.d20.vertices,Yi.d20.faces,e,-.2,-Math.PI/4/2,.955);default:return console.error(`Geometry for ${i} is not available`),null}}fixmaterials(i,e){for(let n=0,r=i.geometry.groups.length;n<r;++n){var t=i.geometry.groups[n].materialIndex-2;if(t<e)continue;let o=t%e;i.geometry.groups[n].materialIndex=o+2}return i.geometry.elementsNeedUpdate=!0,i}create_shape(i,e,t){for(var n=new Array(i.length),r=0;r<i.length;++r)n[r]=new H().fromArray(i[r]).normalize();for(var o=new Array(i.length),s=new Array(e.length),r=0;r<n.length;++r){var a=n[r];o[r]=new w(a.x*t,a.y*t,a.z*t)}for(var r=0;r<e.length;++r)s[r]=e[r].slice(0,e[r].length-1);return new hd({vertices:o,faces:s})}make_geom(i,e,t,n,r){let o=new to;for(let p=0;p<i.length;++p)i[p]=i[p].multiplyScalar(t);let s=[],a=[],l=[],c=new H,u=new H,h,d=0;for(let p=0;p<e.length;++p){let g=e[p],f=g.length-1,m=Math.PI*2/f;h=g[f]+1;for(let y=0;y<f-2;++y)s.push(...i[g[0]].toArray()),s.push(...i[g[y+1]].toArray()),s.push(...i[g[y+2]].toArray()),c.subVectors(i[g[y+2]],i[g[y+1]]),u.subVectors(i[g[0]],i[g[y+1]]),c.cross(u),c.normalize(),a.push(...c.toArray()),a.push(...c.toArray()),a.push(...c.toArray()),l.push((Math.cos(r)+1+n)/2/(1+n),(Math.sin(r)+1+n)/2/(1+n)),l.push((Math.cos(m*(y+1)+r)+1+n)/2/(1+n),(Math.sin(m*(y+1)+r)+1+n)/2/(1+n)),l.push((Math.cos(m*(y+2)+r)+1+n)/2/(1+n),(Math.sin(m*(y+2)+r)+1+n)/2/(1+n));let v=(f-2)*3;for(let y=0;y<v/3;y++)o.addGroup(d,3,h),d+=3}return o.setAttribute("position",new Tn(s,3)),o.setAttribute("normal",new Tn(a,3)),o.setAttribute("uv",new Tn(l,2)),o.boundingSphere=new Sa(new H,t),o}make_d10_geom(i,e,t,n,r){let o=new to;for(let y=0;y<i.length;++y)i[y]=i[y].multiplyScalar(t);let s=[],a=[],l=[],c=new H,u=new H,h,d=0;for(let y=0;y<e.length;++y){let x=e[y],_=x.length-1,S=Math.PI*2/_;h=x[_]+1;var p=.65,g=.85,f=1-1*g,m=1-.895/1.105*g,v=1;for(let R=0;R<_-2;++R)s.push(...i[x[0]].toArray()),s.push(...i[x[R+1]].toArray()),s.push(...i[x[R+2]].toArray()),c.subVectors(i[x[R+2]],i[x[R+1]]),u.subVectors(i[x[0]],i[x[R+1]]),c.cross(u),c.normalize(),a.push(...c.toArray()),a.push(...c.toArray()),a.push(...c.toArray()),e[y][e[y].length-1]==-1||R>=2?(l.push((Math.cos(r)+1+n)/2/(1+n),(Math.sin(r)+1+n)/2/(1+n)),l.push((Math.cos(S*(R+1)+r)+1+n)/2/(1+n),(Math.sin(S*(R+1)+r)+1+n)/2/(1+n)),l.push((Math.cos(S*(R+2)+r)+1+n)/2/(1+n),(Math.sin(S*(R+2)+r)+1+n)/2/(1+n))):R==0?(l.push(.5-p/2,m),l.push(.5,f),l.push(.5+p/2,m)):R==1&&(l.push(.5-p/2,m),l.push(.5+p/2,m),l.push(.5,v));let M=(_-2)*3;for(let R=0;R<M/3;R++)o.addGroup(d,3,h),d+=3}return o.setAttribute("position",new Tn(s,3)),o.setAttribute("normal",new Tn(a,3)),o.setAttribute("uv",new Tn(l,2)),o.boundingSphere=new Sa(new H,t),o}chamfer_geom(i,e,t){for(var n=[],r=[],o=new Array(i.length),s=0;s<i.length;++s)o[s]=[];for(var s=0;s<e.length;++s){for(var a=e[s],l=a.length-1,c=new H,u=new Array(l),h=0;h<l;++h){var d=i[a[h]].clone();c.add(d),o[a[h]].push(u[h]=n.push(d)-1)}c.divideScalar(l);for(var h=0;h<l;++h){var d=n[u[h]];d.subVectors(d,c).multiplyScalar(t).addVectors(d,c)}u.push(a[l]),r.push(u)}for(var s=0;s<e.length-1;++s)for(var h=s+1;h<e.length;++h){for(var p=[],g=-1,f=0;f<e[s].length-1;++f){var m=e[h].indexOf(e[s][f]);m>=0&&m<e[h].length-1&&(g>=0&&f!=g+1?p.unshift([s,f],[h,m]):p.push([s,f],[h,m]),g=f)}p.length==4&&r.push([r[p[0][0]][p[0][1]],r[p[1][0]][p[1][1]],r[p[3][0]][p[3][1]],r[p[2][0]][p[2][1]],-1])}for(var s=0;s<o.length;++s){for(var v=o[s],u=[v[0]],y=v.length-1;y;){for(var f=e.length;f<r.length;++f){var x=r[f].indexOf(u[u.length-1]);if(x>=0&&x<4){--x==-1&&(x=3);var _=r[f][x];if(v.indexOf(_)>=0){u.push(_);break}}}--y}u.push(-1),r.push(u)}return{vectors:n,faces:r}}create_geom(i,e,t,n,r,o){for(var s=new Array(i.length),a=0;a<i.length;++a)s[a]=new H().fromArray(i[a]).normalize();var l=this.chamfer_geom(s,e,o);if(e.length!=10)var c=this.make_geom(l.vectors,l.faces,t,n,r);else var c=this.make_d10_geom(l.vectors,l.faces,t,n,r);return c.cannon_shape=this.create_shape(i,e,t),c.name="d"+e.length,c}},NI=ad;D3(NI,"dice",{});var Pb={cloudy:{name:"Clouds (Transparent)",composite:"destination-in",source:"textures/cloudy.webp",source_bump:"textures/cloudy.alt.webp"},cloudy_2:{name:"Clouds",composite:"multiply",source:"textures/cloudy.alt.webp",source_bump:"textures/cloudy.alt.webp"},fire:{name:"Fire",composite:"multiply",source:"textures/fire.webp",source_bump:"textures/fire.webp",material:"metal"},marble:{name:"Marble",composite:"multiply",source:"textures/marble.webp",source_bump:"",material:"glass"},water:{name:"Water",composite:"destination-in",source:"textures/water.webp",source_bump:"textures/water.webp",material:"glass"},ice:{name:"Ice",composite:"destination-in",source:"textures/ice.webp",source_bump:"textures/ice.webp",material:"glass"},paper:{name:"Paper",composite:"multiply",source:"textures/paper.webp",source_bump:"textures/paper-bump.webp",material:"wood"},speckles:{name:"Speckles",composite:"multiply",source:"textures/speckles.webp",source_bump:"textures/speckles.webp",material:"none"},glitter:{name:"Glitter",composite:"multiply",source:"textures/glitter.webp",source_bump:"textures/glitter-bump.webp",material:"none"},glitter_2:{name:"Glitter (Transparent)",composite:"destination-in",source:"textures/glitter-alpha.webp",source_bump:"",material:"none"},stars:{name:"Stars",composite:"multiply",source:"textures/stars.webp",source_bump:"textures/stars.webp",material:"none"},stainedglass:{name:"Stained Glass",composite:"multiply",source:"textures/stainedglass.webp",source_bump:"textures/stainedglass-bump.webp",material:"glass"},wood:{name:"Wood",composite:"multiply",source:"textures/wood.webp",source_bump:"textures/wood.webp",material:"wood"},metal:{name:"Stainless Steel",composite:"multiply",source:"textures/metal.webp",source_bump:"textures/metal-bump.webp",material:"metal"},skulls:{name:"Skulls",composite:"multiply",source:"textures/skulls.webp",source_bump:"textures/skulls.webp"},leopard:{name:"Leopard",composite:"multiply",source:"textures/leopard.webp",source_bump:"textures/leopard.webp",material:"wood"},tiger:{name:"Tiger",composite:"multiply",source:"textures/tiger.webp",source_bump:"textures/tiger.webp",material:"wood"},cheetah:{name:"Cheetah",composite:"multiply",source:"textures/cheetah.webp",source_bump:"textures/cheetah.webp",material:"wood"},dragon:{name:"Dragon",composite:"multiply",source:"textures/dragon.webp",source_bump:"textures/dragon-bump.webp",material:"none"},lizard:{name:"Lizard",composite:"multiply",source:"textures/lizard.webp",source_bump:"textures/lizard.webp",material:"none"},bird:{name:"Bird",composite:"multiply",source:"textures/feather.webp",source_bump:"textures/feather-bump.webp",material:"wood"},astral:{name:"Astral Sea",composite:"multiply",source:"textures/astral.webp",source_bump:"textures/stars.webp",material:"none"},acleaf:{name:"AC Leaf",composite:"multiply",source:"textures/acleaf.webp",source_bump:"textures/acleaf.webp",material:"none"},thecage:{name:"Nicholas Cage",composite:"multiply",source:"textures/thecage.webp",source_bump:"",material:"metal"},isabelle:{name:"Isabelle",composite:"source-over",source:"textures/isabelle.webp",source_bump:"",material:"none"},bronze01:{name:"bronze01",composite:"difference",source:"textures/bronze01.webp",source_bump:"",material:"metal"},bronze02:{name:"bronze02",composite:"difference",source:"textures/bronze02.webp",source_bump:"",material:"metal"},bronze03:{name:"bronze03",composite:"difference",source:"textures/bronze03.webp",source_bump:"",material:"metal"},bronze03a:{name:"bronze03a",composite:"difference",source:"textures/bronze03a.webp",source_bump:"",material:"metal"},bronze03b:{name:"bronze03b",composite:"difference",source:"textures/bronze03b.webp",source_bump:"",material:"metal"},bronze04:{name:"bronze04",composite:"difference",source:"textures/bronze04.webp",source_bump:"",material:"metal"},none:{name:"none",composite:"source-over",source:"",source_bump:"",material:""},"":{name:"~ Preset ~",composite:"source-over",source:"",source_bump:"",material:""}},gI={coin_default:{name:"Gold Coin",description:"Gold Dragonhead Coin",category:"Other",foreground:"#f6c928",background:"#f6c928",outline:"none",texture:"metal"},coin_silver:{name:"Silver Coin",description:"Gold Dragonhead Coin",category:"Other",foreground:"#f6c928",background:"#f6c928",outline:"none",texture:"metal"},radiant:{name:"Radiant",category:"Damage Types",foreground:"#F9B333",background:"#FFFFFF",outline:"",texture:"paper",description:"Radiant"},fire:{name:"Fire",category:"Damage Types",foreground:"#f8d84f",background:["#f8d84f","#f9b02d","#f43c04","#910200","#4c1009"],outline:"black",texture:"fire",description:"Fire"},ice:{name:"Ice",category:"Damage Types",foreground:"#60E9FF",background:["#214fa3","#3c6ac1","#253f70","#0b56e2","#09317a"],outline:"black",texture:"ice",description:"Ice"},poison:{name:"Poison",category:"Damage Types",foreground:"#D6A8FF",background:["#313866","#504099","#66409e","#934fc3","#c949fc"],outline:"black",texture:"cloudy",description:"Poison"},acid:{name:"Acid",category:"Damage Types",foreground:"#A9FF70",background:["#a6ff00","#83b625","#5ace04","#69f006","#b0f006","#93bc25"],outline:"black",texture:"marble",description:"Acid"},thunder:{name:"Thunder",category:"Damage Types",foreground:"#FFC500",background:"#7D7D7D",outline:"black",texture:"cloudy",description:"Thunder"},lightning:{name:"Lightning",category:"Damage Types",foreground:"#FFC500",background:["#f17105","#f3ca40","#eddea4","#df9a57","#dea54b"],outline:"#7D7D7D",texture:"ice",description:"Lightning"},air:{name:"Air",category:"Damage Types",foreground:"#ffffff",background:["#d0e5ea","#c3dee5","#a4ccd6","#8dafb7","#80a4ad"],outline:"black",texture:"cloudy",description:"Air"},water:{name:"Water",category:"Damage Types",foreground:"#60E9FF",background:["#87b8c4","#77a6b2","#6b98a3","#5b8691","#4b757f"],outline:"black",texture:"water",description:"Water"},earth:{name:"Earth",category:"Damage Types",foreground:"#6C9943",background:["#346804","#184200","#527f22","#3a1d04","#56341a","#331c17","#5a352a","#302210"],outline:"black",texture:"speckles",description:"Earth"},force:{name:"Force",category:"Damage Types",foreground:"white",background:["#FF97FF","#FF68FF","#C651C6"],outline:"#570000",texture:"stars",description:"Force"},psychic:{name:"Psychic",category:"Damage Types",foreground:"#D6A8FF",background:["#313866","#504099","#66409E","#934FC3","#C949FC","#313866"],outline:"black",texture:"speckles",description:"Psychic"},necrotic:{name:"Necrotic",category:"Damage Types",foreground:"#ffffff",background:"#6F0000",outline:"black",texture:"skulls",description:"Necrotic"},breebaby:{name:"Pastel Sunset",category:"Custom Sets",foreground:["#5E175E","#564A5E","#45455E","#3D5A5E","#1E595E","#5E3F3D","#5E1E29","#283C5E","#25295E"],background:["#FE89CF","#DFD4F2","#C2C2E8","#CCE7FA","#A1D9FC","#F3C3C2","#EB8993","#8EA1D2","#7477AD"],outline:"white",texture:"marble",description:"Pastel Sunset, for Breyanna"},pinkdreams:{name:"Pink Dreams",category:"Custom Sets",foreground:"white",background:["#ff007c","#df73ff","#f400a1","#df00ff","#ff33cc"],outline:"#570000",texture:"skulls",description:"Pink Dreams, for Ethan"},inspired:{name:"Inspired",category:"Custom Sets",foreground:"#FFD800",background:"#C4C4B6",outline:"#8E8E86",texture:"none",description:"Inspired, for Austin"},bloodmoon:{name:"Blood Moon",category:"Custom Sets",foreground:"#CDB800",background:"#6F0000",outline:"black",texture:"marble",description:"Blood Moon, for Jared"},starynight:{name:"Stary Night",category:"Custom Sets",foreground:"#4F708F",background:["#091636","#233660","#4F708F","#8597AD","#E2E2E2"],outline:"white",texture:"speckles",description:"Stary Night, for Mai"},glitterparty:{name:"Glitter Party",category:"Custom Sets",foreground:"white",background:["#FFB5F5","#7FC9FF","#A17FFF"],outline:"none",texture:"glitter",description:"Glitter Party, for Austin"},astralsea:{name:"Astral Sea",category:"Custom Sets",foreground:"#565656",background:"white",outline:"none",texture:"astral",description:"The Astral Sea, for Austin"},bronze:{name:"Thylean Bronze",description:"Thylean Bronze by @SpencerThayer",category:"Custom Sets",foreground:["#FF9159","#FFB066","#FFBF59","#FFD059"],background:["#705206","#7A4E06","#643100","#7A2D06"],outline:["#3D2D03","#472D04","#301700","#471A04"],edge:["#FF5D0D","#FF7B00","#FFA20D","#FFBA0D"],texture:["bronze01","bronze02","bronze03","bronze03a","bronze03b","bronze04"]},dragons:{name:"Here be Dragons",category:"Custom Sets",foreground:"#FFFFFF",background:["#B80000","#4D5A5A","#5BB8FF","#7E934E","#FFFFFF","#F6ED7C","#7797A3","#A78437","#862C1A","#FFDF8A"],outline:"black",texture:["dragon","lizard"],description:"Here be Dragons"},birdup:{name:"Bird Up",category:"Custom Sets",foreground:"#FFFFFF",background:["#F11602","#FFC000","#6EC832","#0094BC","#05608D","#FEABB3","#F75680","#F3F0DF","#C7A57F"],outline:"black",texture:"bird",description:"Bird Up!"},tigerking:{name:"Tiger King",category:"Other",foreground:"#ffffff",background:"#FFCC40",outline:"black",texture:["leopard","tiger","cheetah"],description:"Leopard Print"},covid:{name:"COViD",category:"Other",foreground:"#A9FF70",background:["#a6ff00","#83b625","#5ace04","#69f006","#b0f006","#93bc25"],outline:"black",texture:"fire",description:"Covid-19"},acleaf:{name:"Animal Crossing",category:"Other",foreground:"#00FF00",background:"#07540A",outline:"black",texture:"acleaf",description:"Animal Crossing Leaf"},isabelle:{name:"Isabelle",category:"Other",foreground:"white",background:"#FEE5CC",outline:"black",texture:"isabelle",description:"Isabelle"},thecage:{name:"Nicholas Cage",category:"Other",foreground:"#ffffff",background:"#ffffff",outline:"black",texture:"thecage",description:"Nicholas Cage"},test:{name:"Test",category:"Colors",foreground:["#00FF00","#0000FF","#FF0000"],background:["#FF0000","#00FF00","#0000FF"],outline:"black",texture:"none",description:"Test"},rainbow:{name:"Rainblow",category:"Colors",foreground:["#FF5959","#FFA74F","#FFFF56","#59FF59","#2374FF","#00FFFF","#FF59FF"],background:["#900000","#CE3900","#BCBC00","#00B500","#00008E","#008282","#A500A5"],outline:"black",texture:"none",description:"Rainblow"},black:{name:"Black",category:"Colors",foreground:"#ffffff",background:"#000000",outline:"black",texture:"none",description:"Black"},white:{name:"White",category:"Colors",foreground:"#000000",background:"#FFFFFF",outline:"#FFFFFF",texture:"none",description:"White"},swrpg_abi:{name:"Star Wars RPG - Ability",category:"Star Wars\u2122 RPG",foreground:"#00FF00",background:["#3D9238","#52B848","#5EAC56","#9ECB9A"],outline:"#000000",texture:"cloudy_2",description:"Star Wars\u2122 RPG Ability Dice"},swrpg_pro:{name:"Star Wars RPG - Proficiency",category:"Star Wars\u2122 RPG",foreground:"#FFFF00",background:["#CABB1C","#F9E33B","#FFE900","#F0E49D"],outline:"#000000",texture:"paper",description:"Star Wars\u2122 RPG Proficiency Dice"},swrpg_dif:{name:"Star Wars RPG - Difficulty",category:"Star Wars\u2122 RPG",foreground:"#8000FC",background:["#39165F","#664B84","#50247E","#745F88"],outline:"#000000",texture:"cloudy_2",description:"Star Wars\u2122 RPG Difficulty Dice"},swrpg_cha:{name:"Star Wars RPG - Challenge",category:"Star Wars\u2122 RPG",foreground:"#FF0000",background:["#A91F32","#EB4254","#E51836","#BA3645"],outline:"#000000",texture:"paper",description:"Star Wars\u2122 RPG Challenge Dice"},swrpg_boo:{name:"Star Wars RPG - Boost",category:"Star Wars\u2122 RPG",foreground:"#00FFFF",background:["#4B9DC6","#689FC4","#85CFF2","#8FC0D8"],outline:"#000000",texture:"glitter",description:"Star Wars\u2122 RPG Boost Dice"},swrpg_set:{name:"Star Wars RPG - Setback",category:"Star Wars\u2122 RPG",foreground:"#111111",background:["#252223","#241F21","#282828","#111111"],outline:"#ffffff",texture:"glitter",description:"Star Wars\u2122 RPG Setback Dice"},swrpg_for:{name:"Star Wars RPG - Force",category:"Star Wars\u2122 RPG",foreground:"#000000",background:["#F3F3F3","#D3D3D3","#BABABA","#FFFFFF"],outline:"#FFFFFF",texture:"stars",description:"Star Wars\u2122 RPG Force Dice"},swa_red:{name:"Armada Attack - Red",category:"Star Wars\u2122 Armada",foreground:"#ffffff",background:["#440D19","#8A1425","#C72336","#C04551"],outline:"none",texture:"stainedglass",description:"Star Wars\u2122 Armada Red Attack Dice"},swa_blue:{name:"Armada Attack - Blue",category:"Star Wars\u2122 Armada",foreground:"#ffffff",background:["#212642","#28286E","#2B348C","#3D4BB5","#5D64AB"],outline:"none",texture:"stainedglass",description:"Star Wars\u2122 Armada Blue Attack Dice"},swa_black:{name:"Armada Attack - Black",category:"Star Wars\u2122 Armada",foreground:"#ffffff",background:["#252223","#241F21","#282828","#111111"],outline:"none",texture:"stainedglass",description:"Star Wars\u2122 Armada Black Attack Dice"},xwing_red:{name:"X-Wing Attack - Red",category:"Star Wars\u2122 X-Wing",foreground:"#ffffff",background:["#440D19","#8A1425","#C72336","#C04551"],outline:"none",texture:"stars",description:"Star Wars\u2122 X-Wing Red Attack Dice"},xwing_green:{name:"X-Wing Attack - Green",category:"Star Wars\u2122 X-Wing",foreground:"#ffffff",background:["#3D9238","#52B848","#5EAC56","#9ECB9A"],outline:"none",texture:"stars",description:"Star Wars\u2122 X-Wing Green Attack Dice"},swl_atkred:{name:"Legion Attack - Red",category:"Star Wars\u2122 Legion",foreground:"#ffffff",background:["#440D19","#8A1425","#C72336","#C04551"],outline:"none",texture:"fire",description:"Star Wars\u2122 Legion Red Attack Dice"},swl_atkblack:{name:"Legion Attack - Black",category:"Star Wars\u2122 Legion",foreground:"#ffffff",background:["#252223","#241F21","#282828","#111111"],outline:"none",texture:"fire",description:"Star Wars\u2122 Legion Black Attack Dice"},swl_atkwhite:{name:"Legion Attack - White",category:"Star Wars\u2122 Legion",foreground:"#000000",background:["#ffffff","#DFF4FA","#BCBCBC","#F1EDE2","#F2ECE0"],outline:"none",texture:"fire",description:"Star Wars\u2122 Legion White Attack Dice"},swl_defred:{name:"Legion Defense - Red",category:"Star Wars\u2122 Legion",foreground:"#ffffff",background:["#440D19","#8A1425","#C72336","#C04551"],outline:"none",texture:"fire",description:"Star Wars\u2122 Legion Red Defense Dice"},swl_defwhite:{name:"Legion Defense - White",category:"Star Wars\u2122 Legion",foreground:"#000000",background:["#ffffff","#DFF4FA","#BCBCBC","#F1EDE2","#F2ECE0"],outline:"none",texture:"fire",description:"Star Wars\u2122 Legion White Defense Dice"}},bw=class{constructor(e={}){this.colorsets=[],this.assetPath=e.assetPath}ImageLoader(e){return _e(this,null,function*(){if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)e[t]=yield this.ImageLoader(e[t]);return e}return e.source&&e.source!=""&&(e.texture=yield this.loadImage(e.source)),e.source_bump&&e.source_bump!=""&&(e.bump=yield this.loadImage(e.source_bump)),e})}loadImage(e){return new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.crossOrigin="anonymous",r.src=this.assetPath+e,r.onerror=o=>n(o)}).catch(t=>{console.error("Unable to load image texture")})}getColorSet(e){return _e(this,null,function*(){let t,n;if(typeof e=="string"&&(t=e),typeof e=="object"&&(t=e.colorset),this.colorsets.hasOwnProperty(t))return this.colorsets[t];let r=gI[t];return n=e.texture||r.texture,r.texture=this.getTexture(n),r.texture=yield this.ImageLoader(r.texture),e.material&&(r.texture.material=e.material),this.colorsets[t]=r,r})}makeColorSet(){return _e(this,arguments,function*(e={}){if(this.colorsets.hasOwnProperty(e.name))return this.colorsets[e.name];let t=gI.white,n=Object.assign({},t,e),r=this.getTexture(n.texture);return n.texture=yield this.ImageLoader(r),e.material&&(n.texture.material=e.material),n.name.toLowerCase()==="white"&&(n.name=`${Date.now()}`),this.colorsets[n.name]=n,n})}getTexture(e){if(Array.isArray(e)){let t=[];for(let n=0,r=e.length;n<r;n++)t.push(this.getTexture(e[n]));return t}return Pb.hasOwnProperty(e)?Pb[e]:Pb.none}},R5={default:{name:"Solid Color",author:"MajorVictory",showColorPicker:!0,surface:"wood_tray",colors:{fg:"#9794ff",bg:"#0b1a3e"},cubeMap:["envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg"]},"blue-felt":{name:"Blue Felt",author:"MajorVictory",showColorPicker:!0,surface:"felt",colors:{fg:"#9794ff",bg:"#0b1a3e"},cubeMap:["envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg"]},"red-felt":{name:"Red Felt",author:"MajorVictory",showColorPicker:!0,surface:"felt",colors:{fg:"#ff9494",bg:"#4d1e1e"},cubeMap:["envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg"]},"green-felt":{name:"Green Felt",author:"MajorVictory",showColorPicker:!0,surface:"felt",colors:{fg:"#97ff94",bg:"#244d1e"},cubeMap:["envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg","envmap.jpg"]},taverntable:{name:"Old Tavern Table",author:"MajorVictory",showColorPicker:!0,surface:"wood_table",colors:{fg:"#9794ff",bg:"#0b1a3e"},cubeMap:["px.png","nx.png","py.png","ny.png","pz.png","nz.png"]},mahogany:{name:"(Mah-Hog-Any)",author:"MajorVictory",showColorPicker:!0,surface:"wood_table",colors:{fg:"#9794ff",bg:"#0b1a3e"},cubeMap:["px.png","nx.png","py.png","ny.png","pz.png","nz.png"]},stainless:{name:"Stainless Steel",author:"MajorVictory",showColorPicker:!0,surface:"metal",colors:{fg:"#9794ff",bg:"#0b1a3e"},cubeMap:["px.png","nx.png","py.png","ny.png","pz.png","nz.png"]},cyberpunk:{name:"Neo-New-Future-City",author:"MajorVictory",showColorPicker:!0,surface:"metal",colors:{fg:"#3494A6",bg:"#440B28"},cubeMap:["px.png","nx.png","py.png","ny.png","pz.png","nz.png"]},cagetown:{name:"Cage Town",author:"MajorVictory",showColorPicker:!0,surface:"wood_table",colors:{fg:"#D7A866",bg:"#282811"},cubeMap:["px.png","nx.png","py.png","ny.png","pz.png","nz.png"]}},P5=i=>{let e;return function(){let t=this,n=arguments;e&&window.cancelAnimationFrame(e),e=window.requestAnimationFrame(function(){i.apply(t,n)})}},N5={assetPath:"./",framerate:1/60,sounds:!1,volume:100,color_spotlight:15720405,shadows:!0,theme_surface:"green-felt",sound_dieMaterial:"plastic",theme_customColorset:null,theme_colorset:"white",theme_texture:"",theme_material:"glass",gravity_multiplier:400,light_intensity:.7,baseScale:100,strength:1,iterationLimit:1e3,onRollComplete:()=>{},onRerollComplete:()=>{},onAddDiceComplete:()=>{},onRemoveDiceComplete:()=>{}},km=class{constructor(e,t={}){this.initialized=!1,this.container=document.querySelector(e),this.dimensions=new vt(this.container.clientWidth,this.container.clientHeight),this.adaptive_timestep=!1,this.last_time=0,this.running=!1,this.rolling=!1,this.threadid,this.display={currentWidth:null,currentHeight:null,containerWidth:null,containerHeight:null,aspect:null,scale:null},this.cameraHeight={max:null,close:null,medium:null,far:null},this.scene=new Qb,this.world=new yw,this.dice_body_material=new hm,this.sounds_table={},this.sounds_dice=[],this.lastSoundType="",this.lastSoundStep=0,this.lastSound=0,this.iteration,this.renderer,this.barrier,this.camera,this.light,this.light_amb,this.desk,this.box_body={},this.bodies=[],this.meshes=[],this.diceList=[],this.notationVectors=null,this.dieIndex=0,this.soundDelay=10,this.animstate="",this.selector={animate:!0,rotate:!0,intersected:null,dice:[]},Object.assign(this,N5,t),this.DiceColors=new bw({assetPath:this.assetPath}),this.DiceFactory=new NI({baseScale:this.baseScale}),this.DiceFactory.setBumpMapping(!0),this.surface=R5[this.theme_surface].surface}enableShadows(){this.shadows=!0,this.renderer&&(this.renderer.shadowMap.enabled=this.shadows),this.light&&(this.light.castShadow=this.shadows),this.desk&&(this.desk.receiveShadow=this.shadows)}disableShadows(){this.shadows=!1,this.renderer&&(this.renderer.shadowMap.enabled=this.shadows),this.light&&(this.light.castShadow=this.shadows),this.desk&&(this.desk.receiveShadow=this.shadows)}initialize(){return _e(this,null,function*(){this.renderer=new CI({antialias:!0,alpha:!0}),this.container.appendChild(this.renderer.domElement),this.renderer.shadowMap.enabled=this.shadows,this.renderer.shadowMap.type=2,this.renderer.setClearColor(0,0),this.setDimensions(this.dimensions),this.world.gravity.set(0,0,-9.8*this.gravity_multiplier),this.world.broadphase=new Tm,this.world.solver.iterations=14,this.world.allowSleep=!0,this.makeWorldBox(),this.resizeWorld(),yield this.loadTheme({colorset:this.theme_colorset,texture:this.theme_texture,material:this.theme_material}).catch(e=>{throw new Error("Unable to load theme")}),this.sounds&&(yield this.loadSounds().catch(e=>{throw new Error("Unable to load sounds")})),this.initialized=!0,this.renderer.render(this.scene,this.camera)})}makeWorldBox(){Object.keys(this.box_body).length&&(this.world.removeBody(this.box_body.desk),this.world.removeBody(this.box_body.topWall),this.world.removeBody(this.box_body.bottomWall),this.world.removeBody(this.box_body.leftWall),this.world.removeBody(this.box_body.rightWall));let e=new hm,t=new hm;this.world.addContactMaterial(new dm(e,this.dice_body_material,{mass:0,friction:.6,restitution:.5})),this.world.addContactMaterial(new dm(t,this.dice_body_material,{mass:0,friction:.6,restitution:1})),this.world.addContactMaterial(new dm(this.dice_body_material,this.dice_body_material,{mass:0,friction:.6,restitution:.5})),this.box_body.desk=new He({allowSleep:!1,mass:0,shape:new ya,material:e}),this.world.addBody(this.box_body.desk),this.box_body.topWall=new He({allowSleep:!1,mass:0,shape:new ya,material:t}),this.box_body.topWall.quaternion.setFromAxisAngle(new w(1,0,0),Math.PI/2),this.box_body.topWall.position.set(0,this.display.containerHeight*.93,0),this.world.addBody(this.box_body.topWall),this.box_body.bottomWall=new He({allowSleep:!1,mass:0,shape:new ya,material:t}),this.box_body.bottomWall.quaternion.setFromAxisAngle(new w(1,0,0),-Math.PI/2),this.box_body.bottomWall.position.set(0,-this.display.containerHeight*.93,0),this.world.addBody(this.box_body.bottomWall),this.box_body.leftWall=new He({allowSleep:!1,mass:0,shape:new ya,material:t}),this.box_body.leftWall.quaternion.setFromAxisAngle(new w(0,1,0),-Math.PI/2),this.box_body.leftWall.position.set(this.display.containerWidth*.93,0,0),this.world.addBody(this.box_body.leftWall),this.box_body.rightWall=new He({allowSleep:!1,mass:0,shape:new ya,material:t}),this.box_body.rightWall.quaternion.setFromAxisAngle(new w(0,1,0),Math.PI/2),this.box_body.rightWall.position.set(-this.display.containerWidth*.93,0,0),this.world.addBody(this.box_body.rightWall)}loadTheme(e){return _e(this,null,function*(){let t;this.theme_customColorset?t=yield this.DiceColors.makeColorSet(this.theme_customColorset):t=yield this.DiceColors.getColorSet(e),this.DiceFactory.applyColorSet(t),this.colorData=t})}loadSounds(){return _e(this,null,function*(){let e={felt:7,wood_table:7,wood_tray:7,metal:9},t={coin:6,metal:12,plastic:15,wood:12},n=this.colorData.texture.material.match(/wood|metal/g);if(this.sound_dieMaterial=n?this.colorData.texture.material:"plastic",!this.sounds_table.hasOwnProperty(this.surface)){this.sounds_table[this.surface]=[];let r=e[this.surface];for(let o=1;o<=r;++o){let s=yield this.loadAudio(this.assetPath+"sounds/surfaces/surface_"+this.surface+o+".mp3");this.sounds_table[this.surface].push(s)}}if(!this.sounds_dice.hasOwnProperty("coin")){this.sounds_dice.coin=[];let r=t.coin;for(let o=1;o<=r;++o){let s=yield this.loadAudio(this.assetPath+"sounds/dicehit/dicehit_coin"+o+".mp3");this.sounds_dice.coin.push(s)}}if(!this.sounds_dice.hasOwnProperty(this.sound_dieMaterial)){this.sounds_dice[this.sound_dieMaterial]=[];let r=t[this.sound_dieMaterial];for(let o=1;o<=r;++o){let s=yield this.loadAudio(this.assetPath+"sounds/dicehit/dicehit_"+this.sound_dieMaterial+o+".mp3");this.sounds_dice[this.sound_dieMaterial].push(s)}}})}loadAudio(e){return new Promise((t,n)=>{let r=new Audio;r.oncanplaythrough=()=>t(r),r.crossOrigin="anonymous",r.src=e,r.onerror=o=>n(o)}).catch(t=>{console.error("Unable to load audio")})}updateConfig(){return _e(this,arguments,function*(e={}){Object.apply(this,e),this.theme_customColorset=e.theme_customColorset?e.theme_customColorset:null,e.theme_colorset&&(this.theme_colorset=e.theme_colorset),e.theme_texture&&(this.theme_texture=e.theme_texture),e.theme_material&&(this.theme_material=e.theme_material),(e.theme_colorset||e.theme_texture||e.theme_material||e.theme_customColorset)&&(yield this.loadTheme({colorset:this.theme_colorset,texture:this.theme_texture,material:this.theme_material}))})}setDimensions(e){switch(this.display.currentWidth=this.container.clientWidth/2,this.display.currentHeight=this.container.clientHeight/2,e?(this.display.containerWidth=e.x,this.display.containerHeight=e.y):(this.display.containerWidth=this.display.currentWidth,this.display.containerHeight=this.display.currentHeight),this.display.aspect=Math.min(this.display.currentWidth/this.display.containerWidth,this.display.currentHeight/this.display.containerHeight),this.display.scale=Math.sqrt(this.display.containerWidth*this.display.containerWidth+this.display.containerHeight*this.display.containerHeight)/13,this.makeWorldBox(),this.renderer.setSize(this.display.currentWidth*2,this.display.currentHeight*2),this.cameraHeight.max=this.display.currentHeight/this.display.aspect/Math.tan(10*Math.PI/180),this.cameraHeight.medium=this.cameraHeight.max/1.5,this.cameraHeight.far=this.cameraHeight.max,this.cameraHeight.close=this.cameraHeight.max/2,this.camera&&this.scene.remove(this.camera),this.camera=new ni(20,this.display.currentWidth/this.display.currentHeight,1,this.cameraHeight.max*1.3),this.animstate){case"selector":this.camera.position.z=this.selector.dice.length>9?this.cameraHeight.far:this.selector.dice.length<6?this.cameraHeight.close:this.cameraHeight.medium;break;case"throw":case"afterthrow":default:this.camera.position.z=this.cameraHeight.far}this.camera.lookAt(new H(0,0,0));let t=Math.max(this.display.containerWidth,this.display.containerHeight);this.light&&this.scene.remove(this.light),this.light_amb&&this.scene.remove(this.light_amb),this.light=new sw(this.color_spotlight,this.light_intensity),this.light.position.set(-t/2,t/2,t*3),this.light.target.position.set(0,0,0),this.light.distance=t*5,this.light.angle=Math.PI/4,this.light.castShadow=this.shadows,this.light.shadow.camera.near=t/10,this.light.shadow.camera.far=t*5,this.light.shadow.camera.fov=50,this.light.shadow.bias=.001,this.light.shadow.mapSize.width=1024,this.light.shadow.mapSize.height=1024,this.scene.add(this.light),this.light_amb=new iw(16777147,6776689,this.light_intensity),this.scene.add(this.light_amb),this.desk&&this.scene.remove(this.desk);let n=new ew;n.opacity=.5,this.desk=new Xi(new Sm(this.display.containerWidth*6,this.display.containerHeight*6,1,1),n),this.desk.receiveShadow=this.shadows,this.scene.add(this.desk),this.renderer.render(this.scene,this.camera)}resizeWorld(){let e=P5(()=>{let t=this.renderer.domElement,n=this.container.clientWidth,r=this.container.clientHeight,o=t.width!==n||t.height!==r;return o&&this.setDimensions(new vt(this.container.clientWidth,this.container.clientHeight)),o});window.addEventListener("resize",e)}vectorRand({x:e,y:t}){let n=Math.random()*Math.PI/5-Math.PI/5/2,r={x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)};return r.x==0&&(r.x=.01),r.y==0&&(r.y=.01),r}getNotationVectors(e,t,n,r){let o=new Nm(e);for(let s in o.set){let a=this.DiceFactory.get(o.set[s].type),l=o.set[s].num,c=o.set[s].op,u=o.set[s].sid,h=o.set[s].gid,d=o.set[s].glvl,p=o.set[s].func,g=o.set[s].args;for(let f=0;f<l;f++){let m=this.vectorRand(t);m.x/=r,m.y/=r;let v={x:this.display.containerWidth*(m.x>0?-1:1)*.9,y:this.display.containerHeight*(m.y>0?-1:1)*.9,z:Math.random()*200+200},y=Math.abs(m.x/m.y);y>1?v.y/=y:v.x*=y;let x=this.vectorRand(t);x.x/=r,x.y/=r;let _,S,M;a.shape!="d2"?(_={x:x.x*n,y:x.y*n,z:-10},S={x:-(Math.random()*m.y*5+a.inertia*m.y),y:Math.random()*m.x*5+a.inertia*m.x,z:0},M={x:Math.random(),y:Math.random(),z:Math.random(),a:Math.random()}):(_={x:x.x*n/10,y:x.y*n/10,z:3e3},S={x:12*a.inertia,y:1*a.inertia,z:0},M={x:1,y:1,z:Math.random(),a:Math.random()}),o.vectors.push({index:this.dieIndex++,type:a.type,op:c,sid:u,gid:h,glvl:d,func:p,args:g,pos:v,velocity:_,angle:S,axis:M})}}return o}swapDiceFace(e,t){let n=this.DiceFactory.get(e.notation.type);if(e.resultReason="forced",n.shape=="d4"){this.swapDiceFace_D4(e,t);return}n.values;let r=parseInt(e.getLastValue().value);t=parseInt(t),e.notation.type=="d10"&&r==0&&(r=10),e.notation.type=="d100"&&r==0&&(r=100),e.notation.type=="d100"&&r>0&&r<10&&(r*=10),e.notation.type=="d10"&&t==0&&(t=10),e.notation.type=="d100"&&t==0&&(t=100),e.notation.type=="d100"&&t>0&&t<10&&(t*=10);let o=n.values.indexOf(r),s=n.values.indexOf(t);if(o<0||s<0||o==s)return;let a=e.geometry.clone(),l=[],c=[],u=2;n.shape=="d10"&&(u=1);let h,d=s+u;n.shape!="d2"?(h=o+u,d=s+u):(h=o+1,d=s+1);for(var p=0,g=a.groups.length;p<g;++p){let f=a.groups[p].materialIndex;if(f==h){l.push(p);continue}if(f==d){c.push(p);continue}}if(!(l.length<=0||c.length<=0)){for(let f=0,m=c.length;f<m;f++)a.groups[c[f]].materialIndex=h;for(let f=0,m=l.length;f<m;f++)a.groups[l[f]].materialIndex=d;e.geometry=a,e.result=[]}}swapDiceFace_D4(e,t){let n=this.DiceFactory.get(e.notation.type),r=parseInt(e.getLastValue().value);if(t=parseInt(t),!(r>=1&&r<=4))return;let o=t-r,s=e.geometry.clone();for(let a=0,l=s.groups.length;a<l;++a){let c=s.groups[a],u=c.materialIndex;if(u!=0){for(u+=o-1;u>4;)u-=4;for(;u<1;)u+=4;c.materialIndex=u+1}}o!=0&&(o<0&&(o+=4),e.material=this.DiceFactory.createMaterials(n,0,0,!1,o)),e.geometry=s}spawnDice(e,t=!1){let{pos:n,axis:r,angle:o,velocity:s}=e,a;if(t)a=t,a.stopped=0,this.world.removeBody(a.body);else{if(a=this.DiceFactory.create(e.type,this.colorData),!a)return;a.notation=e,a.result=[],a.stopped=0,a.castShadow=this.shadows,this.scene.add(a),this.diceList.push(a)}a.body=new He({allowSleep:!0,sleepSpeedLimit:75,sleepTimeLimit:.9,mass:a.mass,shape:a.geometry.cannon_shape,material:this.dice_body_material}),a.body.type=He.DYNAMIC,a.body.position.set(n.x,n.y,n.z),a.body.quaternion.setFromAxisAngle(new w(r.x,r.y,r.z),r.a*Math.PI*2),a.body.angularVelocity.set(o.x,o.y,o.z),a.body.velocity.set(s.x,s.y,s.z),a.body.linearDamping=.1,a.body.angularDamping=.1,a.body.diceShape=a.shape,a.body.sleepState=0,a.body.addEventListener("collide",this.eventCollide.bind(this)),this.world.addBody(a.body)}eventCollide({body:e,target:t}){if(this.animstate=="simulate"||!this.sounds||!e||this.volume<=0)return;let n=Date.now(),r=e.mass>0?"dice":"table";if(!((this.lastSoundStep==e.world.stepnumber||this.lastSound>n)&&r!="dice")&&!((this.lastSoundStep==e.world.stepnumber||this.lastSound>n)&&r=="dice"&&this.lastSoundType=="dice")){if(e.mass>0){let o=e.velocity.length();if(o<250)return;let s;e.diceShape==="d2"?s=this.sounds_dice.coin[Math.floor(Math.random()*this.sounds_dice.coin.length)]:s=this.sounds_dice[this.sound_dieMaterial][Math.floor(Math.random()*this.sounds_dice[this.sound_dieMaterial].length)],s&&(s.volume=Math.min(o/8e3,this.volume/100),s.play().catch(a=>{})),this.lastSoundType="dice"}else{let o=t.velocity.length();if(o<250)return;let s=this.surface,a=this.sounds_table[s],l=a[Math.floor(Math.random()*a.length)];l&&(l.volume=Math.min(o/8e3,this.volume/100),l.play().catch(c=>{})),this.lastSoundType="table"}this.lastSoundStep=e.world.stepnumber,this.lastSound=n+this.soundDelay}}checkForRethrow(e){let t=e.notation.func?e.notation.func.toLowerCase():"",n,r=!1;if(t!=""&&n&&n.method){t=e.notation.func.toLowerCase();let o=e.notation.args||"";r=n.method(e,o)}return r}throwFinished(){let e=this.iteration>this.iterationLimit;for(let t=0,n=this.diceList.length;t<n;++t){let r=this.diceList[t],o=He.SLEEPING;if(r.body.sleepState<o&&!e)return!1;if(r.body.sleepState==o||e){if(r.body.type===He.KINEMATIC)continue;let s=!1;if(r.result.length==0?(r.storeRolledValue(r.resultReason),s=this.checkForRethrow(r)):r.result.length>0&&r.rerolling&&(r.rerolling=!1,r.storeRolledValue("reroll"),s=this.checkForRethrow(r)),s)return r.rerolls+=1,r.rerolling=!0,r.body.wakeUp(),r.body.type=He.DYNAMIC,r.body.angularVelocity=new w(25,25,25),r.body.velocity=new w(0,0,3e3),!1;r.rerolling=!1,r.body.type=He.KINEMATIC}}return!0}simulateThrow(){for(this.animstate="simulate",this.iteration=0,this.rolling=!0;!this.throwFinished(!0);)++this.iteration,this.world.step(this.framerate)}animateThrow(e,t){this.animstate="throw";let n=Date.now();this.last_time=this.last_time||n-this.framerate*1e3;let r=(n-this.last_time)/1e3;++this.iteration;let o=Math.floor(r/this.framerate);for(let s=0;s<o;s++)this.world.step(this.framerate),++this.steps;for(let s in this.scene.children){let a=this.scene.children[s];a.body!=null&&(a.position.copy(a.body.position),a.quaternion.copy(a.body.quaternion))}if(this.renderer.render(this.scene,this.camera),this.last_time=this.last_time+o*this.framerate*1e3,this.running==e&&this.throwFinished()){this.running=!1,this.rolling=!1,t&&t.call(this,this.notationVectors),this.running=Date.now(),this.animateAfterThrow(this.running);return}this.running==e&&((s,a,l,c,u)=>{!l&&r<this.framerate?setTimeout(()=>{requestAnimationFrame(()=>{s.call(this,a,c,u)})},(this.framerate-r)*1e3):requestAnimationFrame(()=>{s.call(this,a,c,u)})}).bind(this)(this.animateThrow,e,this.adaptive_timestep,t)}animateAfterThrow(e){this.animstate="afterthrow";let t=Date.now(),n=(t-this.last_time)/1e3;n>3&&(n=this.framerate),this.running=!1,this.last_time=t,this.renderer.render(this.scene,this.camera),this.running==e&&((r,o,s)=>{!s&&n<this.framerate?setTimeout(()=>{requestAnimationFrame(()=>{r.call(this,o)})},(this.framerate-n)*1e3):requestAnimationFrame(()=>{r.call(this,o)})}).bind(this)(this.animateAfterThrow,e,this.adaptive_timestep)}startClickThrow(e){this.rolling&&(this.clearDice(),this.rolling=!1);let t={x:(Math.random()*2-.5)*this.display.currentWidth,y:-(Math.random()*2-.5)*this.display.currentHeight},n=Math.sqrt(t.x*t.x+t.y*t.y)+100,r=(Math.random()+3)*n*this.strength;return this.getNotationVectors(e,t,r,n)}clearDice(){this.running=!1;let e;for(;e=this.diceList.pop();)this.scene.remove(e),e.body&&this.world.removeBody(e.body);this.renderer.render(this.scene,this.camera),setTimeout(()=>{this.renderer.render(this.scene,this.camera)},100)}getDiceResults(e){if(e!==void 0)return ne({type:this.diceList[e].shape,sides:parseInt(this.diceList[e].shape.substring(1)),id:e},this.diceList[e].result.at(-1));let t=0,n=this.notationVectors.constant?parseInt(`${this.notationVectors.op}${this.notationVectors.constant}`):0,r=n;return{notation:this.notationVectors.notation,sets:this.notationVectors.set.map(o=>{let s=t+o.num-1,a=0,l=[];for(let u=t;u<=s;u++){if(this.diceList[t].result.at(-1).reason==="remove"){t++;continue}l.push(ne({type:o.type,sides:parseInt(o.type.substring(1)),id:t},this.diceList[t].result.at(-1))),a+=this.diceList[t].result.at(-1).value,t++}let c={num:o.num,type:o.type,sides:parseInt(o.type.substring(1)),rolls:l,total:a};return r+=a,c}),modifier:n,total:r}}roll(e){return _e(this,null,function*(){if(this.notationVectors=this.startClickThrow(e),this.notationVectors)return new Promise((t,n)=>{this.rollDice(()=>{let r=this.getDiceResults();this.onRollComplete(r);let o=new CustomEvent("rollComplete",{detail:r});document.dispatchEvent(o),t(r)})})})}reroll(e){return _e(this,null,function*(){return this.rolling=!0,this.running=Date.now(),this.iteration=0,new Promise((t,n)=>{e.forEach(r=>{let o=this.diceList[r];o.rerolls+=1,o.rerolling=!0,o.body.wakeUp(),o.body.type=He.DYNAMIC,o.body.angularVelocity=new w(25,25,25),o.body.velocity=new w(0,0,3e3)}),this.animateThrow(this.running,()=>{let r=e.map(s=>this.getDiceResults(s));this.onRerollComplete(r);let o=new CustomEvent("rerollComplete",{detail:r});document.dispatchEvent(o),t(r)})})})}add(e){return _e(this,null,function*(){let t=this.diceList.length;if(!t)return this.roll(e);let n=this.startClickThrow(e),r=[];for(let o=0,s=n.vectors.length;o<s;++o)this.spawnDice(n.vectors[o]);this.simulateThrow(),this.steps=0,this.iteration=0;for(let o=0,s=n.vectors.length;o<s;++o){let a=t+o;!this.diceList[a]||(this.spawnDice(n.vectors[o],this.diceList[a]),r.push(a))}if(n.result&&n.result.length>0)for(let o=0;o<n.result.length;o++){let s=t+o,a=this.diceList[s];!a||a.getLastValue().value!=n.result[o]&&this.swapDiceFace(a,n.result[o])}return this.notationVectors=Nm.mergeNotation(this.notationVectors,n),new Promise((o,s)=>{let a=()=>{let l=r.map(u=>this.getDiceResults(u));this.onAddDiceComplete(l);let c=new CustomEvent("addDiceComplete",{detail:l});document.dispatchEvent(c),o(l)};this.rolling=!0,this.running=Date.now(),this.last_time=0,this.animateThrow(this.running,a)})})}remove(e){return _e(this,null,function*(){return new Promise((t,n)=>{let r=[];e.forEach(s=>{let a=this.diceList[s];a.body&&this.world.removeBody(a.body),this.scene.remove(a),a.storeRolledValue("remove"),r.push(this.getDiceResults(s))}),this.renderer.render(this.scene,this.camera),this.onRemoveDiceComplete(r);let o=new CustomEvent("removeDiceComplete",{detail:r});document.dispatchEvent(o),t(r)})})}rollDice(e){if(this.notationVectors.error){e.call(this);return}this.clearDice();for(let t=0,n=this.notationVectors.vectors.length;t<n;++t)this.spawnDice(this.notationVectors.vectors[t]);this.simulateThrow(),this.steps=0,this.iteration=0;for(let t=0,n=this.diceList.length;t<n;++t)!this.diceList[t]||this.spawnDice(this.notationVectors.vectors[t],this.diceList[t]);if(this.notationVectors.result&&this.notationVectors.result.length>0)for(let t=0;t<this.notationVectors.result.length;t++){let n=this.diceList[t];!n||n.getLastValue().value!=this.notationVectors.result[t]&&this.swapDiceFace(n,this.notationVectors.result[t])}this.rolling=!0,this.running=Date.now(),this.last_time=0,this.animateThrow(this.running,e)}};var k5=i=>({display:i}),O5={foreground:"#ffffff",texture:"marble",material:"metal",background:["#573139ff","#263b36ff","#312749ff"],outline:"black"};function L5(i){return new Promise(e=>setTimeout(e,i))}var sc=class i{constructor(e){this.mediator=e;this.readyPromise=new Promise(t=>this.markReady=t)}diceBox;readyPromise;markReady;unsubscribe;visible=!0;ngAfterViewInit(){this.diceBox=new km("#diceCanvas",{framerate:1/144,sound_dieMaterial:"metal",theme_surface:"green-felt",shadows:!0,sounds:!0,volume:100,light_intensity:3,gravity_multiplier:780,baseScale:100,strength:1.8,theme_texture:"marble",theme_customColorset:O5}),this.diceBox.initialize(),this.markReady()}ngOnInit(){let e=this.mediator.getRequests().subscribe(r=>_e(this,[r],function*({request:t,respond:n}){if(t.type==="diceRoller.rollDice")try{let o=String(t.payload?.expression??"1d20"),s=yield this.rollDice(o);n(s)}catch(o){n({error:String(o)})}else if(t.type==="diceRoller.setDiceVisible"){console.log("dice-roller received diceRoller.setDiceVisible request",t.payload);try{let o=!!t.payload?.visible;this.visible=o,n({ok:!0})}catch(o){n({ok:!1,error:String(o)})}}else t.type==="diceRoller.clearDice"&&this.diceBox?.clearDice()}));this.unsubscribe=()=>e.unsubscribe()}rollDice(e){return _e(this,null,function*(){if(yield this.readyPromise,yield L5(0),!this.diceBox||typeof this.diceBox.roll!="function")throw console.error("DiceBox not initialized yet. Did ngAfterViewInit run?"),new Error("DiceBox not initialized");this.visible=!0;let t;try{t=yield this.diceBox.roll(e)}catch(n){console.warn("Dice roll failed:",e,n)}return console.log("Intermediate roll results:",t),t})}ngOnDestroy(){try{this.unsubscribe?.()}catch{}}static \u0275fac=function(t){return new(t||i)(se(qn))};static \u0275cmp=Pe({type:i,selectors:[["app-dice-roller"]],decls:1,vars:3,consts:[["id","diceCanvas",3,"ngStyle"]],template:function(t,n){t&1&&Te(0,"div",0),t&2&&ae("ngStyle",Kc(1,k5,n.visible?"block":"none"))},dependencies:[ke,ou],styles:["#diceCanvas[_ngcontent-%COMP%]{position:fixed;inset:0;overflow:visible;pointer-events:none;z-index:5}"]})};var F5=["inventoryZone"],V5=["equipmentZone"];function kI(i,e){return this.itemKey(e)}var B5=(i,e)=>e.key;function z5(i,e){if(i&1){let t=Qe();C(0,"div",15),Y("mousedown",function(r){let o=ve(t).$implicit,s=ie();return ye(s.onPointerDown(o,"equipment",r))}),C(1,"span",16),Y("mouseenter",function(r){let o=ve(t).$implicit,s=ie();return ye(s.onItemNameEnter(o,r))})("mouseleave",function(r){ve(t);let o=ie();return ye(o.onItemNameLeave(r))})("mousemove",function(r){ve(t);let o=ie();return ye(o.onItemNameMove(r))}),A(2),E(),C(3,"span",17),A(4),E()()}if(i&2){let t=e.$implicit,n=ie();Ze("drag-source",n.draggingItem()===t),P(2),Le(t.item_name),P(2),rt("\xD7 ",t.quantity)}}function j5(i,e){i&1&&(C(0,"div",9),A(1,"no equipped items"),E())}function U5(i,e){if(i&1){let t=Qe();C(0,"div",18),Y("mousedown",function(r){let o=ve(t).$implicit,s=ie();return ye(s.onPointerDown(o,"inventory",r))})("mouseenter",function(r){let o=ve(t).$implicit,s=ie();return ye(s.onItemNameEnter(o,r))})("mouseleave",function(r){ve(t);let o=ie();return ye(o.onItemNameLeave(r))})("mousemove",function(r){ve(t);let o=ie();return ye(o.onItemNameMove(r))}),C(1,"span",19),A(2),E(),C(3,"span",17),A(4),E()()}if(i&2){let t=e.$implicit,n=ie();Ze("drag-source",n.draggingItem()===t),P(2),Le(t.item_name),P(2),rt("\xD7 ",t.quantity)}}function H5(i,e){i&1&&(C(0,"div",9),A(1,"bag is empty"),E())}function G5(i,e){if(i&1&&(C(0,"div",12)(1,"span",20),A(2),E(),C(3,"span",21),A(4),E()()),i&2){let t=e.$implicit;P(2),rt("",t.label,": "),P(2),rt(" ",t.amount)}}function q5(i,e){if(i&1&&(C(0,"div",22)(1,"div",23)(2,"span",19),A(3),E(),C(4,"span",17),A(5),E()()()),i&2){let t=ie();gt("transform",t.dragPreviewTransform()),P(3),Le(t.draggingItem().item_name),P(2),rt("\xD7 ",t.draggingItem().quantity)}}function W5(i,e){if(i&1&&Te(0,"app-hover-preview",14),i&2){let t=ie();ae("show",!0)("content",t.hoverMessage())("offsetX",32)("offsetY",32)}}var Lm=class i{constructor(e,t,n){this.characterSheetService=e;this.cursorService=t;this.soundService=n}draggingItem=at(null);draggingFrom=at(null);cursorX=at(0);cursorY=at(0);cursorSub;moveListener;upListener;hoverTimer;dummyIndex=0;itemIdMap=new WeakMap;nextItemId=1;inventoryZone;equipmentZone;ngOnInit(){this.cursorSub=this.cursorService.cursorPositionTvScreen$.subscribe(e=>{this.cursorX.set(e.x),this.cursorY.set(e.y)})}get inventory(){return this.characterSheetService.getCharacterSheet()?.inventory??[]}ngOnDestroy(){this.cursorSub?.unsubscribe(),this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0)}addCheatItem(){console.log("Adding dummy item to inventory for testing");let e=this.characterSheetService.getCharacterSheet();if(!e)return;let t=[...e.inventory??[]];t.push({item_name:"Ultimate Greataxe",description:"Magic greataxe with powerful enchantments.",quantity:1,equipped:!1,can_equip:!0,item_type:"Greataxe",damage:"2d12 + 6"}),this.characterSheetService.setInventory(t);let n=ne({},e.currencies);n.gp=(n.gp??0)+10,e.currencies=n,this.characterSheetService.setCurrencies(e.currencies),console.log("Current Character Sheet:",this.characterSheetService.getCharacterSheet()),console.log("Current Inventory:",this.inventory),console.log("Equipped Items:",this.equippedItems()),console.log("Bag Items:",this.bagItems())}equippedItems(){return this.inventory.filter(e=>e.equipped)}bagItems(){return this.inventory.filter(e=>!e.equipped)}get currencies(){return this.characterSheetService.getCharacterSheet()?.currencies??{cp:0,sp:0,ep:0,gp:0,pp:0}}currenciesList(){let e=this.currencies;return["cp","sp","ep","gp","pp"].map(n=>({key:n,label:n,amount:e[n]??0}))}currenciesTotal(){let e=this.currencies;return(e.cp??0)+(e.sp??0)+(e.ep??0)+(e.gp??0)+(e.pp??0)}onPointerDown(e,t,n){n.button===0&&(this.draggingItem.set(e),this.draggingFrom.set(t),n.preventDefault(),this.cursorService.setGlobalPosition(n.clientX,n.clientY),this.moveListener=r=>{r.preventDefault(),this.cursorService.setGlobalPosition(r.clientX,r.clientY)},this.upListener=r=>{r.preventDefault(),this.finishCustomDrag(r)},document.addEventListener("mousemove",this.moveListener,{passive:!1}),document.addEventListener("mouseup",this.upListener,{passive:!1}))}onDragEnd(){this.draggingItem.set(null),this.draggingFrom.set(null),this.moveListener&&(document.removeEventListener("mousemove",this.moveListener),this.moveListener=void 0),this.upListener&&(document.removeEventListener("mouseup",this.upListener),this.upListener=void 0)}finishCustomDrag(e){let t=this.draggingItem();if(!t){this.onDragEnd();return}let n={x:e.clientX,y:e.clientY},r=this.isPointInRect(n,this.equipmentZone?.nativeElement?.getBoundingClientRect()),o=this.isPointInRect(n,this.inventoryZone?.nativeElement?.getBoundingClientRect());if(r){if(!t.can_equip){this.onDragEnd();return}t.equipped=!0,this.soundService.playEquipSound(),this.publishInventoryUpdate(),this.onDragEnd();return}if(o){t.equipped=!1,this.soundService.playUnequipSound(),this.publishInventoryUpdate(),this.onDragEnd();return}this.onDragEnd()}isPointInRect(e,t){return t?e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom:!1}onZoneDragOver(e){e.preventDefault()}onEquipmentDragEnter(e){}onEquipmentDragLeave(e){}onDropToEquipment(e){e.preventDefault();let t=this.draggingItem();if(t){if(!t.can_equip){this.onDragEnd();return}t.equipped=!0,this.soundService.playEquipSound(),this.publishInventoryUpdate(),this.onDragEnd()}}onDropToInventory(e){e.preventDefault();let t=this.draggingItem();t&&(t.equipped=!1,this.soundService.playUnequipSound(),this.publishInventoryUpdate(),this.onDragEnd())}itemKey(e){let t=this.itemIdMap.get(e);return t===void 0&&(t=this.nextItemId++,this.itemIdMap.set(e,t)),t}publishInventoryUpdate(){let e=this.characterSheetService.getCharacterSheet();e&&this.characterSheetService.setInventory([...e.inventory??[]])}dragPreviewTransform(){return`translate(${this.cursorX()}px, ${this.cursorY()}px) translate(10px, 0) translate(-100%, -50%)`}hoverItem=at(null);onItemNameEnter(e,t){this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.cursorService.setInsideTvScreenPosition(t.clientX,t.clientY),this.hoverTimer=setTimeout(()=>{e&&this.hoverItem.set(e)},200)}onItemNameMove(e){this.cursorService.setInsideTvScreenPosition(e.clientX,e.clientY)}onItemNameLeave(e){this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.hoverItem.set(null)}hoverMessage=Vr(()=>{let e=this.hoverItem();if(!e)return"";let t=[],n=(e.item_name??"").toString().trim();n.length&&t.push(`### ${n}`);let r=(e.description??"").toString().trim();r.length&&t.push(r);let o=(e.item_type??"").toString().trim();o.length&&t.push(`**Type:** ${o}`);let s=(e.damage??"").toString().trim();s.length&&t.push(`**Damage:** ${s}`);let a=e.armor_class;return a!=null&&`${a}`.toString().trim().length&&t.push(`**Armor Class:** ${a}`),t.join(`

`)});static \u0275fac=function(t){return new(t||i)(se(Wt),se(fi),se(Dn))};static \u0275cmp=Pe({type:i,selectors:[["app-inventory-pane"]],viewQuery:function(t,n){if(t&1&&(At(F5,5),At(V5,5)),t&2){let r;Rt(r=Pt())&&(n.inventoryZone=r.first),Rt(r=Pt())&&(n.equipmentZone=r.first)}},decls:25,vars:6,consts:[["equipmentZone",""],["inventoryZone",""],[1,"inventory-pane-wrapper"],[2,"margin","-1rem","text-align","right","background","transparent","font-size","medium",3,"click"],[1,"up-pane-zone"],["aria-label","Equipment zone",1,"equipment-zone"],[1,"zone-title"],[1,"zone-content"],[1,"item-tile",3,"drag-source"],[1,"zone-empty"],["aria-label","Inventory zone",1,"inventory-zone"],["aria-label","Currencies zone",1,"currencies-zone"],[1,"coin-tile"],[1,"drag-preview",3,"transform"],[3,"show","content","offsetX","offsetY"],[1,"item-tile",3,"mousedown"],[1,"item-name",3,"mouseenter","mouseleave","mousemove"],[1,"item-qty"],[1,"item-tile",3,"mousedown","mouseenter","mouseleave","mousemove"],[1,"item-name"],[1,"coin-name"],[1,"coin-qty"],[1,"drag-preview"],[1,"drag-preview-inner"]],template:function(t,n){if(t&1){let r=Qe();C(0,"div",2)(1,"button",3),Y("click",function(){return ve(r),ye(n.addCheatItem())}),A(2,"\u{1F977}"),E(),C(3,"div",4)(4,"div",5,0)(6,"div",6),A(7,"EQUIPMENT"),E(),C(8,"div",7),Ks(9,z5,5,4,"div",8,kI,!0),li(11,j5,2,0,"div",9),E()(),C(12,"div",10,1)(14,"div",6),A(15,"INVENTORY"),E(),C(16,"div",7),Ks(17,U5,5,4,"div",8,kI,!0),li(19,H5,2,0,"div",9),E()()(),C(20,"div",11),Ks(21,G5,5,2,"div",12,B5),li(23,q5,6,4,"div",13),li(24,W5,1,4,"app-hover-preview",14),E()()}t&2&&(Ze("drag-active",!!n.draggingItem()),P(9),Qs(n.equippedItems()),P(2),ci(n.equippedItems().length?-1:11),P(6),Qs(n.bagItems()),P(2),ci(n.bagItems().length?-1:19),P(2),Qs(n.currenciesList()),P(2),ci(n.draggingItem()?23:-1),P(),ci(!n.draggingItem()&&n.hoverItem()?24:-1))},dependencies:[ke,Fl],styles:['[_nghost-%COMP%]{width:100%;height:100%;display:block;pointer-events:all}.inventory-pane-wrapper[_ngcontent-%COMP%]{justify-content:space-between;padding:.6rem 1.45rem .6rem .6rem;width:100%;height:100%;min-height:320px;display:flex;flex-direction:column;gap:8px;box-sizing:border-box}.up-pane-zone[_ngcontent-%COMP%]{height:92%;display:flex;flex-direction:column;justify-content:flex-start}.equipment-zone[_ngcontent-%COMP%]{margin-top:8px;width:100%;height:35%;box-sizing:border-box;border:2.5px solid #adadadff;display:flex;flex-direction:column}.inventory-zone[_ngcontent-%COMP%]{margin-top:8px;width:100%;height:62%;box-sizing:border-box;border:2.5px solid #adadadff;display:flex;flex-direction:column}.currencies-zone[_ngcontent-%COMP%]{display:flex;min-height:fit-content;height:8%;width:100%;margin-bottom:8px;overflow:hidden;justify-content:center;flex-direction:row;justify-content:space-around}.equipment-zone[_ngcontent-%COMP%], .currencies-zone[_ngcontent-%COMP%], .inventory-zone[_ngcontent-%COMP%]{width:100%}.zone-title[_ngcontent-%COMP%]{font-weight:600;font-size:.9rem;background-color:#181818;padding:4px 8px;border-bottom:2.5px solid #adadadff;text-align:center}.zone-content[_ngcontent-%COMP%]{overflow:auto;padding:6px;display:flex;flex-direction:column;gap:6px}.zone-empty[_ngcontent-%COMP%]{color:#777;font-size:.85rem;padding:4px 6px}.item-tile[_ngcontent-%COMP%]{font-family:"Sans-serif";display:flex;align-items:center;justify-content:space-between;padding:6px 8px;border:1.5px solid #c9c9c9;border-radius:4px;-webkit-user-select:none;user-select:none;transition:opacity .12s ease,filter .12s ease}.item-tile.drag-source[_ngcontent-%COMP%]{opacity:.35;filter:saturate(.7)}.item-name[_ngcontent-%COMP%]{font-weight:500}.item-qty[_ngcontent-%COMP%]{opacity:.8}.coin-tile[_ngcontent-%COMP%]{margin-right:1rem}.coin-name[_ngcontent-%COMP%]{font-weight:600}.coin-qty[_ngcontent-%COMP%]{opacity:.9}.equipment-zone.invalid-drop[_ngcontent-%COMP%]{filter:grayscale(1) brightness(.95);transition:filter .12s ease}.drag-preview[_ngcontent-%COMP%]{position:fixed;left:0;top:0;z-index:9999;pointer-events:none;will-change:transform;transform:translate(0)}.drag-preview-inner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:6px 10px;border:1.5px solid #888;border-radius:6px;background:#202020e6;color:#f2f2f2;box-shadow:0 6px 14px #00000059;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}']})};function $5(i,e){if(i&1){let t=Qe();C(0,"div",10),Y("click",function(r){let o=ve(t).$implicit,s=ie(2);return ye(s.beginTargeting(o,r))}),C(1,"div",11),A(2),E(),C(3,"div",12),A(4),E(),C(5,"div",13),A(6),E()()}if(i&2){let t=e.$implicit,n=ie(2);P(2),Le(t.name),P(2),Le(n.formatSigned(t.hit)),P(2),Ge("",t.damage," (",t.damageRange,")")}}function Y5(i,e){if(i&1&&(C(0,"div",8),nt(1,$5,7,4,"div",9),E()),i&2){let t=ie();P(),ae("ngForOf",t.attackRows)("ngForTrackBy",t.trackAttack)}}function Z5(i,e){i&1&&(C(0,"div",14),A(1,"No equipped weapons with damage."),E())}var Fm=class i{constructor(e,t,n){this.characterSheetService=e;this.mediator=t;this.sessionManager=n}get character(){return this.characterSheetService.getCharacterSheet()}ngOnDestroy(){this.teardownTargeting()}get attackRows(){let e=this.character,n=(e.inventory??[]).filter(o=>!!o.equipped&&this.hasDamage(o)).map(o=>({name:o.item_name,hit:this.getAttackAbilityMod(o,e),damage:String(o.damage??"").trim(),damageRange:this.getDamageRange(o.damage)})),r=e.getStatModifier(e.stats.strength);return n.push({name:"Unarmed",hit:r+e.proficiency_bonus,damage:(1+r).toString(),damageRange:(1+r).toString()}),n}trackAttack=(e,t)=>`${t.name}|${t.damage}`;formatSigned(e){return e>=0?`+${e}`:`${e}`}hasDamage(e){return(e.damage??"").toString().trim().length>0}getAttackAbilityMod(e,t){let n=(e.item_type||"").toLowerCase(),r=(e.item_name||"").toLowerCase(),o=new Set(["shortsword","dagger","rapier","scimitar","sickle","bow","shortbow","longbow","crossbow","hand crossbow","light crossbow","heavy crossbow","sling","dart"]),s=n.includes("finesse")||n.includes("ranged")||n.includes("bow")||n.includes("crossbow")||n.includes("sling")||n.includes("light")||n.includes("dart")||o.has(r)||r.includes("shortsword"),a=t.getStatModifier(t.stats.strength),l=t.getStatModifier(t.stats.dexterity);return s?l:a}getDamageRange(e){let t=String(e??"").trim();if(!t)return"";let n=t.match(/^([+-]?\d+)$/);if(n)return n[1];let r=0,o=0,s=!1,a=/\b(\d*)d(\d+)\b/gi;for(let h of t.matchAll(a)){s=!0;let d=h[1]?parseInt(h[1],10):1,p=parseInt(h[2],10);!Number.isFinite(d)||!Number.isFinite(p)||d<=0||p<=0||(r+=d*1,o+=d*p)}let l=t.replace(a," "),c=/([+-])\s*(\d+)/g,u;for(;(u=c.exec(l))!==null;){let h=u[1]==="-"?-1:1,d=parseInt(u[2],10);Number.isFinite(d)&&(r+=h*d,o+=h*d)}return s?r===o?String(r):`${r}~${o}`:t}targetingActive=!1;pendingAction;teardownFns=[];beginTargeting(e,t){t.stopPropagation(),t.preventDefault(),this.targetingActive&&this.teardownTargeting();let n=t.currentTarget,o=(n?.querySelector(".td.name")??n??t.target).getBoundingClientRect(),s={x:o.left+o.width/2,y:o.top+o.height/2};this.pendingAction={name:e.name,hit:e.hit,damage:e.damage},this.mediator.publish("targeting.begin",{start:s}),this.targetingActive=!0;let a=this.mediator.on("combat.rowClicked").subscribe(({entity:h})=>{if(!this.targetingActive||!this.pendingAction)return;let{name:d,hit:p,damage:g}=this.pendingAction;this.actionRoll(d,p,g,h),this.teardownTargeting()});this.teardownFns.push(()=>a.unsubscribe());let l=h=>{h.target?.closest(".combat-pane .row")||this.teardownTargeting()};document.addEventListener("click",l,!0),this.teardownFns.push(()=>document.removeEventListener("click",l,!0));let c=h=>{h.preventDefault(),this.teardownTargeting()};document.addEventListener("contextmenu",c,!0),this.teardownFns.push(()=>document.removeEventListener("contextmenu",c,!0));let u=h=>{h.button===2&&(h.preventDefault(),this.teardownTargeting())};document.addEventListener("mousedown",u,!0),this.teardownFns.push(()=>document.removeEventListener("mousedown",u,!0))}teardownTargeting(){this.targetingActive=!1,this.pendingAction=void 0;for(let e of this.teardownFns.splice(0))try{e()}catch{}this.mediator.publish("targeting.end",{})}actionRoll(e,t,n,r){return _e(this,null,function*(){let o="1d20",s=String(n??"").trim();if(!s)return;let a=s.match(/^([+-]?\d+)$/),l="",c=0;if(a)l="",c=parseInt(a[1],10);else{let v=s.match(/\b(\d*)d(\d+)\b/i);l=v?v[0]:"";let y=s.replace(/\b(\d*)d(\d+)\b/gi," "),x=/([+-]?\s*\d+)/g,_;for(;(_=x.exec(y))!==null;){let S=parseInt(_[1].replace(/\s+/g,""),10);Number.isFinite(S)&&(c+=S)}}let u=`${o} + ${l}`;console.log(`Rolling attack and damage: ${u}`);let h=yield this.mediator.sendRequest("diceRoller.rollDice",{expression:u});console.log("Got rawResults from dice roller:",h.sets),console.log("Mods:",t,c);let d=(h?.sets[0]?.total??0)+t,p=(h?.sets[1]?.total??0)+c;console.log(`Attack Roll Total: ${d}`);let g={attack:`${o} + ${t}`},f={attack:d},m=`Attack Roll: ${d}`;if(r?.ac!==void 0){d<r.ac?(p=0,m+=` (missed vs AC ${r.ac})`):(g.damage=`${l} + ${c}`,f.damage=p,m+=` (hit vs AC ${r.ac}) Damage: ${p}`);let v=(yield this.mediator.sendRequest("chat.getDraft",{}))?.draft??"";yield this.mediator.sendRequest("chat.clearDraft",{});let y={name:this.characterSheetService.getCharacterName(),dialogue:`${v} Attacks with ${e}: ${m}`,action_name:e,target:r.name,expressions:g,result:f},x={name:this.characterSheetService.getCharacterName(),action_name:KM};this.sessionManager.sendSimulationSequencesToDmAndHandleResponseInChatPane([y,x])}})}static \u0275fac=function(t){return new(t||i)(se(Wt),se(qn),se(Wi))};static \u0275cmp=Pe({type:i,selectors:[["app-actions-pane"]],decls:12,vars:2,consts:[["emptyState",""],[1,"actions-pane"],[1,"table"],[1,"thead"],[1,"th","name"],[1,"th","hit"],[1,"th","dmg"],["class","tbody",4,"ngIf","ngIfElse"],[1,"tbody"],["class","tr",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tr",3,"click"],[1,"td","name"],["clickableDivWithSound","",1,"td","hit"],["clickableDivWithSound","",1,"td","dmg"],[1,"empty"]],template:function(t,n){if(t&1&&(C(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),A(4,"ATTACK"),E(),C(5,"div",5),A(6,"HIT/DC"),E(),C(7,"div",6),A(8,"DAMAGE"),E()(),nt(9,Y5,2,2,"div",7)(10,Z5,2,0,"ng-template",null,0,wo),E()()),t&2){let r=cr(11);P(9),ae("ngIf",n.attackRows.length)("ngIfElse",r)}},dependencies:[ke,pi,_n,Gt],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.actions-pane[_ngcontent-%COMP%]{width:100%;height:100%;padding:.6rem;box-sizing:border-box;display:flex}.table[_ngcontent-%COMP%]{width:100%;height:100%;display:grid;grid-template-rows:auto 1fr;gap:8px}.thead[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr;align-items:center;gap:8px}.thead[_ngcontent-%COMP%]{border-bottom:2.5px solid #adadadff;font-weight:600;background:#181818;padding:6px 8px}.tbody[_ngcontent-%COMP%]{overflow:auto;display:flex;flex-direction:column;gap:6px}.tr[_ngcontent-%COMP%]{border:1.5px solid #c9c9c9;border-radius:4px;padding:8px}.tr[_ngcontent-%COMP%]:hover{background:#333}.td.name[_ngcontent-%COMP%], .th.name[_ngcontent-%COMP%], .td.hit[_ngcontent-%COMP%], .th.hit[_ngcontent-%COMP%], .td.dmg[_ngcontent-%COMP%], .th.dmg[_ngcontent-%COMP%]{justify-self:start}.empty[_ngcontent-%COMP%]{color:#777;padding:.5rem}"]})};var X5=(i,e)=>e.key;function K5(i,e){i&1&&(C(0,"div",4),A(1,"No maps in inventory"),E())}function Q5(i,e){if(i&1){let t=Qe();C(0,"div",11)(1,"img",12),Y("mousedown",function(){ve(t);let r=ie().$implicit,o=ie(2);return ye(o.openModal(r.imageUrl))}),E()()}if(i&2){let t=ie().$implicit;P(),ae("src",t.imageUrl,xi)("alt",t.item.item_name)}}function J5(i,e){if(i&1){let t=Qe();C(0,"div",6)(1,"div",7),Y("mousedown",function(){let r=ve(t).$implicit,o=ie(2);return ye(o.toggle(r.key))}),C(2,"div",8),A(3),E(),C(4,"div",9)(5,"span",10),A(6),E()()(),li(7,Q5,2,2,"div",11),E()}if(i&2){let t=e.$implicit,n=ie(2);P(),Jn("aria-expanded",n.isOpen(t.key)),P(2),Le(t.item.item_name),P(3),Le(n.isOpen(t.key)?"Hide":"Show"),P(),ci(n.isOpen(t.key)?7:-1)}}function eH(i,e){if(i&1&&Ks(0,J5,8,4,"div",6,X5),i&2){let t=ie();Qs(t.mapEntries())}}function tH(i,e){if(i&1){let t=Qe();C(0,"app-image-modal",13),Y("closed",function(){ve(t);let r=ie();return ye(r.closeModal())}),E()}if(i&2){let t=ie();ae("src",t.modalUrl())}}var Vm=class i{characterSheetService=oe(Wt);sessionManager=oe(Wi);openSet=at(new Set);modalUrl=at(null);mapEntries(){return(this.characterSheetService.getCharacterSheet()?.inventory??[]).filter(t=>(t.item_type?.toLowerCase?.()??"")==="map").map(t=>({item:t,imageUrl:this.extractFirstUrl(t.description??void 0)})).filter(t=>!!t.imageUrl).map(t=>Ve(ne({},t),{key:this.computeKey(t.item)+"|"+t.imageUrl}))}toggle(e){let t=new Set(this.openSet().values());t.has(e)?t.delete(e):t.add(e),this.openSet.set(t)}isOpen(e){return this.openSet().has(e)}openModal(e){e&&this.modalUrl.set(e)}closeModal(){this.modalUrl.set(null)}computeKey(e){let t=`${e.item_name??""}|${e.description??""}|${e.quantity??1}`,n=0;for(let r=0;r<t.length;r++)n=n*31+t.charCodeAt(r)>>>0;return n.toString(36)}extractFirstUrl(e){if(!e)return"";let t=/(https?:\/\/[\w\-\.\/:#%?=&+~]+\.(?:png|jpe?g|webp|gif|svg))|((?:\/)\S+\.(?:png|jpe?g|webp|gif|svg))/i;return e.match(t)?.[0]??""}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-map-pane"]],decls:12,vars:4,consts:[[1,"map-pane-wrapper"],[1,"world-info"],[1,"header"],[1,"content"],[1,"empty"],[3,"src"],[1,"map-item"],["clickableDivWithSound","","role","button","tabindex","0",1,"map-item-header",3,"mousedown"],[1,"title"],[1,"actions"],[1,"toggle"],[1,"map-image-wrap"],["clickableDivWithSound","",1,"map-image",3,"mousedown","src","alt"],[3,"closed","src"]],template:function(t,n){t&1&&(C(0,"div",0)(1,"div",1)(2,"div"),A(3),E(),C(4,"div"),A(5),E()(),C(6,"div",2),A(7,"Maps"),E(),C(8,"div",3),li(9,K5,2,0,"div",4)(10,eH,2,0),E()(),li(11,tH,1,1,"app-image-modal",5)),t&2&&(P(3),Le(n.sessionManager.currentCampaignTime),P(2),Le(n.sessionManager.currentLocation),P(4),ci(n.mapEntries().length?10:9),P(2),ci(n.modalUrl()?11:-1))},dependencies:[ke,Gt,Ol],styles:['[_nghost-%COMP%]{width:100%;height:100%;display:block}.world-info[_ngcontent-%COMP%]{display:flex;font-size:1.2rem;color:#ffcf0eb7;font-weight:700;margin:0rem 0 0rem 0rem;padding:6px 8px;right:0;align-items:flex-end;flex-direction:column}.world-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-family:"system-ui";text-align:right}.map-pane-wrapper[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;box-sizing:border-box}.header[_ngcontent-%COMP%]{font-weight:600;padding:6px 8px;border-bottom:2px solid #e1e1e1}.content[_ngcontent-%COMP%]{flex:1 1 auto;min-height:0;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}.empty[_ngcontent-%COMP%]{color:#777;font-size:.95rem;padding:4px 6px}.map-item[_ngcontent-%COMP%]{border:1.5px solid #c9c9c9;border-radius:6px;overflow:hidden}.map-item-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 10px;-webkit-user-select:none;user-select:none}.title[_ngcontent-%COMP%]{font-weight:600}.actions[_ngcontent-%COMP%]{opacity:.9}.toggle[_ngcontent-%COMP%]{font-size:.9rem}.map-image-wrap[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;justify-content:center;align-items:center;padding:8px}.map-image[_ngcontent-%COMP%]{max-width:100%;height:auto;object-fit:contain;display:block;border-radius:4px}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000d1;display:flex;align-items:center;justify-content:center;z-index:10}.modal-content[_ngcontent-%COMP%]{max-width:95vw;max-height:95vh;display:flex;flex-direction:column;align-items:center;gap:8px}.modal-image[_ngcontent-%COMP%]{max-width:80vw;max-height:80vh;object-fit:contain;border-radius:6px;display:block;background:#111}']})};function OI(i){let e=[],t=[];if(!Array.isArray(i))return{loadedHistory:e,latestSuggestions:t};for(let n of i){let r=n?.content?.parts??[];for(let o of r){let s,a=JSON.parse(o.text||"null");Array.isArray(a)?s=a:s=[a];for(let l of s)try{let c;Uu in l?c=l[Uu]:c=[l];for(let u of c){let h=u;e.push(h)}Hu in l&&(t=l[Hu])}catch{}}}return{loadedHistory:e,latestSuggestions:t}}function nH(i,e){if(i&1&&Lr(0,"img",1),i&2){let t=ie();Fr("src",t.character.character_background.avatar_url,xi)}}var Bm=class i{constructor(e){this.characterSheetService=e}get character(){return this.characterSheetService.getCharacterSheet()}static \u0275fac=function(t){return new(t||i)(se(Wt))};static \u0275cmp=Pe({type:i,selectors:[["app-character-card"]],decls:20,vars:7,consts:[["aria-hidden","true",1,"character-card"],["alt","Character Avatar",1,"character-avatar",3,"src"],[1,"character-info"],[1,"info-text-line"]],template:function(t,n){t&1&&(Zt(0,"h3"),A(1),jt(),Zt(2,"div",0),li(3,nH,1,1,"img",1),Zt(4,"div",2)(5,"div",3)(6,"strong"),A(7,"HP: "),jt(),A(8),Zt(9,"strong"),A(10,"AC: "),jt(),A(11),jt(),Zt(12,"div",3)(13,"strong"),A(14,"Level: "),jt(),A(15),jt(),Zt(16,"div",3)(17,"strong"),A(18,"Classes: "),jt(),A(19),jt()()()),t&2&&(P(),Le(n.character.character_background.name),P(2),ci(n.character.character_background.avatar_url?3:-1),P(5),Ge(" ",n.character.hp,"/",n.character.getFullHP()," \xA0 "),P(3),rt(" ",n.character.ac," "),P(4),rt(" ",n.character.character_level," "),P(4),rt(" ",n.character.classes.join(", ")," "))},dependencies:[ke],styles:["[_nghost-%COMP%]{display:block;margin:.5rem}h3[_ngcontent-%COMP%]{margin:0 0 8px}.character-card[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.character-info[_ngcontent-%COMP%]{margin:.2rem 0 0 1rem;display:flex;flex-direction:column;margin-bottom:8px;gap:4px}.character-avatar[_ngcontent-%COMP%]{width:7rem;height:7rem;object-fit:cover;border:2px solid #adadadff}"]})};var iH=["hoverInner"];function rH(i,e){if(i&1&&(C(0,"div",9),A(1),E()),i&2){let t=ie(2);P(),rt("Turn: ",t.turnNumber)}}function oH(i,e){if(i&1){let t=Qe();C(0,"div",12),Y("mouseenter",function(r){let o=ve(t).$implicit,s=ie(3);return ye(s.onRowEnter(o,r))})("mouseleave",function(r){ve(t);let o=ie(3);return ye(o.onRowLeave(r))})("mousemove",function(r){ve(t);let o=ie(3);return ye(o.onRowMove(r))})("click",function(r){let o=ve(t).$implicit,s=ie(3);return ye(s.onRowClick(o,r))}),C(1,"div",13),A(2),E(),C(3,"div",14),A(4),E(),C(5,"div",15),A(6),E(),C(7,"div",16),A(8),E()()}if(i&2){let t=e.$implicit,n=ie(3);Ze("targeting-hover",n.targetingActive&&n.hoveredRowName===t.name),P(2),rt(" ",t.name),P(2),Ge("HP: ",t.hp,"/",t.max_hp),P(2),rt("AC: ",t.ac),P(2),rt("Init: ",t.result<0?"??":t.result," ")}}function sH(i,e){if(i&1&&(C(0,"div",10),nt(1,oH,9,7,"div",11),E()),i&2){let t=ie(2);P(),ae("ngForOf",t.sortedEntities)("ngForTrackBy",t.trackByName)}}function aH(i,e){i&1&&(C(0,"div",17),A(1,"No combatants."),E())}function lH(i,e){if(i&1){let t=Qe();C(0,"div",18),Y("mouseleave",function(r){ve(t);let o=ie(2);return ye(o.onPreviewLeave(r))}),Te(1,"div",19,1),sn(3,"messageHtml"),E()}if(i&2){let t=ie(2);gt("transform",t.hoverPreviewTransform()),P(),ae("innerHTML",Hn(3,3,t.hoverMessage()),Ys)}}function cH(i,e){if(i&1&&(Ci(0),C(1,"div",3)(2,"div",4)(3,"div",5),A(4,"COMBAT"),E(),nt(5,rH,2,1,"div",6),E(),nt(6,sH,2,2,"div",7)(7,aH,2,0,"ng-template",null,0,wo)(9,lH,4,5,"div",8),E(),Ei()),i&2){let t=cr(8),n=ie();P(5),ae("ngIf",n.turnNumber!==null&&n.turnNumber!==void 0),P(),ae("ngIf",n.sortedEntities.length)("ngIfElse",t),P(3),ae("ngIf",!n.targetingActive&&n.hoverEntity()&&n.hoverEntity().stat_type!=="Player Character")}}var uH="https://storage.googleapis.com/dnd_adk_static_contents/monsters/",zm=class i{constructor(e,t){this.cursorService=e;this.mediator=t}isInCombat=!1;turnNumber=null;combinedEntities=[];get sortedEntities(){return[...this.combinedEntities].sort((e,t)=>t.result-e.result)}trackByName=(e,t)=>`${t.name}`;hoverEntity=at(null);hoverMarkdown=at("");cursorX=at(0);cursorY=at(0);cursorSub;hoverTimer;fetchAbort;hoverInnerRef;wheelListener;scrollRaf;scrollTarget;targetingActive=!1;hoveredRowName=null;mediatorUnsubs=[];ngOnInit(){this.cursorSub=this.cursorService.cursorPositionTvScreen$.subscribe(n=>{this.cursorX.set(n.x),this.cursorY.set(n.y)}),this.wheelListener=n=>this.onWindowWheel(n),window.addEventListener("wheel",this.wheelListener,{passive:!1});let e=this.mediator.on("targeting.begin").subscribe(()=>{this.targetingActive=!0,this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.hoverEntity.set(null),this.hoverMarkdown.set(""),this.stopScrollAnim()}),t=this.mediator.on("targeting.end").subscribe(()=>{this.targetingActive=!1,this.hoveredRowName=null});this.mediatorUnsubs.push(()=>e.unsubscribe()),this.mediatorUnsubs.push(()=>t.unsubscribe())}ngOnDestroy(){this.cursorSub?.unsubscribe(),this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=void 0),this.wheelListener&&(window.removeEventListener("wheel",this.wheelListener),this.wheelListener=void 0),this.stopScrollAnim();for(let e of this.mediatorUnsubs.splice(0))try{e()}catch{}}onRowEnter(e,t){this.hoveredRowName=e.name,this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.cursorService.setInsideTvScreenPosition(t.clientX,t.clientY),!this.targetingActive&&(this.hoverTimer=setTimeout(()=>{this.hoverEntity.set(e),this.loadStatBlock(e)},500))}onRowMove(e){this.cursorService.setInsideTvScreenPosition(e.clientX,e.clientY)}onRowLeave(e){let t=e.currentTarget,n=e.relatedTarget;n&&(t&&t.contains(n)||n.closest(".hover-preview"))||(this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.hoverEntity.set(null),this.hoverMarkdown.set(""),this.hoveredRowName=null,this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=void 0),this.stopScrollAnim())}onRowClick(e,t){this.mediator.publish("combat.rowClicked",{entity:e,mouseEvent:t})}onPreviewLeave(e){this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=void 0),this.hoverEntity.set(null),this.hoverMarkdown.set(""),this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=void 0),this.stopScrollAnim()}loadStatBlock(e){return _e(this,null,function*(){if(e.stat_type==="Player Character")return;let t=this.toSnakeCase(e.stat_type),n=`${uH}${t}.md`;this.fetchAbort&&this.fetchAbort.abort(),this.fetchAbort=new AbortController;try{let r=yield fetch(n,{signal:this.fetchAbort.signal});if(!r.ok){this.hoverMarkdown.set(`### ${e.name}

_No stat block found for ${e.stat_type}_`);return}let o=yield r.text();this.hoverMarkdown.set(o||`### ${e.name}`)}catch(r){if(r?.name==="AbortError")return;this.hoverMarkdown.set(`### ${e.name}

_Failed to load stat block._`)}})}toSnakeCase(e){return(e||"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}hoverPreviewTransform(){return`translate(${this.cursorX()+32}px, ${this.cursorY()+32}px)`}hoverMessage=Vr(()=>this.hoverEntity()?this.hoverMarkdown():{text:""});onWindowWheel(e){if(!this.hoverEntity())return;let t=this.hoverInnerRef?.nativeElement;if(!t)return;e.preventDefault();let n=t.scrollHeight-t.clientHeight,r=this.scrollTarget??t.scrollTop;this.scrollTarget=Math.max(0,Math.min(n,r+e.deltaY)),this.scrollRaf==null&&(this.scrollRaf=requestAnimationFrame(this.tickScroll))}tickScroll=()=>{let e=this.hoverInnerRef?.nativeElement;if(!e||this.scrollTarget==null){this.stopScrollAnim();return}let t=e.scrollTop,n=this.scrollTarget-t;if(Math.abs(n)<.5){e.scrollTop=this.scrollTarget,this.stopScrollAnim();return}let r=n*.35;e.scrollTop=t+r,this.scrollRaf=requestAnimationFrame(this.tickScroll)};stopScrollAnim(){this.scrollRaf!=null&&(cancelAnimationFrame(this.scrollRaf),this.scrollRaf=void 0),this.scrollTarget=void 0}static \u0275fac=function(t){return new(t||i)(se(fi),se(qn))};static \u0275cmp=Pe({type:i,selectors:[["app-combat-pane"]],viewQuery:function(t,n){if(t&1&&At(iH,5),t&2){let r;Rt(r=Pt())&&(n.hoverInnerRef=r.first)}},inputs:{isInCombat:"isInCombat",turnNumber:"turnNumber",combinedEntities:"combinedEntities"},decls:1,vars:1,consts:[["empty",""],["hoverInner",""],[4,"ngIf"],[1,"combat-pane"],[1,"thead"],[1,"title"],["class","turn",4,"ngIf"],["class","tbody",4,"ngIf","ngIfElse"],["class","hover-preview",3,"transform","mouseleave",4,"ngIf"],[1,"turn"],[1,"tbody"],["class","row",3,"targeting-hover","mouseenter","mouseleave","mousemove","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"row",3,"mouseenter","mouseleave","mousemove","click"],[1,"name"],[1,"hp"],[1,"ac"],[1,"initiative"],[1,"empty"],[1,"hover-preview",3,"mouseleave"],[1,"hover-preview-inner",3,"innerHTML"]],template:function(t,n){t&1&&nt(0,cH,10,4,"ng-container",2),t&2&&ae("ngIf",n.isInCombat)},dependencies:[ke,pi,_n,vs],styles:["[_nghost-%COMP%]{position:absolute;width:70%;top:6rem;left:6rem;z-index:1;display:flex;justify-content:left;align-items:flex-start;padding-top:2rem;justify-content:center;align-items:center;pointer-events:none}.combat-pane[_ngcontent-%COMP%]{position:absolute;width:auto;pointer-events:auto;background:#1f1f1f;color:#eaeaea;border:1.5px solid #c9c9c9;border-radius:6px;padding:8px;box-shadow:0 6px 16px #00000059}.thead[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:12px;border-bottom:2.5px solid #adadadff;padding:6px 4px 8px;margin-bottom:6px}.title[_ngcontent-%COMP%]{font-weight:600;letter-spacing:.5px}.tbody[_ngcontent-%COMP%]{overflow:auto;display:flex;flex-direction:column;gap:6px}.row[_ngcontent-%COMP%]{display:grid;grid-template-columns:5fr 4fr 4fr 4fr;gap:10px;align-items:center;border:1.5px solid #c9c9c9;border-radius:4px;padding:6px 8px;background:#181818}.row.targeting-hover[_ngcontent-%COMP%]{background:#5b1515;border-color:#ff6b6b}.name[_ngcontent-%COMP%], .hp[_ngcontent-%COMP%], .ac[_ngcontent-%COMP%]{justify-self:start}.empty[_ngcontent-%COMP%]{color:#777;padding:.25rem .5rem}.hover-preview[_ngcontent-%COMP%]{position:fixed;font-size:.8rem;left:0;top:0;z-index:1001;pointer-events:auto;will-change:transform;transform:translate(0)}.hover-preview-inner[_ngcontent-%COMP%]{position:relative;padding:8px 10px;border:1.5px solid #888;border-radius:6px;background:#202020eb;color:#f2f2f2;box-shadow:0 6px 14px #00000059;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);max-width:30rem;max-height:55vh;overflow-y:scroll;scroll-behavior:auto;word-wrap:break-word;pointer-events:auto;overscroll-behavior:contain}"]})};var dH=["ta"],jm=class i{sessionManager=oe(Wi);combinedText="";entriesSub;isDirty=!1;dirtyResetTimer;ta;ngOnInit(){this.entriesSub=this.sessionManager.currentJournalEntries$.subscribe(e=>{let t=(e||[]).join(`

`);this.ta&&document.activeElement===this.ta.nativeElement||this.isDirty||t!==this.combinedText&&(this.combinedText=t)})}ngAfterViewInit(){this.combinedText=(this.sessionManager.currentJournalEntries||[]).join(`

`),console.log("\u{1F4D3} Loaded journal entries:",this.sessionManager.currentJournalEntries)}onTextChange(e){this.isDirty=!0,this.dirtyResetTimer&&clearTimeout(this.dirtyResetTimer),this.combinedText=e??"";let n=(this.combinedText||"").replace(/\r\n/g,`
`).split(/\n{2,}/).map(r=>r.trim()).filter(r=>r.length>0);this.sessionManager.currentJournalEntries=n,this.sessionManager.currentJournalEntries$.next(n),this.sessionManager.hasNewUpdatesToJournal=!0,this.dirtyResetTimer=setTimeout(()=>{this.isDirty=!1},400)}ngOnDestroy(){this.entriesSub?.unsubscribe(),this.dirtyResetTimer&&clearTimeout(this.dirtyResetTimer)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-journals-pane"]],viewQuery:function(t,n){if(t&1&&At(dH,5),t&2){let r;Rt(r=Pt())&&(n.ta=r.first)}},decls:6,vars:1,consts:[["ta",""],[1,"journals-pane"],[1,"title"],["placeholder","Write your journal here... Use blank lines to separate entries.",1,"entries-textarea",3,"input","value"]],template:function(t,n){if(t&1){let r=Qe();Zt(0,"div",1)(1,"h2",2),A(2,"Journals"),jt(),Zt(3,"textarea",3,0),ul("input",function(){ve(r);let s=cr(4);return ye(n.onTextChange(s.value))}),A(5,"      "),jt()()}t&2&&(P(3),Fr("value",n.combinedText))},dependencies:[ke],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.journals-pane[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%;box-sizing:border-box;padding:1rem}.title[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:1.25rem;color:#ddd}.entries-textarea[_ngcontent-%COMP%]{flex:1 1 auto;width:100%;box-sizing:border-box;background:#00000059;border:1px solid #444;border-radius:8px;color:#ddd;padding:.75rem .9rem;outline:none;resize:none;font:inherit;font-size:.9rem;line-height:1.35;white-space:pre-wrap}"]})};var hH=["container"],pH=["resizer"],fH=["rightPane"],mH=["topContent"],gH=()=>[];function vH(i,e){if(i&1&&(Te(0,"app-combat-pane",20),sn(1,"async"),sn(2,"async"),sn(3,"async")),i&2){let t=ie();ae("isInCombat",Hn(1,3,t.sessionManager.isInCombat$)??!1)("combinedEntities",Hn(2,5,t.sessionManager.combinedEntities$)??Un(9,gH))("turnNumber",Hn(3,7,t.sessionManager.combatTurnNumber$)??null)}}var Um=class i{constructor(e,t,n){this.characterSheetService=e;this.sessionManager=t;this.bgm=n}leftWidthPercent=62;minLeftPercent=15;maxLeftPercent=85;dragging=!1;currentRightPaneKey="character";sessionId=null;oldChatHistory=[];latestSuggestions=[];containerRef;resizerRef;rightPane;topContentRef;chatComponent;characterSheetComponent;menuPaneComponent;settingsComponent;diceRoller;ngOnInit(){this.sessionId=window.location.pathname.split("/").pop()||"",this.sessionManager.setSessionId(this.sessionId),console.log("GameplayPageComponent ngOnInit with sessionId=",this.sessionId),this.bgm.playYouTube("https://www.youtube.com/watch?v=Jikm8CCRbdM",void 0,!0)}ngAfterViewInit(){return _e(this,null,function*(){console.log("GameplayPageComponent ngAfterViewInit");let{characterSheetList:e,loadedHistory:t,latestSuggestions:n}=yield this.continueSessionFromDb();this.characterSheetService.updateCharacterSheetFromList(e),this.oldChatHistory=t,this.latestSuggestions=n,this.sessionManager.seedInitialChatHistory(this.oldChatHistory,this.latestSuggestions),this.chatComponent?.scheduleScroll(),this.updateTopExpandedHeight()})}continueSessionFromDb(){return _e(this,null,function*(){if(!this.sessionId)return console.warn("No sessionId available to continue session from DB"),{characterSheetList:[],loadedHistory:[],latestSuggestions:[]};let{events:e=[],state:t={}}=yield this.sessionManager.getSessionStateFromDbAndSync(this.sessionId),n=t.character_sheet_list||[],{loadedHistory:r,latestSuggestions:o}=OI(e);return t.current_campaign_time&&(this.sessionManager.currentCampaignTime=t.current_campaign_time),t.current_location&&(this.sessionManager.currentLocation=t.current_location),{characterSheetList:n,loadedHistory:r,latestSuggestions:o}})}ngOnDestroy(){this.bgm.stop()}onSelectPane(e){this.updateTopExpandedHeight(),this.currentRightPaneKey=e}onResizerMouseDown(e){e.preventDefault(),this.dragging=!0,this.containerRef.nativeElement.classList.add("resizing")}onWindowMouseUp(e){this.dragging&&(this.dragging=!1,this.containerRef.nativeElement.classList.remove("resizing"))}onWindowMouseMove(e){if(!this.dragging)return;let n=this.containerRef.nativeElement.getBoundingClientRect(),o=this.resizerRef?.nativeElement.getBoundingClientRect()?.width??10,a=(e.clientX-n.left-o/2)/n.width*100;this.leftWidthPercent=this.clamp(a,this.minLeftPercent,this.maxLeftPercent)}onWindowResize(){this.updateTopExpandedHeight()}updateTopExpandedHeight(){let e=this.topContentRef?.nativeElement;if(!e)return;let t=e.scrollHeight;t>0&&e.style.setProperty("--top-expanded-height",`${t}px`)}clamp(e,t,n){return Math.max(t,Math.min(n,e))}static \u0275fac=function(t){return new(t||i)(se(Wt),se(Wi),se(gs))};static \u0275cmp=Pe({type:i,selectors:[["app-gameplay-page"]],viewQuery:function(t,n){if(t&1&&(At(hH,7),At(pH,7),At(fH,7),At(mH,7),At(Xu,5),At(Ku,5),At(Qu,5),At(aa,5),At(sc,5)),t&2){let r;Rt(r=Pt())&&(n.containerRef=r.first),Rt(r=Pt())&&(n.resizerRef=r.first),Rt(r=Pt())&&(n.rightPane=r.first),Rt(r=Pt())&&(n.topContentRef=r.first),Rt(r=Pt())&&(n.chatComponent=r.first),Rt(r=Pt())&&(n.characterSheetComponent=r.first),Rt(r=Pt())&&(n.menuPaneComponent=r.first),Rt(r=Pt())&&(n.settingsComponent=r.first),Rt(r=Pt())&&(n.diceRoller=r.first)}},hostBindings:function(t,n){t&1&&Y("mouseup",function(o){return n.onWindowMouseUp(o)},Zs)("mousemove",function(o){return n.onWindowMouseMove(o)},Zs)("resize",function(){return n.onWindowResize()},Zs)},decls:30,vars:22,consts:[["container",""],["resizer",""],["rightPane",""],["topContent",""],[1,"gameplay-page"],[1,"pane","chat-pane"],[3,"isInCombat","combinedEntities","turnNumber",4,"ngIf"],["role","separator","aria-orientation","vertical","tabindex","0",1,"resizer",3,"mousedown"],[1,"pane","right-pane"],[1,"right-adaptive-spacer"],[1,"right-top-content"],[1,"right-middle"],[1,"inventory-section"],[1,"actions-section"],[1,"settings-section"],[1,"maps-section"],[1,"journals-section"],[2,"padding","1rem","color","#666"],[1,"right-bottom-fixed"],[3,"selectPane","currentPane"],[3,"isInCombat","combinedEntities","turnNumber"]],template:function(t,n){if(t&1){let r=Qe();C(0,"div",4,0)(2,"div",5),nt(3,vH,4,10,"app-combat-pane",6),sn(4,"async"),Te(5,"app-chat-component"),E(),C(6,"div",7,1),Y("mousedown",function(s){return ve(r),ye(n.onResizerMouseDown(s))}),E(),C(8,"div",8,2)(10,"div",9)(11,"div",10,3),Te(13,"app-character-card"),E(),C(14,"div",11)(15,"section"),Te(16,"app-character-pane"),E(),C(17,"section",12),Te(18,"app-inventory-pane"),E(),C(19,"section",13),Te(20,"app-actions-pane"),E(),C(21,"section",14),Te(22,"app-settings-pane"),E(),C(23,"section",15),Te(24,"app-map-pane"),E(),C(25,"section",16),Te(26,"app-journals-pane"),E(),Te(27,"div",17),E()(),C(28,"div",18)(29,"app-menu-pane",19),Y("selectPane",function(s){return ve(r),ye(n.onSelectPane(s))}),E()()()()}t&2&&(P(2),gt("flex","0 0 "+n.leftWidthPercent+"%"),P(),ae("ngIf",Hn(4,20,n.sessionManager.isInCombat$)),P(8),Ze("collapsed",n.currentRightPaneKey==="settings"),P(4),gt("display",n.currentRightPaneKey==="character"?"block":"none"),P(2),gt("display",n.currentRightPaneKey==="inventory"?"flex":"none"),P(2),gt("display",n.currentRightPaneKey==="actions"?"block":"none"),P(2),gt("display",n.currentRightPaneKey==="settings"?"block":"none"),P(2),gt("display",n.currentRightPaneKey==="maps"?"flex":"none"),P(2),gt("display",n.currentRightPaneKey==="journals"?"block":"none"),P(2),gt("display",n.currentRightPaneKey==="character"||n.currentRightPaneKey==="settings"||n.currentRightPaneKey==="inventory"||n.currentRightPaneKey==="maps"?"none":"block"),P(2),ae("currentPane",n.currentRightPaneKey))},dependencies:[ke,_n,Xu,Ku,Qu,aa,Lm,Fm,Vm,Bm,zm,jm,su],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%}.gameplay-page[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;position:relative}.pane[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box;justify-content:space-between}.pane-inner[_ngcontent-%COMP%]{padding:2rem;height:100%;box-sizing:border-box}.chat-pane[_ngcontent-%COMP%]{position:relative;overflow:auto;border:none}.right-pane[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;min-height:0}.right-top-content[_ngcontent-%COMP%]{flex:0 0 auto;border-bottom:4px solid #444;overflow:hidden;transition:max-height .45s ease-in-out,padding .25s ease-in-out,margin .45s ease-in-out;height:25%;max-height:var(--top-expanded-height, 1000px)}.right-top-content.collapsed[_ngcontent-%COMP%]{max-height:0}.right-middle[_ngcontent-%COMP%]{flex:1 1 auto;overflow:auto;min-height:0}.right-adaptive-spacer[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:90%}.right-bottom-fixed[_ngcontent-%COMP%]{display:flex;height:5rem;border-top:1px solid #e5e5e5;justify-content:flex-end;overflow:hidden}.inventory-section[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}.inventory-section[_ngcontent-%COMP%]   app-inventory-pane[_ngcontent-%COMP%]{flex:1 1 auto}.maps-section[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}.maps-section[_ngcontent-%COMP%]   app-map-pane[_ngcontent-%COMP%]{flex:1 1 auto}.settings-section[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}.journals-section[_ngcontent-%COMP%]{height:100%;width:100%;display:block}.resizer[_ngcontent-%COMP%]:hover, .resizer[_ngcontent-%COMP%]:focus{background-color:#444;outline:none}"]})};var LI=[{path:"",component:Tf},{path:"session/:userId/:sessionId",component:Um}];function yH(){let i=oe(Dn);return()=>i.preloadAll()}function _H(){let i=oe(Bt);return()=>{if(typeof window>"u")return;let e=null;try{e=window.localStorage?.getItem(Nl)??null}catch{e=null}if(!e)return;let t=e.trim().replace(/[^0-9.]/g,"");t&&i?.documentElement?.style?.setProperty("--global-font-size-text",`${t}%`)}}var FI={providers:[vv(),ry({eventCoalescing:!0}),p_(LI),Uy(),{provide:Zc,useFactory:yH,multi:!0},{provide:Zc,useFactory:_H,multi:!0}]};function bH(i,e){if(i&1&&(C(0,"div",7)(1,"h3",8),A(2),E()()),i&2){let t=ie().ngIf;P(2),Le(t.title)}}function wH(i,e){if(i&1){let t=Qe();C(0,"div",9)(1,"button",10),Y("click",function(){ve(t);let r=ie(2);return ye(r.modal.confirmCurrent())}),A(2),E()()}if(i&2){let t=ie().ngIf;P(2),Le(t.confirmText||"OK")}}function xH(i,e){if(i&1){let t=Qe();C(0,"div",9)(1,"button",11),Y("click",function(){ve(t);let r=ie(2);return ye(r.modal.confirmCurrent())}),A(2),E(),C(3,"button",11),Y("click",function(){ve(t);let r=ie(2);return ye(r.modal.cancelCurrent())}),A(4),E()()}if(i&2){let t=ie().ngIf;P(2),Le(t.confirmText||"OK"),P(2),Le(t.cancelText||"Cancel")}}function SH(i,e){if(i&1&&(Ci(0),C(1,"div",1)(2,"div",2),nt(3,bH,3,1,"div",3),C(4,"div",4)(5,"p",5),A(6),E()(),nt(7,wH,3,1,"div",6)(8,xH,5,2,"div",6),E()(),Ei()),i&2){let t=e.ngIf;P(3),ae("ngIf",t.title),P(3),Le(t.message),P(),ae("ngIf",t.kind==="alert"),P(),ae("ngIf",t.kind==="confirm")}}var Hm=class i{modal=oe(Wr);static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Pe({type:i,selectors:[["app-modal-host"]],decls:2,vars:3,consts:[[4,"ngIf"],[1,"modal-overlay"],[1,"modal"],["class","modal-header",4,"ngIf"],[1,"modal-body"],[1,"message"],["class","modal-actions",4,"ngIf"],[1,"modal-header"],[1,"title"],[1,"modal-actions"],["type","button",1,"btn","primary",3,"click"],["clickableDivWithSound","button",1,"btn",3,"click"]],template:function(t,n){t&1&&(nt(0,SH,9,4,"ng-container",0),sn(1,"async")),t&2&&ae("ngIf",Hn(1,1,n.modal.state$))},dependencies:[ke,_n,Gt,su],styles:["[_nghost-%COMP%]{width:100%;height:100%}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal[_ngcontent-%COMP%]{font-family:Geo,sans-serif;width:25rem;height:15rem;background:#1f1f23;color:#f1f1f1;border:1px solid #3a3a3a;border-radius:8px;display:flex;flex-direction:column;box-shadow:0 8px 32px #0009}.modal-header[_ngcontent-%COMP%]{padding:.75rem 1rem 0}.title[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.modal-body[_ngcontent-%COMP%]{flex:1;padding:0 1rem;display:flex;align-items:center}.message[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap}.modal-actions[_ngcontent-%COMP%]{padding:.75rem 1rem 1rem;display:flex;justify-content:flex-end;gap:.5rem}"]})};function CH(i,e){if(i&1&&(C(0,"div",10),A(1),E()),i&2){let t=ie(2);P(),rt(" Total Bonus ",t.promptMod>=0?"+"+t.promptMod:t.promptMod," ")}}function EH(i,e){if(i&1&&(C(0,"div",11),A(1),E()),i&2){let t=ie(2);P(),rt(" DC: ",t.dc)}}function MH(i,e){if(i&1&&(C(0,"div",12),A(1),E()),i&2){let t=ie(2);Ze("show",t.showRollBreakdown),P(),up(" ",t.lastRawResult," ",t.breakdownOperator," ",t.absLastMod," = ",(t.lastRawResult??0)+(t.lastMod??0)," ")}}function DH(i,e){i&1&&(C(0,"div",13),A(1,"Click to roll"),E())}function IH(i,e){if(i&1&&(C(0,"div",14)(1,"div",15),A(2),E(),C(3,"div",16),A(4,"Continue"),E()()),i&2){let t=ie(2);Ze("show",t.phase===t.TrayState.SHOWING_BREAKDOWN||t.phase===t.TrayState.WAIT_CONTINUE),P(),Ze("success",t.isSuccess)("failure",!t.isSuccess)("show",t.showOutcome&&t.dc!==null),P(),rt(" ",t.isSuccess?"SUCCESS":"FAILURE"," "),P(),Ze("show",t.showContinue)}}function TH(i,e){if(i&1){let t=Qe();C(0,"div",1),Y("click",function(){ve(t);let r=ie();return ye(r.onOverlayClick())}),C(1,"div",2)(2,"div",3)(3,"div",4),A(4),E(),nt(5,CH,2,1,"div",5)(6,EH,2,1,"div",6)(7,MH,2,6,"div",7),E(),nt(8,DH,2,0,"div",8)(9,IH,5,11,"div",9),E()()}if(i&2){let t=ie();Ze("visible",t.overlayVisible)("hide-pointer",t.phase!==t.TrayState.PROMPT),P(4),rt(" ",t.currentCheckType," "),P(),ae("ngIf",t.promptMod!==null),P(),ae("ngIf",t.dc!==null),P(),ae("ngIf",t.phase===t.TrayState.SHOWING_BREAKDOWN||t.phase===t.TrayState.WAIT_CONTINUE),P(),ae("ngIf",t.phase===t.TrayState.PROMPT),P(),ae("ngIf",t.phase===t.TrayState.SHOWING_BREAKDOWN||t.phase===t.TrayState.WAIT_CONTINUE)}}var VI=(r=>(r.PROMPT="PROMPT",r.ROLLING="ROLLING",r.SHOWING_BREAKDOWN="SHOWING_BREAKDOWN",r.WAIT_CONTINUE="WAIT_CONTINUE",r))(VI||{}),Gm=class i{constructor(e,t,n){this.mediator=e;this.sound=t;this.characterSheetService=n;this.mediator.getRequests().subscribe(s=>_e(this,[s],function*({request:r,respond:o}){if(r.type==="diceTray.rollDice"){let a=r.payload;this.currentCheckType=a?.checkType??null,this.dc=a?.dc??null,this.expression=r.payload?.expression,this.pendingRespond=o,this.openPrompt(),this.prefetchModifier(),this.sound.preloadAll().catch(()=>{})}}))}active=!1;phase="PROMPT";TrayState=VI;dc=null;isSuccess=!1;overlayVisible=!1;showRollBreakdown=!1;showOutcome=!1;showContinue=!1;expression=null;pendingRespond=null;currentCheckType=null;promptMod=null;prefetchModifier(){return _e(this,null,function*(){if(!this.currentCheckType){this.promptMod=null;return}let e=this.characterSheetService.getCharacterSheet().getModifierFromCheckableDiceRoll(this.currentCheckType);this.promptMod=Number(e??0)})}openPrompt(){this.active=!0,this.phase="PROMPT",this.mediator.sendRequest("setDiceVisible",{visible:!1}),this.overlayVisible=!1,setTimeout(()=>this.overlayVisible=!0,20)}lastRawResult=null;lastMod=null;get breakdownOperator(){return(this.lastMod??0)<0?"-":"+"}get absLastMod(){return Math.abs(this.lastMod??0)}onOverlayClick(){return _e(this,null,function*(){if(!this.active)return;if(this.phase==="WAIT_CONTINUE"){this.onContinue(new MouseEvent("click"));return}if(this.phase!=="PROMPT")return;this.phase="ROLLING";let e=0;if(this.currentCheckType)if(this.promptMod!==null)e=this.promptMod;else{let r=this.characterSheetService.getCharacterSheet().getModifierFromCheckableDiceRoll(this.currentCheckType);this.promptMod=Number(r??0)}this.mediator.sendRequest("diceRoller.setDiceVisible",{visible:!0});let t=yield this.mediator.sendRequest("diceRoller.rollDice",{expression:this.expression});console.log("DiceTrayComponent received roll response:",t);let n=t.total+e;this.isSuccess=this.dc!=null?n>=this.dc:!1,this.phase="SHOWING_BREAKDOWN",this.lastRawResult=t.total,this.lastMod=e,this.dc!==null?this.isSuccess?this.sound.playDiceSuccessSound():this.sound.playDiceFailureSound():this.sound.playDiceNoDcSound(),this.showRollBreakdown=!1,this.showOutcome=!1,this.showContinue=!1,setTimeout(()=>{this.showRollBreakdown=!0},0),setTimeout(()=>{this.showOutcome=!0},600),setTimeout(()=>{this.showContinue=!0,this.phase="WAIT_CONTINUE"},1500)})}onContinue(e){if(this.phase==="WAIT_CONTINUE"){if(this.mediator.sendRequest("diceRoller.setDiceVisible",{visible:!1}),this.mediator.sendRequest("diceRoller.clearDice",{}),this.pendingRespond){let t={rawResult:this.lastRawResult??0,mod:this.lastMod??0,total:(this.lastRawResult??0)+(this.lastMod??0),expression:this.expression??""};this.pendingRespond(t),this.pendingRespond=null}this.active=!1,this.phase="PROMPT",this.dc=null,this.currentCheckType=null,this.lastRawResult=null,this.lastMod=null,this.overlayVisible=!1,this.showRollBreakdown=!1,this.showOutcome=!1,this.showContinue=!1,this.promptMod=null}}onKeydown(e){this.active&&(e.key==="Enter"&&this.phase==="PROMPT"&&(e.preventDefault(),this.onOverlayClick()),e.key==="Enter"&&this.phase==="WAIT_CONTINUE"&&(e.preventDefault(),this.onContinue(new MouseEvent("click"))))}static \u0275fac=function(t){return new(t||i)(se(qn),se(Dn),se(Wt))};static \u0275cmp=Pe({type:i,selectors:[["app-dice-tray"]],hostBindings:function(t,n){t&1&&Y("keydown",function(o){return n.onKeydown(o)},Si)},decls:1,vars:1,consts:[["class","dice-tray-overlay",3,"visible","hide-pointer","click",4,"ngIf"],[1,"dice-tray-overlay",3,"click"],[1,"content-wrap"],[1,"top-info"],[1,"check-type-line"],["class","prompt-bonus",4,"ngIf"],["class","dc-line",4,"ngIf"],["class","roll-breakdown",3,"show",4,"ngIf"],["class","prompt",4,"ngIf"],["class","result",3,"show",4,"ngIf"],[1,"prompt-bonus"],[1,"dc-line"],[1,"roll-breakdown"],[1,"prompt"],[1,"result"],[1,"result-text","fade-step"],[1,"continue","fade-step"]],template:function(t,n){t&1&&nt(0,TH,10,10,"div",0),t&2&&ae("ngIf",n.active)},dependencies:[ke,_n],styles:[".dice-tray-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;z-index:2;display:flex;align-items:center;justify-content:center;color:#fff;-webkit-user-select:none;user-select:none;opacity:0;transition:opacity .3s ease}.dice-tray-overlay.visible[_ngcontent-%COMP%]{opacity:1}.content-wrap[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px}.top-info[_ngcontent-%COMP%]{gap:1rem;position:absolute;top:10%;left:50%;transform:translate(-50%);display:flex;flex-direction:column;align-items:center}.check-type-line[_ngcontent-%COMP%]{font-size:24px;font-weight:600;letter-spacing:1px;text-shadow:0 2px 6px rgba(0,0,0,.6)}.dc-line[_ngcontent-%COMP%]{font-size:48px;font-weight:800;letter-spacing:2px;text-shadow:0 2px 6px rgba(0,0,0,.6);position:absolute;top:10%;left:50%;transform:translate(-50%)}.top-info[_ngcontent-%COMP%]   .dc-line[_ngcontent-%COMP%]{position:static;top:auto;left:auto;transform:none}.prompt[_ngcontent-%COMP%]{font-size:36px;font-style:italic;color:#d4af37;text-shadow:0 2px 6px rgba(0,0,0,.6)}.prompt-bonus[_ngcontent-%COMP%]{margin-top:8px;font-size:24px;font-size:1.5rem;text-shadow:0 2px 6px rgba(0,0,0,.6)}.result[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;opacity:0;transform-origin:center;transition:opacity .5s ease,transform .5s ease}.result.show[_ngcontent-%COMP%]{opacity:1;transform:translate(-50%,calc(-50% - 12px))}.roll-breakdown[_ngcontent-%COMP%], .fade-step[_ngcontent-%COMP%]{opacity:0;transform:translateY(8px);transition:opacity .4s ease,transform .4s ease;font-size:1.5rem;text-shadow:0 2px 6px rgba(0,0,0,.6);margin-bottom:12px}.roll-breakdown.show[_ngcontent-%COMP%], .fade-step.show[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}.result-text[_ngcontent-%COMP%]{font-size:40px;font-weight:900;letter-spacing:3px;text-shadow:0 2px 6px rgba(0,0,0,.6);margin-bottom:16px}.result-text.success[_ngcontent-%COMP%]{color:#6cff86}.result-text.failure[_ngcontent-%COMP%]{color:#ff6c6c}.continue[_ngcontent-%COMP%]{font-size:28px;font-style:italic;color:#d4af37;text-shadow:0 2px 6px rgba(0,0,0,.6);pointer-events:none}.continue.show[_ngcontent-%COMP%], .hide-pointer[_ngcontent-%COMP%]{pointer-events:auto}"]})};var AH=["overlayCanvas"],qm=class i{constructor(e,t){this.host=e;this.mediator=t}canvasRef;active=!1;startClient;cursorClient;rafId;activeTeardown=[];lifetimeUnsubs=[];ngOnInit(){let e=this.mediator.on("targeting.begin").subscribe(n=>{this.startClient=n.start,this.cursorClient=ne({},n.start),this.active=!0,this.resizeCanvas(),this.queueDraw();let r=s=>{this.active&&(this.cursorClient={x:s.clientX,y:s.clientY},this.queueDraw())};window.addEventListener("mousemove",r),this.activeTeardown.push(()=>window.removeEventListener("mousemove",r));let o=()=>{this.active&&(this.resizeCanvas(),this.queueDraw())};window.addEventListener("resize",o),this.activeTeardown.push(()=>window.removeEventListener("resize",o))}),t=this.mediator.on("targeting.end").subscribe(()=>this.stop());this.lifetimeUnsubs.push(()=>e.unsubscribe()),this.lifetimeUnsubs.push(()=>t.unsubscribe())}ngOnDestroy(){this.stop();for(let e of this.lifetimeUnsubs.splice(0))try{e()}catch{}}stop(){this.active=!1,this.rafId!=null&&(cancelAnimationFrame(this.rafId),this.rafId=void 0);for(let n of this.activeTeardown.splice(0))try{n()}catch{}let e=this.canvasRef?.nativeElement?.getContext("2d"),t=this.canvasRef?.nativeElement;e&&t&&e.clearRect(0,0,t.width,t.height),this.startClient=void 0,this.cursorClient=void 0}resizeCanvas(){let e=this.canvasRef.nativeElement,t=this.host.nativeElement,n=window.devicePixelRatio||1,r=t.getBoundingClientRect(),o=Math.max(1,Math.floor(r.width*n)),s=Math.max(1,Math.floor(r.height*n));(e.width!==o||e.height!==s)&&(e.width=o,e.height=s)}queueDraw(){this.rafId==null&&(this.rafId=requestAnimationFrame(()=>{this.rafId=void 0,this.draw()}))}draw(){if(!this.active||!this.startClient||!this.cursorClient)return;let e=this.canvasRef.nativeElement,t=e.getContext("2d");if(!t)return;let n=window.devicePixelRatio||1,r=this.host.nativeElement.getBoundingClientRect(),o=(this.startClient.x-r.left)*n,s=(this.startClient.y-r.top)*n,a=(this.cursorClient.x-r.left)*n,l=(this.cursorClient.y-r.top)*n;t.clearRect(0,0,e.width,e.height),t.save(),t.lineWidth=4*n,t.strokeStyle="#ffffff",t.shadowColor="rgba(0,0,0,0.6)",t.shadowBlur=4*n,t.beginPath(),t.moveTo(o,s),t.lineTo(a,l),t.stroke(),t.restore()}static \u0275fac=function(t){return new(t||i)(se(Fn),se(qn))};static \u0275cmp=Pe({type:i,selectors:[["app-targeting-overlay"]],viewQuery:function(t,n){if(t&1&&At(AH,7),t&2){let r;Rt(r=Pt())&&(n.canvasRef=r.first)}},decls:2,vars:2,consts:[["overlayCanvas",""],[1,"overlay"]],template:function(t,n){t&1&&Lr(0,"canvas",1,0),t&2&&gt("display",n.active?"block":"none")},dependencies:[ke],styles:["[_nghost-%COMP%]{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:2000;display:block}canvas.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}"]})};var RH=["cursor"],PH=["crtScreenDiv"],NH=["AppViewport"],kH=i=>({transform:i}),Wm=class i{constructor(e,t,n){this.ngZone=e;this.cursorService=t;this.soundService=n;this.cursorService.cursorImage$.subscribe(r=>{this.cursorImage=r})}title=at("dnd_adk_frontend");cursor;crtScreenDiv;appViewport;cursorXCrtScreen=0;cursorYCrtScreen=0;cursorXGlobal=0;cursorYGlobal=0;isClicked=!1;rafId=null;cursorImage="cursors/normal_64.png";onRightClick(e){e.preventDefault()}onMouseMove(e){this.ngZone.runOutsideAngular(()=>{let t=this.cursor?.nativeElement;this.cursorXCrtScreen=e.clientX-this.crtScreenDiv.nativeElement.offsetLeft-this.appViewport.nativeElement.offsetLeft,this.cursorYCrtScreen=e.clientY-this.crtScreenDiv.nativeElement.offsetTop-this.appViewport.nativeElement.offsetTop,this.cursorService.setInsideTvScreenPosition(this.cursorXCrtScreen,this.cursorYCrtScreen),this.cursorXGlobal=e.clientX-this.crtScreenDiv.nativeElement.offsetLeft-this.appViewport.nativeElement.offsetLeft,this.cursorYGlobal=e.clientY-this.crtScreenDiv.nativeElement.offsetTop-this.appViewport.nativeElement.offsetTop,this.cursorService.setGlobalPosition(this.cursorXGlobal,this.cursorYGlobal),this.scheduleUpdate()})}onMouseDown(e){this.ngZone.runOutsideAngular(()=>{this.isClicked=!0;try{!!e.target?.closest("[clickableDivWithSound]")||(e.button===0?this.soundService.playEmptyClickSound():e.button===2&&this.soundService.playRightClickSound())}catch{}this.scheduleUpdate()})}onMouseUp(){this.ngZone.runOutsideAngular(()=>{this.isClicked=!1,this.scheduleUpdate()})}onDragOver(e){this.ngZone.runOutsideAngular(()=>{this.cursorXGlobal=e.clientX-this.crtScreenDiv.nativeElement.offsetLeft,this.cursorYGlobal=e.clientY-this.crtScreenDiv.nativeElement.offsetTop,this.cursorService.setGlobalPosition(this.cursorXGlobal,this.cursorYGlobal),this.scheduleUpdate()})}scheduleUpdate(){this.rafId===null&&(this.rafId=requestAnimationFrame(()=>{this.updateTransform(),this.rafId=null}))}updateTransform(){if(!this.cursor)return;let e=`translate(${this.cursorXGlobal}px, ${this.cursorYGlobal}px)`,t=this.isClicked?" rotate(-8deg)":"";this.cursor.nativeElement.style.transform=e+t}ngOnDestroy(){this.rafId!==null&&cancelAnimationFrame(this.rafId)}setCursorImage(e){this.cursorService.setCursor(e)}static \u0275fac=function(t){return new(t||i)(se(zt),se(fi),se(Dn))};static \u0275cmp=Pe({type:i,selectors:[["app-root"]],viewQuery:function(t,n){if(t&1&&(At(RH,5),At(PH,5),At(NH,5)),t&2){let r;Rt(r=Pt())&&(n.cursor=r.first),Rt(r=Pt())&&(n.crtScreenDiv=r.first),Rt(r=Pt())&&(n.appViewport=r.first)}},hostBindings:function(t,n){t&1&&Y("contextmenu",function(o){return n.onRightClick(o)},Si)("mousemove",function(o){return n.onMouseMove(o)},Si)("mousedown",function(o){return n.onMouseDown(o)},Si)("mouseup",function(){return n.onMouseUp()},Si)("dragover",function(o){return n.onDragOver(o)},Si)},decls:19,vars:4,consts:[["AppViewport",""],["crtScreenDiv",""],["cursor",""],["id","app-shell"],["id","app-viewport"],["src","crt_green_mask.png",1,"crt-outside-frame"],["src","dust.png",1,"dust"],["src","reflection.png",1,"reflection"],[1,"vignette"],[1,"crt-curved-screen"],["src","crt_rgb.png",1,"crt-rgb"],[1,"screen-noise"],[1,"screen-lines"],[1,"custom-cursor",3,"src","ngStyle"]],template:function(t,n){t&1&&(C(0,"div",3)(1,"div",4,0),Te(3,"img",5)(4,"img",6)(5,"img",7)(6,"div",8),C(7,"div",9,1),Te(9,"img",10)(10,"div",11)(11,"div",12)(12,"img",13,2)(14,"router-outlet")(15,"app-modal-host")(16,"app-dice-roller")(17,"app-dice-tray")(18,"app-targeting-overlay"),E()()()),t&2&&(P(12),ae("src",n.cursorImage,xi)("ngStyle",Kc(2,kH,"translate("+n.cursorXGlobal+"px,"+n.cursorYGlobal+"px)")))},dependencies:[Ru,ke,ou,Hm,sc,Gm,qm],styles:["[_nghost-%COMP%]{--tv-frame-z: 307;--dust-z: 306;--reflection-z: 305;--filter-crt-z: 304;--crt-rgb-z: 303;--filter-screen-noise-z: 302;--filter-screen-lines-z: 301;--filter-chromatic-z: 300}  img{max-width:100%;height:auto}.custom-cursor[_ngcontent-%COMP%]{position:fixed;width:64px;height:64px;pointer-events:none;z-index:10000;will-change:transform;transform-origin:10px 10px;filter:drop-shadow(2px 2px 4px #222)}.crt-outside-frame[_ngcontent-%COMP%]{position:fixed;z-index:var(--tv-frame-z);pointer-events:none;width:100%;height:100%;visibility:var(--monitor-frame)}.reflection[_ngcontent-%COMP%]{position:fixed;z-index:var(--dust-z);pointer-events:none;width:100%;height:100%;opacity:.3;mix-blend-mode:screen}.dust[_ngcontent-%COMP%]{position:fixed;z-index:var(--dust-z);pointer-events:none;width:100%;height:100%;opacity:.3;filter:drop-shadow(3px 4px 0px rgba(0,0,0,.897))}.vignette[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;pointer-events:none;z-index:var(--filter-crt-z);background:radial-gradient(ellipse at center,#0000 78%,#0009)}.crt-curved-screen[_ngcontent-%COMP%]{position:fixed;contain:paint;will-change:transform;backface-visibility:hidden;transform:translateZ(0);filter:var(--filter-crt-curve, url(#CRTCurve)) var(--filter-vhs-chroma, url(#VHSChromaSmear)) var(--filter-color-grading, url(#ColorGrading));width:var(--crt-width, 92.5%);height:var(--crt-height, 91%);left:var(--crt-left, 2.5%);top:var(--crt-top, 5%);z-index:var(--filter-chromatic-z);pointer-events:none;touch-action:none}.crt-rgb[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;z-index:var(--crt-rgb-z);pointer-events:none;mix-blend-mode:screen;opacity:1}.screen-lines[_ngcontent-%COMP%]{position:fixed;filter:var(--filter-screen-lines, url(#screenLines));animation:_ngcontent-%COMP%_screenNoise .1s steps(5) infinite;width:300%;height:300%;left:-50%;top:-110%;z-index:var(--filter-screen-lines-z);pointer-events:none;opacity:.6}.screen-noise[_ngcontent-%COMP%]{position:fixed;animation:_ngcontent-%COMP%_screenNoise 2s steps(10) infinite;filter:var(--filter-screen-noise, url(#ScreenNoiseFilter));width:300%;height:300%;left:-50%;top:-110%;z-index:var(--filter-screen-noise-z);opacity:.7;pointer-events:none}@keyframes _ngcontent-%COMP%_screenNoise{0%,to{transform:translate(0)}10%{transform:translate(-5%,-10%)}20%{transform:translate(-15%,5%)}30%{transform:translate(7%,-25%)}40%{transform:translate(-5%,25%)}50%{transform:translate(-15%,10%)}60%{transform:translate(15%)}70%{transform:translateY(15%)}80%{transform:translate(3%,35%)}90%{transform:translate(-10%,10%)}}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{overflow:hidden}#app-shell[_ngcontent-%COMP%]{position:fixed;inset:0;display:grid;place-items:center;background:#000}#app-viewport[_ngcontent-%COMP%]{width:var(--viewport-width, min(100vw, (100vh * 4) / 3) );height:var(--viewport-height, min(100vh, (100vw * 3) / 4) );aspect-ratio:var(--viewport-aspect, 4 / 3);overflow:hidden;transform:translateZ(0)}app-root[_ngcontent-%COMP%]{display:block;width:100%;height:100%}.vignette[_ngcontent-%COMP%]{display:var(--vignette-display, block)}.dust[_ngcontent-%COMP%]{display:var(--dust-display, block)}.reflection[_ngcontent-%COMP%]{display:var(--reflection-display, block)}"]})};By(Wm,FI).catch(i=>console.error(i));
